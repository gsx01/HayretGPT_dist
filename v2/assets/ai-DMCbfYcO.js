function e(e,t,n,r,i){if(r===`m`)throw TypeError(`Private method is not writable`);if(r===`a`&&!i)throw TypeError(`Private accessor was defined without a setter`);if(typeof t==`function`?e!==t||!i:!t.has(e))throw TypeError(`Cannot write private member to an object whose class did not declare it`);return r===`a`?i.call(e,n):i?i.value=n:t.set(e,n),n}function t(e,t,n,r){if(n===`a`&&!r)throw TypeError(`Private accessor was defined without a getter`);if(typeof t==`function`?e!==t||!r:!t.has(e))throw TypeError(`Cannot read private member from an object whose class did not declare it`);return n===`m`?r:n===`a`?r.call(e):r?r.value:t.get(e)}let n=function(){let{crypto:e}=globalThis;if(e?.randomUUID)return n=e.randomUUID.bind(e),e.randomUUID();let t=new Uint8Array(1),r=e?()=>e.getRandomValues(t)[0]:()=>Math.random()*255&255;return`10000000-1000-4000-8000-100000000000`.replace(/[018]/g,e=>(e^r()&15>>e/4).toString(16))};function r(e){return typeof e==`object`&&!!e&&(`name`in e&&e.name===`AbortError`||`message`in e&&String(e.message).includes(`FetchRequestCanceledException`))}const i=e=>{if(e instanceof Error)return e;if(typeof e==`object`&&e){try{if(Object.prototype.toString.call(e)===`[object Error]`){let t=Error(e.message,e.cause?{cause:e.cause}:{});return e.stack&&(t.stack=e.stack),e.cause&&!t.cause&&(t.cause=e.cause),e.name&&(t.name=e.name),t}}catch{}try{return Error(JSON.stringify(e))}catch{}}return Error(e)};var a=class extends Error{},o=class e extends a{constructor(t,n,r,i){super(`${e.makeMessage(t,n,r)}`),this.status=t,this.headers=i,this.requestID=i?.get(`x-request-id`),this.error=n;let a=n;this.code=a?.code,this.param=a?.param,this.type=a?.type}static makeMessage(e,t,n){let r=t?.message?typeof t.message==`string`?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&r?`${e} ${r}`:e?`${e} status code (no body)`:r||`(no status code or body)`}static generate(t,n,r,a){if(!t||!a)return new c({message:r,cause:i(n)});let o=n?.error;return t===400?new u(t,o,r,a):t===401?new d(t,o,r,a):t===403?new f(t,o,r,a):t===404?new p(t,o,r,a):t===409?new m(t,o,r,a):t===422?new h(t,o,r,a):t===429?new g(t,o,r,a):t>=500?new _(t,o,r,a):new e(t,o,r,a)}},s=class extends o{constructor({message:e}={}){super(void 0,void 0,e||`Request was aborted.`,void 0)}},c=class extends o{constructor({message:e,cause:t}){super(void 0,void 0,e||`Connection error.`,void 0),t&&(this.cause=t)}},l=class extends c{constructor({message:e}={}){super({message:e??`Request timed out.`})}},u=class extends o{},d=class extends o{},f=class extends o{},p=class extends o{},m=class extends o{},h=class extends o{},g=class extends o{},_=class extends o{},v=class extends a{constructor(){super(`Could not parse response content as the length limit was reached`)}},y=class extends a{constructor(){super(`Could not parse response content as the request was rejected by the content filter`)}},b=class extends Error{constructor(e){super(e)}},x=/^[a-z][a-z0-9+.-]*:/i;const S=e=>x.test(e);let C=e=>(C=Array.isArray,C(e)),w=C;function T(e){return typeof e==`object`?e??{}:{}}function E(e){if(!e)return!0;for(let t in e)return!1;return!0}function ee(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function te(e){return typeof e==`object`&&!!e&&!Array.isArray(e)}const ne=(e,t)=>{if(typeof t!=`number`||!Number.isInteger(t))throw new a(`${e} must be an integer`);if(t<0)throw new a(`${e} must be a positive integer`);return t},re=e=>{try{return JSON.parse(e)}catch{return}},ie=e=>new Promise(t=>setTimeout(t,e)),ae=`6.10.0`,oe=()=>typeof window<`u`&&window.document!==void 0&&typeof navigator<`u`;function se(){return typeof Deno<`u`&&Deno.build!=null?`deno`:typeof EdgeRuntime<`u`?`edge`:Object.prototype.toString.call(globalThis.process===void 0?0:globalThis.process)===`[object process]`?`node`:`unknown`}var ce=()=>{let e=se();if(e===`deno`)return{"X-Stainless-Lang":`js`,"X-Stainless-Package-Version":ae,"X-Stainless-OS":de(Deno.build.os),"X-Stainless-Arch":ue(Deno.build.arch),"X-Stainless-Runtime":`deno`,"X-Stainless-Runtime-Version":typeof Deno.version==`string`?Deno.version:Deno.version?.deno??`unknown`};if(typeof EdgeRuntime<`u`)return{"X-Stainless-Lang":`js`,"X-Stainless-Package-Version":ae,"X-Stainless-OS":`Unknown`,"X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":`edge`,"X-Stainless-Runtime-Version":globalThis.process.version};if(e===`node`)return{"X-Stainless-Lang":`js`,"X-Stainless-Package-Version":ae,"X-Stainless-OS":de(globalThis.process.platform??`unknown`),"X-Stainless-Arch":ue(globalThis.process.arch??`unknown`),"X-Stainless-Runtime":`node`,"X-Stainless-Runtime-Version":globalThis.process.version??`unknown`};let t=le();return t?{"X-Stainless-Lang":`js`,"X-Stainless-Package-Version":ae,"X-Stainless-OS":`Unknown`,"X-Stainless-Arch":`unknown`,"X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":`js`,"X-Stainless-Package-Version":ae,"X-Stainless-OS":`Unknown`,"X-Stainless-Arch":`unknown`,"X-Stainless-Runtime":`unknown`,"X-Stainless-Runtime-Version":`unknown`}};function le(){if(typeof navigator>`u`||!navigator)return null;for(let{key:e,pattern:t}of[{key:`edge`,pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:`ie`,pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:`ie`,pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:`chrome`,pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:`firefox`,pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:`safari`,pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}]){let n=t.exec(navigator.userAgent);if(n)return{browser:e,version:`${n[1]||0}.${n[2]||0}.${n[3]||0}`}}return null}var ue=e=>e===`x32`?`x32`:e===`x86_64`||e===`x64`?`x64`:e===`arm`?`arm`:e===`aarch64`||e===`arm64`?`arm64`:e?`other:${e}`:`unknown`,de=e=>(e=e.toLowerCase(),e.includes(`ios`)?`iOS`:e===`android`?`Android`:e===`darwin`?`MacOS`:e===`win32`?`Windows`:e===`freebsd`?`FreeBSD`:e===`openbsd`?`OpenBSD`:e===`linux`?`Linux`:e?`Other:${e}`:`Unknown`),fe;const pe=()=>fe??=ce();function me(){if(typeof fetch<`u`)return fetch;throw Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function he(...e){let t=globalThis.ReadableStream;if(t===void 0)throw Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new t(...e)}function ge(e){let t=Symbol.asyncIterator in e?e[Symbol.asyncIterator]():e[Symbol.iterator]();return he({start(){},async pull(e){let{done:n,value:r}=await t.next();n?e.close():e.enqueue(r)},async cancel(){await t.return?.()}})}function _e(e){if(e[Symbol.asyncIterator])return e;let t=e.getReader();return{async next(){try{let e=await t.read();return e?.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){let e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function ve(e){if(typeof e!=`object`||!e)return;if(e[Symbol.asyncIterator]){await e[Symbol.asyncIterator]().return?.();return}let t=e.getReader(),n=t.cancel();t.releaseLock(),await n}const ye=({headers:e,body:t})=>({bodyHeaders:{"content-type":`application/json`},body:JSON.stringify(t)}),be=`RFC3986`,xe=e=>String(e),Se={RFC1738:e=>String(e).replace(/%20/g,`+`),RFC3986:xe};let Ce=(e,t)=>(Ce=Object.hasOwn??Function.prototype.call.bind(Object.prototype.hasOwnProperty),Ce(e,t));var we=(()=>{let e=[];for(let t=0;t<256;++t)e.push(`%`+((t<16?`0`:``)+t.toString(16)).toUpperCase());return e})(),Te=1024;const Ee=(e,t,n,r,i)=>{if(e.length===0)return e;let a=e;if(typeof e==`symbol`?a=Symbol.prototype.toString.call(e):typeof e!=`string`&&(a=String(e)),n===`iso-8859-1`)return escape(a).replace(/%u[0-9a-f]{4}/gi,function(e){return`%26%23`+parseInt(e.slice(2),16)+`%3B`});let o=``;for(let e=0;e<a.length;e+=Te){let t=a.length>=Te?a.slice(e,e+Te):a,n=[];for(let e=0;e<t.length;++e){let r=t.charCodeAt(e);if(r===45||r===46||r===95||r===126||r>=48&&r<=57||r>=65&&r<=90||r>=97&&r<=122||i===`RFC1738`&&(r===40||r===41)){n[n.length]=t.charAt(e);continue}if(r<128){n[n.length]=we[r];continue}if(r<2048){n[n.length]=we[192|r>>6]+we[128|r&63];continue}if(r<55296||r>=57344){n[n.length]=we[224|r>>12]+we[128|r>>6&63]+we[128|r&63];continue}e+=1,r=65536+((r&1023)<<10|t.charCodeAt(e)&1023),n[n.length]=we[240|r>>18]+we[128|r>>12&63]+we[128|r>>6&63]+we[128|r&63]}o+=n.join(``)}return o};function De(e){return!e||typeof e!=`object`?!1:!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))}function Oe(e,t){if(C(e)){let n=[];for(let r=0;r<e.length;r+=1)n.push(t(e[r]));return n}return t(e)}var ke={brackets(e){return String(e)+`[]`},comma:`comma`,indices(e,t){return String(e)+`[`+t+`]`},repeat(e){return String(e)}},Ae=function(e,t){Array.prototype.push.apply(e,C(t)?t:[t])},je,D={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:`indices`,charset:`utf-8`,charsetSentinel:!1,delimiter:`&`,encode:!0,encodeDotInKeys:!1,encoder:Ee,encodeValuesOnly:!1,format:be,formatter:xe,indices:!1,serializeDate(e){return(je??=Function.prototype.call.bind(Date.prototype.toISOString))(e)},skipNulls:!1,strictNullHandling:!1};function Me(e){return typeof e==`string`||typeof e==`number`||typeof e==`boolean`||typeof e==`symbol`||typeof e==`bigint`}var Ne={};function Pe(e,t,n,r,i,a,o,s,c,l,u,d,f,p,m,h,g,_){let v=e,y=_,b=0,x=!1;for(;(y=y.get(Ne))!==void 0&&!x;){let t=y.get(e);if(b+=1,t!==void 0){if(t===b)throw RangeError(`Cyclic object value`);x=!0}y.get(Ne)===void 0&&(b=0)}if(typeof l==`function`?v=l(t,v):v instanceof Date?v=f?.(v):n===`comma`&&C(v)&&(v=Oe(v,function(e){return e instanceof Date?f?.(e):e})),v===null){if(a)return c&&!h?c(t,D.encoder,g,`key`,p):t;v=``}if(Me(v)||De(v)){if(c){let e=h?t:c(t,D.encoder,g,`key`,p);return[m?.(e)+`=`+m?.(c(v,D.encoder,g,`value`,p))]}return[m?.(t)+`=`+m?.(String(v))]}let S=[];if(v===void 0)return S;let w;if(n===`comma`&&C(v))h&&c&&(v=Oe(v,c)),w=[{value:v.length>0?v.join(`,`)||null:void 0}];else if(C(l))w=l;else{let e=Object.keys(v);w=u?e.sort(u):e}let T=s?String(t).replace(/\./g,`%2E`):String(t),E=r&&C(v)&&v.length===1?T+`[]`:T;if(i&&C(v)&&v.length===0)return E+`[]`;for(let t=0;t<w.length;++t){let y=w[t],x=typeof y==`object`&&y.value!==void 0?y.value:v[y];if(o&&x===null)continue;let T=d&&s?y.replace(/\./g,`%2E`):y,ee=C(v)?typeof n==`function`?n(E,T):E:E+(d?`.`+T:`[`+T+`]`);_.set(e,b);let te=new WeakMap;te.set(Ne,_),Ae(S,Pe(x,ee,n,r,i,a,o,s,n===`comma`&&h&&C(v)?null:c,l,u,d,f,p,m,h,g,te))}return S}function Fe(e=D){if(e.allowEmptyArrays!==void 0&&typeof e.allowEmptyArrays!=`boolean`)throw TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(e.encodeDotInKeys!==void 0&&typeof e.encodeDotInKeys!=`boolean`)throw TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(e.encoder!==null&&e.encoder!==void 0&&typeof e.encoder!=`function`)throw TypeError(`Encoder has to be a function.`);let t=e.charset||D.charset;if(e.charset!==void 0&&e.charset!==`utf-8`&&e.charset!==`iso-8859-1`)throw TypeError(`The charset option must be either utf-8, iso-8859-1, or undefined`);let n=be;if(e.format!==void 0){if(!Ce(Se,e.format))throw TypeError(`Unknown format option provided.`);n=e.format}let r=Se[n],i=D.filter;(typeof e.filter==`function`||C(e.filter))&&(i=e.filter);let a;if(a=e.arrayFormat&&e.arrayFormat in ke?e.arrayFormat:`indices`in e?e.indices?`indices`:`repeat`:D.arrayFormat,`commaRoundTrip`in e&&typeof e.commaRoundTrip!=`boolean`)throw TypeError("`commaRoundTrip` must be a boolean, or absent");let o=e.allowDots===void 0?e.encodeDotInKeys?!0:D.allowDots:!!e.allowDots;return{addQueryPrefix:typeof e.addQueryPrefix==`boolean`?e.addQueryPrefix:D.addQueryPrefix,allowDots:o,allowEmptyArrays:typeof e.allowEmptyArrays==`boolean`?!!e.allowEmptyArrays:D.allowEmptyArrays,arrayFormat:a,charset:t,charsetSentinel:typeof e.charsetSentinel==`boolean`?e.charsetSentinel:D.charsetSentinel,commaRoundTrip:!!e.commaRoundTrip,delimiter:e.delimiter===void 0?D.delimiter:e.delimiter,encode:typeof e.encode==`boolean`?e.encode:D.encode,encodeDotInKeys:typeof e.encodeDotInKeys==`boolean`?e.encodeDotInKeys:D.encodeDotInKeys,encoder:typeof e.encoder==`function`?e.encoder:D.encoder,encodeValuesOnly:typeof e.encodeValuesOnly==`boolean`?e.encodeValuesOnly:D.encodeValuesOnly,filter:i,format:n,formatter:r,serializeDate:typeof e.serializeDate==`function`?e.serializeDate:D.serializeDate,skipNulls:typeof e.skipNulls==`boolean`?e.skipNulls:D.skipNulls,sort:typeof e.sort==`function`?e.sort:null,strictNullHandling:typeof e.strictNullHandling==`boolean`?e.strictNullHandling:D.strictNullHandling}}function Ie(e,t={}){let n=e,r=Fe(t),i,a;typeof r.filter==`function`?(a=r.filter,n=a(``,n)):C(r.filter)&&(a=r.filter,i=a);let o=[];if(typeof n!=`object`||!n)return``;let s=ke[r.arrayFormat],c=s===`comma`&&r.commaRoundTrip;i||=Object.keys(n),r.sort&&i.sort(r.sort);let l=new WeakMap;for(let e=0;e<i.length;++e){let t=i[e];r.skipNulls&&n[t]===null||Ae(o,Pe(n[t],t,s,c,r.allowEmptyArrays,r.strictNullHandling,r.skipNulls,r.encodeDotInKeys,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,l))}let u=o.join(r.delimiter),d=r.addQueryPrefix===!0?`?`:``;return r.charsetSentinel&&(r.charset===`iso-8859-1`?d+=`utf8=%26%2310003%3B&`:d+=`utf8=%E2%9C%93&`),u.length>0?d+u:``}function Le(e){let t=0;for(let n of e)t+=n.length;let n=new Uint8Array(t),r=0;for(let t of e)n.set(t,r),r+=t.length;return n}var Re;function ze(e){let t;return(Re??=(t=new globalThis.TextEncoder,t.encode.bind(t)))(e)}var Be;function Ve(e){let t;return(Be??=(t=new globalThis.TextDecoder,t.decode.bind(t)))(e)}var He,Ue,We=class{constructor(){He.set(this,void 0),Ue.set(this,void 0),e(this,He,new Uint8Array,`f`),e(this,Ue,null,`f`)}decode(n){if(n==null)return[];let r=n instanceof ArrayBuffer?new Uint8Array(n):typeof n==`string`?ze(n):n;e(this,He,Le([t(this,He,`f`),r]),`f`);let i=[],a;for(;(a=Ge(t(this,He,`f`),t(this,Ue,`f`)))!=null;){if(a.carriage&&t(this,Ue,`f`)==null){e(this,Ue,a.index,`f`);continue}if(t(this,Ue,`f`)!=null&&(a.index!==t(this,Ue,`f`)+1||a.carriage)){i.push(Ve(t(this,He,`f`).subarray(0,t(this,Ue,`f`)-1))),e(this,He,t(this,He,`f`).subarray(t(this,Ue,`f`)),`f`),e(this,Ue,null,`f`);continue}let n=t(this,Ue,`f`)===null?a.preceding:a.preceding-1,r=Ve(t(this,He,`f`).subarray(0,n));i.push(r),e(this,He,t(this,He,`f`).subarray(a.index),`f`),e(this,Ue,null,`f`)}return i}flush(){return t(this,He,`f`).length?this.decode(`
`):[]}};He=new WeakMap,Ue=new WeakMap,We.NEWLINE_CHARS=new Set([`
`,`\r`]),We.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function Ge(e,t){for(let n=t??0;n<e.length;n++){if(e[n]===10)return{preceding:n,index:n+1,carriage:!1};if(e[n]===13)return{preceding:n,index:n+1,carriage:!0}}return null}function Ke(e){for(let t=0;t<e.length-1;t++){if(e[t]===10&&e[t+1]===10||e[t]===13&&e[t+1]===13)return t+2;if(e[t]===13&&e[t+1]===10&&t+3<e.length&&e[t+2]===13&&e[t+3]===10)return t+4}return-1}var qe={off:0,error:200,warn:300,info:400,debug:500};const Je=(e,t,n)=>{if(e){if(ee(qe,e))return e;O(n).warn(`${t} was set to ${JSON.stringify(e)}, expected one of ${JSON.stringify(Object.keys(qe))}`)}};function Ye(){}function Xe(e,t,n){return!t||qe[e]>qe[n]?Ye:t[e].bind(t)}var Ze={error:Ye,warn:Ye,info:Ye,debug:Ye},Qe=new WeakMap;function O(e){let t=e.logger,n=e.logLevel??`off`;if(!t)return Ze;let r=Qe.get(t);if(r&&r[0]===n)return r[1];let i={error:Xe(`error`,t,n),warn:Xe(`warn`,t,n),info:Xe(`info`,t,n),debug:Xe(`debug`,t,n)};return Qe.set(t,[n,i]),i}const $e=e=>(e.options&&(e.options={...e.options},delete e.options.headers),e.headers&&=Object.fromEntries((e.headers instanceof Headers?[...e.headers]:Object.entries(e.headers)).map(([e,t])=>[e,e.toLowerCase()===`authorization`||e.toLowerCase()===`cookie`||e.toLowerCase()===`set-cookie`?`***`:t])),`retryOfRequestLogID`in e&&(e.retryOfRequestLogID&&(e.retryOf=e.retryOfRequestLogID),delete e.retryOfRequestLogID),e);var et,tt=class n{constructor(t,n,r){this.iterator=t,et.set(this,void 0),this.controller=n,e(this,et,r,`f`)}static fromSSEResponse(e,t,i){let s=!1,c=i?O(i):console;async function*l(){if(s)throw new a("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let n=!1;try{for await(let r of nt(e,t))if(!n){if(r.data.startsWith(`[DONE]`)){n=!0;continue}if(r.event===null||!r.event.startsWith(`thread.`)){let t;try{t=JSON.parse(r.data)}catch(e){throw c.error(`Could not parse message into JSON:`,r.data),c.error(`From chunk:`,r.raw),e}if(t&&t.error)throw new o(void 0,t.error,void 0,e.headers);yield t}else{let e;try{e=JSON.parse(r.data)}catch(e){throw console.error(`Could not parse message into JSON:`,r.data),console.error(`From chunk:`,r.raw),e}if(r.event==`error`)throw new o(void 0,e.error,e.message,void 0);yield{event:r.event,data:e}}}n=!0}catch(e){if(r(e))return;throw e}finally{n||t.abort()}}return new n(l,t,i)}static fromReadableStream(e,t,i){let o=!1;async function*s(){let t=new We,n=_e(e);for await(let e of n)for(let n of t.decode(e))yield n;for(let e of t.flush())yield e}async function*c(){if(o)throw new a("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");o=!0;let e=!1;try{for await(let t of s())e||t&&(yield JSON.parse(t));e=!0}catch(e){if(r(e))return;throw e}finally{e||t.abort()}}return new n(c,t,i)}[(et=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){let e=[],r=[],i=this.iterator(),a=t=>({next:()=>{if(t.length===0){let t=i.next();e.push(t),r.push(t)}return t.shift()}});return[new n(()=>a(e),this.controller,t(this,et,`f`)),new n(()=>a(r),this.controller,t(this,et,`f`))]}toReadableStream(){let e=this,t;return he({async start(){t=e[Symbol.asyncIterator]()},async pull(e){try{let{value:n,done:r}=await t.next();if(r)return e.close();let i=ze(JSON.stringify(n)+`
`);e.enqueue(i)}catch(t){e.error(t)}},async cancel(){await t.return?.()}})}};async function*nt(e,t){if(!e.body)throw t.abort(),globalThis.navigator!==void 0&&globalThis.navigator.product===`ReactNative`?new a(`The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api`):new a(`Attempted to iterate over a response with no body`);let n=new it,r=new We,i=_e(e.body);for await(let e of rt(i))for(let t of r.decode(e)){let e=n.decode(t);e&&(yield e)}for(let e of r.flush()){let t=n.decode(e);t&&(yield t)}}async function*rt(e){let t=new Uint8Array;for await(let n of e){if(n==null)continue;let e=n instanceof ArrayBuffer?new Uint8Array(n):typeof n==`string`?ze(n):n,r=new Uint8Array(t.length+e.length);r.set(t),r.set(e,t.length),t=r;let i;for(;(i=Ke(t))!==-1;)yield t.slice(0,i),t=t.slice(i)}t.length>0&&(yield t)}var it=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith(`\r`)&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let e={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(`:`))return null;let[t,n,r]=at(e,`:`);return r.startsWith(` `)&&(r=r.substring(1)),t===`event`?this.event=r:t===`data`&&this.data.push(r),null}};function at(e,t){let n=e.indexOf(t);return n===-1?[e,``,``]:[e.substring(0,n),t,e.substring(n+t.length)]}async function ot(e,t){let{response:n,requestLogID:r,retryOfRequestLogID:i,startTime:a}=t,o=await(async()=>{if(t.options.stream)return O(e).debug(`response`,n.status,n.url,n.headers,n.body),t.options.__streamClass?t.options.__streamClass.fromSSEResponse(n,t.controller,e):tt.fromSSEResponse(n,t.controller,e);if(n.status===204)return null;if(t.options.__binaryResponse)return n;let r=n.headers.get(`content-type`)?.split(`;`)[0]?.trim();return r?.includes(`application/json`)||r?.endsWith(`+json`)?st(await n.json(),n):await n.text()})();return O(e).debug(`[${r}] response parsed`,$e({retryOfRequestLogID:i,url:n.url,status:n.status,body:o,durationMs:Date.now()-a})),o}function st(e,t){return!e||typeof e!=`object`||Array.isArray(e)?e:Object.defineProperty(e,`_request_id`,{value:t.headers.get(`x-request-id`),enumerable:!1})}var ct,lt=class n extends Promise{constructor(t,n,r=ot){super(e=>{e(null)}),this.responsePromise=n,this.parseResponse=r,ct.set(this,void 0),e(this,ct,t,`f`)}_thenUnwrap(e){return new n(t(this,ct,`f`),this.responsePromise,async(t,n)=>st(e(await this.parseResponse(t,n),n),n.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get(`x-request-id`)}}parse(){return this.parsedPromise||=this.responsePromise.then(e=>this.parseResponse(t(this,ct,`f`),e)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}};ct=new WeakMap;var ut,dt=class{constructor(t,n,r,i){ut.set(this,void 0),e(this,ut,t,`f`),this.options=i,this.response=n,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageRequestOptions()!=null:!1}async getNextPage(){let e=this.nextPageRequestOptions();if(!e)throw new a("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await t(this,ut,`f`).requestAPIList(this.constructor,e)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(ut=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}},ft=class extends lt{constructor(e,t,n){super(e,t,async(e,t)=>new n(e,t.response,await ot(e,t),t.options))}async*[Symbol.asyncIterator](){let e=await this;for await(let t of e)yield t}},pt=class extends dt{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[],this.object=n.object}getPaginatedItems(){return this.data??[]}nextPageRequestOptions(){return null}},k=class extends dt{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[],this.has_more=n.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){let e=this.getPaginatedItems(),t=e[e.length-1]?.id;return t?{...this.options,query:{...T(this.options.query),after:t}}:null}},mt=class extends dt{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[],this.has_more=n.has_more||!1,this.last_id=n.last_id||``}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){let e=this.last_id;return e?{...this.options,query:{...T(this.options.query),after:e}}:null}};const ht=()=>{if(typeof File>`u`){let{process:e}=globalThis,t=typeof e?.versions?.node==`string`&&parseInt(e.versions.node.split(`.`))<20;throw Error("`File` is not defined as a global, which is required for file uploads."+(t?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":``))}};function gt(e,t,n){return ht(),new File(e,t??`unknown_file`,n)}function _t(e){return(typeof e==`object`&&!!e&&(`name`in e&&e.name&&String(e.name)||`url`in e&&e.url&&String(e.url)||`filename`in e&&e.filename&&String(e.filename)||`path`in e&&e.path&&String(e.path))||``).split(/[\\/]/).pop()||void 0}const vt=e=>typeof e==`object`&&!!e&&typeof e[Symbol.asyncIterator]==`function`,yt=async(e,t)=>Et(e.body)?{...e,body:await Ct(e.body,t)}:e,bt=async(e,t)=>({...e,body:await Ct(e.body,t)});var xt=new WeakMap;function St(e){let t=typeof e==`function`?e:e.fetch,n=xt.get(t);if(n)return n;let r=(async()=>{try{let e=`Response`in t?t.Response:(await t(`data:,`)).constructor,n=new FormData;return n.toString()!==await new e(n).text()}catch{return!0}})();return xt.set(t,r),r}const Ct=async(e,t)=>{if(!await St(t))throw TypeError(`The provided fetch function does not support file uploads with the current global FormData class.`);let n=new FormData;return await Promise.all(Object.entries(e||{}).map(([e,t])=>Dt(n,e,t))),n};var wt=e=>e instanceof Blob&&`name`in e,Tt=e=>typeof e==`object`&&!!e&&(e instanceof Response||vt(e)||wt(e)),Et=e=>{if(Tt(e))return!0;if(Array.isArray(e))return e.some(Et);if(e&&typeof e==`object`){for(let t in e)if(Et(e[t]))return!0}return!1},Dt=async(e,t,n)=>{if(n!==void 0){if(n==null)throw TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if(typeof n==`string`||typeof n==`number`||typeof n==`boolean`)e.append(t,String(n));else if(n instanceof Response)e.append(t,gt([await n.blob()],_t(n)));else if(vt(n))e.append(t,gt([await new Response(ge(n)).blob()],_t(n)));else if(wt(n))e.append(t,n,_t(n));else if(Array.isArray(n))await Promise.all(n.map(n=>Dt(e,t+`[]`,n)));else if(typeof n==`object`)await Promise.all(Object.entries(n).map(([n,r])=>Dt(e,`${t}[${n}]`,r)));else throw TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${n} instead`)}},Ot=e=>typeof e==`object`&&!!e&&typeof e.size==`number`&&typeof e.type==`string`&&typeof e.text==`function`&&typeof e.slice==`function`&&typeof e.arrayBuffer==`function`,kt=e=>typeof e==`object`&&!!e&&typeof e.name==`string`&&typeof e.lastModified==`number`&&Ot(e),At=e=>typeof e==`object`&&!!e&&typeof e.url==`string`&&typeof e.blob==`function`;async function jt(e,t,n){if(ht(),e=await e,kt(e))return e instanceof File?e:gt([await e.arrayBuffer()],e.name);if(At(e)){let r=await e.blob();return t||=new URL(e.url).pathname.split(/[\\/]/).pop(),gt(await Mt(r),t,n)}let r=await Mt(e);if(t||=_t(e),!n?.type){let e=r.find(e=>typeof e==`object`&&`type`in e&&e.type);typeof e==`string`&&(n={...n,type:e})}return gt(r,t,n)}async function Mt(e){let t=[];if(typeof e==`string`||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(Ot(e))t.push(e instanceof Blob?e:await e.arrayBuffer());else if(vt(e))for await(let n of e)t.push(...await Mt(n));else{let t=e?.constructor?.name;throw Error(`Unexpected data type: ${typeof e}${t?`; constructor: ${t}`:``}${Nt(e)}`)}return t}function Nt(e){return typeof e!=`object`||!e?``:`; props: [${Object.getOwnPropertyNames(e).map(e=>`"${e}"`).join(`, `)}]`}var A=class{constructor(e){this._client=e}};function Pt(e){return e.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}var Ft=Object.freeze(Object.create(null));const j=((e=Pt)=>function(t,...n){if(t.length===1)return t[0];let r=!1,i=[],o=t.reduce((t,a,o)=>{/[?#]/.test(a)&&(r=!0);let s=n[o],c=(r?encodeURIComponent:e)(``+s);return o!==n.length&&(s==null||typeof s==`object`&&s.toString===Object.getPrototypeOf(Object.getPrototypeOf(s.hasOwnProperty??Ft)??Ft)?.toString)&&(c=s+``,i.push({start:t.length+a.length,length:c.length,error:`Value of type ${Object.prototype.toString.call(s).slice(8,-1)} is not a valid path parameter`})),t+a+(o===n.length?``:c)},``),s=o.split(/[?#]/,1)[0],c=RegExp(`(?<=^|\\/)(?:\\.|%2e){1,2}(?=\\/|$)`,`gi`),l;for(;(l=c.exec(s))!==null;)i.push({start:l.index,length:l[0].length,error:`Value "${l[0]}" can\'t be safely passed as a path parameter`});if(i.sort((e,t)=>e.start-t.start),i.length>0){let e=0,t=i.reduce((t,n)=>{let r=` `.repeat(n.start-e),i=`^`.repeat(n.length);return e=n.start+n.length,t+r+i},``);throw new a(`Path parameters result in path with invalid segments:\n${i.map(e=>e.error).join(`
`)}\n${o}\n${t}`)}return o})(Pt);var It=class extends A{list(e,t={},n){return this._client.getAPIList(j`/chat/completions/${e}/messages`,k,{query:t,...n})}};function Lt(e){return e!==void 0&&`function`in e&&e.function!==void 0}function Rt(e){return e?.$brand===`auto-parseable-response-format`}function zt(e){return e?.$brand===`auto-parseable-tool`}function Bt(e,t){return!t||!Gt(t)?{...e,choices:e.choices.map(e=>(Kt(e.message.tool_calls),{...e,message:{...e.message,parsed:null,...e.message.tool_calls?{tool_calls:e.message.tool_calls}:void 0}}))}:Vt(e,t)}function Vt(e,t){let n=e.choices.map(e=>{if(e.finish_reason===`length`)throw new v;if(e.finish_reason===`content_filter`)throw new y;return Kt(e.message.tool_calls),{...e,message:{...e.message,...e.message.tool_calls?{tool_calls:e.message.tool_calls?.map(e=>Ut(t,e))??void 0}:void 0,parsed:e.message.content&&!e.message.refusal?Ht(t,e.message.content):null}}});return{...e,choices:n}}function Ht(e,t){return e.response_format?.type===`json_schema`&&e.response_format?.type===`json_schema`?`$parseRaw`in e.response_format?e.response_format.$parseRaw(t):JSON.parse(t):null}function Ut(e,t){let n=e.tools?.find(e=>Lt(e)&&e.function?.name===t.function.name);return{...t,function:{...t.function,parsed_arguments:zt(n)?n.$parseRaw(t.function.arguments):n?.function.strict?JSON.parse(t.function.arguments):null}}}function Wt(e,t){if(!e||!(`tools`in e)||!e.tools)return!1;let n=e.tools?.find(e=>Lt(e)&&e.function?.name===t.function.name);return Lt(n)&&(zt(n)||n?.function.strict||!1)}function Gt(e){return Rt(e.response_format)?!0:e.tools?.some(e=>zt(e)||e.type===`function`&&e.function.strict===!0)??!1}function Kt(e){for(let t of e||[])if(t.type!==`function`)throw new a(`Currently only \`function\` tool calls are supported; Received \`${t.type}\``)}function qt(e){for(let t of e??[]){if(t.type!==`function`)throw new a(`Currently only \`function\` tool types support auto-parsing; Received \`${t.type}\``);if(t.function.strict!==!0)throw new a(`The \`${t.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}const Jt=e=>e?.role===`assistant`,Yt=e=>e?.role===`tool`;var Xt,Zt,Qt,$t,en,tn,nn,rn,an,on,sn,cn,ln,un=class{constructor(){Xt.add(this),this.controller=new AbortController,Zt.set(this,void 0),Qt.set(this,()=>{}),$t.set(this,()=>{}),en.set(this,void 0),tn.set(this,()=>{}),nn.set(this,()=>{}),rn.set(this,{}),an.set(this,!1),on.set(this,!1),sn.set(this,!1),cn.set(this,!1),e(this,Zt,new Promise((t,n)=>{e(this,Qt,t,`f`),e(this,$t,n,`f`)}),`f`),e(this,en,new Promise((t,n)=>{e(this,tn,t,`f`),e(this,nn,n,`f`)}),`f`),t(this,Zt,`f`).catch(()=>{}),t(this,en,`f`).catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit(`end`)},t(this,Xt,`m`,ln).bind(this))},0)}_connected(){this.ended||(t(this,Qt,`f`).call(this),this._emit(`connect`))}get ended(){return t(this,an,`f`)}get errored(){return t(this,on,`f`)}get aborted(){return t(this,sn,`f`)}abort(){this.controller.abort()}on(e,n){return(t(this,rn,`f`)[e]||(t(this,rn,`f`)[e]=[])).push({listener:n}),this}off(e,n){let r=t(this,rn,`f`)[e];if(!r)return this;let i=r.findIndex(e=>e.listener===n);return i>=0&&r.splice(i,1),this}once(e,n){return(t(this,rn,`f`)[e]||(t(this,rn,`f`)[e]=[])).push({listener:n,once:!0}),this}emitted(t){return new Promise((n,r)=>{e(this,cn,!0,`f`),t!==`error`&&this.once(`error`,r),this.once(t,n)})}async done(){e(this,cn,!0,`f`),await t(this,en,`f`)}_emit(n,...r){if(t(this,an,`f`))return;n===`end`&&(e(this,an,!0,`f`),t(this,tn,`f`).call(this));let i=t(this,rn,`f`)[n];if(i&&(t(this,rn,`f`)[n]=i.filter(e=>!e.once),i.forEach(({listener:e})=>e(...r))),n===`abort`){let e=r[0];!t(this,cn,`f`)&&!i?.length&&Promise.reject(e),t(this,$t,`f`).call(this,e),t(this,nn,`f`).call(this,e),this._emit(`end`);return}if(n===`error`){let e=r[0];!t(this,cn,`f`)&&!i?.length&&Promise.reject(e),t(this,$t,`f`).call(this,e),t(this,nn,`f`).call(this,e),this._emit(`end`)}}_emitFinal(){}};Zt=new WeakMap,Qt=new WeakMap,$t=new WeakMap,en=new WeakMap,tn=new WeakMap,nn=new WeakMap,rn=new WeakMap,an=new WeakMap,on=new WeakMap,sn=new WeakMap,cn=new WeakMap,Xt=new WeakSet,ln=function(t){if(e(this,on,!0,`f`),t instanceof Error&&t.name===`AbortError`&&(t=new s),t instanceof s)return e(this,sn,!0,`f`),this._emit(`abort`,t);if(t instanceof a)return this._emit(`error`,t);if(t instanceof Error){let e=new a(t.message);return e.cause=t,this._emit(`error`,e)}return this._emit(`error`,new a(String(t)))};function dn(e){return typeof e.parse==`function`}var M,fn,pn,mn,hn,gn,_n,vn,yn=10,bn=class extends un{constructor(){super(...arguments),M.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit(`chatCompletion`,e);let t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if(`content`in e||(e.content=null),this.messages.push(e),t){if(this._emit(`message`,e),Yt(e)&&e.content)this._emit(`functionToolCallResult`,e.content);else if(Jt(e)&&e.tool_calls)for(let t of e.tool_calls)t.type===`function`&&this._emit(`functionToolCall`,t.function)}}async finalChatCompletion(){await this.done();let e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new a(`stream ended without producing a ChatCompletion`);return e}async finalContent(){return await this.done(),t(this,M,`m`,fn).call(this)}async finalMessage(){return await this.done(),t(this,M,`m`,pn).call(this)}async finalFunctionToolCall(){return await this.done(),t(this,M,`m`,mn).call(this)}async finalFunctionToolCallResult(){return await this.done(),t(this,M,`m`,hn).call(this)}async totalUsage(){return await this.done(),t(this,M,`m`,gn).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){let e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit(`finalChatCompletion`,e);let n=t(this,M,`m`,pn).call(this);n&&this._emit(`finalMessage`,n);let r=t(this,M,`m`,fn).call(this);r&&this._emit(`finalContent`,r);let i=t(this,M,`m`,mn).call(this);i&&this._emit(`finalFunctionToolCall`,i);let a=t(this,M,`m`,hn).call(this);a!=null&&this._emit(`finalFunctionToolCallResult`,a),this._chatCompletions.some(e=>e.usage)&&this._emit(`totalUsage`,t(this,M,`m`,gn).call(this))}async _createChatCompletion(e,n,r){let i=r?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener(`abort`,()=>this.controller.abort())),t(this,M,`m`,_n).call(this,n);let a=await e.chat.completions.create({...n,stream:!1},{...r,signal:this.controller.signal});return this._connected(),this._addChatCompletion(Vt(a,n))}async _runChatCompletion(e,t,n){for(let e of t.messages)this._addMessage(e,!1);return await this._createChatCompletion(e,t,n)}async _runTools(e,n,r){let i=`tool`,{tool_choice:o=`auto`,stream:s,...c}=n,l=typeof o!=`string`&&o.type===`function`&&o?.function?.name,{maxChatCompletions:u=yn}=r||{},d=n.tools.map(e=>{if(zt(e)){if(!e.$callback)throw new a("Tool given to `.runTools()` that does not have an associated function");return{type:`function`,function:{function:e.$callback,name:e.function.name,description:e.function.description||``,parameters:e.function.parameters,parse:e.$parseRaw,strict:!0}}}return e}),f={};for(let e of d)e.type===`function`&&(f[e.function.name||e.function.function.name]=e.function);let p=`tools`in n?d.map(e=>e.type===`function`?{type:`function`,function:{name:e.function.name||e.function.function.name,parameters:e.function.parameters,description:e.function.description,strict:e.function.strict}}:e):void 0;for(let e of n.messages)this._addMessage(e,!1);for(let n=0;n<u;++n){let n=(await this._createChatCompletion(e,{...c,tool_choice:o,tools:p,messages:[...this.messages]},r)).choices[0]?.message;if(!n)throw new a(`missing message in ChatCompletion response`);if(!n.tool_calls?.length)return;for(let e of n.tool_calls){if(e.type!==`function`)continue;let n=e.id,{name:r,arguments:a}=e.function,o=f[r];if(o){if(l&&l!==r){let e=`Invalid tool_call: ${JSON.stringify(r)}. ${JSON.stringify(l)} requested. Please try again`;this._addMessage({role:i,tool_call_id:n,content:e});continue}}else{let e=`Invalid tool_call: ${JSON.stringify(r)}. Available options are: ${Object.keys(f).map(e=>JSON.stringify(e)).join(`, `)}. Please try again`;this._addMessage({role:i,tool_call_id:n,content:e});continue}let s;try{s=dn(o)?await o.parse(a):a}catch(e){let t=e instanceof Error?e.message:String(e);this._addMessage({role:i,tool_call_id:n,content:t});continue}let c=await o.function(s,this),u=t(this,M,`m`,vn).call(this,c);if(this._addMessage({role:i,tool_call_id:n,content:u}),l)return}}}};M=new WeakSet,fn=function(){return t(this,M,`m`,pn).call(this).content??null},pn=function(){let e=this.messages.length;for(;e-- >0;){let t=this.messages[e];if(Jt(t))return{...t,content:t.content??null,refusal:t.refusal??null}}throw new a(`stream ended without producing a ChatCompletionMessage with role=assistant`)},mn=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(Jt(t)&&t?.tool_calls?.length)return t.tool_calls.filter(e=>e.type===`function`).at(-1)?.function}},hn=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(Yt(t)&&t.content!=null&&typeof t.content==`string`&&this.messages.some(e=>e.role===`assistant`&&e.tool_calls?.some(e=>e.type===`function`&&e.id===t.tool_call_id)))return t.content}},gn=function(){let e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(let{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},_n=function(e){if(e.n!=null&&e.n>1)throw new a(`ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.`)},vn=function(e){return typeof e==`string`?e:e===void 0?`undefined`:JSON.stringify(e)};var xn=class e extends bn{static runTools(t,n,r){let i=new e,a={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":`runTools`}};return i._run(()=>i._runTools(t,n,a)),i}_addMessage(e,t=!0){super._addMessage(e,t),Jt(e)&&e.content&&this._emit(`content`,e.content)}},Sn=1,Cn=2,wn=4,Tn=8,En=16,Dn=32,On=64,kn=128,An=256,jn=kn|An,Mn=496,Nn=Cn|497,Pn=wn|Tn,N={STR:Sn,NUM:Cn,ARR:wn,OBJ:Tn,NULL:En,BOOL:Dn,NAN:On,INFINITY:kn,MINUS_INFINITY:An,INF:jn,SPECIAL:Mn,ATOM:Nn,COLLECTION:Pn,ALL:Nn|Pn},Fn=class extends Error{},In=class extends Error{};function Ln(e,t=N.ALL){if(typeof e!=`string`)throw TypeError(`expecting str, got ${typeof e}`);if(!e.trim())throw Error(`${e} is empty`);return Rn(e.trim(),t)}var Rn=(e,t)=>{let n=e.length,r=0,i=e=>{throw new Fn(`${e} at position ${r}`)},a=e=>{throw new In(`${e} at position ${r}`)},o=()=>(d(),r>=n&&i(`Unexpected end of input`),e[r]===`"`?s():e[r]===`{`?c():e[r]===`[`?l():e.substring(r,r+4)===`null`||N.NULL&t&&n-r<4&&`null`.startsWith(e.substring(r))?(r+=4,null):e.substring(r,r+4)===`true`||N.BOOL&t&&n-r<4&&`true`.startsWith(e.substring(r))?(r+=4,!0):e.substring(r,r+5)===`false`||N.BOOL&t&&n-r<5&&`false`.startsWith(e.substring(r))?(r+=5,!1):e.substring(r,r+8)===`Infinity`||N.INFINITY&t&&n-r<8&&`Infinity`.startsWith(e.substring(r))?(r+=8,1/0):e.substring(r,r+9)===`-Infinity`||N.MINUS_INFINITY&t&&1<n-r&&n-r<9&&`-Infinity`.startsWith(e.substring(r))?(r+=9,-1/0):e.substring(r,r+3)===`NaN`||N.NAN&t&&n-r<3&&`NaN`.startsWith(e.substring(r))?(r+=3,NaN):u()),s=()=>{let o=r,s=!1;for(r++;r<n&&(e[r]!==`"`||s&&e[r-1]===`\\`);)s=e[r]===`\\`?!s:!1,r++;if(e.charAt(r)==`"`)try{return JSON.parse(e.substring(o,++r-Number(s)))}catch(e){a(String(e))}else if(N.STR&t)try{return JSON.parse(e.substring(o,r-Number(s))+`"`)}catch{return JSON.parse(e.substring(o,e.lastIndexOf(`\\`))+`"`)}i(`Unterminated string literal`)},c=()=>{r++,d();let a={};try{for(;e[r]!==`}`;){if(d(),r>=n&&N.OBJ&t)return a;let i=s();d(),r++;try{let e=o();Object.defineProperty(a,i,{value:e,writable:!0,enumerable:!0,configurable:!0})}catch(e){if(N.OBJ&t)return a;throw e}d(),e[r]===`,`&&r++}}catch{if(N.OBJ&t)return a;i(`Expected '}' at end of object`)}return r++,a},l=()=>{r++;let n=[];try{for(;e[r]!==`]`;)n.push(o()),d(),e[r]===`,`&&r++}catch{if(N.ARR&t)return n;i(`Expected ']' at end of array`)}return r++,n},u=()=>{if(r===0){e===`-`&&N.NUM&t&&i(`Not sure what '-' is`);try{return JSON.parse(e)}catch(n){if(N.NUM&t)try{return e[e.length-1]===`.`?JSON.parse(e.substring(0,e.lastIndexOf(`.`))):JSON.parse(e.substring(0,e.lastIndexOf(`e`)))}catch{}a(String(n))}}let o=r;for(e[r]===`-`&&r++;e[r]&&!`,]}`.includes(e[r]);)r++;r==n&&!(N.NUM&t)&&i(`Unterminated number literal`);try{return JSON.parse(e.substring(o,r))}catch{e.substring(o,r)===`-`&&N.NUM&t&&i(`Not sure what '-' is`);try{return JSON.parse(e.substring(o,e.lastIndexOf(`e`)))}catch(e){a(String(e))}}},d=()=>{for(;r<n&&` 
\r	`.includes(e[r]);)r++};return o()},zn=e=>Ln(e,N.ALL^N.NUM),P,Bn,Vn,Hn,Un,Wn,Gn,Kn,qn,Jn,Yn,Xn,Zn=class n extends bn{constructor(t){super(),P.add(this),Bn.set(this,void 0),Vn.set(this,void 0),Hn.set(this,void 0),e(this,Bn,t,`f`),e(this,Vn,[],`f`)}get currentChatCompletionSnapshot(){return t(this,Hn,`f`)}static fromReadableStream(e){let t=new n(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,r){let i=new n(t);return i._run(()=>i._runChatCompletion(e,{...t,stream:!0},{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":`stream`}})),i}async _createChatCompletion(e,n,r){super._createChatCompletion;let i=r?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener(`abort`,()=>this.controller.abort())),t(this,P,`m`,Un).call(this);let a=await e.chat.completions.create({...n,stream:!0},{...r,signal:this.controller.signal});this._connected();for await(let e of a)t(this,P,`m`,Gn).call(this,e);if(a.controller.signal?.aborted)throw new s;return this._addChatCompletion(t(this,P,`m`,Jn).call(this))}async _fromReadableStream(e,n){let r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener(`abort`,()=>this.controller.abort())),t(this,P,`m`,Un).call(this),this._connected();let i=tt.fromReadableStream(e,this.controller),a;for await(let e of i)a&&a!==e.id&&this._addChatCompletion(t(this,P,`m`,Jn).call(this)),t(this,P,`m`,Gn).call(this,e),a=e.id;if(i.controller.signal?.aborted)throw new s;return this._addChatCompletion(t(this,P,`m`,Jn).call(this))}[(Bn=new WeakMap,Vn=new WeakMap,Hn=new WeakMap,P=new WeakSet,Un=function(){this.ended||e(this,Hn,void 0,`f`)},Wn=function(e){let n=t(this,Vn,`f`)[e.index];return n||(n={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},t(this,Vn,`f`)[e.index]=n,n)},Gn=function(e){if(this.ended)return;let n=t(this,P,`m`,Xn).call(this,e);this._emit(`chunk`,e,n);for(let r of e.choices){let e=n.choices[r.index];r.delta.content!=null&&e.message?.role===`assistant`&&e.message?.content&&(this._emit(`content`,r.delta.content,e.message.content),this._emit(`content.delta`,{delta:r.delta.content,snapshot:e.message.content,parsed:e.message.parsed})),r.delta.refusal!=null&&e.message?.role===`assistant`&&e.message?.refusal&&this._emit(`refusal.delta`,{delta:r.delta.refusal,snapshot:e.message.refusal}),r.logprobs?.content!=null&&e.message?.role===`assistant`&&this._emit(`logprobs.content.delta`,{content:r.logprobs?.content,snapshot:e.logprobs?.content??[]}),r.logprobs?.refusal!=null&&e.message?.role===`assistant`&&this._emit(`logprobs.refusal.delta`,{refusal:r.logprobs?.refusal,snapshot:e.logprobs?.refusal??[]});let i=t(this,P,`m`,Wn).call(this,e);e.finish_reason&&(t(this,P,`m`,qn).call(this,e),i.current_tool_call_index!=null&&t(this,P,`m`,Kn).call(this,e,i.current_tool_call_index));for(let n of r.delta.tool_calls??[])i.current_tool_call_index!==n.index&&(t(this,P,`m`,qn).call(this,e),i.current_tool_call_index!=null&&t(this,P,`m`,Kn).call(this,e,i.current_tool_call_index)),i.current_tool_call_index=n.index;for(let t of r.delta.tool_calls??[]){let n=e.message.tool_calls?.[t.index];n?.type&&(n?.type===`function`?this._emit(`tool_calls.function.arguments.delta`,{name:n.function?.name,index:t.index,arguments:n.function.arguments,parsed_arguments:n.function.parsed_arguments,arguments_delta:t.function?.arguments??``}):n?.type)}}},Kn=function(e,n){if(t(this,P,`m`,Wn).call(this,e).done_tool_calls.has(n))return;let r=e.message.tool_calls?.[n];if(!r)throw Error(`no tool call snapshot`);if(!r.type)throw Error("tool call snapshot missing `type`");if(r.type===`function`){let e=t(this,Bn,`f`)?.tools?.find(e=>Lt(e)&&e.function.name===r.function.name);this._emit(`tool_calls.function.arguments.done`,{name:r.function.name,index:n,arguments:r.function.arguments,parsed_arguments:zt(e)?e.$parseRaw(r.function.arguments):e?.function.strict?JSON.parse(r.function.arguments):null})}else r.type},qn=function(e){let n=t(this,P,`m`,Wn).call(this,e);if(e.message.content&&!n.content_done){n.content_done=!0;let r=t(this,P,`m`,Yn).call(this);this._emit(`content.done`,{content:e.message.content,parsed:r?r.$parseRaw(e.message.content):null})}e.message.refusal&&!n.refusal_done&&(n.refusal_done=!0,this._emit(`refusal.done`,{refusal:e.message.refusal})),e.logprobs?.content&&!n.logprobs_content_done&&(n.logprobs_content_done=!0,this._emit(`logprobs.content.done`,{content:e.logprobs.content})),e.logprobs?.refusal&&!n.logprobs_refusal_done&&(n.logprobs_refusal_done=!0,this._emit(`logprobs.refusal.done`,{refusal:e.logprobs.refusal}))},Jn=function(){if(this.ended)throw new a(`stream has ended, this shouldn't happen`);let n=t(this,Hn,`f`);if(!n)throw new a(`request ended without sending any chunks`);return e(this,Hn,void 0,`f`),e(this,Vn,[],`f`),Qn(n,t(this,Bn,`f`))},Yn=function(){let e=t(this,Bn,`f`)?.response_format;return Rt(e)?e:null},Xn=function(n){var r,i,a,o;let s=t(this,Hn,`f`),{choices:c,...l}=n;s?Object.assign(s,l):s=e(this,Hn,{...l,choices:[]},`f`);for(let{delta:e,finish_reason:c,index:l,logprobs:u=null,...d}of n.choices){let n=s.choices[l];if(n||=s.choices[l]={finish_reason:c,index:l,message:{},logprobs:u,...d},u)if(!n.logprobs)n.logprobs=Object.assign({},u);else{let{content:e,refusal:t,...a}=u;Object.assign(n.logprobs,a),e&&((r=n.logprobs).content??(r.content=[]),n.logprobs.content.push(...e)),t&&((i=n.logprobs).refusal??(i.refusal=[]),n.logprobs.refusal.push(...t))}if(c&&(n.finish_reason=c,t(this,Bn,`f`)&&Gt(t(this,Bn,`f`)))){if(c===`length`)throw new v;if(c===`content_filter`)throw new y}if(Object.assign(n,d),!e)continue;let{content:f,refusal:p,function_call:m,role:h,tool_calls:g,..._}=e;if(Object.assign(n.message,_),p&&(n.message.refusal=(n.message.refusal||``)+p),h&&(n.message.role=h),m&&(n.message.function_call?(m.name&&(n.message.function_call.name=m.name),m.arguments&&((a=n.message.function_call).arguments??(a.arguments=``),n.message.function_call.arguments+=m.arguments)):n.message.function_call=m),f&&(n.message.content=(n.message.content||``)+f,!n.message.refusal&&t(this,P,`m`,Yn).call(this)&&(n.message.parsed=zn(n.message.content))),g){n.message.tool_calls||(n.message.tool_calls=[]);for(let{index:e,id:r,type:i,function:a,...s}of g){let c=(o=n.message.tool_calls)[e]??(o[e]={});Object.assign(c,s),r&&(c.id=r),i&&(c.type=i),a&&(c.function??={name:a.name??``,arguments:``}),a?.name&&(c.function.name=a.name),a?.arguments&&(c.function.arguments+=a.arguments,Wt(t(this,Bn,`f`),c)&&(c.function.parsed_arguments=zn(c.function.arguments)))}}}return s},Symbol.asyncIterator)](){let e=[],t=[],n=!1;return this.on(`chunk`,n=>{let r=t.shift();r?r.resolve(n):e.push(n)}),this.on(`end`,()=>{n=!0;for(let e of t)e.resolve(void 0);t.length=0}),this.on(`abort`,e=>{n=!0;for(let n of t)n.reject(e);t.length=0}),this.on(`error`,e=>{n=!0;for(let n of t)n.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((e,n)=>t.push({resolve:e,reject:n})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new tt(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}};function Qn(e,t){let{id:n,choices:r,created:i,model:o,system_fingerprint:s,...c}=e;return Bt({...c,id:n,choices:r.map(({message:t,finish_reason:n,index:r,logprobs:i,...o})=>{if(!n)throw new a(`missing finish_reason for choice ${r}`);let{content:s=null,function_call:c,tool_calls:l,...u}=t,d=t.role;if(!d)throw new a(`missing role for choice ${r}`);if(c){let{arguments:e,name:l}=c;if(e==null)throw new a(`missing function_call.arguments for choice ${r}`);if(!l)throw new a(`missing function_call.name for choice ${r}`);return{...o,message:{content:s,function_call:{arguments:e,name:l},role:d,refusal:t.refusal??null},finish_reason:n,index:r,logprobs:i}}return l?{...o,index:r,finish_reason:n,logprobs:i,message:{...u,role:d,content:s,refusal:t.refusal??null,tool_calls:l.map((t,n)=>{let{function:i,type:o,id:s,...c}=t,{arguments:l,name:u,...d}=i||{};if(s==null)throw new a(`missing choices[${r}].tool_calls[${n}].id\n${$n(e)}`);if(o==null)throw new a(`missing choices[${r}].tool_calls[${n}].type\n${$n(e)}`);if(u==null)throw new a(`missing choices[${r}].tool_calls[${n}].function.name\n${$n(e)}`);if(l==null)throw new a(`missing choices[${r}].tool_calls[${n}].function.arguments\n${$n(e)}`);return{...c,id:s,type:o,function:{...d,name:u,arguments:l}}})}}:{...o,message:{...u,content:s,role:d,refusal:t.refusal??null},finish_reason:n,index:r,logprobs:i}}),created:i,model:o,object:`chat.completion`,...s?{system_fingerprint:s}:{}},t)}function $n(e){return JSON.stringify(e)}var er=class e extends Zn{static fromReadableStream(t){let n=new e(null);return n._run(()=>n._fromReadableStream(t)),n}static runTools(t,n,r){let i=new e(n),a={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":`runTools`}};return i._run(()=>i._runTools(t,n,a)),i}},tr=class extends A{constructor(){super(...arguments),this.messages=new It(this._client)}create(e,t){return this._client.post(`/chat/completions`,{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(j`/chat/completions/${e}`,t)}update(e,t,n){return this._client.post(j`/chat/completions/${e}`,{body:t,...n})}list(e={},t){return this._client.getAPIList(`/chat/completions`,k,{query:e,...t})}delete(e,t){return this._client.delete(j`/chat/completions/${e}`,t)}parse(e,t){return qt(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":`chat.completions.parse`}})._thenUnwrap(t=>Vt(t,e))}runTools(e,t){return e.stream?er.runTools(this._client,e,t):xn.runTools(this._client,e,t)}stream(e,t){return Zn.createChatCompletion(this._client,e,t)}};tr.Messages=It;var nr=class extends A{constructor(){super(...arguments),this.completions=new tr(this._client)}};nr.Completions=tr;var rr=Symbol(`brand.privateNullableHeaders`);function*ir(e){if(!e)return;if(rr in e){let{values:t,nulls:n}=e;yield*t.entries();for(let e of n)yield[e,null];return}let t=!1,n;e instanceof Headers?n=e.entries():w(e)?n=e:(t=!0,n=Object.entries(e??{}));for(let e of n){let n=e[0];if(typeof n!=`string`)throw TypeError(`expected header name to be a string`);let r=w(e[1])?e[1]:[e[1]],i=!1;for(let e of r)e!==void 0&&(t&&!i&&(i=!0,yield[n,null]),yield[n,e])}}const F=e=>{let t=new Headers,n=new Set;for(let r of e){let e=new Set;for(let[i,a]of ir(r)){let r=i.toLowerCase();e.has(r)||(t.delete(i),e.add(r)),a===null?(t.delete(i),n.add(r)):(t.append(i,a),n.delete(r))}}return{[rr]:!0,values:t,nulls:n}};var ar=class extends A{create(e,t){return this._client.post(`/audio/speech`,{body:e,...t,headers:F([{Accept:`application/octet-stream`},t?.headers]),__binaryResponse:!0})}},or=class extends A{create(e,t){return this._client.post(`/audio/transcriptions`,bt({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}},this._client))}},sr=class extends A{create(e,t){return this._client.post(`/audio/translations`,bt({body:e,...t,__metadata:{model:e.model}},this._client))}},cr=class extends A{constructor(){super(...arguments),this.transcriptions=new or(this._client),this.translations=new sr(this._client),this.speech=new ar(this._client)}};cr.Transcriptions=or,cr.Translations=sr,cr.Speech=ar;var lr=class extends A{create(e,t){return this._client.post(`/batches`,{body:e,...t})}retrieve(e,t){return this._client.get(j`/batches/${e}`,t)}list(e={},t){return this._client.getAPIList(`/batches`,k,{query:e,...t})}cancel(e,t){return this._client.post(j`/batches/${e}/cancel`,t)}},ur=class extends A{create(e,t){return this._client.post(`/assistants`,{body:e,...t,headers:F([{"OpenAI-Beta":`assistants=v2`},t?.headers])})}retrieve(e,t){return this._client.get(j`/assistants/${e}`,{...t,headers:F([{"OpenAI-Beta":`assistants=v2`},t?.headers])})}update(e,t,n){return this._client.post(j`/assistants/${e}`,{body:t,...n,headers:F([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}list(e={},t){return this._client.getAPIList(`/assistants`,k,{query:e,...t,headers:F([{"OpenAI-Beta":`assistants=v2`},t?.headers])})}delete(e,t){return this._client.delete(j`/assistants/${e}`,{...t,headers:F([{"OpenAI-Beta":`assistants=v2`},t?.headers])})}},dr=class extends A{create(e,t){return this._client.post(`/realtime/sessions`,{body:e,...t,headers:F([{"OpenAI-Beta":`assistants=v2`},t?.headers])})}},fr=class extends A{create(e,t){return this._client.post(`/realtime/transcription_sessions`,{body:e,...t,headers:F([{"OpenAI-Beta":`assistants=v2`},t?.headers])})}},pr=class extends A{constructor(){super(...arguments),this.sessions=new dr(this._client),this.transcriptionSessions=new fr(this._client)}};pr.Sessions=dr,pr.TranscriptionSessions=fr;var mr=class extends A{create(e,t){return this._client.post(`/chatkit/sessions`,{body:e,...t,headers:F([{"OpenAI-Beta":`chatkit_beta=v1`},t?.headers])})}cancel(e,t){return this._client.post(j`/chatkit/sessions/${e}/cancel`,{...t,headers:F([{"OpenAI-Beta":`chatkit_beta=v1`},t?.headers])})}},hr=class extends A{retrieve(e,t){return this._client.get(j`/chatkit/threads/${e}`,{...t,headers:F([{"OpenAI-Beta":`chatkit_beta=v1`},t?.headers])})}list(e={},t){return this._client.getAPIList(`/chatkit/threads`,mt,{query:e,...t,headers:F([{"OpenAI-Beta":`chatkit_beta=v1`},t?.headers])})}delete(e,t){return this._client.delete(j`/chatkit/threads/${e}`,{...t,headers:F([{"OpenAI-Beta":`chatkit_beta=v1`},t?.headers])})}listItems(e,t={},n){return this._client.getAPIList(j`/chatkit/threads/${e}/items`,mt,{query:t,...n,headers:F([{"OpenAI-Beta":`chatkit_beta=v1`},n?.headers])})}},gr=class extends A{constructor(){super(...arguments),this.sessions=new mr(this._client),this.threads=new hr(this._client)}};gr.Sessions=mr,gr.Threads=hr;var _r=class extends A{create(e,t,n){return this._client.post(j`/threads/${e}/messages`,{body:t,...n,headers:F([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}retrieve(e,t,n){let{thread_id:r}=t;return this._client.get(j`/threads/${r}/messages/${e}`,{...n,headers:F([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}update(e,t,n){let{thread_id:r,...i}=t;return this._client.post(j`/threads/${r}/messages/${e}`,{body:i,...n,headers:F([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}list(e,t={},n){return this._client.getAPIList(j`/threads/${e}/messages`,k,{query:t,...n,headers:F([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}delete(e,t,n){let{thread_id:r}=t;return this._client.delete(j`/threads/${r}/messages/${e}`,{...n,headers:F([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}},vr=class extends A{retrieve(e,t,n){let{thread_id:r,run_id:i,...a}=t;return this._client.get(j`/threads/${r}/runs/${i}/steps/${e}`,{query:a,...n,headers:F([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}list(e,t,n){let{thread_id:r,...i}=t;return this._client.getAPIList(j`/threads/${r}/runs/${e}/steps`,k,{query:i,...n,headers:F([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}};const yr=e=>{if(typeof Buffer<`u`){let t=Buffer.from(e,`base64`);return Array.from(new Float32Array(t.buffer,t.byteOffset,t.length/Float32Array.BYTES_PER_ELEMENT))}else{let t=atob(e),n=t.length,r=new Uint8Array(n);for(let e=0;e<n;e++)r[e]=t.charCodeAt(e);return Array.from(new Float32Array(r.buffer))}},br=e=>{if(globalThis.process!==void 0)return{}?.[e]?.trim()??void 0;if(globalThis.Deno!==void 0)return globalThis.Deno.env?.get?.(e)?.trim()};var I,xr,Sr,Cr,wr,Tr,Er,Dr,Or,kr,Ar,jr,Mr,Nr,Pr,Fr,Ir,Lr,Rr,zr,Br,Vr,Hr,Ur=class extends un{constructor(){super(...arguments),I.add(this),Sr.set(this,[]),Cr.set(this,{}),wr.set(this,{}),Tr.set(this,void 0),Er.set(this,void 0),Dr.set(this,void 0),Or.set(this,void 0),kr.set(this,void 0),Ar.set(this,void 0),jr.set(this,void 0),Mr.set(this,void 0),Nr.set(this,void 0)}[(Sr=new WeakMap,Cr=new WeakMap,wr=new WeakMap,Tr=new WeakMap,Er=new WeakMap,Dr=new WeakMap,Or=new WeakMap,kr=new WeakMap,Ar=new WeakMap,jr=new WeakMap,Mr=new WeakMap,Nr=new WeakMap,I=new WeakSet,Symbol.asyncIterator)](){let e=[],t=[],n=!1;return this.on(`event`,n=>{let r=t.shift();r?r.resolve(n):e.push(n)}),this.on(`end`,()=>{n=!0;for(let e of t)e.resolve(void 0);t.length=0}),this.on(`abort`,e=>{n=!0;for(let n of t)n.reject(e);t.length=0}),this.on(`error`,e=>{n=!0;for(let n of t)n.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((e,n)=>t.push({resolve:e,reject:n})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){let t=new xr;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,n){let r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener(`abort`,()=>this.controller.abort())),this._connected();let i=tt.fromReadableStream(e,this.controller);for await(let e of i)t(this,I,`m`,Pr).call(this,e);if(i.controller.signal?.aborted)throw new s;return this._addRun(t(this,I,`m`,Fr).call(this))}toReadableStream(){return new tt(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,n,r){let i=new xr;return i._run(()=>i._runToolAssistantStream(e,t,n,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":`stream`}})),i}async _createToolAssistantStream(e,n,r,i){let a=i?.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener(`abort`,()=>this.controller.abort()));let o={...r,stream:!0},c=await e.submitToolOutputs(n,o,{...i,signal:this.controller.signal});this._connected();for await(let e of c)t(this,I,`m`,Pr).call(this,e);if(c.controller.signal?.aborted)throw new s;return this._addRun(t(this,I,`m`,Fr).call(this))}static createThreadAssistantStream(e,t,n){let r=new xr;return r._run(()=>r._threadAssistantStream(e,t,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":`stream`}})),r}static createAssistantStream(e,t,n,r){let i=new xr;return i._run(()=>i._runAssistantStream(e,t,n,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":`stream`}})),i}currentEvent(){return t(this,jr,`f`)}currentRun(){return t(this,Mr,`f`)}currentMessageSnapshot(){return t(this,Tr,`f`)}currentRunStepSnapshot(){return t(this,Nr,`f`)}async finalRunSteps(){return await this.done(),Object.values(t(this,Cr,`f`))}async finalMessages(){return await this.done(),Object.values(t(this,wr,`f`))}async finalRun(){if(await this.done(),!t(this,Er,`f`))throw Error(`Final run was not received.`);return t(this,Er,`f`)}async _createThreadAssistantStream(e,n,r){let i=r?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener(`abort`,()=>this.controller.abort()));let a={...n,stream:!0},o=await e.createAndRun(a,{...r,signal:this.controller.signal});this._connected();for await(let e of o)t(this,I,`m`,Pr).call(this,e);if(o.controller.signal?.aborted)throw new s;return this._addRun(t(this,I,`m`,Fr).call(this))}async _createAssistantStream(e,n,r,i){let a=i?.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener(`abort`,()=>this.controller.abort()));let o={...r,stream:!0},c=await e.create(n,o,{...i,signal:this.controller.signal});this._connected();for await(let e of c)t(this,I,`m`,Pr).call(this,e);if(c.controller.signal?.aborted)throw new s;return this._addRun(t(this,I,`m`,Fr).call(this))}static accumulateDelta(e,t){for(let[n,r]of Object.entries(t)){if(!e.hasOwnProperty(n)){e[n]=r;continue}let t=e[n];if(t==null){e[n]=r;continue}if(n===`index`||n===`type`){e[n]=r;continue}if(typeof t==`string`&&typeof r==`string`)t+=r;else if(typeof t==`number`&&typeof r==`number`)t+=r;else if(te(t)&&te(r))t=this.accumulateDelta(t,r);else if(Array.isArray(t)&&Array.isArray(r)){if(t.every(e=>typeof e==`string`||typeof e==`number`)){t.push(...r);continue}for(let e of r){if(!te(e))throw Error(`Expected array delta entry to be an object but got: ${e}`);let n=e.index;if(n==null)throw console.error(e),Error("Expected array delta entry to have an `index` property");if(typeof n!=`number`)throw Error(`Expected array delta entry \`index\` property to be a number but got ${n}`);let r=t[n];r==null?t.push(e):t[n]=this.accumulateDelta(r,e)}continue}else throw Error(`Unhandled record type: ${n}, deltaValue: ${r}, accValue: ${t}`);e[n]=t}return e}_addRun(e){return e}async _threadAssistantStream(e,t,n){return await this._createThreadAssistantStream(t,e,n)}async _runAssistantStream(e,t,n,r){return await this._createAssistantStream(t,e,n,r)}async _runToolAssistantStream(e,t,n,r){return await this._createToolAssistantStream(t,e,n,r)}};xr=Ur,Pr=function(n){if(!this.ended)switch(e(this,jr,n,`f`),t(this,I,`m`,Rr).call(this,n),n.event){case`thread.created`:break;case`thread.run.created`:case`thread.run.queued`:case`thread.run.in_progress`:case`thread.run.requires_action`:case`thread.run.completed`:case`thread.run.incomplete`:case`thread.run.failed`:case`thread.run.cancelling`:case`thread.run.cancelled`:case`thread.run.expired`:t(this,I,`m`,Hr).call(this,n);break;case`thread.run.step.created`:case`thread.run.step.in_progress`:case`thread.run.step.delta`:case`thread.run.step.completed`:case`thread.run.step.failed`:case`thread.run.step.cancelled`:case`thread.run.step.expired`:t(this,I,`m`,Lr).call(this,n);break;case`thread.message.created`:case`thread.message.in_progress`:case`thread.message.delta`:case`thread.message.completed`:case`thread.message.incomplete`:t(this,I,`m`,Ir).call(this,n);break;case`error`:throw Error(`Encountered an error event in event processing - errors should be processed earlier`);default:}},Fr=function(){if(this.ended)throw new a(`stream has ended, this shouldn't happen`);if(!t(this,Er,`f`))throw Error(`Final run has not been received`);return t(this,Er,`f`)},Ir=function(n){let[r,i]=t(this,I,`m`,Br).call(this,n,t(this,Tr,`f`));e(this,Tr,r,`f`),t(this,wr,`f`)[r.id]=r;for(let e of i){let t=r.content[e.index];t?.type==`text`&&this._emit(`textCreated`,t.text)}switch(n.event){case`thread.message.created`:this._emit(`messageCreated`,n.data);break;case`thread.message.in_progress`:break;case`thread.message.delta`:if(this._emit(`messageDelta`,n.data.delta,r),n.data.delta.content)for(let i of n.data.delta.content){if(i.type==`text`&&i.text){let e=i.text,t=r.content[i.index];if(t&&t.type==`text`)this._emit(`textDelta`,e,t.text);else throw Error(`The snapshot associated with this text delta is not text or missing`)}if(i.index!=t(this,Dr,`f`)){if(t(this,Or,`f`))switch(t(this,Or,`f`).type){case`text`:this._emit(`textDone`,t(this,Or,`f`).text,t(this,Tr,`f`));break;case`image_file`:this._emit(`imageFileDone`,t(this,Or,`f`).image_file,t(this,Tr,`f`));break}e(this,Dr,i.index,`f`)}e(this,Or,r.content[i.index],`f`)}break;case`thread.message.completed`:case`thread.message.incomplete`:if(t(this,Dr,`f`)!==void 0){let e=n.data.content[t(this,Dr,`f`)];if(e)switch(e.type){case`image_file`:this._emit(`imageFileDone`,e.image_file,t(this,Tr,`f`));break;case`text`:this._emit(`textDone`,e.text,t(this,Tr,`f`));break}}t(this,Tr,`f`)&&this._emit(`messageDone`,n.data),e(this,Tr,void 0,`f`)}},Lr=function(n){let r=t(this,I,`m`,zr).call(this,n);switch(e(this,Nr,r,`f`),n.event){case`thread.run.step.created`:this._emit(`runStepCreated`,n.data);break;case`thread.run.step.delta`:let i=n.data.delta;if(i.step_details&&i.step_details.type==`tool_calls`&&i.step_details.tool_calls&&r.step_details.type==`tool_calls`)for(let n of i.step_details.tool_calls)n.index==t(this,kr,`f`)?this._emit(`toolCallDelta`,n,r.step_details.tool_calls[n.index]):(t(this,Ar,`f`)&&this._emit(`toolCallDone`,t(this,Ar,`f`)),e(this,kr,n.index,`f`),e(this,Ar,r.step_details.tool_calls[n.index],`f`),t(this,Ar,`f`)&&this._emit(`toolCallCreated`,t(this,Ar,`f`)));this._emit(`runStepDelta`,n.data.delta,r);break;case`thread.run.step.completed`:case`thread.run.step.failed`:case`thread.run.step.cancelled`:case`thread.run.step.expired`:e(this,Nr,void 0,`f`),n.data.step_details.type==`tool_calls`&&t(this,Ar,`f`)&&(this._emit(`toolCallDone`,t(this,Ar,`f`)),e(this,Ar,void 0,`f`)),this._emit(`runStepDone`,n.data,r);break;case`thread.run.step.in_progress`:break}},Rr=function(e){t(this,Sr,`f`).push(e),this._emit(`event`,e)},zr=function(e){switch(e.event){case`thread.run.step.created`:return t(this,Cr,`f`)[e.data.id]=e.data,e.data;case`thread.run.step.delta`:let n=t(this,Cr,`f`)[e.data.id];if(!n)throw Error(`Received a RunStepDelta before creation of a snapshot`);let r=e.data;if(r.delta){let i=xr.accumulateDelta(n,r.delta);t(this,Cr,`f`)[e.data.id]=i}return t(this,Cr,`f`)[e.data.id];case`thread.run.step.completed`:case`thread.run.step.failed`:case`thread.run.step.cancelled`:case`thread.run.step.expired`:case`thread.run.step.in_progress`:t(this,Cr,`f`)[e.data.id]=e.data;break}if(t(this,Cr,`f`)[e.data.id])return t(this,Cr,`f`)[e.data.id];throw Error(`No snapshot available`)},Br=function(e,n){let r=[];switch(e.event){case`thread.message.created`:return[e.data,r];case`thread.message.delta`:if(!n)throw Error(`Received a delta with no existing snapshot (there should be one from message creation)`);let i=e.data;if(i.delta.content)for(let e of i.delta.content)if(e.index in n.content){let r=n.content[e.index];n.content[e.index]=t(this,I,`m`,Vr).call(this,e,r)}else n.content[e.index]=e,r.push(e);return[n,r];case`thread.message.in_progress`:case`thread.message.completed`:case`thread.message.incomplete`:if(n)return[n,r];throw Error(`Received thread message event with no existing snapshot`)}throw Error(`Tried to accumulate a non-message event`)},Vr=function(e,t){return xr.accumulateDelta(t,e)},Hr=function(n){switch(e(this,Mr,n.data,`f`),n.event){case`thread.run.created`:break;case`thread.run.queued`:break;case`thread.run.in_progress`:break;case`thread.run.requires_action`:case`thread.run.cancelled`:case`thread.run.failed`:case`thread.run.completed`:case`thread.run.expired`:case`thread.run.incomplete`:e(this,Er,n.data,`f`),t(this,Ar,`f`)&&(this._emit(`toolCallDone`,t(this,Ar,`f`)),e(this,Ar,void 0,`f`));break;case`thread.run.cancelling`:break}};var Wr=class extends A{constructor(){super(...arguments),this.steps=new vr(this._client)}create(e,t,n){let{include:r,...i}=t;return this._client.post(j`/threads/${e}/runs`,{query:{include:r},body:i,...n,headers:F([{"OpenAI-Beta":`assistants=v2`},n?.headers]),stream:t.stream??!1})}retrieve(e,t,n){let{thread_id:r}=t;return this._client.get(j`/threads/${r}/runs/${e}`,{...n,headers:F([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}update(e,t,n){let{thread_id:r,...i}=t;return this._client.post(j`/threads/${r}/runs/${e}`,{body:i,...n,headers:F([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}list(e,t={},n){return this._client.getAPIList(j`/threads/${e}/runs`,k,{query:t,...n,headers:F([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}cancel(e,t,n){let{thread_id:r}=t;return this._client.post(j`/threads/${r}/runs/${e}/cancel`,{...n,headers:F([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}async createAndPoll(e,t,n){let r=await this.create(e,t,n);return await this.poll(r.id,{thread_id:e},n)}createAndStream(e,t,n){return Ur.createAssistantStream(e,this._client.beta.threads.runs,t,n)}async poll(e,t,n){let r=F([n?.headers,{"X-Stainless-Poll-Helper":`true`,"X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:i,response:a}=await this.retrieve(e,t,{...n,headers:{...n?.headers,...r}}).withResponse();switch(i.status){case`queued`:case`in_progress`:case`cancelling`:let e=5e3;if(n?.pollIntervalMs)e=n.pollIntervalMs;else{let t=a.headers.get(`openai-poll-after-ms`);if(t){let n=parseInt(t);isNaN(n)||(e=n)}}await ie(e);break;case`requires_action`:case`incomplete`:case`cancelled`:case`completed`:case`failed`:case`expired`:return i}}}stream(e,t,n){return Ur.createAssistantStream(e,this._client.beta.threads.runs,t,n)}submitToolOutputs(e,t,n){let{thread_id:r,...i}=t;return this._client.post(j`/threads/${r}/runs/${e}/submit_tool_outputs`,{body:i,...n,headers:F([{"OpenAI-Beta":`assistants=v2`},n?.headers]),stream:t.stream??!1})}async submitToolOutputsAndPoll(e,t,n){let r=await this.submitToolOutputs(e,t,n);return await this.poll(r.id,t,n)}submitToolOutputsStream(e,t,n){return Ur.createToolAssistantStream(e,this._client.beta.threads.runs,t,n)}};Wr.Steps=vr;var Gr=class extends A{constructor(){super(...arguments),this.runs=new Wr(this._client),this.messages=new _r(this._client)}create(e={},t){return this._client.post(`/threads`,{body:e,...t,headers:F([{"OpenAI-Beta":`assistants=v2`},t?.headers])})}retrieve(e,t){return this._client.get(j`/threads/${e}`,{...t,headers:F([{"OpenAI-Beta":`assistants=v2`},t?.headers])})}update(e,t,n){return this._client.post(j`/threads/${e}`,{body:t,...n,headers:F([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}delete(e,t){return this._client.delete(j`/threads/${e}`,{...t,headers:F([{"OpenAI-Beta":`assistants=v2`},t?.headers])})}createAndRun(e,t){return this._client.post(`/threads/runs`,{body:e,...t,headers:F([{"OpenAI-Beta":`assistants=v2`},t?.headers]),stream:e.stream??!1})}async createAndRunPoll(e,t){let n=await this.createAndRun(e,t);return await this.runs.poll(n.id,{thread_id:n.thread_id},t)}createAndRunStream(e,t){return Ur.createThreadAssistantStream(e,this._client.beta.threads,t)}};Gr.Runs=Wr,Gr.Messages=_r;var Kr=class extends A{constructor(){super(...arguments),this.realtime=new pr(this._client),this.chatkit=new gr(this._client),this.assistants=new ur(this._client),this.threads=new Gr(this._client)}};Kr.Realtime=pr,Kr.ChatKit=gr,Kr.Assistants=ur,Kr.Threads=Gr;var qr=class extends A{create(e,t){return this._client.post(`/completions`,{body:e,...t,stream:e.stream??!1})}},Jr=class extends A{retrieve(e,t,n){let{container_id:r}=t;return this._client.get(j`/containers/${r}/files/${e}/content`,{...n,headers:F([{Accept:`application/binary`},n?.headers]),__binaryResponse:!0})}},Yr=class extends A{constructor(){super(...arguments),this.content=new Jr(this._client)}create(e,t,n){return this._client.post(j`/containers/${e}/files`,bt({body:t,...n},this._client))}retrieve(e,t,n){let{container_id:r}=t;return this._client.get(j`/containers/${r}/files/${e}`,n)}list(e,t={},n){return this._client.getAPIList(j`/containers/${e}/files`,k,{query:t,...n})}delete(e,t,n){let{container_id:r}=t;return this._client.delete(j`/containers/${r}/files/${e}`,{...n,headers:F([{Accept:`*/*`},n?.headers])})}};Yr.Content=Jr;var Xr=class extends A{constructor(){super(...arguments),this.files=new Yr(this._client)}create(e,t){return this._client.post(`/containers`,{body:e,...t})}retrieve(e,t){return this._client.get(j`/containers/${e}`,t)}list(e={},t){return this._client.getAPIList(`/containers`,k,{query:e,...t})}delete(e,t){return this._client.delete(j`/containers/${e}`,{...t,headers:F([{Accept:`*/*`},t?.headers])})}};Xr.Files=Yr;var Zr=class extends A{create(e,t,n){let{include:r,...i}=t;return this._client.post(j`/conversations/${e}/items`,{query:{include:r},body:i,...n})}retrieve(e,t,n){let{conversation_id:r,...i}=t;return this._client.get(j`/conversations/${r}/items/${e}`,{query:i,...n})}list(e,t={},n){return this._client.getAPIList(j`/conversations/${e}/items`,mt,{query:t,...n})}delete(e,t,n){let{conversation_id:r}=t;return this._client.delete(j`/conversations/${r}/items/${e}`,n)}},Qr=class extends A{constructor(){super(...arguments),this.items=new Zr(this._client)}create(e={},t){return this._client.post(`/conversations`,{body:e,...t})}retrieve(e,t){return this._client.get(j`/conversations/${e}`,t)}update(e,t,n){return this._client.post(j`/conversations/${e}`,{body:t,...n})}delete(e,t){return this._client.delete(j`/conversations/${e}`,t)}};Qr.Items=Zr;var $r=class extends A{create(e,t){let n=!!e.encoding_format,r=n?e.encoding_format:`base64`;n&&O(this._client).debug(`embeddings/user defined encoding_format:`,e.encoding_format);let i=this._client.post(`/embeddings`,{body:{...e,encoding_format:r},...t});return n?i:(O(this._client).debug(`embeddings/decoding base64 embeddings from base64`),i._thenUnwrap(e=>(e&&e.data&&e.data.forEach(e=>{let t=e.embedding;e.embedding=yr(t)}),e)))}},ei=class extends A{retrieve(e,t,n){let{eval_id:r,run_id:i}=t;return this._client.get(j`/evals/${r}/runs/${i}/output_items/${e}`,n)}list(e,t,n){let{eval_id:r,...i}=t;return this._client.getAPIList(j`/evals/${r}/runs/${e}/output_items`,k,{query:i,...n})}},ti=class extends A{constructor(){super(...arguments),this.outputItems=new ei(this._client)}create(e,t,n){return this._client.post(j`/evals/${e}/runs`,{body:t,...n})}retrieve(e,t,n){let{eval_id:r}=t;return this._client.get(j`/evals/${r}/runs/${e}`,n)}list(e,t={},n){return this._client.getAPIList(j`/evals/${e}/runs`,k,{query:t,...n})}delete(e,t,n){let{eval_id:r}=t;return this._client.delete(j`/evals/${r}/runs/${e}`,n)}cancel(e,t,n){let{eval_id:r}=t;return this._client.post(j`/evals/${r}/runs/${e}`,n)}};ti.OutputItems=ei;var ni=class extends A{constructor(){super(...arguments),this.runs=new ti(this._client)}create(e,t){return this._client.post(`/evals`,{body:e,...t})}retrieve(e,t){return this._client.get(j`/evals/${e}`,t)}update(e,t,n){return this._client.post(j`/evals/${e}`,{body:t,...n})}list(e={},t){return this._client.getAPIList(`/evals`,k,{query:e,...t})}delete(e,t){return this._client.delete(j`/evals/${e}`,t)}};ni.Runs=ti;var ri=class extends A{create(e,t){return this._client.post(`/files`,bt({body:e,...t},this._client))}retrieve(e,t){return this._client.get(j`/files/${e}`,t)}list(e={},t){return this._client.getAPIList(`/files`,k,{query:e,...t})}delete(e,t){return this._client.delete(j`/files/${e}`,t)}content(e,t){return this._client.get(j`/files/${e}/content`,{...t,headers:F([{Accept:`application/binary`},t?.headers]),__binaryResponse:!0})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:n=1800*1e3}={}){let r=new Set([`processed`,`error`,`deleted`]),i=Date.now(),a=await this.retrieve(e);for(;!a.status||!r.has(a.status);)if(await ie(t),a=await this.retrieve(e),Date.now()-i>n)throw new l({message:`Giving up on waiting for file ${e} to finish processing after ${n} milliseconds.`});return a}},ii=class extends A{},ai=class extends A{run(e,t){return this._client.post(`/fine_tuning/alpha/graders/run`,{body:e,...t})}validate(e,t){return this._client.post(`/fine_tuning/alpha/graders/validate`,{body:e,...t})}},oi=class extends A{constructor(){super(...arguments),this.graders=new ai(this._client)}};oi.Graders=ai;var si=class extends A{create(e,t,n){return this._client.getAPIList(j`/fine_tuning/checkpoints/${e}/permissions`,pt,{body:t,method:`post`,...n})}retrieve(e,t={},n){return this._client.get(j`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...n})}delete(e,t,n){let{fine_tuned_model_checkpoint:r}=t;return this._client.delete(j`/fine_tuning/checkpoints/${r}/permissions/${e}`,n)}},ci=class extends A{constructor(){super(...arguments),this.permissions=new si(this._client)}};ci.Permissions=si;var li=class extends A{list(e,t={},n){return this._client.getAPIList(j`/fine_tuning/jobs/${e}/checkpoints`,k,{query:t,...n})}},ui=class extends A{constructor(){super(...arguments),this.checkpoints=new li(this._client)}create(e,t){return this._client.post(`/fine_tuning/jobs`,{body:e,...t})}retrieve(e,t){return this._client.get(j`/fine_tuning/jobs/${e}`,t)}list(e={},t){return this._client.getAPIList(`/fine_tuning/jobs`,k,{query:e,...t})}cancel(e,t){return this._client.post(j`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},n){return this._client.getAPIList(j`/fine_tuning/jobs/${e}/events`,k,{query:t,...n})}pause(e,t){return this._client.post(j`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post(j`/fine_tuning/jobs/${e}/resume`,t)}};ui.Checkpoints=li;var di=class extends A{constructor(){super(...arguments),this.methods=new ii(this._client),this.jobs=new ui(this._client),this.checkpoints=new ci(this._client),this.alpha=new oi(this._client)}};di.Methods=ii,di.Jobs=ui,di.Checkpoints=ci,di.Alpha=oi;var fi=class extends A{},pi=class extends A{constructor(){super(...arguments),this.graderModels=new fi(this._client)}};pi.GraderModels=fi;var mi=class extends A{createVariation(e,t){return this._client.post(`/images/variations`,bt({body:e,...t},this._client))}edit(e,t){return this._client.post(`/images/edits`,bt({body:e,...t,stream:e.stream??!1},this._client))}generate(e,t){return this._client.post(`/images/generations`,{body:e,...t,stream:e.stream??!1})}},hi=class extends A{retrieve(e,t){return this._client.get(j`/models/${e}`,t)}list(e){return this._client.getAPIList(`/models`,pt,e)}delete(e,t){return this._client.delete(j`/models/${e}`,t)}},gi=class extends A{create(e,t){return this._client.post(`/moderations`,{body:e,...t})}},_i=class extends A{accept(e,t,n){return this._client.post(j`/realtime/calls/${e}/accept`,{body:t,...n,headers:F([{Accept:`*/*`},n?.headers])})}hangup(e,t){return this._client.post(j`/realtime/calls/${e}/hangup`,{...t,headers:F([{Accept:`*/*`},t?.headers])})}refer(e,t,n){return this._client.post(j`/realtime/calls/${e}/refer`,{body:t,...n,headers:F([{Accept:`*/*`},n?.headers])})}reject(e,t={},n){return this._client.post(j`/realtime/calls/${e}/reject`,{body:t,...n,headers:F([{Accept:`*/*`},n?.headers])})}},vi=class extends A{create(e,t){return this._client.post(`/realtime/client_secrets`,{body:e,...t})}},yi=class extends A{constructor(){super(...arguments),this.clientSecrets=new vi(this._client),this.calls=new _i(this._client)}};yi.ClientSecrets=vi,yi.Calls=_i;function bi(e,t){return!t||!Ci(t)?{...e,output_parsed:null,output:e.output.map(e=>e.type===`function_call`?{...e,parsed_arguments:null}:e.type===`message`?{...e,content:e.content.map(e=>({...e,parsed:null}))}:e)}:xi(e,t)}function xi(e,t){let n=e.output.map(e=>{if(e.type===`function_call`)return{...e,parsed_arguments:Ei(t,e)};if(e.type===`message`){let n=e.content.map(e=>e.type===`output_text`?{...e,parsed:Si(t,e.text)}:e);return{...e,content:n}}return e}),r=Object.assign({},e,{output:n});return Object.getOwnPropertyDescriptor(e,`output_text`)||Di(r),Object.defineProperty(r,`output_parsed`,{enumerable:!0,get(){for(let e of r.output)if(e.type===`message`){for(let t of e.content)if(t.type===`output_text`&&t.parsed!==null)return t.parsed}return null}}),r}function Si(e,t){return e.text?.format?.type===`json_schema`?`$parseRaw`in e.text?.format?(e.text?.format).$parseRaw(t):JSON.parse(t):null}function Ci(e){return!!Rt(e.text?.format)}function wi(e){return e?.$brand===`auto-parseable-tool`}function Ti(e,t){return e.find(e=>e.type===`function`&&e.name===t)}function Ei(e,t){let n=Ti(e.tools??[],t.name);return{...t,...t,parsed_arguments:wi(n)?n.$parseRaw(t.arguments):n?.strict?JSON.parse(t.arguments):null}}function Di(e){let t=[];for(let n of e.output)if(n.type===`message`)for(let e of n.content)e.type===`output_text`&&t.push(e.text);e.output_text=t.join(``)}var Oi,ki,Ai,ji,Mi,Ni,Pi,Fi,Ii=class n extends un{constructor(t){super(),Oi.add(this),ki.set(this,void 0),Ai.set(this,void 0),ji.set(this,void 0),e(this,ki,t,`f`)}static createResponse(e,t,r){let i=new n(t);return i._run(()=>i._createOrRetrieveResponse(e,t,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":`stream`}})),i}async _createOrRetrieveResponse(e,n,r){let i=r?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener(`abort`,()=>this.controller.abort())),t(this,Oi,`m`,Mi).call(this);let a,o=null;`response_id`in n?(a=await e.responses.retrieve(n.response_id,{stream:!0},{...r,signal:this.controller.signal,stream:!0}),o=n.starting_after??null):a=await e.responses.create({...n,stream:!0},{...r,signal:this.controller.signal}),this._connected();for await(let e of a)t(this,Oi,`m`,Ni).call(this,e,o);if(a.controller.signal?.aborted)throw new s;return t(this,Oi,`m`,Pi).call(this)}[(ki=new WeakMap,Ai=new WeakMap,ji=new WeakMap,Oi=new WeakSet,Mi=function(){this.ended||e(this,Ai,void 0,`f`)},Ni=function(e,n){if(this.ended)return;let r=(e,t)=>{(n==null||t.sequence_number>n)&&this._emit(e,t)},i=t(this,Oi,`m`,Fi).call(this,e);switch(r(`event`,e),e.type){case`response.output_text.delta`:{let t=i.output[e.output_index];if(!t)throw new a(`missing output at index ${e.output_index}`);if(t.type===`message`){let n=t.content[e.content_index];if(!n)throw new a(`missing content at index ${e.content_index}`);if(n.type!==`output_text`)throw new a(`expected content to be 'output_text', got ${n.type}`);r(`response.output_text.delta`,{...e,snapshot:n.text})}break}case`response.function_call_arguments.delta`:{let t=i.output[e.output_index];if(!t)throw new a(`missing output at index ${e.output_index}`);t.type===`function_call`&&r(`response.function_call_arguments.delta`,{...e,snapshot:t.arguments});break}default:r(e.type,e);break}},Pi=function(){if(this.ended)throw new a(`stream has ended, this shouldn't happen`);let n=t(this,Ai,`f`);if(!n)throw new a(`request ended without sending any events`);e(this,Ai,void 0,`f`);let r=Li(n,t(this,ki,`f`));return e(this,ji,r,`f`),r},Fi=function(n){let r=t(this,Ai,`f`);if(!r){if(n.type!==`response.created`)throw new a(`When snapshot hasn't been set yet, expected 'response.created' event, got ${n.type}`);return r=e(this,Ai,n.response,`f`),r}switch(n.type){case`response.output_item.added`:r.output.push(n.item);break;case`response.content_part.added`:{let e=r.output[n.output_index];if(!e)throw new a(`missing output at index ${n.output_index}`);let t=e.type,i=n.part;t===`message`&&i.type!==`reasoning_text`?e.content.push(i):t===`reasoning`&&i.type===`reasoning_text`&&(e.content||=[],e.content.push(i));break}case`response.output_text.delta`:{let e=r.output[n.output_index];if(!e)throw new a(`missing output at index ${n.output_index}`);if(e.type===`message`){let t=e.content[n.content_index];if(!t)throw new a(`missing content at index ${n.content_index}`);if(t.type!==`output_text`)throw new a(`expected content to be 'output_text', got ${t.type}`);t.text+=n.delta}break}case`response.function_call_arguments.delta`:{let e=r.output[n.output_index];if(!e)throw new a(`missing output at index ${n.output_index}`);e.type===`function_call`&&(e.arguments+=n.delta);break}case`response.reasoning_text.delta`:{let e=r.output[n.output_index];if(!e)throw new a(`missing output at index ${n.output_index}`);if(e.type===`reasoning`){let t=e.content?.[n.content_index];if(!t)throw new a(`missing content at index ${n.content_index}`);if(t.type!==`reasoning_text`)throw new a(`expected content to be 'reasoning_text', got ${t.type}`);t.text+=n.delta}break}case`response.completed`:e(this,Ai,n.response,`f`);break}return r},Symbol.asyncIterator)](){let e=[],t=[],n=!1;return this.on(`event`,n=>{let r=t.shift();r?r.resolve(n):e.push(n)}),this.on(`end`,()=>{n=!0;for(let e of t)e.resolve(void 0);t.length=0}),this.on(`abort`,e=>{n=!0;for(let n of t)n.reject(e);t.length=0}),this.on(`error`,e=>{n=!0;for(let n of t)n.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((e,n)=>t.push({resolve:e,reject:n})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();let e=t(this,ji,`f`);if(!e)throw new a(`stream ended without producing a ChatCompletion`);return e}};function Li(e,t){return bi(e,t)}var Ri=class extends A{list(e,t={},n){return this._client.getAPIList(j`/responses/${e}/input_items`,k,{query:t,...n})}},zi=class extends A{count(e={},t){return this._client.post(`/responses/input_tokens`,{body:e,...t})}},Bi=class extends A{constructor(){super(...arguments),this.inputItems=new Ri(this._client),this.inputTokens=new zi(this._client)}create(e,t){return this._client.post(`/responses`,{body:e,...t,stream:e.stream??!1})._thenUnwrap(e=>(`object`in e&&e.object===`response`&&Di(e),e))}retrieve(e,t={},n){return this._client.get(j`/responses/${e}`,{query:t,...n,stream:t?.stream??!1})._thenUnwrap(e=>(`object`in e&&e.object===`response`&&Di(e),e))}delete(e,t){return this._client.delete(j`/responses/${e}`,{...t,headers:F([{Accept:`*/*`},t?.headers])})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(t=>xi(t,e))}stream(e,t){return Ii.createResponse(this._client,e,t)}cancel(e,t){return this._client.post(j`/responses/${e}/cancel`,t)}compact(e={},t){return this._client.post(`/responses/compact`,{body:e,...t})}};Bi.InputItems=Ri,Bi.InputTokens=zi;var Vi=class extends A{create(e,t,n){return this._client.post(j`/uploads/${e}/parts`,bt({body:t,...n},this._client))}},Hi=class extends A{constructor(){super(...arguments),this.parts=new Vi(this._client)}create(e,t){return this._client.post(`/uploads`,{body:e,...t})}cancel(e,t){return this._client.post(j`/uploads/${e}/cancel`,t)}complete(e,t,n){return this._client.post(j`/uploads/${e}/complete`,{body:t,...n})}};Hi.Parts=Vi;const Ui=async e=>{let t=await Promise.allSettled(e),n=t.filter(e=>e.status===`rejected`);if(n.length){for(let e of n)console.error(e.reason);throw Error(`${n.length} promise(s) failed - see the above errors`)}let r=[];for(let e of t)e.status===`fulfilled`&&r.push(e.value);return r};var Wi=class extends A{create(e,t,n){return this._client.post(j`/vector_stores/${e}/file_batches`,{body:t,...n,headers:F([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}retrieve(e,t,n){let{vector_store_id:r}=t;return this._client.get(j`/vector_stores/${r}/file_batches/${e}`,{...n,headers:F([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}cancel(e,t,n){let{vector_store_id:r}=t;return this._client.post(j`/vector_stores/${r}/file_batches/${e}/cancel`,{...n,headers:F([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}async createAndPoll(e,t,n){let r=await this.create(e,t);return await this.poll(e,r.id,n)}listFiles(e,t,n){let{vector_store_id:r,...i}=t;return this._client.getAPIList(j`/vector_stores/${r}/file_batches/${e}/files`,k,{query:i,...n,headers:F([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}async poll(e,t,n){let r=F([n?.headers,{"X-Stainless-Poll-Helper":`true`,"X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:i,response:a}=await this.retrieve(t,{vector_store_id:e},{...n,headers:r}).withResponse();switch(i.status){case`in_progress`:let e=5e3;if(n?.pollIntervalMs)e=n.pollIntervalMs;else{let t=a.headers.get(`openai-poll-after-ms`);if(t){let n=parseInt(t);isNaN(n)||(e=n)}}await ie(e);break;case`failed`:case`cancelled`:case`completed`:return i}}}async uploadAndPoll(e,{files:t,fileIds:n=[]},r){if(t==null||t.length==0)throw Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");let i=r?.maxConcurrency??5,a=Math.min(i,t.length),o=this._client,s=t.values(),c=[...n];async function l(e){for(let t of e){let e=await o.files.create({file:t,purpose:`assistants`},r);c.push(e.id)}}return await Ui(Array(a).fill(s).map(l)),await this.createAndPoll(e,{file_ids:c})}},Gi=class extends A{create(e,t,n){return this._client.post(j`/vector_stores/${e}/files`,{body:t,...n,headers:F([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}retrieve(e,t,n){let{vector_store_id:r}=t;return this._client.get(j`/vector_stores/${r}/files/${e}`,{...n,headers:F([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}update(e,t,n){let{vector_store_id:r,...i}=t;return this._client.post(j`/vector_stores/${r}/files/${e}`,{body:i,...n,headers:F([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}list(e,t={},n){return this._client.getAPIList(j`/vector_stores/${e}/files`,k,{query:t,...n,headers:F([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}delete(e,t,n){let{vector_store_id:r}=t;return this._client.delete(j`/vector_stores/${r}/files/${e}`,{...n,headers:F([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}async createAndPoll(e,t,n){let r=await this.create(e,t,n);return await this.poll(e,r.id,n)}async poll(e,t,n){let r=F([n?.headers,{"X-Stainless-Poll-Helper":`true`,"X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){let i=await this.retrieve(t,{vector_store_id:e},{...n,headers:r}).withResponse(),a=i.data;switch(a.status){case`in_progress`:let e=5e3;if(n?.pollIntervalMs)e=n.pollIntervalMs;else{let t=i.response.headers.get(`openai-poll-after-ms`);if(t){let n=parseInt(t);isNaN(n)||(e=n)}}await ie(e);break;case`failed`:case`completed`:return a}}}async upload(e,t,n){let r=await this._client.files.create({file:t,purpose:`assistants`},n);return this.create(e,{file_id:r.id},n)}async uploadAndPoll(e,t,n){let r=await this.upload(e,t,n);return await this.poll(e,r.id,n)}content(e,t,n){let{vector_store_id:r}=t;return this._client.getAPIList(j`/vector_stores/${r}/files/${e}/content`,pt,{...n,headers:F([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}},Ki=class extends A{constructor(){super(...arguments),this.files=new Gi(this._client),this.fileBatches=new Wi(this._client)}create(e,t){return this._client.post(`/vector_stores`,{body:e,...t,headers:F([{"OpenAI-Beta":`assistants=v2`},t?.headers])})}retrieve(e,t){return this._client.get(j`/vector_stores/${e}`,{...t,headers:F([{"OpenAI-Beta":`assistants=v2`},t?.headers])})}update(e,t,n){return this._client.post(j`/vector_stores/${e}`,{body:t,...n,headers:F([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}list(e={},t){return this._client.getAPIList(`/vector_stores`,k,{query:e,...t,headers:F([{"OpenAI-Beta":`assistants=v2`},t?.headers])})}delete(e,t){return this._client.delete(j`/vector_stores/${e}`,{...t,headers:F([{"OpenAI-Beta":`assistants=v2`},t?.headers])})}search(e,t,n){return this._client.getAPIList(j`/vector_stores/${e}/search`,pt,{body:t,method:`post`,...n,headers:F([{"OpenAI-Beta":`assistants=v2`},n?.headers])})}};Ki.Files=Gi,Ki.FileBatches=Wi;var qi=class extends A{create(e,t){return this._client.post(`/videos`,yt({body:e,...t},this._client))}retrieve(e,t){return this._client.get(j`/videos/${e}`,t)}list(e={},t){return this._client.getAPIList(`/videos`,mt,{query:e,...t})}delete(e,t){return this._client.delete(j`/videos/${e}`,t)}downloadContent(e,t={},n){return this._client.get(j`/videos/${e}/content`,{query:t,...n,headers:F([{Accept:`application/binary`},n?.headers]),__binaryResponse:!0})}remix(e,t,n){return this._client.post(j`/videos/${e}/remix`,yt({body:t,...n},this._client))}},Ji,Yi,Xi,Zi=class extends A{constructor(){super(...arguments),Ji.add(this)}async unwrap(e,t,n=this._client.webhookSecret,r=300){return await this.verifySignature(e,t,n,r),JSON.parse(e)}async verifySignature(e,n,r=this._client.webhookSecret,i=300){if(typeof crypto>`u`||typeof crypto.subtle.importKey!=`function`||typeof crypto.subtle.verify!=`function`)throw Error("Webhook signature verification is only supported when the `crypto` global is defined");t(this,Ji,`m`,Yi).call(this,r);let a=F([n]).values,o=t(this,Ji,`m`,Xi).call(this,a,`webhook-signature`),s=t(this,Ji,`m`,Xi).call(this,a,`webhook-timestamp`),c=t(this,Ji,`m`,Xi).call(this,a,`webhook-id`),l=parseInt(s,10);if(isNaN(l))throw new b(`Invalid webhook timestamp format`);let u=Math.floor(Date.now()/1e3);if(u-l>i)throw new b(`Webhook timestamp is too old`);if(l>u+i)throw new b(`Webhook timestamp is too new`);let d=o.split(` `).map(e=>e.startsWith(`v1,`)?e.substring(3):e),f=r.startsWith(`whsec_`)?Buffer.from(r.replace(`whsec_`,``),`base64`):Buffer.from(r,`utf-8`),p=c?`${c}.${s}.${e}`:`${s}.${e}`,m=await crypto.subtle.importKey(`raw`,f,{name:`HMAC`,hash:`SHA-256`},!1,[`verify`]);for(let e of d)try{let t=Buffer.from(e,`base64`);if(await crypto.subtle.verify(`HMAC`,m,t,new TextEncoder().encode(p)))return}catch{continue}throw new b(`The given webhook signature does not match the expected signature`)}};Ji=new WeakSet,Yi=function(e){if(typeof e!=`string`||e.length===0)throw Error(`The webhook secret must either be set using the env var, OPENAI_WEBHOOK_SECRET, on the client class, OpenAI({ webhookSecret: '123' }), or passed to this function`)},Xi=function(e,t){if(!e)throw Error(`Headers are required`);let n=e.get(t);if(n==null)throw Error(`Missing required header: ${t}`);return n};var Qi,$i,ea,ta,L=class{constructor({baseURL:t=br(`OPENAI_BASE_URL`),apiKey:n=br(`OPENAI_API_KEY`),organization:r=br(`OPENAI_ORG_ID`)??null,project:i=br(`OPENAI_PROJECT_ID`)??null,webhookSecret:o=br(`OPENAI_WEBHOOK_SECRET`)??null,...s}={}){if(Qi.add(this),ea.set(this,void 0),this.completions=new qr(this),this.chat=new nr(this),this.embeddings=new $r(this),this.files=new ri(this),this.images=new mi(this),this.audio=new cr(this),this.moderations=new gi(this),this.models=new hi(this),this.fineTuning=new di(this),this.graders=new pi(this),this.vectorStores=new Ki(this),this.webhooks=new Zi(this),this.beta=new Kr(this),this.batches=new lr(this),this.uploads=new Hi(this),this.responses=new Bi(this),this.realtime=new yi(this),this.conversations=new Qr(this),this.evals=new ni(this),this.containers=new Xr(this),this.videos=new qi(this),n===void 0)throw new a("Missing credentials. Please pass an `apiKey`, or set the `OPENAI_API_KEY` environment variable.");let c={apiKey:n,organization:r,project:i,webhookSecret:o,...s,baseURL:t||`https://api.openai.com/v1`};if(!c.dangerouslyAllowBrowser&&oe())throw new a(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);this.baseURL=c.baseURL,this.timeout=c.timeout??$i.DEFAULT_TIMEOUT,this.logger=c.logger??console;let l=`warn`;this.logLevel=l,this.logLevel=Je(c.logLevel,`ClientOptions.logLevel`,this)??Je(br(`OPENAI_LOG`),`process.env['OPENAI_LOG']`,this)??l,this.fetchOptions=c.fetchOptions,this.maxRetries=c.maxRetries??2,this.fetch=c.fetch??me(),e(this,ea,ye,`f`),this._options=c,this.apiKey=typeof n==`string`?n:`Missing Key`,this.organization=r,this.project=i,this.webhookSecret=o}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,organization:this.organization,project:this.project,webhookSecret:this.webhookSecret,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){}async authHeaders(e){return F([{Authorization:`Bearer ${this.apiKey}`}])}stringifyQuery(e){return Ie(e,{arrayFormat:`brackets`})}getUserAgent(){return`${this.constructor.name}/JS ${ae}`}defaultIdempotencyKey(){return`stainless-node-retry-${n()}`}makeStatusError(e,t,n,r){return o.generate(e,t,n,r)}async _callApiKey(){let e=this._options.apiKey;if(typeof e!=`function`)return!1;let t;try{t=await e()}catch(e){throw e instanceof a?e:new a(`Failed to get token from 'apiKey' function: ${e.message}`,{cause:e})}if(typeof t!=`string`||!t)throw new a(`Expected 'apiKey' function argument to return a string but it returned ${t}`);return this.apiKey=t,!0}buildURL(e,n,r){let i=!t(this,Qi,`m`,ta).call(this)&&r||this.baseURL,a=S(e)?new URL(e):new URL(i+(i.endsWith(`/`)&&e.startsWith(`/`)?e.slice(1):e)),o=this.defaultQuery();return E(o)||(n={...o,...n}),typeof n==`object`&&n&&!Array.isArray(n)&&(a.search=this.stringifyQuery(n)),a.toString()}async prepareOptions(e){await this._callApiKey()}async prepareRequest(e,{url:t,options:n}){}get(e,t){return this.methodRequest(`get`,e,t)}post(e,t){return this.methodRequest(`post`,e,t)}patch(e,t){return this.methodRequest(`patch`,e,t)}put(e,t){return this.methodRequest(`put`,e,t)}delete(e,t){return this.methodRequest(`delete`,e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then(n=>({method:e,path:t,...n})))}request(e,t=null){return new lt(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,n){let a=await e,o=a.maxRetries??this.maxRetries;t??=o,await this.prepareOptions(a);let{req:u,url:d,timeout:f}=await this.buildRequest(a,{retryCount:o-t});await this.prepareRequest(u,{url:d,options:a});let p=`log_`+(Math.random()*(1<<24)|0).toString(16).padStart(6,`0`),m=n===void 0?``:`, retryOf: ${n}`,h=Date.now();if(O(this).debug(`[${p}] sending request`,$e({retryOfRequestLogID:n,method:a.method,url:d,options:a,headers:u.headers})),a.signal?.aborted)throw new s;let g=new AbortController,_=await this.fetchWithTimeout(d,u,f,g).catch(i),v=Date.now();if(_ instanceof globalThis.Error){let e=`retrying, ${t} attempts remaining`;if(a.signal?.aborted)throw new s;let i=r(_)||/timed? ?out/i.test(String(_)+(`cause`in _?String(_.cause):``));if(t)return O(this).info(`[${p}] connection ${i?`timed out`:`failed`} - ${e}`),O(this).debug(`[${p}] connection ${i?`timed out`:`failed`} (${e})`,$e({retryOfRequestLogID:n,url:d,durationMs:v-h,message:_.message})),this.retryRequest(a,t,n??p);throw O(this).info(`[${p}] connection ${i?`timed out`:`failed`} - error; no more retries left`),O(this).debug(`[${p}] connection ${i?`timed out`:`failed`} (error; no more retries left)`,$e({retryOfRequestLogID:n,url:d,durationMs:v-h,message:_.message})),i?new l:new c({cause:_})}let y=`[${p}${m}${[..._.headers.entries()].filter(([e])=>e===`x-request-id`).map(([e,t])=>`, `+e+`: `+JSON.stringify(t)).join(``)}] ${u.method} ${d} ${_.ok?`succeeded`:`failed`} with status ${_.status} in ${v-h}ms`;if(!_.ok){let e=await this.shouldRetry(_);if(t&&e){let e=`retrying, ${t} attempts remaining`;return await ve(_.body),O(this).info(`${y} - ${e}`),O(this).debug(`[${p}] response error (${e})`,$e({retryOfRequestLogID:n,url:_.url,status:_.status,headers:_.headers,durationMs:v-h})),this.retryRequest(a,t,n??p,_.headers)}let r=e?`error; no more retries left`:`error; not retryable`;O(this).info(`${y} - ${r}`);let o=await _.text().catch(e=>i(e).message),s=re(o),c=s?void 0:o;throw O(this).debug(`[${p}] response error (${r})`,$e({retryOfRequestLogID:n,url:_.url,status:_.status,headers:_.headers,message:c,durationMs:Date.now()-h})),this.makeStatusError(_.status,s,c,_.headers)}return O(this).info(y),O(this).debug(`[${p}] response start`,$e({retryOfRequestLogID:n,url:_.url,status:_.status,headers:_.headers,durationMs:v-h})),{response:_,options:a,controller:g,requestLogID:p,retryOfRequestLogID:n,startTime:h}}getAPIList(e,t,n){return this.requestAPIList(t,{method:`get`,path:e,...n})}requestAPIList(e,t){let n=this.makeRequest(t,null,void 0);return new ft(this,n,e)}async fetchWithTimeout(e,t,n,r){let{signal:i,method:a,...o}=t||{};i&&i.addEventListener(`abort`,()=>r.abort());let s=setTimeout(()=>r.abort(),n),c=globalThis.ReadableStream&&o.body instanceof globalThis.ReadableStream||typeof o.body==`object`&&o.body!==null&&Symbol.asyncIterator in o.body,l={signal:r.signal,...c?{duplex:`half`}:{},method:`GET`,...o};a&&(l.method=a.toUpperCase());try{return await this.fetch.call(void 0,e,l)}finally{clearTimeout(s)}}async shouldRetry(e){let t=e.headers.get(`x-should-retry`);return t===`true`?!0:t===`false`?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,n,r){let i,a=r?.get(`retry-after-ms`);if(a){let e=parseFloat(a);Number.isNaN(e)||(i=e)}let o=r?.get(`retry-after`);if(o&&!i){let e=parseFloat(o);i=Number.isNaN(e)?Date.parse(o)-Date.now():e*1e3}if(!(i&&0<=i&&i<60*1e3)){let n=e.maxRetries??this.maxRetries;i=this.calculateDefaultRetryTimeoutMillis(t,n)}return await ie(i),this.makeRequest(e,t-1,n)}calculateDefaultRetryTimeoutMillis(e,t){let n=t-e;return Math.min(.5*2**n,8)*(1-Math.random()*.25)*1e3}async buildRequest(e,{retryCount:t=0}={}){let n={...e},{method:r,path:i,query:a,defaultBaseURL:o}=n,s=this.buildURL(i,a,o);`timeout`in n&&ne(`timeout`,n.timeout),n.timeout=n.timeout??this.timeout;let{bodyHeaders:c,body:l}=this.buildBody({options:n});return{req:{method:r,headers:await this.buildHeaders({options:e,method:r,bodyHeaders:c,retryCount:t}),...n.signal&&{signal:n.signal},...globalThis.ReadableStream&&l instanceof globalThis.ReadableStream&&{duplex:`half`},...l&&{body:l},...this.fetchOptions??{},...n.fetchOptions??{}},url:s,timeout:n.timeout}}async buildHeaders({options:e,method:t,bodyHeaders:n,retryCount:r}){let i={};this.idempotencyHeader&&t!==`get`&&(e.idempotencyKey||=this.defaultIdempotencyKey(),i[this.idempotencyHeader]=e.idempotencyKey);let a=F([i,{Accept:`application/json`,"User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(r),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...pe(),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project},await this.authHeaders(e),this._options.defaultHeaders,n,e.headers]);return this.validateHeaders(a),a.values}buildBody({options:{body:e,headers:n}}){if(!e)return{bodyHeaders:void 0,body:void 0};let r=F([n]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||typeof e==`string`&&r.values.has(`content-type`)||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:typeof e==`object`&&(Symbol.asyncIterator in e||Symbol.iterator in e&&`next`in e&&typeof e.next==`function`)?{bodyHeaders:void 0,body:ge(e)}:t(this,ea,`f`).call(this,{body:e,headers:r})}};$i=L,ea=new WeakMap,Qi=new WeakSet,ta=function(){return this.baseURL!==`https://api.openai.com/v1`},L.OpenAI=$i,L.DEFAULT_TIMEOUT=6e5,L.OpenAIError=a,L.APIError=o,L.APIConnectionError=c,L.APIConnectionTimeoutError=l,L.APIUserAbortError=s,L.NotFoundError=p,L.ConflictError=m,L.RateLimitError=g,L.BadRequestError=u,L.AuthenticationError=d,L.InternalServerError=_,L.PermissionDeniedError=f,L.UnprocessableEntityError=h,L.InvalidWebhookSignatureError=b,L.toFile=jt,L.Completions=qr,L.Chat=nr,L.Embeddings=$r,L.Files=ri,L.Images=mi,L.Audio=cr,L.Moderations=gi,L.Models=hi,L.FineTuning=di,L.Graders=pi,L.VectorStores=Ki,L.Webhooks=Zi,L.Beta=Kr,L.Batches=lr,L.Uploads=Hi,L.Responses=Bi,L.Realtime=yi,L.Conversations=Qr,L.Evals=ni,L.Containers=Xr,L.Videos=qi;function R(e,t,n,r,i){if(r===`m`)throw TypeError(`Private method is not writable`);if(r===`a`&&!i)throw TypeError(`Private accessor was defined without a setter`);if(typeof t==`function`?e!==t||!i:!t.has(e))throw TypeError(`Cannot write private member to an object whose class did not declare it`);return r===`a`?i.call(e,n):i?i.value=n:t.set(e,n),n}function z(e,t,n,r){if(n===`a`&&!r)throw TypeError(`Private accessor was defined without a getter`);if(typeof t==`function`?e!==t||!r:!t.has(e))throw TypeError(`Cannot read private member from an object whose class did not declare it`);return n===`m`?r:n===`a`?r.call(e):r?r.value:t.get(e)}let na=function(){let{crypto:e}=globalThis;if(e?.randomUUID)return na=e.randomUUID.bind(e),e.randomUUID();let t=new Uint8Array(1),n=e?()=>e.getRandomValues(t)[0]:()=>Math.random()*255&255;return`10000000-1000-4000-8000-100000000000`.replace(/[018]/g,e=>(e^n()&15>>e/4).toString(16))};function ra(e){return typeof e==`object`&&!!e&&(`name`in e&&e.name===`AbortError`||`message`in e&&String(e.message).includes(`FetchRequestCanceledException`))}const ia=e=>{if(e instanceof Error)return e;if(typeof e==`object`&&e){try{if(Object.prototype.toString.call(e)===`[object Error]`){let t=Error(e.message,e.cause?{cause:e.cause}:{});return e.stack&&(t.stack=e.stack),e.cause&&!t.cause&&(t.cause=e.cause),e.name&&(t.name=e.name),t}}catch{}try{return Error(JSON.stringify(e))}catch{}}return Error(e)};var B=class extends Error{},aa=class e extends B{constructor(t,n,r,i){super(`${e.makeMessage(t,n,r)}`),this.status=t,this.headers=i,this.requestID=i?.get(`request-id`),this.error=n}static makeMessage(e,t,n){let r=t?.message?typeof t.message==`string`?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&r?`${e} ${r}`:e?`${e} status code (no body)`:r||`(no status code or body)`}static generate(t,n,r,i){if(!t||!i)return new sa({message:r,cause:ia(n)});let a=n;return t===400?new la(t,a,r,i):t===401?new ua(t,a,r,i):t===403?new da(t,a,r,i):t===404?new fa(t,a,r,i):t===409?new pa(t,a,r,i):t===422?new ma(t,a,r,i):t===429?new ha(t,a,r,i):t>=500?new ga(t,a,r,i):new e(t,a,r,i)}},oa=class extends aa{constructor({message:e}={}){super(void 0,void 0,e||`Request was aborted.`,void 0)}},sa=class extends aa{constructor({message:e,cause:t}){super(void 0,void 0,e||`Connection error.`,void 0),t&&(this.cause=t)}},ca=class extends sa{constructor({message:e}={}){super({message:e??`Request timed out.`})}},la=class extends aa{},ua=class extends aa{},da=class extends aa{},fa=class extends aa{},pa=class extends aa{},ma=class extends aa{},ha=class extends aa{},ga=class extends aa{},_a=/^[a-z][a-z0-9+.-]*:/i;const va=e=>_a.test(e);let ya=e=>(ya=Array.isArray,ya(e)),ba=ya;function xa(e){return typeof e==`object`?e??{}:{}}function Sa(e){if(!e)return!0;for(let t in e)return!1;return!0}function Ca(e,t){return Object.prototype.hasOwnProperty.call(e,t)}const wa=(e,t)=>{if(typeof t!=`number`||!Number.isInteger(t))throw new B(`${e} must be an integer`);if(t<0)throw new B(`${e} must be a positive integer`);return t},Ta=e=>{try{return JSON.parse(e)}catch{return}},Ea=e=>new Promise(t=>setTimeout(t,e)),Da=`0.71.2`,Oa=()=>typeof window<`u`&&window.document!==void 0&&typeof navigator<`u`;function ka(){return typeof Deno<`u`&&Deno.build!=null?`deno`:typeof EdgeRuntime<`u`?`edge`:Object.prototype.toString.call(globalThis.process===void 0?0:globalThis.process)===`[object process]`?`node`:`unknown`}var Aa=()=>{let e=ka();if(e===`deno`)return{"X-Stainless-Lang":`js`,"X-Stainless-Package-Version":Da,"X-Stainless-OS":Na(Deno.build.os),"X-Stainless-Arch":Ma(Deno.build.arch),"X-Stainless-Runtime":`deno`,"X-Stainless-Runtime-Version":typeof Deno.version==`string`?Deno.version:Deno.version?.deno??`unknown`};if(typeof EdgeRuntime<`u`)return{"X-Stainless-Lang":`js`,"X-Stainless-Package-Version":Da,"X-Stainless-OS":`Unknown`,"X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":`edge`,"X-Stainless-Runtime-Version":globalThis.process.version};if(e===`node`)return{"X-Stainless-Lang":`js`,"X-Stainless-Package-Version":Da,"X-Stainless-OS":Na(globalThis.process.platform??`unknown`),"X-Stainless-Arch":Ma(globalThis.process.arch??`unknown`),"X-Stainless-Runtime":`node`,"X-Stainless-Runtime-Version":globalThis.process.version??`unknown`};let t=ja();return t?{"X-Stainless-Lang":`js`,"X-Stainless-Package-Version":Da,"X-Stainless-OS":`Unknown`,"X-Stainless-Arch":`unknown`,"X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":`js`,"X-Stainless-Package-Version":Da,"X-Stainless-OS":`Unknown`,"X-Stainless-Arch":`unknown`,"X-Stainless-Runtime":`unknown`,"X-Stainless-Runtime-Version":`unknown`}};function ja(){if(typeof navigator>`u`||!navigator)return null;for(let{key:e,pattern:t}of[{key:`edge`,pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:`ie`,pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:`ie`,pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:`chrome`,pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:`firefox`,pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:`safari`,pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}]){let n=t.exec(navigator.userAgent);if(n)return{browser:e,version:`${n[1]||0}.${n[2]||0}.${n[3]||0}`}}return null}var Ma=e=>e===`x32`?`x32`:e===`x86_64`||e===`x64`?`x64`:e===`arm`?`arm`:e===`aarch64`||e===`arm64`?`arm64`:e?`other:${e}`:`unknown`,Na=e=>(e=e.toLowerCase(),e.includes(`ios`)?`iOS`:e===`android`?`Android`:e===`darwin`?`MacOS`:e===`win32`?`Windows`:e===`freebsd`?`FreeBSD`:e===`openbsd`?`OpenBSD`:e===`linux`?`Linux`:e?`Other:${e}`:`Unknown`),Pa;const Fa=()=>Pa??=Aa();function Ia(){if(typeof fetch<`u`)return fetch;throw Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new Anthropic({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function La(...e){let t=globalThis.ReadableStream;if(t===void 0)throw Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new t(...e)}function Ra(e){let t=Symbol.asyncIterator in e?e[Symbol.asyncIterator]():e[Symbol.iterator]();return La({start(){},async pull(e){let{done:n,value:r}=await t.next();n?e.close():e.enqueue(r)},async cancel(){await t.return?.()}})}function za(e){if(e[Symbol.asyncIterator])return e;let t=e.getReader();return{async next(){try{let e=await t.read();return e?.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){let e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function Ba(e){if(typeof e!=`object`||!e)return;if(e[Symbol.asyncIterator]){await e[Symbol.asyncIterator]().return?.();return}let t=e.getReader(),n=t.cancel();t.releaseLock(),await n}const Va=({headers:e,body:t})=>({bodyHeaders:{"content-type":`application/json`},body:JSON.stringify(t)});function Ha(e){let t=0;for(let n of e)t+=n.length;let n=new Uint8Array(t),r=0;for(let t of e)n.set(t,r),r+=t.length;return n}var Ua;function Wa(e){let t;return(Ua??=(t=new globalThis.TextEncoder,t.encode.bind(t)))(e)}var Ga;function Ka(e){let t;return(Ga??=(t=new globalThis.TextDecoder,t.decode.bind(t)))(e)}var qa,Ja,Ya=class{constructor(){qa.set(this,void 0),Ja.set(this,void 0),R(this,qa,new Uint8Array,`f`),R(this,Ja,null,`f`)}decode(e){if(e==null)return[];let t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e==`string`?Wa(e):e;R(this,qa,Ha([z(this,qa,`f`),t]),`f`);let n=[],r;for(;(r=Xa(z(this,qa,`f`),z(this,Ja,`f`)))!=null;){if(r.carriage&&z(this,Ja,`f`)==null){R(this,Ja,r.index,`f`);continue}if(z(this,Ja,`f`)!=null&&(r.index!==z(this,Ja,`f`)+1||r.carriage)){n.push(Ka(z(this,qa,`f`).subarray(0,z(this,Ja,`f`)-1))),R(this,qa,z(this,qa,`f`).subarray(z(this,Ja,`f`)),`f`),R(this,Ja,null,`f`);continue}let e=z(this,Ja,`f`)===null?r.preceding:r.preceding-1,t=Ka(z(this,qa,`f`).subarray(0,e));n.push(t),R(this,qa,z(this,qa,`f`).subarray(r.index),`f`),R(this,Ja,null,`f`)}return n}flush(){return z(this,qa,`f`).length?this.decode(`
`):[]}};qa=new WeakMap,Ja=new WeakMap,Ya.NEWLINE_CHARS=new Set([`
`,`\r`]),Ya.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function Xa(e,t){for(let n=t??0;n<e.length;n++){if(e[n]===10)return{preceding:n,index:n+1,carriage:!1};if(e[n]===13)return{preceding:n,index:n+1,carriage:!0}}return null}function Za(e){for(let t=0;t<e.length-1;t++){if(e[t]===10&&e[t+1]===10||e[t]===13&&e[t+1]===13)return t+2;if(e[t]===13&&e[t+1]===10&&t+3<e.length&&e[t+2]===13&&e[t+3]===10)return t+4}return-1}var Qa={off:0,error:200,warn:300,info:400,debug:500};const $a=(e,t,n)=>{if(e){if(Ca(Qa,e))return e;V(n).warn(`${t} was set to ${JSON.stringify(e)}, expected one of ${JSON.stringify(Object.keys(Qa))}`)}};function eo(){}function to(e,t,n){return!t||Qa[e]>Qa[n]?eo:t[e].bind(t)}var no={error:eo,warn:eo,info:eo,debug:eo},ro=new WeakMap;function V(e){let t=e.logger,n=e.logLevel??`off`;if(!t)return no;let r=ro.get(t);if(r&&r[0]===n)return r[1];let i={error:to(`error`,t,n),warn:to(`warn`,t,n),info:to(`info`,t,n),debug:to(`debug`,t,n)};return ro.set(t,[n,i]),i}const io=e=>(e.options&&(e.options={...e.options},delete e.options.headers),e.headers&&=Object.fromEntries((e.headers instanceof Headers?[...e.headers]:Object.entries(e.headers)).map(([e,t])=>[e,e.toLowerCase()===`x-api-key`||e.toLowerCase()===`authorization`||e.toLowerCase()===`cookie`||e.toLowerCase()===`set-cookie`?`***`:t])),`retryOfRequestLogID`in e&&(e.retryOfRequestLogID&&(e.retryOf=e.retryOfRequestLogID),delete e.retryOfRequestLogID),e);var ao,oo=class e{constructor(e,t,n){this.iterator=e,ao.set(this,void 0),this.controller=t,R(this,ao,n,`f`)}static fromSSEResponse(t,n,r){let i=!1,a=r?V(r):console;async function*o(){if(i)throw new B("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");i=!0;let e=!1;try{for await(let e of so(t,n)){if(e.event===`completion`)try{yield JSON.parse(e.data)}catch(t){throw a.error(`Could not parse message into JSON:`,e.data),a.error(`From chunk:`,e.raw),t}if(e.event===`message_start`||e.event===`message_delta`||e.event===`message_stop`||e.event===`content_block_start`||e.event===`content_block_delta`||e.event===`content_block_stop`)try{yield JSON.parse(e.data)}catch(t){throw a.error(`Could not parse message into JSON:`,e.data),a.error(`From chunk:`,e.raw),t}if(e.event!==`ping`&&e.event===`error`)throw new aa(void 0,Ta(e.data)??e.data,void 0,t.headers)}e=!0}catch(e){if(ra(e))return;throw e}finally{e||n.abort()}}return new e(o,n,r)}static fromReadableStream(t,n,r){let i=!1;async function*a(){let e=new Ya,n=za(t);for await(let t of n)for(let n of e.decode(t))yield n;for(let t of e.flush())yield t}async function*o(){if(i)throw new B("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");i=!0;let e=!1;try{for await(let t of a())e||t&&(yield JSON.parse(t));e=!0}catch(e){if(ra(e))return;throw e}finally{e||n.abort()}}return new e(o,n,r)}[(ao=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){let t=[],n=[],r=this.iterator(),i=e=>({next:()=>{if(e.length===0){let e=r.next();t.push(e),n.push(e)}return e.shift()}});return[new e(()=>i(t),this.controller,z(this,ao,`f`)),new e(()=>i(n),this.controller,z(this,ao,`f`))]}toReadableStream(){let e=this,t;return La({async start(){t=e[Symbol.asyncIterator]()},async pull(e){try{let{value:n,done:r}=await t.next();if(r)return e.close();let i=Wa(JSON.stringify(n)+`
`);e.enqueue(i)}catch(t){e.error(t)}},async cancel(){await t.return?.()}})}};async function*so(e,t){if(!e.body)throw t.abort(),globalThis.navigator!==void 0&&globalThis.navigator.product===`ReactNative`?new B(`The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api`):new B(`Attempted to iterate over a response with no body`);let n=new lo,r=new Ya,i=za(e.body);for await(let e of co(i))for(let t of r.decode(e)){let e=n.decode(t);e&&(yield e)}for(let e of r.flush()){let t=n.decode(e);t&&(yield t)}}async function*co(e){let t=new Uint8Array;for await(let n of e){if(n==null)continue;let e=n instanceof ArrayBuffer?new Uint8Array(n):typeof n==`string`?Wa(n):n,r=new Uint8Array(t.length+e.length);r.set(t),r.set(e,t.length),t=r;let i;for(;(i=Za(t))!==-1;)yield t.slice(0,i),t=t.slice(i)}t.length>0&&(yield t)}var lo=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith(`\r`)&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let e={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(`:`))return null;let[t,n,r]=uo(e,`:`);return r.startsWith(` `)&&(r=r.substring(1)),t===`event`?this.event=r:t===`data`&&this.data.push(r),null}};function uo(e,t){let n=e.indexOf(t);return n===-1?[e,``,``]:[e.substring(0,n),t,e.substring(n+t.length)]}async function fo(e,t){let{response:n,requestLogID:r,retryOfRequestLogID:i,startTime:a}=t,o=await(async()=>{if(t.options.stream)return V(e).debug(`response`,n.status,n.url,n.headers,n.body),t.options.__streamClass?t.options.__streamClass.fromSSEResponse(n,t.controller):oo.fromSSEResponse(n,t.controller);if(n.status===204)return null;if(t.options.__binaryResponse)return n;let r=n.headers.get(`content-type`)?.split(`;`)[0]?.trim();return r?.includes(`application/json`)||r?.endsWith(`+json`)?po(await n.json(),n):await n.text()})();return V(e).debug(`[${r}] response parsed`,io({retryOfRequestLogID:i,url:n.url,status:n.status,body:o,durationMs:Date.now()-a})),o}function po(e,t){return!e||typeof e!=`object`||Array.isArray(e)?e:Object.defineProperty(e,`_request_id`,{value:t.headers.get(`request-id`),enumerable:!1})}var mo,ho=class e extends Promise{constructor(e,t,n=fo){super(e=>{e(null)}),this.responsePromise=t,this.parseResponse=n,mo.set(this,void 0),R(this,mo,e,`f`)}_thenUnwrap(t){return new e(z(this,mo,`f`),this.responsePromise,async(e,n)=>po(t(await this.parseResponse(e,n),n),n.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get(`request-id`)}}parse(){return this.parsedPromise||=this.responsePromise.then(e=>this.parseResponse(z(this,mo,`f`),e)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}};mo=new WeakMap;var go,_o=class{constructor(e,t,n,r){go.set(this,void 0),R(this,go,e,`f`),this.options=r,this.response=t,this.body=n}hasNextPage(){return this.getPaginatedItems().length?this.nextPageRequestOptions()!=null:!1}async getNextPage(){let e=this.nextPageRequestOptions();if(!e)throw new B("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await z(this,go,`f`).requestAPIList(this.constructor,e)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(go=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}},vo=class extends ho{constructor(e,t,n){super(e,t,async(e,t)=>new n(e,t.response,await fo(e,t),t.options))}async*[Symbol.asyncIterator](){let e=await this;for await(let t of e)yield t}},yo=class extends _o{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[],this.has_more=n.has_more||!1,this.first_id=n.first_id||null,this.last_id=n.last_id||null}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){if(this.options.query?.before_id){let e=this.first_id;return e?{...this.options,query:{...xa(this.options.query),before_id:e}}:null}let e=this.last_id;return e?{...this.options,query:{...xa(this.options.query),after_id:e}}:null}},bo=class extends _o{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[],this.has_more=n.has_more||!1,this.next_page=n.next_page||null}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){let e=this.next_page;return e?{...this.options,query:{...xa(this.options.query),page:e}}:null}};const xo=()=>{if(typeof File>`u`){let{process:e}=globalThis,t=typeof e?.versions?.node==`string`&&parseInt(e.versions.node.split(`.`))<20;throw Error("`File` is not defined as a global, which is required for file uploads."+(t?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":``))}};function So(e,t,n){return xo(),new File(e,t??`unknown_file`,n)}function Co(e){return(typeof e==`object`&&!!e&&(`name`in e&&e.name&&String(e.name)||`url`in e&&e.url&&String(e.url)||`filename`in e&&e.filename&&String(e.filename)||`path`in e&&e.path&&String(e.path))||``).split(/[\\/]/).pop()||void 0}const wo=e=>typeof e==`object`&&!!e&&typeof e[Symbol.asyncIterator]==`function`,To=async(e,t)=>({...e,body:await Oo(e.body,t)});var Eo=new WeakMap;function Do(e){let t=typeof e==`function`?e:e.fetch,n=Eo.get(t);if(n)return n;let r=(async()=>{try{let e=`Response`in t?t.Response:(await t(`data:,`)).constructor,n=new FormData;return n.toString()!==await new e(n).text()}catch{return!0}})();return Eo.set(t,r),r}const Oo=async(e,t)=>{if(!await Do(t))throw TypeError(`The provided fetch function does not support file uploads with the current global FormData class.`);let n=new FormData;return await Promise.all(Object.entries(e||{}).map(([e,t])=>Ao(n,e,t))),n};var ko=e=>e instanceof Blob&&`name`in e,Ao=async(e,t,n)=>{if(n!==void 0){if(n==null)throw TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if(typeof n==`string`||typeof n==`number`||typeof n==`boolean`)e.append(t,String(n));else if(n instanceof Response){let r={},i=n.headers.get(`Content-Type`);i&&(r={type:i}),e.append(t,So([await n.blob()],Co(n),r))}else if(wo(n))e.append(t,So([await new Response(Ra(n)).blob()],Co(n)));else if(ko(n))e.append(t,So([n],Co(n),{type:n.type}));else if(Array.isArray(n))await Promise.all(n.map(n=>Ao(e,t+`[]`,n)));else if(typeof n==`object`)await Promise.all(Object.entries(n).map(([n,r])=>Ao(e,`${t}[${n}]`,r)));else throw TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${n} instead`)}},jo=e=>typeof e==`object`&&!!e&&typeof e.size==`number`&&typeof e.type==`string`&&typeof e.text==`function`&&typeof e.slice==`function`&&typeof e.arrayBuffer==`function`,Mo=e=>typeof e==`object`&&!!e&&typeof e.name==`string`&&typeof e.lastModified==`number`&&jo(e),No=e=>typeof e==`object`&&!!e&&typeof e.url==`string`&&typeof e.blob==`function`;async function Po(e,t,n){if(xo(),e=await e,t||=Co(e),Mo(e))return e instanceof File&&t==null&&n==null?e:So([await e.arrayBuffer()],t??e.name,{type:e.type,lastModified:e.lastModified,...n});if(No(e)){let r=await e.blob();return t||=new URL(e.url).pathname.split(/[\\/]/).pop(),So(await Fo(r),t,n)}let r=await Fo(e);if(!n?.type){let e=r.find(e=>typeof e==`object`&&`type`in e&&e.type);typeof e==`string`&&(n={...n,type:e})}return So(r,t,n)}async function Fo(e){let t=[];if(typeof e==`string`||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(jo(e))t.push(e instanceof Blob?e:await e.arrayBuffer());else if(wo(e))for await(let n of e)t.push(...await Fo(n));else{let t=e?.constructor?.name;throw Error(`Unexpected data type: ${typeof e}${t?`; constructor: ${t}`:``}${Io(e)}`)}return t}function Io(e){return typeof e!=`object`||!e?``:`; props: [${Object.getOwnPropertyNames(e).map(e=>`"${e}"`).join(`, `)}]`}var Lo=class{constructor(e){this._client=e}},Ro=Symbol.for(`brand.privateNullableHeaders`);function*zo(e){if(!e)return;if(Ro in e){let{values:t,nulls:n}=e;yield*t.entries();for(let e of n)yield[e,null];return}let t=!1,n;e instanceof Headers?n=e.entries():ba(e)?n=e:(t=!0,n=Object.entries(e??{}));for(let e of n){let n=e[0];if(typeof n!=`string`)throw TypeError(`expected header name to be a string`);let r=ba(e[1])?e[1]:[e[1]],i=!1;for(let e of r)e!==void 0&&(t&&!i&&(i=!0,yield[n,null]),yield[n,e])}}const H=e=>{let t=new Headers,n=new Set;for(let r of e){let e=new Set;for(let[i,a]of zo(r)){let r=i.toLowerCase();e.has(r)||(t.delete(i),e.add(r)),a===null?(t.delete(i),n.add(r)):(t.append(i,a),n.delete(r))}}return{[Ro]:!0,values:t,nulls:n}};function Bo(e){return e.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}var Vo=Object.freeze(Object.create(null));const U=((e=Bo)=>function(t,...n){if(t.length===1)return t[0];let r=!1,i=[],a=t.reduce((t,a,o)=>{/[?#]/.test(a)&&(r=!0);let s=n[o],c=(r?encodeURIComponent:e)(``+s);return o!==n.length&&(s==null||typeof s==`object`&&s.toString===Object.getPrototypeOf(Object.getPrototypeOf(s.hasOwnProperty??Vo)??Vo)?.toString)&&(c=s+``,i.push({start:t.length+a.length,length:c.length,error:`Value of type ${Object.prototype.toString.call(s).slice(8,-1)} is not a valid path parameter`})),t+a+(o===n.length?``:c)},``),o=a.split(/[?#]/,1)[0],s=RegExp(`(?<=^|\\/)(?:\\.|%2e){1,2}(?=\\/|$)`,`gi`),c;for(;(c=s.exec(o))!==null;)i.push({start:c.index,length:c[0].length,error:`Value "${c[0]}" can\'t be safely passed as a path parameter`});if(i.sort((e,t)=>e.start-t.start),i.length>0){let e=0,t=i.reduce((t,n)=>{let r=` `.repeat(n.start-e),i=`^`.repeat(n.length);return e=n.start+n.length,t+r+i},``);throw new B(`Path parameters result in path with invalid segments:\n${i.map(e=>e.error).join(`
`)}\n${a}\n${t}`)}return a})(Bo);var Ho=class extends Lo{list(e={},t){let{betas:n,...r}=e??{};return this._client.getAPIList(`/v1/files`,yo,{query:r,...t,headers:H([{"anthropic-beta":[...n??[],`files-api-2025-04-14`].toString()},t?.headers])})}delete(e,t={},n){let{betas:r}=t??{};return this._client.delete(U`/v1/files/${e}`,{...n,headers:H([{"anthropic-beta":[...r??[],`files-api-2025-04-14`].toString()},n?.headers])})}download(e,t={},n){let{betas:r}=t??{};return this._client.get(U`/v1/files/${e}/content`,{...n,headers:H([{"anthropic-beta":[...r??[],`files-api-2025-04-14`].toString(),Accept:`application/binary`},n?.headers]),__binaryResponse:!0})}retrieveMetadata(e,t={},n){let{betas:r}=t??{};return this._client.get(U`/v1/files/${e}`,{...n,headers:H([{"anthropic-beta":[...r??[],`files-api-2025-04-14`].toString()},n?.headers])})}upload(e,t){let{betas:n,...r}=e;return this._client.post(`/v1/files`,To({body:r,...t,headers:H([{"anthropic-beta":[...n??[],`files-api-2025-04-14`].toString()},t?.headers])},this._client))}},Uo=class extends Lo{retrieve(e,t={},n){let{betas:r}=t??{};return this._client.get(U`/v1/models/${e}?beta=true`,{...n,headers:H([{...r?.toString()==null?void 0:{"anthropic-beta":r?.toString()}},n?.headers])})}list(e={},t){let{betas:n,...r}=e??{};return this._client.getAPIList(`/v1/models?beta=true`,yo,{query:r,...t,headers:H([{...n?.toString()==null?void 0:{"anthropic-beta":n?.toString()}},t?.headers])})}};const Wo={"claude-opus-4-20250514":8192,"claude-opus-4-0":8192,"claude-4-opus-20250514":8192,"anthropic.claude-opus-4-20250514-v1:0":8192,"claude-opus-4@20250514":8192,"claude-opus-4-1-20250805":8192,"anthropic.claude-opus-4-1-20250805-v1:0":8192,"claude-opus-4-1@20250805":8192};function Go(e,t,n){return!t||!(`parse`in(t.output_format??{}))?{...e,content:e.content.map(e=>{if(e.type===`text`){let t=Object.defineProperty({...e},`parsed_output`,{value:null,enumerable:!1});return Object.defineProperty(t,`parsed`,{get(){return n.logger.warn("The `parsed` property on `text` blocks is deprecated, please use `parsed_output` instead."),null},enumerable:!1})}return e}),parsed_output:null}:Ko(e,t,n)}function Ko(e,t,n){let r=null,i=e.content.map(e=>{if(e.type===`text`){let i=qo(t,e.text);r===null&&(r=i);let a=Object.defineProperty({...e},`parsed_output`,{value:i,enumerable:!1});return Object.defineProperty(a,`parsed`,{get(){return n.logger.warn("The `parsed` property on `text` blocks is deprecated, please use `parsed_output` instead."),i},enumerable:!1})}return e});return{...e,content:i,parsed_output:r}}function qo(e,t){if(e.output_format?.type!==`json_schema`)return null;try{return`parse`in e.output_format?e.output_format.parse(t):JSON.parse(t)}catch(e){throw new B(`Failed to parse structured output: ${e}`)}}var Jo=e=>{let t=0,n=[];for(;t<e.length;){let r=e[t];if(r===`\\`){t++;continue}if(r===`{`){n.push({type:`brace`,value:`{`}),t++;continue}if(r===`}`){n.push({type:`brace`,value:`}`}),t++;continue}if(r===`[`){n.push({type:`paren`,value:`[`}),t++;continue}if(r===`]`){n.push({type:`paren`,value:`]`}),t++;continue}if(r===`:`){n.push({type:`separator`,value:`:`}),t++;continue}if(r===`,`){n.push({type:`delimiter`,value:`,`}),t++;continue}if(r===`"`){let i=``,a=!1;for(r=e[++t];r!==`"`;){if(t===e.length){a=!0;break}if(r===`\\`){if(t++,t===e.length){a=!0;break}i+=r+e[t],r=e[++t]}else i+=r,r=e[++t]}r=e[++t],a||n.push({type:`string`,value:i});continue}if(r&&/\s/.test(r)){t++;continue}let i=/[0-9]/;if(r&&i.test(r)||r===`-`||r===`.`){let a=``;for(r===`-`&&(a+=r,r=e[++t]);r&&i.test(r)||r===`.`;)a+=r,r=e[++t];n.push({type:`number`,value:a});continue}let a=/[a-z]/i;if(r&&a.test(r)){let i=``;for(;r&&a.test(r)&&t!==e.length;)i+=r,r=e[++t];if(i==`true`||i==`false`||i===`null`)n.push({type:`name`,value:i});else{t++;continue}continue}t++}return n},Yo=e=>{if(e.length===0)return e;let t=e[e.length-1];switch(t.type){case`separator`:return e=e.slice(0,e.length-1),Yo(e);case`number`:let n=t.value[t.value.length-1];if(n===`.`||n===`-`)return e=e.slice(0,e.length-1),Yo(e);case`string`:let r=e[e.length-2];if(r?.type===`delimiter`||r?.type===`brace`&&r.value===`{`)return e=e.slice(0,e.length-1),Yo(e);break;case`delimiter`:return e=e.slice(0,e.length-1),Yo(e)}return e},Xo=e=>{let t=[];return e.map(e=>{e.type===`brace`&&(e.value===`{`?t.push(`}`):t.splice(t.lastIndexOf(`}`),1)),e.type===`paren`&&(e.value===`[`?t.push(`]`):t.splice(t.lastIndexOf(`]`),1))}),t.length>0&&t.reverse().map(t=>{t===`}`?e.push({type:`brace`,value:`}`}):t===`]`&&e.push({type:`paren`,value:`]`})}),e},Zo=e=>{let t=``;return e.map(e=>{switch(e.type){case`string`:t+=`"`+e.value+`"`;break;default:t+=e.value;break}}),t},Qo=e=>JSON.parse(Zo(Xo(Yo(Jo(e))))),$o,es,ts,ns,rs,is,as,os,ss,cs,ls,us,ds,fs,ps,ms,hs,gs,_s,vs,ys,bs,xs,Ss,Cs=`__json_buf`;function ws(e){return e.type===`tool_use`||e.type===`server_tool_use`||e.type===`mcp_tool_use`}var Ts=class e{constructor(e,t){$o.add(this),this.messages=[],this.receivedMessages=[],es.set(this,void 0),ts.set(this,null),this.controller=new AbortController,ns.set(this,void 0),rs.set(this,()=>{}),is.set(this,()=>{}),as.set(this,void 0),os.set(this,()=>{}),ss.set(this,()=>{}),cs.set(this,{}),ls.set(this,!1),us.set(this,!1),ds.set(this,!1),fs.set(this,!1),ps.set(this,void 0),ms.set(this,void 0),hs.set(this,void 0),vs.set(this,e=>{if(R(this,us,!0,`f`),ra(e)&&(e=new oa),e instanceof oa)return R(this,ds,!0,`f`),this._emit(`abort`,e);if(e instanceof B)return this._emit(`error`,e);if(e instanceof Error){let t=new B(e.message);return t.cause=e,this._emit(`error`,t)}return this._emit(`error`,new B(String(e)))}),R(this,ns,new Promise((e,t)=>{R(this,rs,e,`f`),R(this,is,t,`f`)}),`f`),R(this,as,new Promise((e,t)=>{R(this,os,e,`f`),R(this,ss,t,`f`)}),`f`),z(this,ns,`f`).catch(()=>{}),z(this,as,`f`).catch(()=>{}),R(this,ts,e,`f`),R(this,hs,t?.logger??console,`f`)}get response(){return z(this,ps,`f`)}get request_id(){return z(this,ms,`f`)}async withResponse(){R(this,fs,!0,`f`);let e=await z(this,ns,`f`);if(!e)throw Error("Could not resolve a `Response` object");return{data:this,response:e,request_id:e.headers.get(`request-id`)}}static fromReadableStream(t){let n=new e(null);return n._run(()=>n._fromReadableStream(t)),n}static createMessage(t,n,r,{logger:i}={}){let a=new e(n,{logger:i});for(let e of n.messages)a._addMessageParam(e);return R(a,ts,{...n,stream:!0},`f`),a._run(()=>a._createMessage(t,{...n,stream:!0},{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":`stream`}})),a}_run(e){e().then(()=>{this._emitFinal(),this._emit(`end`)},z(this,vs,`f`))}_addMessageParam(e){this.messages.push(e)}_addMessage(e,t=!0){this.receivedMessages.push(e),t&&this._emit(`message`,e)}async _createMessage(e,t,n){let r=n?.signal,i;r&&(r.aborted&&this.controller.abort(),i=this.controller.abort.bind(this.controller),r.addEventListener(`abort`,i));try{z(this,$o,`m`,ys).call(this);let{response:r,data:i}=await e.create({...t,stream:!0},{...n,signal:this.controller.signal}).withResponse();this._connected(r);for await(let e of i)z(this,$o,`m`,bs).call(this,e);if(i.controller.signal?.aborted)throw new oa;z(this,$o,`m`,xs).call(this)}finally{r&&i&&r.removeEventListener(`abort`,i)}}_connected(e){this.ended||(R(this,ps,e,`f`),R(this,ms,e?.headers.get(`request-id`),`f`),z(this,rs,`f`).call(this,e),this._emit(`connect`))}get ended(){return z(this,ls,`f`)}get errored(){return z(this,us,`f`)}get aborted(){return z(this,ds,`f`)}abort(){this.controller.abort()}on(e,t){return(z(this,cs,`f`)[e]||(z(this,cs,`f`)[e]=[])).push({listener:t}),this}off(e,t){let n=z(this,cs,`f`)[e];if(!n)return this;let r=n.findIndex(e=>e.listener===t);return r>=0&&n.splice(r,1),this}once(e,t){return(z(this,cs,`f`)[e]||(z(this,cs,`f`)[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,n)=>{R(this,fs,!0,`f`),e!==`error`&&this.once(`error`,n),this.once(e,t)})}async done(){R(this,fs,!0,`f`),await z(this,as,`f`)}get currentMessage(){return z(this,es,`f`)}async finalMessage(){return await this.done(),z(this,$o,`m`,gs).call(this)}async finalText(){return await this.done(),z(this,$o,`m`,_s).call(this)}_emit(e,...t){if(z(this,ls,`f`))return;e===`end`&&(R(this,ls,!0,`f`),z(this,os,`f`).call(this));let n=z(this,cs,`f`)[e];if(n&&(z(this,cs,`f`)[e]=n.filter(e=>!e.once),n.forEach(({listener:e})=>e(...t))),e===`abort`){let e=t[0];!z(this,fs,`f`)&&!n?.length&&Promise.reject(e),z(this,is,`f`).call(this,e),z(this,ss,`f`).call(this,e),this._emit(`end`);return}if(e===`error`){let e=t[0];!z(this,fs,`f`)&&!n?.length&&Promise.reject(e),z(this,is,`f`).call(this,e),z(this,ss,`f`).call(this,e),this._emit(`end`)}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit(`finalMessage`,z(this,$o,`m`,gs).call(this))}async _fromReadableStream(e,t){let n=t?.signal,r;n&&(n.aborted&&this.controller.abort(),r=this.controller.abort.bind(this.controller),n.addEventListener(`abort`,r));try{z(this,$o,`m`,ys).call(this),this._connected(null);let t=oo.fromReadableStream(e,this.controller);for await(let e of t)z(this,$o,`m`,bs).call(this,e);if(t.controller.signal?.aborted)throw new oa;z(this,$o,`m`,xs).call(this)}finally{n&&r&&n.removeEventListener(`abort`,r)}}[(es=new WeakMap,ts=new WeakMap,ns=new WeakMap,rs=new WeakMap,is=new WeakMap,as=new WeakMap,os=new WeakMap,ss=new WeakMap,cs=new WeakMap,ls=new WeakMap,us=new WeakMap,ds=new WeakMap,fs=new WeakMap,ps=new WeakMap,ms=new WeakMap,hs=new WeakMap,vs=new WeakMap,$o=new WeakSet,gs=function(){if(this.receivedMessages.length===0)throw new B(`stream ended without producing a Message with role=assistant`);return this.receivedMessages.at(-1)},_s=function(){if(this.receivedMessages.length===0)throw new B(`stream ended without producing a Message with role=assistant`);let e=this.receivedMessages.at(-1).content.filter(e=>e.type===`text`).map(e=>e.text);if(e.length===0)throw new B(`stream ended without producing a content block with type=text`);return e.join(` `)},ys=function(){this.ended||R(this,es,void 0,`f`)},bs=function(e){if(this.ended)return;let t=z(this,$o,`m`,Ss).call(this,e);switch(this._emit(`streamEvent`,e,t),e.type){case`content_block_delta`:{let n=t.content.at(-1);switch(e.delta.type){case`text_delta`:n.type===`text`&&this._emit(`text`,e.delta.text,n.text||``);break;case`citations_delta`:n.type===`text`&&this._emit(`citation`,e.delta.citation,n.citations??[]);break;case`input_json_delta`:ws(n)&&n.input&&this._emit(`inputJson`,e.delta.partial_json,n.input);break;case`thinking_delta`:n.type===`thinking`&&this._emit(`thinking`,e.delta.thinking,n.thinking);break;case`signature_delta`:n.type===`thinking`&&this._emit(`signature`,n.signature);break;default:e.delta}break}case`message_stop`:this._addMessageParam(t),this._addMessage(Go(t,z(this,ts,`f`),{logger:z(this,hs,`f`)}),!0);break;case`content_block_stop`:this._emit(`contentBlock`,t.content.at(-1));break;case`message_start`:R(this,es,t,`f`);break;case`content_block_start`:case`message_delta`:break}},xs=function(){if(this.ended)throw new B(`stream has ended, this shouldn't happen`);let e=z(this,es,`f`);if(!e)throw new B(`request ended without sending any chunks`);return R(this,es,void 0,`f`),Go(e,z(this,ts,`f`),{logger:z(this,hs,`f`)})},Ss=function(e){let t=z(this,es,`f`);if(e.type===`message_start`){if(t)throw new B(`Unexpected event order, got ${e.type} before receiving "message_stop"`);return e.message}if(!t)throw new B(`Unexpected event order, got ${e.type} before "message_start"`);switch(e.type){case`message_stop`:return t;case`message_delta`:return t.container=e.delta.container,t.stop_reason=e.delta.stop_reason,t.stop_sequence=e.delta.stop_sequence,t.usage.output_tokens=e.usage.output_tokens,t.context_management=e.context_management,e.usage.input_tokens!=null&&(t.usage.input_tokens=e.usage.input_tokens),e.usage.cache_creation_input_tokens!=null&&(t.usage.cache_creation_input_tokens=e.usage.cache_creation_input_tokens),e.usage.cache_read_input_tokens!=null&&(t.usage.cache_read_input_tokens=e.usage.cache_read_input_tokens),e.usage.server_tool_use!=null&&(t.usage.server_tool_use=e.usage.server_tool_use),t;case`content_block_start`:return t.content.push(e.content_block),t;case`content_block_delta`:{let n=t.content.at(e.index);switch(e.delta.type){case`text_delta`:n?.type===`text`&&(t.content[e.index]={...n,text:(n.text||``)+e.delta.text});break;case`citations_delta`:n?.type===`text`&&(t.content[e.index]={...n,citations:[...n.citations??[],e.delta.citation]});break;case`input_json_delta`:if(n&&ws(n)){let r=n[Cs]||``;r+=e.delta.partial_json;let i={...n};if(Object.defineProperty(i,Cs,{value:r,enumerable:!1,writable:!0}),r)try{i.input=Qo(r)}catch(e){let t=new B(`Unable to parse tool parameter JSON from model. Please retry your request or adjust your prompt. Error: ${e}. JSON: ${r}`);z(this,vs,`f`).call(this,t)}t.content[e.index]=i}break;case`thinking_delta`:n?.type===`thinking`&&(t.content[e.index]={...n,thinking:n.thinking+e.delta.thinking});break;case`signature_delta`:n?.type===`thinking`&&(t.content[e.index]={...n,signature:e.delta.signature});break;default:e.delta}return t}case`content_block_stop`:return t}},Symbol.asyncIterator)](){let e=[],t=[],n=!1;return this.on(`streamEvent`,n=>{let r=t.shift();r?r.resolve(n):e.push(n)}),this.on(`end`,()=>{n=!0;for(let e of t)e.resolve(void 0);t.length=0}),this.on(`abort`,e=>{n=!0;for(let n of t)n.reject(e);t.length=0}),this.on(`error`,e=>{n=!0;for(let n of t)n.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((e,n)=>t.push({resolve:e,reject:n})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new oo(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}},Es,Ds,Os,W,ks,As,js,Ms,Ns,Ps,Fs;function Is(){let e,t;return{promise:new Promise((n,r)=>{e=n,t=r}),resolve:e,reject:t}}var Ls=class{constructor(e,t,n){Es.add(this),this.client=e,Ds.set(this,!1),Os.set(this,!1),W.set(this,void 0),ks.set(this,void 0),As.set(this,void 0),js.set(this,void 0),Ms.set(this,void 0),Ns.set(this,0),R(this,W,{params:{...t,messages:structuredClone(t.messages)}},`f`),R(this,ks,{...n,headers:H([{"x-stainless-helper":`BetaToolRunner`},n?.headers])},`f`),R(this,Ms,Is(),`f`)}async*[(Ds=new WeakMap,Os=new WeakMap,W=new WeakMap,ks=new WeakMap,As=new WeakMap,js=new WeakMap,Ms=new WeakMap,Ns=new WeakMap,Es=new WeakSet,Ps=async function(){let e=z(this,W,`f`).params.compactionControl;if(!e||!e.enabled)return!1;let t=0;if(z(this,As,`f`)!==void 0)try{let e=await z(this,As,`f`);t=e.usage.input_tokens+(e.usage.cache_creation_input_tokens??0)+(e.usage.cache_read_input_tokens??0)+e.usage.output_tokens}catch{return!1}let n=e.contextTokenThreshold??1e5;if(t<n)return!1;let r=e.model??z(this,W,`f`).params.model,i=e.summaryPrompt??`You have been working on the task described above but have not yet completed it. Write a continuation summary that will allow you (or another instance of yourself) to resume work efficiently in a future context window where the conversation history will be replaced with this summary. Your summary should be structured, concise, and actionable. Include:
1. Task Overview
The user's core request and success criteria
Any clarifications or constraints they specified
2. Current State
What has been completed so far
Files created, modified, or analyzed (with paths if relevant)
Key outputs or artifacts produced
3. Important Discoveries
Technical constraints or requirements uncovered
Decisions made and their rationale
Errors encountered and how they were resolved
What approaches were tried that didn't work (and why)
4. Next Steps
Specific actions needed to complete the task
Any blockers or open questions to resolve
Priority order if multiple steps remain
5. Context to Preserve
User preferences or style requirements
Domain-specific details that aren't obvious
Any promises made to the user
Be concise but completeerr on the side of including information that would prevent duplicate work or repeated mistakes. Write in a way that enables immediate resumption of the task.
Wrap your summary in <summary></summary> tags.`,a=z(this,W,`f`).params.messages;if(a[a.length-1].role===`assistant`){let e=a[a.length-1];if(Array.isArray(e.content)){let t=e.content.filter(e=>e.type!==`tool_use`);t.length===0?a.pop():e.content=t}}let o=await this.client.beta.messages.create({model:r,messages:[...a,{role:`user`,content:[{type:`text`,text:i}]}],max_tokens:z(this,W,`f`).params.max_tokens},{headers:{"x-stainless-helper":`compaction`}});if(o.content[0]?.type!==`text`)throw new B(`Expected text response for compaction`);return z(this,W,`f`).params.messages=[{role:`user`,content:o.content}],!0},Symbol.asyncIterator)](){var e;if(z(this,Ds,`f`))throw new B(`Cannot iterate over a consumed stream`);R(this,Ds,!0,`f`),R(this,Os,!0,`f`),R(this,js,void 0,`f`);try{for(;;){let t;try{if(z(this,W,`f`).params.max_iterations&&z(this,Ns,`f`)>=z(this,W,`f`).params.max_iterations)break;R(this,Os,!1,`f`),R(this,js,void 0,`f`),R(this,Ns,(e=z(this,Ns,`f`),e++,e),`f`),R(this,As,void 0,`f`);let{max_iterations:n,compactionControl:r,...i}=z(this,W,`f`).params;if(i.stream?(t=this.client.beta.messages.stream({...i},z(this,ks,`f`)),R(this,As,t.finalMessage(),`f`),z(this,As,`f`).catch(()=>{}),yield t):(R(this,As,this.client.beta.messages.create({...i,stream:!1},z(this,ks,`f`)),`f`),yield z(this,As,`f`)),!await z(this,Es,`m`,Ps).call(this)){if(!z(this,Os,`f`)){let{role:e,content:t}=await z(this,As,`f`);z(this,W,`f`).params.messages.push({role:e,content:t})}let e=await z(this,Es,`m`,Fs).call(this,z(this,W,`f`).params.messages.at(-1));if(e)z(this,W,`f`).params.messages.push(e);else if(!z(this,Os,`f`))break}}finally{t&&t.abort()}}if(!z(this,As,`f`))throw new B(`ToolRunner concluded without a message from the server`);z(this,Ms,`f`).resolve(await z(this,As,`f`))}catch(e){throw R(this,Ds,!1,`f`),z(this,Ms,`f`).promise.catch(()=>{}),z(this,Ms,`f`).reject(e),R(this,Ms,Is(),`f`),e}}setMessagesParams(e){typeof e==`function`?z(this,W,`f`).params=e(z(this,W,`f`).params):z(this,W,`f`).params=e,R(this,Os,!0,`f`),R(this,js,void 0,`f`)}async generateToolResponse(){let e=await z(this,As,`f`)??this.params.messages.at(-1);return e?z(this,Es,`m`,Fs).call(this,e):null}done(){return z(this,Ms,`f`).promise}async runUntilDone(){if(!z(this,Ds,`f`))for await(let e of this);return this.done()}get params(){return z(this,W,`f`).params}pushMessages(...e){this.setMessagesParams(t=>({...t,messages:[...t.messages,...e]}))}then(e,t){return this.runUntilDone().then(e,t)}};Fs=async function(e){return z(this,js,`f`)===void 0&&R(this,js,Rs(z(this,W,`f`).params,e),`f`),z(this,js,`f`)};async function Rs(e,t=e.messages.at(-1)){if(!t||t.role!==`assistant`||!t.content||typeof t.content==`string`)return null;let n=t.content.filter(e=>e.type===`tool_use`);return n.length===0?null:{role:`user`,content:await Promise.all(n.map(async t=>{let n=e.tools.find(e=>(`name`in e?e.name:e.mcp_server_name)===t.name);if(!n||!(`run`in n))return{type:`tool_result`,tool_use_id:t.id,content:`Error: Tool '${t.name}' not found`,is_error:!0};try{let e=t.input;`parse`in n&&n.parse&&(e=n.parse(e));let r=await n.run(e);return{type:`tool_result`,tool_use_id:t.id,content:r}}catch(e){return{type:`tool_result`,tool_use_id:t.id,content:`Error: ${e instanceof Error?e.message:String(e)}`,is_error:!0}}}))}}var zs=class e{constructor(e,t){this.iterator=e,this.controller=t}async*decoder(){let e=new Ya;for await(let t of this.iterator)for(let n of e.decode(t))yield JSON.parse(n);for(let t of e.flush())yield JSON.parse(t)}[Symbol.asyncIterator](){return this.decoder()}static fromResponse(t,n){if(!t.body)throw n.abort(),globalThis.navigator!==void 0&&globalThis.navigator.product===`ReactNative`?new B(`The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api`):new B(`Attempted to iterate over a response with no body`);return new e(za(t.body),n)}},Bs=class extends Lo{create(e,t){let{betas:n,...r}=e;return this._client.post(`/v1/messages/batches?beta=true`,{body:r,...t,headers:H([{"anthropic-beta":[...n??[],`message-batches-2024-09-24`].toString()},t?.headers])})}retrieve(e,t={},n){let{betas:r}=t??{};return this._client.get(U`/v1/messages/batches/${e}?beta=true`,{...n,headers:H([{"anthropic-beta":[...r??[],`message-batches-2024-09-24`].toString()},n?.headers])})}list(e={},t){let{betas:n,...r}=e??{};return this._client.getAPIList(`/v1/messages/batches?beta=true`,yo,{query:r,...t,headers:H([{"anthropic-beta":[...n??[],`message-batches-2024-09-24`].toString()},t?.headers])})}delete(e,t={},n){let{betas:r}=t??{};return this._client.delete(U`/v1/messages/batches/${e}?beta=true`,{...n,headers:H([{"anthropic-beta":[...r??[],`message-batches-2024-09-24`].toString()},n?.headers])})}cancel(e,t={},n){let{betas:r}=t??{};return this._client.post(U`/v1/messages/batches/${e}/cancel?beta=true`,{...n,headers:H([{"anthropic-beta":[...r??[],`message-batches-2024-09-24`].toString()},n?.headers])})}async results(e,t={},n){let r=await this.retrieve(e);if(!r.results_url)throw new B(`No batch \`results_url\`; Has it finished processing? ${r.processing_status} - ${r.id}`);let{betas:i}=t??{};return this._client.get(r.results_url,{...n,headers:H([{"anthropic-beta":[...i??[],`message-batches-2024-09-24`].toString(),Accept:`application/binary`},n?.headers]),stream:!0,__binaryResponse:!0})._thenUnwrap((e,t)=>zs.fromResponse(t.response,t.controller))}},Vs={"claude-1.3":`November 6th, 2024`,"claude-1.3-100k":`November 6th, 2024`,"claude-instant-1.1":`November 6th, 2024`,"claude-instant-1.1-100k":`November 6th, 2024`,"claude-instant-1.2":`November 6th, 2024`,"claude-3-sonnet-20240229":`July 21st, 2025`,"claude-3-opus-20240229":`January 5th, 2026`,"claude-2.1":`July 21st, 2025`,"claude-2.0":`July 21st, 2025`,"claude-3-7-sonnet-latest":`February 19th, 2026`,"claude-3-7-sonnet-20250219":`February 19th, 2026`},Hs=class extends Lo{constructor(){super(...arguments),this.batches=new Bs(this._client)}create(e,t){let{betas:n,...r}=e;r.model in Vs&&console.warn(`The model '${r.model}' is deprecated and will reach end-of-life on ${Vs[r.model]}\nPlease migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`);let i=this._client._options.timeout;if(!r.stream&&i==null){let e=Wo[r.model]??void 0;i=this._client.calculateNonstreamingTimeout(r.max_tokens,e)}return this._client.post(`/v1/messages?beta=true`,{body:r,timeout:i??6e5,...t,headers:H([{...n?.toString()==null?void 0:{"anthropic-beta":n?.toString()}},t?.headers]),stream:e.stream??!1})}parse(e,t){return t={...t,headers:H([{"anthropic-beta":[...e.betas??[],`structured-outputs-2025-11-13`].toString()},t?.headers])},this.create(e,t).then(t=>Ko(t,e,{logger:this._client.logger??console}))}stream(e,t){return Ts.createMessage(this,e,t)}countTokens(e,t){let{betas:n,...r}=e;return this._client.post(`/v1/messages/count_tokens?beta=true`,{body:r,...t,headers:H([{"anthropic-beta":[...n??[],`token-counting-2024-11-01`].toString()},t?.headers])})}toolRunner(e,t){return new Ls(this._client,e,t)}};Hs.Batches=Bs,Hs.BetaToolRunner=Ls;var Us=class extends Lo{create(e,t={},n){let{betas:r,...i}=t??{};return this._client.post(U`/v1/skills/${e}/versions?beta=true`,To({body:i,...n,headers:H([{"anthropic-beta":[...r??[],`skills-2025-10-02`].toString()},n?.headers])},this._client))}retrieve(e,t,n){let{skill_id:r,betas:i}=t;return this._client.get(U`/v1/skills/${r}/versions/${e}?beta=true`,{...n,headers:H([{"anthropic-beta":[...i??[],`skills-2025-10-02`].toString()},n?.headers])})}list(e,t={},n){let{betas:r,...i}=t??{};return this._client.getAPIList(U`/v1/skills/${e}/versions?beta=true`,bo,{query:i,...n,headers:H([{"anthropic-beta":[...r??[],`skills-2025-10-02`].toString()},n?.headers])})}delete(e,t,n){let{skill_id:r,betas:i}=t;return this._client.delete(U`/v1/skills/${r}/versions/${e}?beta=true`,{...n,headers:H([{"anthropic-beta":[...i??[],`skills-2025-10-02`].toString()},n?.headers])})}},Ws=class extends Lo{constructor(){super(...arguments),this.versions=new Us(this._client)}create(e={},t){let{betas:n,...r}=e??{};return this._client.post(`/v1/skills?beta=true`,To({body:r,...t,headers:H([{"anthropic-beta":[...n??[],`skills-2025-10-02`].toString()},t?.headers])},this._client))}retrieve(e,t={},n){let{betas:r}=t??{};return this._client.get(U`/v1/skills/${e}?beta=true`,{...n,headers:H([{"anthropic-beta":[...r??[],`skills-2025-10-02`].toString()},n?.headers])})}list(e={},t){let{betas:n,...r}=e??{};return this._client.getAPIList(`/v1/skills?beta=true`,bo,{query:r,...t,headers:H([{"anthropic-beta":[...n??[],`skills-2025-10-02`].toString()},t?.headers])})}delete(e,t={},n){let{betas:r}=t??{};return this._client.delete(U`/v1/skills/${e}?beta=true`,{...n,headers:H([{"anthropic-beta":[...r??[],`skills-2025-10-02`].toString()},n?.headers])})}};Ws.Versions=Us;var Gs=class extends Lo{constructor(){super(...arguments),this.models=new Uo(this._client),this.messages=new Hs(this._client),this.files=new Ho(this._client),this.skills=new Ws(this._client)}};Gs.Models=Uo,Gs.Messages=Hs,Gs.Files=Ho,Gs.Skills=Ws;var Ks=class extends Lo{create(e,t){let{betas:n,...r}=e;return this._client.post(`/v1/complete`,{body:r,timeout:this._client._options.timeout??6e5,...t,headers:H([{...n?.toString()==null?void 0:{"anthropic-beta":n?.toString()}},t?.headers]),stream:e.stream??!1})}},qs,Js,Ys,Xs,Zs,Qs,$s,ec,tc,nc,rc,ic,ac,oc,sc,cc,lc,uc,dc,fc,pc,mc,hc=`__json_buf`;function gc(e){return e.type===`tool_use`||e.type===`server_tool_use`}var _c=class e{constructor(){qs.add(this),this.messages=[],this.receivedMessages=[],Js.set(this,void 0),this.controller=new AbortController,Ys.set(this,void 0),Xs.set(this,()=>{}),Zs.set(this,()=>{}),Qs.set(this,void 0),$s.set(this,()=>{}),ec.set(this,()=>{}),tc.set(this,{}),nc.set(this,!1),rc.set(this,!1),ic.set(this,!1),ac.set(this,!1),oc.set(this,void 0),sc.set(this,void 0),uc.set(this,e=>{if(R(this,rc,!0,`f`),ra(e)&&(e=new oa),e instanceof oa)return R(this,ic,!0,`f`),this._emit(`abort`,e);if(e instanceof B)return this._emit(`error`,e);if(e instanceof Error){let t=new B(e.message);return t.cause=e,this._emit(`error`,t)}return this._emit(`error`,new B(String(e)))}),R(this,Ys,new Promise((e,t)=>{R(this,Xs,e,`f`),R(this,Zs,t,`f`)}),`f`),R(this,Qs,new Promise((e,t)=>{R(this,$s,e,`f`),R(this,ec,t,`f`)}),`f`),z(this,Ys,`f`).catch(()=>{}),z(this,Qs,`f`).catch(()=>{})}get response(){return z(this,oc,`f`)}get request_id(){return z(this,sc,`f`)}async withResponse(){R(this,ac,!0,`f`);let e=await z(this,Ys,`f`);if(!e)throw Error("Could not resolve a `Response` object");return{data:this,response:e,request_id:e.headers.get(`request-id`)}}static fromReadableStream(t){let n=new e;return n._run(()=>n._fromReadableStream(t)),n}static createMessage(t,n,r){let i=new e;for(let e of n.messages)i._addMessageParam(e);return i._run(()=>i._createMessage(t,{...n,stream:!0},{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":`stream`}})),i}_run(e){e().then(()=>{this._emitFinal(),this._emit(`end`)},z(this,uc,`f`))}_addMessageParam(e){this.messages.push(e)}_addMessage(e,t=!0){this.receivedMessages.push(e),t&&this._emit(`message`,e)}async _createMessage(e,t,n){let r=n?.signal,i;r&&(r.aborted&&this.controller.abort(),i=this.controller.abort.bind(this.controller),r.addEventListener(`abort`,i));try{z(this,qs,`m`,dc).call(this);let{response:r,data:i}=await e.create({...t,stream:!0},{...n,signal:this.controller.signal}).withResponse();this._connected(r);for await(let e of i)z(this,qs,`m`,fc).call(this,e);if(i.controller.signal?.aborted)throw new oa;z(this,qs,`m`,pc).call(this)}finally{r&&i&&r.removeEventListener(`abort`,i)}}_connected(e){this.ended||(R(this,oc,e,`f`),R(this,sc,e?.headers.get(`request-id`),`f`),z(this,Xs,`f`).call(this,e),this._emit(`connect`))}get ended(){return z(this,nc,`f`)}get errored(){return z(this,rc,`f`)}get aborted(){return z(this,ic,`f`)}abort(){this.controller.abort()}on(e,t){return(z(this,tc,`f`)[e]||(z(this,tc,`f`)[e]=[])).push({listener:t}),this}off(e,t){let n=z(this,tc,`f`)[e];if(!n)return this;let r=n.findIndex(e=>e.listener===t);return r>=0&&n.splice(r,1),this}once(e,t){return(z(this,tc,`f`)[e]||(z(this,tc,`f`)[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,n)=>{R(this,ac,!0,`f`),e!==`error`&&this.once(`error`,n),this.once(e,t)})}async done(){R(this,ac,!0,`f`),await z(this,Qs,`f`)}get currentMessage(){return z(this,Js,`f`)}async finalMessage(){return await this.done(),z(this,qs,`m`,cc).call(this)}async finalText(){return await this.done(),z(this,qs,`m`,lc).call(this)}_emit(e,...t){if(z(this,nc,`f`))return;e===`end`&&(R(this,nc,!0,`f`),z(this,$s,`f`).call(this));let n=z(this,tc,`f`)[e];if(n&&(z(this,tc,`f`)[e]=n.filter(e=>!e.once),n.forEach(({listener:e})=>e(...t))),e===`abort`){let e=t[0];!z(this,ac,`f`)&&!n?.length&&Promise.reject(e),z(this,Zs,`f`).call(this,e),z(this,ec,`f`).call(this,e),this._emit(`end`);return}if(e===`error`){let e=t[0];!z(this,ac,`f`)&&!n?.length&&Promise.reject(e),z(this,Zs,`f`).call(this,e),z(this,ec,`f`).call(this,e),this._emit(`end`)}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit(`finalMessage`,z(this,qs,`m`,cc).call(this))}async _fromReadableStream(e,t){let n=t?.signal,r;n&&(n.aborted&&this.controller.abort(),r=this.controller.abort.bind(this.controller),n.addEventListener(`abort`,r));try{z(this,qs,`m`,dc).call(this),this._connected(null);let t=oo.fromReadableStream(e,this.controller);for await(let e of t)z(this,qs,`m`,fc).call(this,e);if(t.controller.signal?.aborted)throw new oa;z(this,qs,`m`,pc).call(this)}finally{n&&r&&n.removeEventListener(`abort`,r)}}[(Js=new WeakMap,Ys=new WeakMap,Xs=new WeakMap,Zs=new WeakMap,Qs=new WeakMap,$s=new WeakMap,ec=new WeakMap,tc=new WeakMap,nc=new WeakMap,rc=new WeakMap,ic=new WeakMap,ac=new WeakMap,oc=new WeakMap,sc=new WeakMap,uc=new WeakMap,qs=new WeakSet,cc=function(){if(this.receivedMessages.length===0)throw new B(`stream ended without producing a Message with role=assistant`);return this.receivedMessages.at(-1)},lc=function(){if(this.receivedMessages.length===0)throw new B(`stream ended without producing a Message with role=assistant`);let e=this.receivedMessages.at(-1).content.filter(e=>e.type===`text`).map(e=>e.text);if(e.length===0)throw new B(`stream ended without producing a content block with type=text`);return e.join(` `)},dc=function(){this.ended||R(this,Js,void 0,`f`)},fc=function(e){if(this.ended)return;let t=z(this,qs,`m`,mc).call(this,e);switch(this._emit(`streamEvent`,e,t),e.type){case`content_block_delta`:{let n=t.content.at(-1);switch(e.delta.type){case`text_delta`:n.type===`text`&&this._emit(`text`,e.delta.text,n.text||``);break;case`citations_delta`:n.type===`text`&&this._emit(`citation`,e.delta.citation,n.citations??[]);break;case`input_json_delta`:gc(n)&&n.input&&this._emit(`inputJson`,e.delta.partial_json,n.input);break;case`thinking_delta`:n.type===`thinking`&&this._emit(`thinking`,e.delta.thinking,n.thinking);break;case`signature_delta`:n.type===`thinking`&&this._emit(`signature`,n.signature);break;default:e.delta}break}case`message_stop`:this._addMessageParam(t),this._addMessage(t,!0);break;case`content_block_stop`:this._emit(`contentBlock`,t.content.at(-1));break;case`message_start`:R(this,Js,t,`f`);break;case`content_block_start`:case`message_delta`:break}},pc=function(){if(this.ended)throw new B(`stream has ended, this shouldn't happen`);let e=z(this,Js,`f`);if(!e)throw new B(`request ended without sending any chunks`);return R(this,Js,void 0,`f`),e},mc=function(e){let t=z(this,Js,`f`);if(e.type===`message_start`){if(t)throw new B(`Unexpected event order, got ${e.type} before receiving "message_stop"`);return e.message}if(!t)throw new B(`Unexpected event order, got ${e.type} before "message_start"`);switch(e.type){case`message_stop`:return t;case`message_delta`:return t.stop_reason=e.delta.stop_reason,t.stop_sequence=e.delta.stop_sequence,t.usage.output_tokens=e.usage.output_tokens,e.usage.input_tokens!=null&&(t.usage.input_tokens=e.usage.input_tokens),e.usage.cache_creation_input_tokens!=null&&(t.usage.cache_creation_input_tokens=e.usage.cache_creation_input_tokens),e.usage.cache_read_input_tokens!=null&&(t.usage.cache_read_input_tokens=e.usage.cache_read_input_tokens),e.usage.server_tool_use!=null&&(t.usage.server_tool_use=e.usage.server_tool_use),t;case`content_block_start`:return t.content.push({...e.content_block}),t;case`content_block_delta`:{let n=t.content.at(e.index);switch(e.delta.type){case`text_delta`:n?.type===`text`&&(t.content[e.index]={...n,text:(n.text||``)+e.delta.text});break;case`citations_delta`:n?.type===`text`&&(t.content[e.index]={...n,citations:[...n.citations??[],e.delta.citation]});break;case`input_json_delta`:if(n&&gc(n)){let r=n[hc]||``;r+=e.delta.partial_json;let i={...n};Object.defineProperty(i,hc,{value:r,enumerable:!1,writable:!0}),r&&(i.input=Qo(r)),t.content[e.index]=i}break;case`thinking_delta`:n?.type===`thinking`&&(t.content[e.index]={...n,thinking:n.thinking+e.delta.thinking});break;case`signature_delta`:n?.type===`thinking`&&(t.content[e.index]={...n,signature:e.delta.signature});break;default:e.delta}return t}case`content_block_stop`:return t}},Symbol.asyncIterator)](){let e=[],t=[],n=!1;return this.on(`streamEvent`,n=>{let r=t.shift();r?r.resolve(n):e.push(n)}),this.on(`end`,()=>{n=!0;for(let e of t)e.resolve(void 0);t.length=0}),this.on(`abort`,e=>{n=!0;for(let n of t)n.reject(e);t.length=0}),this.on(`error`,e=>{n=!0;for(let n of t)n.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((e,n)=>t.push({resolve:e,reject:n})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new oo(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}},vc=class extends Lo{create(e,t){return this._client.post(`/v1/messages/batches`,{body:e,...t})}retrieve(e,t){return this._client.get(U`/v1/messages/batches/${e}`,t)}list(e={},t){return this._client.getAPIList(`/v1/messages/batches`,yo,{query:e,...t})}delete(e,t){return this._client.delete(U`/v1/messages/batches/${e}`,t)}cancel(e,t){return this._client.post(U`/v1/messages/batches/${e}/cancel`,t)}async results(e,t){let n=await this.retrieve(e);if(!n.results_url)throw new B(`No batch \`results_url\`; Has it finished processing? ${n.processing_status} - ${n.id}`);return this._client.get(n.results_url,{...t,headers:H([{Accept:`application/binary`},t?.headers]),stream:!0,__binaryResponse:!0})._thenUnwrap((e,t)=>zs.fromResponse(t.response,t.controller))}},yc=class extends Lo{constructor(){super(...arguments),this.batches=new vc(this._client)}create(e,t){e.model in bc&&console.warn(`The model '${e.model}' is deprecated and will reach end-of-life on ${bc[e.model]}\nPlease migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`);let n=this._client._options.timeout;if(!e.stream&&n==null){let t=Wo[e.model]??void 0;n=this._client.calculateNonstreamingTimeout(e.max_tokens,t)}return this._client.post(`/v1/messages`,{body:e,timeout:n??6e5,...t,stream:e.stream??!1})}stream(e,t){return _c.createMessage(this,e,t)}countTokens(e,t){return this._client.post(`/v1/messages/count_tokens`,{body:e,...t})}},bc={"claude-1.3":`November 6th, 2024`,"claude-1.3-100k":`November 6th, 2024`,"claude-instant-1.1":`November 6th, 2024`,"claude-instant-1.1-100k":`November 6th, 2024`,"claude-instant-1.2":`November 6th, 2024`,"claude-3-sonnet-20240229":`July 21st, 2025`,"claude-3-opus-20240229":`January 5th, 2026`,"claude-2.1":`July 21st, 2025`,"claude-2.0":`July 21st, 2025`,"claude-3-7-sonnet-latest":`February 19th, 2026`,"claude-3-7-sonnet-20250219":`February 19th, 2026`};yc.Batches=vc;var xc=class extends Lo{retrieve(e,t={},n){let{betas:r}=t??{};return this._client.get(U`/v1/models/${e}`,{...n,headers:H([{...r?.toString()==null?void 0:{"anthropic-beta":r?.toString()}},n?.headers])})}list(e={},t){let{betas:n,...r}=e??{};return this._client.getAPIList(`/v1/models`,yo,{query:r,...t,headers:H([{...n?.toString()==null?void 0:{"anthropic-beta":n?.toString()}},t?.headers])})}};const Sc=e=>{if(globalThis.process!==void 0)return{}?.[e]?.trim()??void 0;if(globalThis.Deno!==void 0)return globalThis.Deno.env?.get?.(e)?.trim()};var Cc,wc,Tc,Ec,G=class{constructor({baseURL:e=Sc(`ANTHROPIC_BASE_URL`),apiKey:t=Sc(`ANTHROPIC_API_KEY`)??null,authToken:n=Sc(`ANTHROPIC_AUTH_TOKEN`)??null,...r}={}){Cc.add(this),Tc.set(this,void 0);let i={apiKey:t,authToken:n,...r,baseURL:e||`https://api.anthropic.com`};if(!i.dangerouslyAllowBrowser&&Oa())throw new B(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new Anthropic({ apiKey, dangerouslyAllowBrowser: true });
`);this.baseURL=i.baseURL,this.timeout=i.timeout??wc.DEFAULT_TIMEOUT,this.logger=i.logger??console;let a=`warn`;this.logLevel=a,this.logLevel=$a(i.logLevel,`ClientOptions.logLevel`,this)??$a(Sc(`ANTHROPIC_LOG`),`process.env['ANTHROPIC_LOG']`,this)??a,this.fetchOptions=i.fetchOptions,this.maxRetries=i.maxRetries??2,this.fetch=i.fetch??Ia(),R(this,Tc,Va,`f`),this._options=i,this.apiKey=typeof t==`string`?t:null,this.authToken=n}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,authToken:this.authToken,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){if(!(e.get(`x-api-key`)||e.get(`authorization`))&&!(this.apiKey&&e.get(`x-api-key`))&&!t.has(`x-api-key`)&&!(this.authToken&&e.get(`authorization`))&&!t.has(`authorization`))throw Error(`Could not resolve authentication method. Expected either apiKey or authToken to be set. Or for one of the "X-Api-Key" or "Authorization" headers to be explicitly omitted`)}async authHeaders(e){return H([await this.apiKeyAuth(e),await this.bearerAuth(e)])}async apiKeyAuth(e){if(this.apiKey!=null)return H([{"X-Api-Key":this.apiKey}])}async bearerAuth(e){if(this.authToken!=null)return H([{Authorization:`Bearer ${this.authToken}`}])}stringifyQuery(e){return Object.entries(e).filter(([e,t])=>t!==void 0).map(([e,t])=>{if(typeof t==`string`||typeof t==`number`||typeof t==`boolean`)return`${encodeURIComponent(e)}=${encodeURIComponent(t)}`;if(t===null)return`${encodeURIComponent(e)}=`;throw new B(`Cannot stringify type ${typeof t}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join(`&`)}getUserAgent(){return`${this.constructor.name}/JS ${Da}`}defaultIdempotencyKey(){return`stainless-node-retry-${na()}`}makeStatusError(e,t,n,r){return aa.generate(e,t,n,r)}buildURL(e,t,n){let r=!z(this,Cc,`m`,Ec).call(this)&&n||this.baseURL,i=va(e)?new URL(e):new URL(r+(r.endsWith(`/`)&&e.startsWith(`/`)?e.slice(1):e)),a=this.defaultQuery();return Sa(a)||(t={...a,...t}),typeof t==`object`&&t&&!Array.isArray(t)&&(i.search=this.stringifyQuery(t)),i.toString()}_calculateNonstreamingTimeout(e){if(3600*e/128e3>600)throw new B(`Streaming is required for operations that may take longer than 10 minutes. See https://github.com/anthropics/anthropic-sdk-typescript#streaming-responses for more details`);return 600*1e3}async prepareOptions(e){}async prepareRequest(e,{url:t,options:n}){}get(e,t){return this.methodRequest(`get`,e,t)}post(e,t){return this.methodRequest(`post`,e,t)}patch(e,t){return this.methodRequest(`patch`,e,t)}put(e,t){return this.methodRequest(`put`,e,t)}delete(e,t){return this.methodRequest(`delete`,e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then(n=>({method:e,path:t,...n})))}request(e,t=null){return new ho(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,n){let r=await e,i=r.maxRetries??this.maxRetries;t??=i,await this.prepareOptions(r);let{req:a,url:o,timeout:s}=await this.buildRequest(r,{retryCount:i-t});await this.prepareRequest(a,{url:o,options:r});let c=`log_`+(Math.random()*(1<<24)|0).toString(16).padStart(6,`0`),l=n===void 0?``:`, retryOf: ${n}`,u=Date.now();if(V(this).debug(`[${c}] sending request`,io({retryOfRequestLogID:n,method:r.method,url:o,options:r,headers:a.headers})),r.signal?.aborted)throw new oa;let d=new AbortController,f=await this.fetchWithTimeout(o,a,s,d).catch(ia),p=Date.now();if(f instanceof globalThis.Error){let e=`retrying, ${t} attempts remaining`;if(r.signal?.aborted)throw new oa;let i=ra(f)||/timed? ?out/i.test(String(f)+(`cause`in f?String(f.cause):``));if(t)return V(this).info(`[${c}] connection ${i?`timed out`:`failed`} - ${e}`),V(this).debug(`[${c}] connection ${i?`timed out`:`failed`} (${e})`,io({retryOfRequestLogID:n,url:o,durationMs:p-u,message:f.message})),this.retryRequest(r,t,n??c);throw V(this).info(`[${c}] connection ${i?`timed out`:`failed`} - error; no more retries left`),V(this).debug(`[${c}] connection ${i?`timed out`:`failed`} (error; no more retries left)`,io({retryOfRequestLogID:n,url:o,durationMs:p-u,message:f.message})),i?new ca:new sa({cause:f})}let m=`[${c}${l}${[...f.headers.entries()].filter(([e])=>e===`request-id`).map(([e,t])=>`, `+e+`: `+JSON.stringify(t)).join(``)}] ${a.method} ${o} ${f.ok?`succeeded`:`failed`} with status ${f.status} in ${p-u}ms`;if(!f.ok){let e=await this.shouldRetry(f);if(t&&e){let e=`retrying, ${t} attempts remaining`;return await Ba(f.body),V(this).info(`${m} - ${e}`),V(this).debug(`[${c}] response error (${e})`,io({retryOfRequestLogID:n,url:f.url,status:f.status,headers:f.headers,durationMs:p-u})),this.retryRequest(r,t,n??c,f.headers)}let i=e?`error; no more retries left`:`error; not retryable`;V(this).info(`${m} - ${i}`);let a=await f.text().catch(e=>ia(e).message),o=Ta(a),s=o?void 0:a;throw V(this).debug(`[${c}] response error (${i})`,io({retryOfRequestLogID:n,url:f.url,status:f.status,headers:f.headers,message:s,durationMs:Date.now()-u})),this.makeStatusError(f.status,o,s,f.headers)}return V(this).info(m),V(this).debug(`[${c}] response start`,io({retryOfRequestLogID:n,url:f.url,status:f.status,headers:f.headers,durationMs:p-u})),{response:f,options:r,controller:d,requestLogID:c,retryOfRequestLogID:n,startTime:u}}getAPIList(e,t,n){return this.requestAPIList(t,{method:`get`,path:e,...n})}requestAPIList(e,t){let n=this.makeRequest(t,null,void 0);return new vo(this,n,e)}async fetchWithTimeout(e,t,n,r){let{signal:i,method:a,...o}=t||{};i&&i.addEventListener(`abort`,()=>r.abort());let s=setTimeout(()=>r.abort(),n),c=globalThis.ReadableStream&&o.body instanceof globalThis.ReadableStream||typeof o.body==`object`&&o.body!==null&&Symbol.asyncIterator in o.body,l={signal:r.signal,...c?{duplex:`half`}:{},method:`GET`,...o};a&&(l.method=a.toUpperCase());try{return await this.fetch.call(void 0,e,l)}finally{clearTimeout(s)}}async shouldRetry(e){let t=e.headers.get(`x-should-retry`);return t===`true`?!0:t===`false`?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,n,r){let i,a=r?.get(`retry-after-ms`);if(a){let e=parseFloat(a);Number.isNaN(e)||(i=e)}let o=r?.get(`retry-after`);if(o&&!i){let e=parseFloat(o);i=Number.isNaN(e)?Date.parse(o)-Date.now():e*1e3}if(!(i&&0<=i&&i<60*1e3)){let n=e.maxRetries??this.maxRetries;i=this.calculateDefaultRetryTimeoutMillis(t,n)}return await Ea(i),this.makeRequest(e,t-1,n)}calculateDefaultRetryTimeoutMillis(e,t){let n=t-e;return Math.min(.5*2**n,8)*(1-Math.random()*.25)*1e3}calculateNonstreamingTimeout(e,t){let n=600*1e3;if(36e5*e/128e3>n||t!=null&&e>t)throw new B(`Streaming is required for operations that may take longer than 10 minutes. See https://github.com/anthropics/anthropic-sdk-typescript#long-requests for more details`);return n}async buildRequest(e,{retryCount:t=0}={}){let n={...e},{method:r,path:i,query:a,defaultBaseURL:o}=n,s=this.buildURL(i,a,o);`timeout`in n&&wa(`timeout`,n.timeout),n.timeout=n.timeout??this.timeout;let{bodyHeaders:c,body:l}=this.buildBody({options:n});return{req:{method:r,headers:await this.buildHeaders({options:e,method:r,bodyHeaders:c,retryCount:t}),...n.signal&&{signal:n.signal},...globalThis.ReadableStream&&l instanceof globalThis.ReadableStream&&{duplex:`half`},...l&&{body:l},...this.fetchOptions??{},...n.fetchOptions??{}},url:s,timeout:n.timeout}}async buildHeaders({options:e,method:t,bodyHeaders:n,retryCount:r}){let i={};this.idempotencyHeader&&t!==`get`&&(e.idempotencyKey||=this.defaultIdempotencyKey(),i[this.idempotencyHeader]=e.idempotencyKey);let a=H([i,{Accept:`application/json`,"User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(r),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...Fa(),...this._options.dangerouslyAllowBrowser?{"anthropic-dangerous-direct-browser-access":`true`}:void 0,"anthropic-version":`2023-06-01`},await this.authHeaders(e),this._options.defaultHeaders,n,e.headers]);return this.validateHeaders(a),a.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};let n=H([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||typeof e==`string`&&n.values.has(`content-type`)||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:typeof e==`object`&&(Symbol.asyncIterator in e||Symbol.iterator in e&&`next`in e&&typeof e.next==`function`)?{bodyHeaders:void 0,body:Ra(e)}:z(this,Tc,`f`).call(this,{body:e,headers:n})}};wc=G,Tc=new WeakMap,Cc=new WeakSet,Ec=function(){return this.baseURL!==`https://api.anthropic.com`},G.Anthropic=wc,G.HUMAN_PROMPT=`\\n\\nHuman:`,G.AI_PROMPT=`\\n\\nAssistant:`,G.DEFAULT_TIMEOUT=6e5,G.AnthropicError=B,G.APIError=aa,G.APIConnectionError=sa,G.APIConnectionTimeoutError=ca,G.APIUserAbortError=oa,G.NotFoundError=fa,G.ConflictError=pa,G.RateLimitError=ha,G.BadRequestError=la,G.AuthenticationError=ua,G.InternalServerError=ga,G.PermissionDeniedError=da,G.UnprocessableEntityError=ma,G.toFile=Po;var Dc=class extends G{constructor(){super(...arguments),this.completions=new Ks(this),this.messages=new yc(this),this.models=new xc(this),this.beta=new Gs(this)}};Dc.Completions=Ks,Dc.Messages=yc,Dc.Models=xc,Dc.Beta=Gs;var Oc=void 0,kc=void 0;function Ac(){return{geminiUrl:Oc,vertexUrl:kc}}function jc(e,t,n,r){if(!e?.baseUrl){let e=Ac();return t?e.vertexUrl??n:e.geminiUrl??r}return e.baseUrl}var Mc=class{};function K(e,t){return e.replace(/\{([^}]+)\}/g,(e,n)=>{if(Object.prototype.hasOwnProperty.call(t,n)){let e=t[n];return e==null?``:String(e)}else throw Error(`Key '${n}' not found in valueMap.`)})}function q(e,t,n){for(let r=0;r<t.length-1;r++){let i=t[r];if(i.endsWith(`[]`)){let a=i.slice(0,-2);if(!(a in e))if(Array.isArray(n))e[a]=Array.from({length:n.length},()=>({}));else throw Error(`Value must be a list given an array path ${i}`);if(Array.isArray(e[a])){let i=e[a];if(Array.isArray(n))for(let e=0;e<i.length;e++){let a=i[e];q(a,t.slice(r+1),n[e])}else for(let e of i)q(e,t.slice(r+1),n)}return}else if(i.endsWith(`[0]`)){let a=i.slice(0,-3);a in e||(e[a]=[{}]);let o=e[a];q(o[0],t.slice(r+1),n);return}(!e[i]||typeof e[i]!=`object`)&&(e[i]={}),e=e[i]}let r=t[t.length-1],i=e[r];if(i!==void 0){if(!n||typeof n==`object`&&Object.keys(n).length===0||n===i)return;if(typeof i==`object`&&typeof n==`object`&&i!==null&&n!==null)Object.assign(i,n);else throw Error(`Cannot set value for an existing key. Key: ${r}`)}else if(r===`_self`&&typeof n==`object`&&n&&!Array.isArray(n)){let t=n;Object.assign(e,t)}else e[r]=n}function J(e,t,n=void 0){try{if(t.length===1&&t[0]===`_self`)return e;for(let r=0;r<t.length;r++){if(typeof e!=`object`||!e)return n;let i=t[r];if(i.endsWith(`[]`)){let a=i.slice(0,-2);if(a in e){let i=e[a];return Array.isArray(i)?i.map(e=>J(e,t.slice(r+1),n)):n}else return n}else e=e[i]}return e}catch(e){if(e instanceof TypeError)return n;throw e}}function Nc(e,t){for(let[n,r]of Object.entries(t)){let t=n.split(`.`),i=r.split(`.`),a=new Set,o=-1;for(let e=0;e<t.length;e++)if(t[e]===`*`){o=e;break}if(o!==-1&&i.length>o)for(let e=o;e<i.length;e++){let t=i[e];t!==`*`&&!t.endsWith(`[]`)&&!t.endsWith(`[0]`)&&a.add(t)}Pc(e,t,i,0,a)}}function Pc(e,t,n,r,i){if(r>=t.length||typeof e!=`object`||!e)return;let a=t[r];if(a.endsWith(`[]`)){let o=a.slice(0,-2),s=e;if(o in s&&Array.isArray(s[o]))for(let e of s[o])Pc(e,t,n,r+1,i)}else if(a===`*`){if(typeof e==`object`&&e&&!Array.isArray(e)){let t=e,a=Object.keys(t).filter(e=>!e.startsWith(`_`)&&!i.has(e)),o={};for(let e of a)o[e]=t[e];for(let[e,i]of Object.entries(o)){let a=[];for(let t of n.slice(r))t===`*`?a.push(e):a.push(t);q(t,a,i)}for(let e of a)delete t[e]}}else{let o=e;a in o&&Pc(o[a],t,n,r+1,i)}}function Fc(e){if(typeof e!=`string`)throw Error(`fromImageBytes must be a string`);return e}function Ic(e){let t={},n=J(e,[`operationName`]);n!=null&&q(t,[`operationName`],n);let r=J(e,[`resourceName`]);return r!=null&&q(t,[`_url`,`resourceName`],r),t}function Lc(e){let t={},n=J(e,[`name`]);n!=null&&q(t,[`name`],n);let r=J(e,[`metadata`]);r!=null&&q(t,[`metadata`],r);let i=J(e,[`done`]);i!=null&&q(t,[`done`],i);let a=J(e,[`error`]);a!=null&&q(t,[`error`],a);let o=J(e,[`response`,`generateVideoResponse`]);return o!=null&&q(t,[`response`],zc(o)),t}function Rc(e){let t={},n=J(e,[`name`]);n!=null&&q(t,[`name`],n);let r=J(e,[`metadata`]);r!=null&&q(t,[`metadata`],r);let i=J(e,[`done`]);i!=null&&q(t,[`done`],i);let a=J(e,[`error`]);a!=null&&q(t,[`error`],a);let o=J(e,[`response`]);return o!=null&&q(t,[`response`],Bc(o)),t}function zc(e){let t={},n=J(e,[`generatedSamples`]);if(n!=null){let e=n;Array.isArray(e)&&(e=e.map(e=>Vc(e))),q(t,[`generatedVideos`],e)}let r=J(e,[`raiMediaFilteredCount`]);r!=null&&q(t,[`raiMediaFilteredCount`],r);let i=J(e,[`raiMediaFilteredReasons`]);return i!=null&&q(t,[`raiMediaFilteredReasons`],i),t}function Bc(e){let t={},n=J(e,[`videos`]);if(n!=null){let e=n;Array.isArray(e)&&(e=e.map(e=>Hc(e))),q(t,[`generatedVideos`],e)}let r=J(e,[`raiMediaFilteredCount`]);r!=null&&q(t,[`raiMediaFilteredCount`],r);let i=J(e,[`raiMediaFilteredReasons`]);return i!=null&&q(t,[`raiMediaFilteredReasons`],i),t}function Vc(e){let t={},n=J(e,[`video`]);return n!=null&&q(t,[`video`],Yc(n)),t}function Hc(e){let t={},n=J(e,[`_self`]);return n!=null&&q(t,[`video`],Xc(n)),t}function Uc(e){let t={},n=J(e,[`operationName`]);return n!=null&&q(t,[`_url`,`operationName`],n),t}function Wc(e){let t={},n=J(e,[`operationName`]);return n!=null&&q(t,[`_url`,`operationName`],n),t}function Gc(e){let t={},n=J(e,[`name`]);n!=null&&q(t,[`name`],n);let r=J(e,[`metadata`]);r!=null&&q(t,[`metadata`],r);let i=J(e,[`done`]);i!=null&&q(t,[`done`],i);let a=J(e,[`error`]);a!=null&&q(t,[`error`],a);let o=J(e,[`response`]);return o!=null&&q(t,[`response`],Kc(o)),t}function Kc(e){let t={},n=J(e,[`sdkHttpResponse`]);n!=null&&q(t,[`sdkHttpResponse`],n);let r=J(e,[`parent`]);r!=null&&q(t,[`parent`],r);let i=J(e,[`documentName`]);return i!=null&&q(t,[`documentName`],i),t}function qc(e){let t={},n=J(e,[`name`]);n!=null&&q(t,[`name`],n);let r=J(e,[`metadata`]);r!=null&&q(t,[`metadata`],r);let i=J(e,[`done`]);i!=null&&q(t,[`done`],i);let a=J(e,[`error`]);a!=null&&q(t,[`error`],a);let o=J(e,[`response`]);return o!=null&&q(t,[`response`],Jc(o)),t}function Jc(e){let t={},n=J(e,[`sdkHttpResponse`]);n!=null&&q(t,[`sdkHttpResponse`],n);let r=J(e,[`parent`]);r!=null&&q(t,[`parent`],r);let i=J(e,[`documentName`]);return i!=null&&q(t,[`documentName`],i),t}function Yc(e){let t={},n=J(e,[`uri`]);n!=null&&q(t,[`uri`],n);let r=J(e,[`encodedVideo`]);r!=null&&q(t,[`videoBytes`],Fc(r));let i=J(e,[`encoding`]);return i!=null&&q(t,[`mimeType`],i),t}function Xc(e){let t={},n=J(e,[`gcsUri`]);n!=null&&q(t,[`uri`],n);let r=J(e,[`bytesBase64Encoded`]);r!=null&&q(t,[`videoBytes`],Fc(r));let i=J(e,[`mimeType`]);return i!=null&&q(t,[`mimeType`],i),t}var Zc;(function(e){e.OUTCOME_UNSPECIFIED=`OUTCOME_UNSPECIFIED`,e.OUTCOME_OK=`OUTCOME_OK`,e.OUTCOME_FAILED=`OUTCOME_FAILED`,e.OUTCOME_DEADLINE_EXCEEDED=`OUTCOME_DEADLINE_EXCEEDED`})(Zc||={});var Qc;(function(e){e.LANGUAGE_UNSPECIFIED=`LANGUAGE_UNSPECIFIED`,e.PYTHON=`PYTHON`})(Qc||={});var $c;(function(e){e.SCHEDULING_UNSPECIFIED=`SCHEDULING_UNSPECIFIED`,e.SILENT=`SILENT`,e.WHEN_IDLE=`WHEN_IDLE`,e.INTERRUPT=`INTERRUPT`})($c||={});var el;(function(e){e.TYPE_UNSPECIFIED=`TYPE_UNSPECIFIED`,e.STRING=`STRING`,e.NUMBER=`NUMBER`,e.INTEGER=`INTEGER`,e.BOOLEAN=`BOOLEAN`,e.ARRAY=`ARRAY`,e.OBJECT=`OBJECT`,e.NULL=`NULL`})(el||={});var tl;(function(e){e.MODE_UNSPECIFIED=`MODE_UNSPECIFIED`,e.MODE_DYNAMIC=`MODE_DYNAMIC`})(tl||={});var nl;(function(e){e.API_SPEC_UNSPECIFIED=`API_SPEC_UNSPECIFIED`,e.SIMPLE_SEARCH=`SIMPLE_SEARCH`,e.ELASTIC_SEARCH=`ELASTIC_SEARCH`})(nl||={});var rl;(function(e){e.AUTH_TYPE_UNSPECIFIED=`AUTH_TYPE_UNSPECIFIED`,e.NO_AUTH=`NO_AUTH`,e.API_KEY_AUTH=`API_KEY_AUTH`,e.HTTP_BASIC_AUTH=`HTTP_BASIC_AUTH`,e.GOOGLE_SERVICE_ACCOUNT_AUTH=`GOOGLE_SERVICE_ACCOUNT_AUTH`,e.OAUTH=`OAUTH`,e.OIDC_AUTH=`OIDC_AUTH`})(rl||={});var il;(function(e){e.HTTP_IN_UNSPECIFIED=`HTTP_IN_UNSPECIFIED`,e.HTTP_IN_QUERY=`HTTP_IN_QUERY`,e.HTTP_IN_HEADER=`HTTP_IN_HEADER`,e.HTTP_IN_PATH=`HTTP_IN_PATH`,e.HTTP_IN_BODY=`HTTP_IN_BODY`,e.HTTP_IN_COOKIE=`HTTP_IN_COOKIE`})(il||={});var al;(function(e){e.PHISH_BLOCK_THRESHOLD_UNSPECIFIED=`PHISH_BLOCK_THRESHOLD_UNSPECIFIED`,e.BLOCK_LOW_AND_ABOVE=`BLOCK_LOW_AND_ABOVE`,e.BLOCK_MEDIUM_AND_ABOVE=`BLOCK_MEDIUM_AND_ABOVE`,e.BLOCK_HIGH_AND_ABOVE=`BLOCK_HIGH_AND_ABOVE`,e.BLOCK_HIGHER_AND_ABOVE=`BLOCK_HIGHER_AND_ABOVE`,e.BLOCK_VERY_HIGH_AND_ABOVE=`BLOCK_VERY_HIGH_AND_ABOVE`,e.BLOCK_ONLY_EXTREMELY_HIGH=`BLOCK_ONLY_EXTREMELY_HIGH`})(al||={});var ol;(function(e){e.THINKING_LEVEL_UNSPECIFIED=`THINKING_LEVEL_UNSPECIFIED`,e.LOW=`LOW`,e.MEDIUM=`MEDIUM`,e.HIGH=`HIGH`,e.MINIMAL=`MINIMAL`})(ol||={});var sl;(function(e){e.HARM_CATEGORY_UNSPECIFIED=`HARM_CATEGORY_UNSPECIFIED`,e.HARM_CATEGORY_HARASSMENT=`HARM_CATEGORY_HARASSMENT`,e.HARM_CATEGORY_HATE_SPEECH=`HARM_CATEGORY_HATE_SPEECH`,e.HARM_CATEGORY_SEXUALLY_EXPLICIT=`HARM_CATEGORY_SEXUALLY_EXPLICIT`,e.HARM_CATEGORY_DANGEROUS_CONTENT=`HARM_CATEGORY_DANGEROUS_CONTENT`,e.HARM_CATEGORY_CIVIC_INTEGRITY=`HARM_CATEGORY_CIVIC_INTEGRITY`,e.HARM_CATEGORY_IMAGE_HATE=`HARM_CATEGORY_IMAGE_HATE`,e.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT=`HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT`,e.HARM_CATEGORY_IMAGE_HARASSMENT=`HARM_CATEGORY_IMAGE_HARASSMENT`,e.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT=`HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT`,e.HARM_CATEGORY_JAILBREAK=`HARM_CATEGORY_JAILBREAK`})(sl||={});var cl;(function(e){e.HARM_BLOCK_METHOD_UNSPECIFIED=`HARM_BLOCK_METHOD_UNSPECIFIED`,e.SEVERITY=`SEVERITY`,e.PROBABILITY=`PROBABILITY`})(cl||={});var ll;(function(e){e.HARM_BLOCK_THRESHOLD_UNSPECIFIED=`HARM_BLOCK_THRESHOLD_UNSPECIFIED`,e.BLOCK_LOW_AND_ABOVE=`BLOCK_LOW_AND_ABOVE`,e.BLOCK_MEDIUM_AND_ABOVE=`BLOCK_MEDIUM_AND_ABOVE`,e.BLOCK_ONLY_HIGH=`BLOCK_ONLY_HIGH`,e.BLOCK_NONE=`BLOCK_NONE`,e.OFF=`OFF`})(ll||={});var ul;(function(e){e.FINISH_REASON_UNSPECIFIED=`FINISH_REASON_UNSPECIFIED`,e.STOP=`STOP`,e.MAX_TOKENS=`MAX_TOKENS`,e.SAFETY=`SAFETY`,e.RECITATION=`RECITATION`,e.LANGUAGE=`LANGUAGE`,e.OTHER=`OTHER`,e.BLOCKLIST=`BLOCKLIST`,e.PROHIBITED_CONTENT=`PROHIBITED_CONTENT`,e.SPII=`SPII`,e.MALFORMED_FUNCTION_CALL=`MALFORMED_FUNCTION_CALL`,e.IMAGE_SAFETY=`IMAGE_SAFETY`,e.UNEXPECTED_TOOL_CALL=`UNEXPECTED_TOOL_CALL`,e.IMAGE_PROHIBITED_CONTENT=`IMAGE_PROHIBITED_CONTENT`,e.NO_IMAGE=`NO_IMAGE`,e.IMAGE_RECITATION=`IMAGE_RECITATION`,e.IMAGE_OTHER=`IMAGE_OTHER`})(ul||={});var dl;(function(e){e.HARM_PROBABILITY_UNSPECIFIED=`HARM_PROBABILITY_UNSPECIFIED`,e.NEGLIGIBLE=`NEGLIGIBLE`,e.LOW=`LOW`,e.MEDIUM=`MEDIUM`,e.HIGH=`HIGH`})(dl||={});var fl;(function(e){e.HARM_SEVERITY_UNSPECIFIED=`HARM_SEVERITY_UNSPECIFIED`,e.HARM_SEVERITY_NEGLIGIBLE=`HARM_SEVERITY_NEGLIGIBLE`,e.HARM_SEVERITY_LOW=`HARM_SEVERITY_LOW`,e.HARM_SEVERITY_MEDIUM=`HARM_SEVERITY_MEDIUM`,e.HARM_SEVERITY_HIGH=`HARM_SEVERITY_HIGH`})(fl||={});var pl;(function(e){e.URL_RETRIEVAL_STATUS_UNSPECIFIED=`URL_RETRIEVAL_STATUS_UNSPECIFIED`,e.URL_RETRIEVAL_STATUS_SUCCESS=`URL_RETRIEVAL_STATUS_SUCCESS`,e.URL_RETRIEVAL_STATUS_ERROR=`URL_RETRIEVAL_STATUS_ERROR`,e.URL_RETRIEVAL_STATUS_PAYWALL=`URL_RETRIEVAL_STATUS_PAYWALL`,e.URL_RETRIEVAL_STATUS_UNSAFE=`URL_RETRIEVAL_STATUS_UNSAFE`})(pl||={});var ml;(function(e){e.BLOCKED_REASON_UNSPECIFIED=`BLOCKED_REASON_UNSPECIFIED`,e.SAFETY=`SAFETY`,e.OTHER=`OTHER`,e.BLOCKLIST=`BLOCKLIST`,e.PROHIBITED_CONTENT=`PROHIBITED_CONTENT`,e.IMAGE_SAFETY=`IMAGE_SAFETY`,e.MODEL_ARMOR=`MODEL_ARMOR`,e.JAILBREAK=`JAILBREAK`})(ml||={});var hl;(function(e){e.TRAFFIC_TYPE_UNSPECIFIED=`TRAFFIC_TYPE_UNSPECIFIED`,e.ON_DEMAND=`ON_DEMAND`,e.PROVISIONED_THROUGHPUT=`PROVISIONED_THROUGHPUT`})(hl||={});var gl;(function(e){e.MODALITY_UNSPECIFIED=`MODALITY_UNSPECIFIED`,e.TEXT=`TEXT`,e.IMAGE=`IMAGE`,e.AUDIO=`AUDIO`})(gl||={});var _l;(function(e){e.MEDIA_RESOLUTION_UNSPECIFIED=`MEDIA_RESOLUTION_UNSPECIFIED`,e.MEDIA_RESOLUTION_LOW=`MEDIA_RESOLUTION_LOW`,e.MEDIA_RESOLUTION_MEDIUM=`MEDIA_RESOLUTION_MEDIUM`,e.MEDIA_RESOLUTION_HIGH=`MEDIA_RESOLUTION_HIGH`})(_l||={});var vl;(function(e){e.TUNING_MODE_UNSPECIFIED=`TUNING_MODE_UNSPECIFIED`,e.TUNING_MODE_FULL=`TUNING_MODE_FULL`,e.TUNING_MODE_PEFT_ADAPTER=`TUNING_MODE_PEFT_ADAPTER`})(vl||={});var yl;(function(e){e.ADAPTER_SIZE_UNSPECIFIED=`ADAPTER_SIZE_UNSPECIFIED`,e.ADAPTER_SIZE_ONE=`ADAPTER_SIZE_ONE`,e.ADAPTER_SIZE_TWO=`ADAPTER_SIZE_TWO`,e.ADAPTER_SIZE_FOUR=`ADAPTER_SIZE_FOUR`,e.ADAPTER_SIZE_EIGHT=`ADAPTER_SIZE_EIGHT`,e.ADAPTER_SIZE_SIXTEEN=`ADAPTER_SIZE_SIXTEEN`,e.ADAPTER_SIZE_THIRTY_TWO=`ADAPTER_SIZE_THIRTY_TWO`})(yl||={});var bl;(function(e){e.JOB_STATE_UNSPECIFIED=`JOB_STATE_UNSPECIFIED`,e.JOB_STATE_QUEUED=`JOB_STATE_QUEUED`,e.JOB_STATE_PENDING=`JOB_STATE_PENDING`,e.JOB_STATE_RUNNING=`JOB_STATE_RUNNING`,e.JOB_STATE_SUCCEEDED=`JOB_STATE_SUCCEEDED`,e.JOB_STATE_FAILED=`JOB_STATE_FAILED`,e.JOB_STATE_CANCELLING=`JOB_STATE_CANCELLING`,e.JOB_STATE_CANCELLED=`JOB_STATE_CANCELLED`,e.JOB_STATE_PAUSED=`JOB_STATE_PAUSED`,e.JOB_STATE_EXPIRED=`JOB_STATE_EXPIRED`,e.JOB_STATE_UPDATING=`JOB_STATE_UPDATING`,e.JOB_STATE_PARTIALLY_SUCCEEDED=`JOB_STATE_PARTIALLY_SUCCEEDED`})(bl||={});var xl;(function(e){e.TUNING_TASK_UNSPECIFIED=`TUNING_TASK_UNSPECIFIED`,e.TUNING_TASK_I2V=`TUNING_TASK_I2V`,e.TUNING_TASK_T2V=`TUNING_TASK_T2V`,e.TUNING_TASK_R2V=`TUNING_TASK_R2V`})(xl||={});var Sl;(function(e){e.MEDIA_RESOLUTION_UNSPECIFIED=`MEDIA_RESOLUTION_UNSPECIFIED`,e.MEDIA_RESOLUTION_LOW=`MEDIA_RESOLUTION_LOW`,e.MEDIA_RESOLUTION_MEDIUM=`MEDIA_RESOLUTION_MEDIUM`,e.MEDIA_RESOLUTION_HIGH=`MEDIA_RESOLUTION_HIGH`,e.MEDIA_RESOLUTION_ULTRA_HIGH=`MEDIA_RESOLUTION_ULTRA_HIGH`})(Sl||={});var Cl;(function(e){e.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED=`FEATURE_SELECTION_PREFERENCE_UNSPECIFIED`,e.PRIORITIZE_QUALITY=`PRIORITIZE_QUALITY`,e.BALANCED=`BALANCED`,e.PRIORITIZE_COST=`PRIORITIZE_COST`})(Cl||={});var wl;(function(e){e.UNSPECIFIED=`UNSPECIFIED`,e.BLOCKING=`BLOCKING`,e.NON_BLOCKING=`NON_BLOCKING`})(wl||={});var Tl;(function(e){e.MODE_UNSPECIFIED=`MODE_UNSPECIFIED`,e.MODE_DYNAMIC=`MODE_DYNAMIC`})(Tl||={});var El;(function(e){e.ENVIRONMENT_UNSPECIFIED=`ENVIRONMENT_UNSPECIFIED`,e.ENVIRONMENT_BROWSER=`ENVIRONMENT_BROWSER`})(El||={});var Dl;(function(e){e.MODE_UNSPECIFIED=`MODE_UNSPECIFIED`,e.AUTO=`AUTO`,e.ANY=`ANY`,e.NONE=`NONE`,e.VALIDATED=`VALIDATED`})(Dl||={});var Ol;(function(e){e.BLOCK_LOW_AND_ABOVE=`BLOCK_LOW_AND_ABOVE`,e.BLOCK_MEDIUM_AND_ABOVE=`BLOCK_MEDIUM_AND_ABOVE`,e.BLOCK_ONLY_HIGH=`BLOCK_ONLY_HIGH`,e.BLOCK_NONE=`BLOCK_NONE`})(Ol||={});var kl;(function(e){e.DONT_ALLOW=`DONT_ALLOW`,e.ALLOW_ADULT=`ALLOW_ADULT`,e.ALLOW_ALL=`ALLOW_ALL`})(kl||={});var Al;(function(e){e.auto=`auto`,e.en=`en`,e.ja=`ja`,e.ko=`ko`,e.hi=`hi`,e.zh=`zh`,e.pt=`pt`,e.es=`es`})(Al||={});var jl;(function(e){e.MASK_MODE_DEFAULT=`MASK_MODE_DEFAULT`,e.MASK_MODE_USER_PROVIDED=`MASK_MODE_USER_PROVIDED`,e.MASK_MODE_BACKGROUND=`MASK_MODE_BACKGROUND`,e.MASK_MODE_FOREGROUND=`MASK_MODE_FOREGROUND`,e.MASK_MODE_SEMANTIC=`MASK_MODE_SEMANTIC`})(jl||={});var Ml;(function(e){e.CONTROL_TYPE_DEFAULT=`CONTROL_TYPE_DEFAULT`,e.CONTROL_TYPE_CANNY=`CONTROL_TYPE_CANNY`,e.CONTROL_TYPE_SCRIBBLE=`CONTROL_TYPE_SCRIBBLE`,e.CONTROL_TYPE_FACE_MESH=`CONTROL_TYPE_FACE_MESH`})(Ml||={});var Nl;(function(e){e.SUBJECT_TYPE_DEFAULT=`SUBJECT_TYPE_DEFAULT`,e.SUBJECT_TYPE_PERSON=`SUBJECT_TYPE_PERSON`,e.SUBJECT_TYPE_ANIMAL=`SUBJECT_TYPE_ANIMAL`,e.SUBJECT_TYPE_PRODUCT=`SUBJECT_TYPE_PRODUCT`})(Nl||={});var Pl;(function(e){e.EDIT_MODE_DEFAULT=`EDIT_MODE_DEFAULT`,e.EDIT_MODE_INPAINT_REMOVAL=`EDIT_MODE_INPAINT_REMOVAL`,e.EDIT_MODE_INPAINT_INSERTION=`EDIT_MODE_INPAINT_INSERTION`,e.EDIT_MODE_OUTPAINT=`EDIT_MODE_OUTPAINT`,e.EDIT_MODE_CONTROLLED_EDITING=`EDIT_MODE_CONTROLLED_EDITING`,e.EDIT_MODE_STYLE=`EDIT_MODE_STYLE`,e.EDIT_MODE_BGSWAP=`EDIT_MODE_BGSWAP`,e.EDIT_MODE_PRODUCT_IMAGE=`EDIT_MODE_PRODUCT_IMAGE`})(Pl||={});var Fl;(function(e){e.FOREGROUND=`FOREGROUND`,e.BACKGROUND=`BACKGROUND`,e.PROMPT=`PROMPT`,e.SEMANTIC=`SEMANTIC`,e.INTERACTIVE=`INTERACTIVE`})(Fl||={});var Il;(function(e){e.ASSET=`ASSET`,e.STYLE=`STYLE`})(Il||={});var Ll;(function(e){e.INSERT=`INSERT`,e.REMOVE=`REMOVE`,e.REMOVE_STATIC=`REMOVE_STATIC`,e.OUTPAINT=`OUTPAINT`})(Ll||={});var Rl;(function(e){e.OPTIMIZED=`OPTIMIZED`,e.LOSSLESS=`LOSSLESS`})(Rl||={});var zl;(function(e){e.SUPERVISED_FINE_TUNING=`SUPERVISED_FINE_TUNING`,e.PREFERENCE_TUNING=`PREFERENCE_TUNING`})(zl||={});var Bl;(function(e){e.STATE_UNSPECIFIED=`STATE_UNSPECIFIED`,e.STATE_PENDING=`STATE_PENDING`,e.STATE_ACTIVE=`STATE_ACTIVE`,e.STATE_FAILED=`STATE_FAILED`})(Bl||={});var Vl;(function(e){e.STATE_UNSPECIFIED=`STATE_UNSPECIFIED`,e.PROCESSING=`PROCESSING`,e.ACTIVE=`ACTIVE`,e.FAILED=`FAILED`})(Vl||={});var Hl;(function(e){e.SOURCE_UNSPECIFIED=`SOURCE_UNSPECIFIED`,e.UPLOADED=`UPLOADED`,e.GENERATED=`GENERATED`})(Hl||={});var Ul;(function(e){e.TURN_COMPLETE_REASON_UNSPECIFIED=`TURN_COMPLETE_REASON_UNSPECIFIED`,e.MALFORMED_FUNCTION_CALL=`MALFORMED_FUNCTION_CALL`,e.RESPONSE_REJECTED=`RESPONSE_REJECTED`,e.NEED_MORE_INPUT=`NEED_MORE_INPUT`})(Ul||={});var Wl;(function(e){e.MODALITY_UNSPECIFIED=`MODALITY_UNSPECIFIED`,e.TEXT=`TEXT`,e.IMAGE=`IMAGE`,e.VIDEO=`VIDEO`,e.AUDIO=`AUDIO`,e.DOCUMENT=`DOCUMENT`})(Wl||={});var Gl;(function(e){e.VAD_SIGNAL_TYPE_UNSPECIFIED=`VAD_SIGNAL_TYPE_UNSPECIFIED`,e.VAD_SIGNAL_TYPE_SOS=`VAD_SIGNAL_TYPE_SOS`,e.VAD_SIGNAL_TYPE_EOS=`VAD_SIGNAL_TYPE_EOS`})(Gl||={});var Kl;(function(e){e.START_SENSITIVITY_UNSPECIFIED=`START_SENSITIVITY_UNSPECIFIED`,e.START_SENSITIVITY_HIGH=`START_SENSITIVITY_HIGH`,e.START_SENSITIVITY_LOW=`START_SENSITIVITY_LOW`})(Kl||={});var ql;(function(e){e.END_SENSITIVITY_UNSPECIFIED=`END_SENSITIVITY_UNSPECIFIED`,e.END_SENSITIVITY_HIGH=`END_SENSITIVITY_HIGH`,e.END_SENSITIVITY_LOW=`END_SENSITIVITY_LOW`})(ql||={});var Jl;(function(e){e.ACTIVITY_HANDLING_UNSPECIFIED=`ACTIVITY_HANDLING_UNSPECIFIED`,e.START_OF_ACTIVITY_INTERRUPTS=`START_OF_ACTIVITY_INTERRUPTS`,e.NO_INTERRUPTION=`NO_INTERRUPTION`})(Jl||={});var Yl;(function(e){e.TURN_COVERAGE_UNSPECIFIED=`TURN_COVERAGE_UNSPECIFIED`,e.TURN_INCLUDES_ONLY_ACTIVITY=`TURN_INCLUDES_ONLY_ACTIVITY`,e.TURN_INCLUDES_ALL_INPUT=`TURN_INCLUDES_ALL_INPUT`})(Yl||={});var Xl;(function(e){e.SCALE_UNSPECIFIED=`SCALE_UNSPECIFIED`,e.C_MAJOR_A_MINOR=`C_MAJOR_A_MINOR`,e.D_FLAT_MAJOR_B_FLAT_MINOR=`D_FLAT_MAJOR_B_FLAT_MINOR`,e.D_MAJOR_B_MINOR=`D_MAJOR_B_MINOR`,e.E_FLAT_MAJOR_C_MINOR=`E_FLAT_MAJOR_C_MINOR`,e.E_MAJOR_D_FLAT_MINOR=`E_MAJOR_D_FLAT_MINOR`,e.F_MAJOR_D_MINOR=`F_MAJOR_D_MINOR`,e.G_FLAT_MAJOR_E_FLAT_MINOR=`G_FLAT_MAJOR_E_FLAT_MINOR`,e.G_MAJOR_E_MINOR=`G_MAJOR_E_MINOR`,e.A_FLAT_MAJOR_F_MINOR=`A_FLAT_MAJOR_F_MINOR`,e.A_MAJOR_G_FLAT_MINOR=`A_MAJOR_G_FLAT_MINOR`,e.B_FLAT_MAJOR_G_MINOR=`B_FLAT_MAJOR_G_MINOR`,e.B_MAJOR_A_FLAT_MINOR=`B_MAJOR_A_FLAT_MINOR`})(Xl||={});var Zl;(function(e){e.MUSIC_GENERATION_MODE_UNSPECIFIED=`MUSIC_GENERATION_MODE_UNSPECIFIED`,e.QUALITY=`QUALITY`,e.DIVERSITY=`DIVERSITY`,e.VOCALIZATION=`VOCALIZATION`})(Zl||={});var Ql;(function(e){e.PLAYBACK_CONTROL_UNSPECIFIED=`PLAYBACK_CONTROL_UNSPECIFIED`,e.PLAY=`PLAY`,e.PAUSE=`PAUSE`,e.STOP=`STOP`,e.RESET_CONTEXT=`RESET_CONTEXT`})(Ql||={});var $l=class{constructor(e){let t={};for(let n of e.headers.entries())t[n[0]]=n[1];this.headers=t,this.responseInternal=e}json(){return this.responseInternal.json()}},eu=class{get text(){if(this.candidates?.[0]?.content?.parts?.length===0)return;this.candidates&&this.candidates.length>1&&console.warn(`there are multiple candidates in the response, returning text from the first one.`);let e=``,t=!1,n=[];for(let r of this.candidates?.[0]?.content?.parts??[]){for(let[e,t]of Object.entries(r))e!==`text`&&e!==`thought`&&e!==`thoughtSignature`&&(t!==null||t!==void 0)&&n.push(e);if(typeof r.text==`string`){if(typeof r.thought==`boolean`&&r.thought)continue;t=!0,e+=r.text}}return n.length>0&&console.warn(`there are non-text parts ${n} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),t?e:void 0}get data(){if(this.candidates?.[0]?.content?.parts?.length===0)return;this.candidates&&this.candidates.length>1&&console.warn(`there are multiple candidates in the response, returning data from the first one.`);let e=``,t=[];for(let n of this.candidates?.[0]?.content?.parts??[]){for(let[e,r]of Object.entries(n))e!==`inlineData`&&(r!==null||r!==void 0)&&t.push(e);n.inlineData&&typeof n.inlineData.data==`string`&&(e+=atob(n.inlineData.data))}return t.length>0&&console.warn(`there are non-data parts ${t} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),e.length>0?btoa(e):void 0}get functionCalls(){if(this.candidates?.[0]?.content?.parts?.length===0)return;this.candidates&&this.candidates.length>1&&console.warn(`there are multiple candidates in the response, returning function calls from the first one.`);let e=(this.candidates?.[0]?.content?.parts)?.filter(e=>e.functionCall).map(e=>e.functionCall).filter(e=>e!==void 0);if(e?.length!==0)return e}get executableCode(){if(this.candidates?.[0]?.content?.parts?.length===0)return;this.candidates&&this.candidates.length>1&&console.warn(`there are multiple candidates in the response, returning executable code from the first one.`);let e=(this.candidates?.[0]?.content?.parts)?.filter(e=>e.executableCode).map(e=>e.executableCode).filter(e=>e!==void 0);if(e?.length!==0)return e?.[0]?.code}get codeExecutionResult(){if(this.candidates?.[0]?.content?.parts?.length===0)return;this.candidates&&this.candidates.length>1&&console.warn(`there are multiple candidates in the response, returning code execution result from the first one.`);let e=(this.candidates?.[0]?.content?.parts)?.filter(e=>e.codeExecutionResult).map(e=>e.codeExecutionResult).filter(e=>e!==void 0);if(e?.length!==0)return e?.[0]?.output}},tu=class{},nu=class{},ru=class{},iu=class{},au=class{},ou=class{},su=class{},cu=class{},lu=class{},uu=class{},du=class e{_fromAPIResponse({apiResponse:t,_isVertexAI:n}){let r=new e,i,a=t;return i=n?Rc(a):Lc(a),Object.assign(r,i),r}},fu=class{},pu=class{},mu=class{},hu=class{},gu=class{},_u=class{},vu=class{},yu=class e{_fromAPIResponse({apiResponse:t,_isVertexAI:n}){let r=new e,i=Gc(t);return Object.assign(r,i),r}},bu=class{},xu=class{},Su=class{},Cu=class{},wu=class{get text(){let e=``,t=!1,n=[];for(let r of this.serverContent?.modelTurn?.parts??[]){for(let[e,t]of Object.entries(r))e!==`text`&&e!==`thought`&&t!==null&&n.push(e);if(typeof r.text==`string`){if(typeof r.thought==`boolean`&&r.thought)continue;t=!0,e+=r.text}}return n.length>0&&console.warn(`there are non-text parts ${n} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),t?e:void 0}get data(){let e=``,t=[];for(let n of this.serverContent?.modelTurn?.parts??[]){for(let[e,r]of Object.entries(n))e!==`inlineData`&&r!==null&&t.push(e);n.inlineData&&typeof n.inlineData.data==`string`&&(e+=atob(n.inlineData.data))}return t.length>0&&console.warn(`there are non-data parts ${t} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),e.length>0?btoa(e):void 0}},Tu=class{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}},Eu=class e{_fromAPIResponse({apiResponse:t,_isVertexAI:n}){let r=new e,i=qc(t);return Object.assign(r,i),r}};function Y(e,t){if(!t||typeof t!=`string`)throw Error(`model is required and must be a string`);if(t.includes(`..`)||t.includes(`?`)||t.includes(`&`))throw Error(`invalid model parameter`);if(e.isVertexAI()){if(t.startsWith(`publishers/`)||t.startsWith(`projects/`)||t.startsWith(`models/`))return t;if(t.indexOf(`/`)>=0){let e=t.split(`/`,2);return`publishers/${e[0]}/models/${e[1]}`}else return`publishers/google/models/${t}`}else if(t.startsWith(`models/`)||t.startsWith(`tunedModels/`))return t;else return`models/${t}`}function Du(e,t){let n=Y(e,t);return n?n.startsWith(`publishers/`)&&e.isVertexAI()?`projects/${e.getProject()}/locations/${e.getLocation()}/${n}`:n.startsWith(`models/`)&&e.isVertexAI()?`projects/${e.getProject()}/locations/${e.getLocation()}/publishers/google/${n}`:n:``}function Ou(e){return Array.isArray(e)?e.map(e=>ku(e)):[ku(e)]}function ku(e){if(typeof e==`object`&&e)return e;throw Error(`Could not parse input as Blob. Unsupported blob type: ${typeof e}`)}function Au(e){let t=ku(e);if(t.mimeType&&t.mimeType.startsWith(`image/`))return t;throw Error(`Unsupported mime type: ${t.mimeType}`)}function ju(e){let t=ku(e);if(t.mimeType&&t.mimeType.startsWith(`audio/`))return t;throw Error(`Unsupported mime type: ${t.mimeType}`)}function Mu(e){if(e==null)throw Error(`PartUnion is required`);if(typeof e==`object`)return e;if(typeof e==`string`)return{text:e};throw Error(`Unsupported part type: ${typeof e}`)}function Nu(e){if(e==null||Array.isArray(e)&&e.length===0)throw Error(`PartListUnion is required`);return Array.isArray(e)?e.map(e=>Mu(e)):[Mu(e)]}function Pu(e){return typeof e==`object`&&!!e&&`parts`in e&&Array.isArray(e.parts)}function Fu(e){return typeof e==`object`&&!!e&&`functionCall`in e}function Iu(e){return typeof e==`object`&&!!e&&`functionResponse`in e}function X(e){if(e==null)throw Error(`ContentUnion is required`);return Pu(e)?e:{role:`user`,parts:Nu(e)}}function Lu(e,t){if(!t)return[];if(e.isVertexAI()&&Array.isArray(t))return t.flatMap(e=>{let t=X(e);return t.parts&&t.parts.length>0&&t.parts[0].text!==void 0?[t.parts[0].text]:[]});if(e.isVertexAI()){let e=X(t);return e.parts&&e.parts.length>0&&e.parts[0].text!==void 0?[e.parts[0].text]:[]}return Array.isArray(t)?t.map(e=>X(e)):[X(t)]}function Ru(e){if(e==null||Array.isArray(e)&&e.length===0)throw Error(`contents are required`);if(!Array.isArray(e)){if(Fu(e)||Iu(e))throw Error(`To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them`);return[X(e)]}let t=[],n=[],r=Pu(e[0]);for(let i of e){let e=Pu(i);if(e!=r)throw Error(`Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them`);if(e)t.push(i);else if(Fu(i)||Iu(i))throw Error(`To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them`);else n.push(i)}return r||t.push({role:`user`,parts:Nu(n)}),t}function zu(e,t){e.includes(`null`)&&(t.nullable=!0);let n=e.filter(e=>e!==`null`);if(n.length===1)t.type=Object.values(el).includes(n[0].toUpperCase())?n[0].toUpperCase():el.TYPE_UNSPECIFIED;else{t.anyOf=[];for(let e of n)t.anyOf.push({type:Object.values(el).includes(e.toUpperCase())?e.toUpperCase():el.TYPE_UNSPECIFIED})}}function Bu(e){let t={},n=[`items`],r=[`anyOf`],i=[`properties`];if(e.type&&e.anyOf)throw Error(`type and anyOf cannot be both populated.`);let a=e.anyOf;a!=null&&a.length==2&&(a[0].type===`null`?(t.nullable=!0,e=a[1]):a[1].type===`null`&&(t.nullable=!0,e=a[0])),e.type instanceof Array&&zu(e.type,t);for(let[a,o]of Object.entries(e))if(o!=null)if(a==`type`){if(o===`null`)throw Error(`type: null can not be the only possible type for the field.`);if(o instanceof Array)continue;t.type=Object.values(el).includes(o.toUpperCase())?o.toUpperCase():el.TYPE_UNSPECIFIED}else if(n.includes(a))t[a]=Bu(o);else if(r.includes(a)){let e=[];for(let n of o){if(n.type==`null`){t.nullable=!0;continue}e.push(Bu(n))}t[a]=e}else if(i.includes(a)){let e={};for(let[t,n]of Object.entries(o))e[t]=Bu(n);t[a]=e}else{if(a===`additionalProperties`)continue;t[a]=o}return t}function Vu(e){return Bu(e)}function Hu(e){if(typeof e==`object`)return e;if(typeof e==`string`)return{voiceConfig:{prebuiltVoiceConfig:{voiceName:e}}};throw Error(`Unsupported speechConfig type: ${typeof e}`)}function Uu(e){if(`multiSpeakerVoiceConfig`in e)throw Error(`multiSpeakerVoiceConfig is not supported in the live API.`);return e}function Wu(e){if(e.functionDeclarations)for(let t of e.functionDeclarations)t.parameters&&(Object.keys(t.parameters).includes(`$schema`)?t.parametersJsonSchema||(t.parametersJsonSchema=t.parameters,delete t.parameters):t.parameters=Bu(t.parameters)),t.response&&(Object.keys(t.response).includes(`$schema`)?t.responseJsonSchema||(t.responseJsonSchema=t.response,delete t.response):t.response=Bu(t.response));return e}function Gu(e){if(e==null)throw Error(`tools is required`);if(!Array.isArray(e))throw Error(`tools is required and must be an array of Tools`);let t=[];for(let n of e)t.push(n);return t}function Ku(e,t,n,r=1){let i=!t.startsWith(`${n}/`)&&t.split(`/`).length===r;return e.isVertexAI()?t.startsWith(`projects/`)?t:t.startsWith(`locations/`)?`projects/${e.getProject()}/${t}`:t.startsWith(`${n}/`)?`projects/${e.getProject()}/locations/${e.getLocation()}/${t}`:i?`projects/${e.getProject()}/locations/${e.getLocation()}/${n}/${t}`:t:i?`${n}/${t}`:t}function qu(e,t){if(typeof t!=`string`)throw Error(`name must be a string`);return Ku(e,t,`cachedContents`)}function Ju(e){switch(e){case`STATE_UNSPECIFIED`:return`JOB_STATE_UNSPECIFIED`;case`CREATING`:return`JOB_STATE_RUNNING`;case`ACTIVE`:return`JOB_STATE_SUCCEEDED`;case`FAILED`:return`JOB_STATE_FAILED`;default:return e}}function Yu(e){return Fc(e)}function Xu(e){return typeof e==`object`&&!!e&&`name`in e}function Zu(e){return typeof e==`object`&&!!e&&`video`in e}function Qu(e){return typeof e==`object`&&!!e&&`uri`in e}function $u(e){let t;if(Xu(e)&&(t=e.name),!(Qu(e)&&(t=e.uri,t===void 0))&&!(Zu(e)&&(t=e.video?.uri,t===void 0))){if(typeof e==`string`&&(t=e),t===void 0)throw Error(`Could not extract file name from the provided input.`);if(t.startsWith(`https://`)){let e=t.split(`files/`)[1].match(/[a-z0-9]+/);if(e===null)throw Error(`Could not extract file name from URI ${t}`);t=e[0]}else t.startsWith(`files/`)&&(t=t.split(`files/`)[1]);return t}}function ed(e,t){let n;return n=e.isVertexAI()?t?`publishers/google/models`:`models`:t?`models`:`tunedModels`,n}function td(e){for(let t of[`models`,`tunedModels`,`publisherModels`])if(nd(e,t))return e[t];return[]}function nd(e,t){return typeof e==`object`&&!!e&&t in e}function rd(e,t={}){let n=e,r={name:n.name,description:n.description,parametersJsonSchema:n.inputSchema};return n.outputSchema&&(r.responseJsonSchema=n.outputSchema),t.behavior&&(r.behavior=t.behavior),{functionDeclarations:[r]}}function id(e,t={}){let n=[],r=new Set;for(let i of e){let e=i.name;if(r.has(e))throw Error(`Duplicate function name ${e} found in MCP tools. Please ensure function names are unique.`);r.add(e);let a=rd(i,t);a.functionDeclarations&&n.push(...a.functionDeclarations)}return{functionDeclarations:n}}function ad(e,t){let n;if(typeof t==`string`)if(e.isVertexAI())if(t.startsWith(`gs://`))n={format:`jsonl`,gcsUri:[t]};else if(t.startsWith(`bq://`))n={format:`bigquery`,bigqueryUri:t};else throw Error(`Unsupported string source for Vertex AI: ${t}`);else if(t.startsWith(`files/`))n={fileName:t};else throw Error(`Unsupported string source for Gemini API: ${t}`);else if(Array.isArray(t)){if(e.isVertexAI())throw Error(`InlinedRequest[] is not supported in Vertex AI.`);n={inlinedRequests:t}}else n=t;let r=[n.gcsUri,n.bigqueryUri].filter(Boolean).length,i=[n.inlinedRequests,n.fileName].filter(Boolean).length;if(e.isVertexAI()){if(i>0||r!==1)throw Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(r>0||i!==1)throw Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return n}function od(e){if(typeof e!=`string`)return e;let t=e;if(t.startsWith(`gs://`))return{format:`jsonl`,gcsUri:t};if(t.startsWith(`bq://`))return{format:`bigquery`,bigqueryUri:t};throw Error(`Unsupported destination: ${t}`)}function sd(e){if(typeof e!=`object`||!e)return{};let t=e,n=t.inlinedResponses;if(typeof n!=`object`||!n)return e;let r=n.inlinedResponses;if(!Array.isArray(r)||r.length===0)return e;let i=!1;for(let e of r){if(typeof e!=`object`||!e)continue;let t=e.response;if(!(typeof t!=`object`||!t)&&t.embedding!==void 0){i=!0;break}}return i&&(t.inlinedEmbedContentResponses=t.inlinedResponses,delete t.inlinedResponses),e}function cd(e,t){let n=t;if(!e.isVertexAI()){if(/batches\/[^/]+$/.test(n))return n.split(`/`).pop();throw Error(`Invalid batch job name: ${n}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(n))return n.split(`/`).pop();if(/^\d+$/.test(n))return n;throw Error(`Invalid batch job name: ${n}.`)}function ld(e){let t=e;return t===`BATCH_STATE_UNSPECIFIED`?`JOB_STATE_UNSPECIFIED`:t===`BATCH_STATE_PENDING`?`JOB_STATE_PENDING`:t===`BATCH_STATE_RUNNING`?`JOB_STATE_RUNNING`:t===`BATCH_STATE_SUCCEEDED`?`JOB_STATE_SUCCEEDED`:t===`BATCH_STATE_FAILED`?`JOB_STATE_FAILED`:t===`BATCH_STATE_CANCELLED`?`JOB_STATE_CANCELLED`:t===`BATCH_STATE_EXPIRED`?`JOB_STATE_EXPIRED`:t}function ud(e){let t={},n=J(e,[`responsesFile`]);n!=null&&q(t,[`fileName`],n);let r=J(e,[`inlinedResponses`,`inlinedResponses`]);if(r!=null){let e=r;Array.isArray(e)&&(e=e.map(e=>Jd(e))),q(t,[`inlinedResponses`],e)}let i=J(e,[`inlinedEmbedContentResponses`,`inlinedResponses`]);if(i!=null){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),q(t,[`inlinedEmbedContentResponses`],e)}return t}function dd(e){let t={},n=J(e,[`predictionsFormat`]);n!=null&&q(t,[`format`],n);let r=J(e,[`gcsDestination`,`outputUriPrefix`]);r!=null&&q(t,[`gcsUri`],r);let i=J(e,[`bigqueryDestination`,`outputUri`]);return i!=null&&q(t,[`bigqueryUri`],i),t}function fd(e){let t={},n=J(e,[`format`]);n!=null&&q(t,[`predictionsFormat`],n);let r=J(e,[`gcsUri`]);r!=null&&q(t,[`gcsDestination`,`outputUriPrefix`],r);let i=J(e,[`bigqueryUri`]);if(i!=null&&q(t,[`bigqueryDestination`,`outputUri`],i),J(e,[`fileName`])!==void 0)throw Error(`fileName parameter is not supported in Vertex AI.`);if(J(e,[`inlinedResponses`])!==void 0)throw Error(`inlinedResponses parameter is not supported in Vertex AI.`);if(J(e,[`inlinedEmbedContentResponses`])!==void 0)throw Error(`inlinedEmbedContentResponses parameter is not supported in Vertex AI.`);return t}function pd(e){let t={},n=J(e,[`name`]);n!=null&&q(t,[`name`],n);let r=J(e,[`metadata`,`displayName`]);r!=null&&q(t,[`displayName`],r);let i=J(e,[`metadata`,`state`]);i!=null&&q(t,[`state`],ld(i));let a=J(e,[`metadata`,`createTime`]);a!=null&&q(t,[`createTime`],a);let o=J(e,[`metadata`,`endTime`]);o!=null&&q(t,[`endTime`],o);let s=J(e,[`metadata`,`updateTime`]);s!=null&&q(t,[`updateTime`],s);let c=J(e,[`metadata`,`model`]);c!=null&&q(t,[`model`],c);let l=J(e,[`metadata`,`output`]);return l!=null&&q(t,[`dest`],ud(sd(l))),t}function md(e){let t={},n=J(e,[`name`]);n!=null&&q(t,[`name`],n);let r=J(e,[`displayName`]);r!=null&&q(t,[`displayName`],r);let i=J(e,[`state`]);i!=null&&q(t,[`state`],ld(i));let a=J(e,[`error`]);a!=null&&q(t,[`error`],a);let o=J(e,[`createTime`]);o!=null&&q(t,[`createTime`],o);let s=J(e,[`startTime`]);s!=null&&q(t,[`startTime`],s);let c=J(e,[`endTime`]);c!=null&&q(t,[`endTime`],c);let l=J(e,[`updateTime`]);l!=null&&q(t,[`updateTime`],l);let u=J(e,[`model`]);u!=null&&q(t,[`model`],u);let d=J(e,[`inputConfig`]);d!=null&&q(t,[`src`],hd(d));let f=J(e,[`outputConfig`]);f!=null&&q(t,[`dest`],dd(sd(f)));let p=J(e,[`completionStats`]);return p!=null&&q(t,[`completionStats`],p),t}function hd(e){let t={},n=J(e,[`instancesFormat`]);n!=null&&q(t,[`format`],n);let r=J(e,[`gcsSource`,`uris`]);r!=null&&q(t,[`gcsUri`],r);let i=J(e,[`bigquerySource`,`inputUri`]);return i!=null&&q(t,[`bigqueryUri`],i),t}function gd(e,t){let n={};if(J(t,[`format`])!==void 0)throw Error(`format parameter is not supported in Gemini API.`);if(J(t,[`gcsUri`])!==void 0)throw Error(`gcsUri parameter is not supported in Gemini API.`);if(J(t,[`bigqueryUri`])!==void 0)throw Error(`bigqueryUri parameter is not supported in Gemini API.`);let r=J(t,[`fileName`]);r!=null&&q(n,[`fileName`],r);let i=J(t,[`inlinedRequests`]);if(i!=null){let t=i;Array.isArray(t)&&(t=t.map(t=>qd(e,t))),q(n,[`requests`,`requests`],t)}return n}function _d(e){let t={},n=J(e,[`format`]);n!=null&&q(t,[`instancesFormat`],n);let r=J(e,[`gcsUri`]);r!=null&&q(t,[`gcsSource`,`uris`],r);let i=J(e,[`bigqueryUri`]);if(i!=null&&q(t,[`bigquerySource`,`inputUri`],i),J(e,[`fileName`])!==void 0)throw Error(`fileName parameter is not supported in Vertex AI.`);if(J(e,[`inlinedRequests`])!==void 0)throw Error(`inlinedRequests parameter is not supported in Vertex AI.`);return t}function vd(e){let t={},n=J(e,[`data`]);if(n!=null&&q(t,[`data`],n),J(e,[`displayName`])!==void 0)throw Error(`displayName parameter is not supported in Gemini API.`);let r=J(e,[`mimeType`]);return r!=null&&q(t,[`mimeType`],r),t}function yd(e,t){let n={},r=J(t,[`name`]);return r!=null&&q(n,[`_url`,`name`],cd(e,r)),n}function bd(e,t){let n={},r=J(t,[`name`]);return r!=null&&q(n,[`_url`,`name`],cd(e,r)),n}function xd(e){let t={},n=J(e,[`content`]);n!=null&&q(t,[`content`],n);let r=J(e,[`citationMetadata`]);r!=null&&q(t,[`citationMetadata`],Sd(r));let i=J(e,[`tokenCount`]);i!=null&&q(t,[`tokenCount`],i);let a=J(e,[`finishReason`]);a!=null&&q(t,[`finishReason`],a);let o=J(e,[`avgLogprobs`]);o!=null&&q(t,[`avgLogprobs`],o);let s=J(e,[`groundingMetadata`]);s!=null&&q(t,[`groundingMetadata`],s);let c=J(e,[`index`]);c!=null&&q(t,[`index`],c);let l=J(e,[`logprobsResult`]);l!=null&&q(t,[`logprobsResult`],l);let u=J(e,[`safetyRatings`]);if(u!=null){let e=u;Array.isArray(e)&&(e=e.map(e=>e)),q(t,[`safetyRatings`],e)}let d=J(e,[`urlContextMetadata`]);return d!=null&&q(t,[`urlContextMetadata`],d),t}function Sd(e){let t={},n=J(e,[`citationSources`]);if(n!=null){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),q(t,[`citations`],e)}return t}function Cd(e){let t={},n=J(e,[`parts`]);if(n!=null){let e=n;Array.isArray(e)&&(e=e.map(e=>tf(e))),q(t,[`parts`],e)}let r=J(e,[`role`]);return r!=null&&q(t,[`role`],r),t}function wd(e,t){let n={},r=J(e,[`displayName`]);if(t!==void 0&&r!=null&&q(t,[`batch`,`displayName`],r),J(e,[`dest`])!==void 0)throw Error(`dest parameter is not supported in Gemini API.`);return n}function Td(e,t){let n={},r=J(e,[`displayName`]);t!==void 0&&r!=null&&q(t,[`displayName`],r);let i=J(e,[`dest`]);return t!==void 0&&i!=null&&q(t,[`outputConfig`],fd(od(i))),n}function Ed(e,t){let n={},r=J(t,[`model`]);r!=null&&q(n,[`_url`,`model`],Y(e,r));let i=J(t,[`src`]);i!=null&&q(n,[`batch`,`inputConfig`],gd(e,ad(e,i)));let a=J(t,[`config`]);return a!=null&&wd(a,n),n}function Dd(e,t){let n={},r=J(t,[`model`]);r!=null&&q(n,[`model`],Y(e,r));let i=J(t,[`src`]);i!=null&&q(n,[`inputConfig`],_d(ad(e,i)));let a=J(t,[`config`]);return a!=null&&Td(a,n),n}function Od(e,t){let n={},r=J(e,[`displayName`]);return t!==void 0&&r!=null&&q(t,[`batch`,`displayName`],r),n}function kd(e,t){let n={},r=J(t,[`model`]);r!=null&&q(n,[`_url`,`model`],Y(e,r));let i=J(t,[`src`]);i!=null&&q(n,[`batch`,`inputConfig`],Id(e,i));let a=J(t,[`config`]);return a!=null&&Od(a,n),n}function Ad(e,t){let n={},r=J(t,[`name`]);return r!=null&&q(n,[`_url`,`name`],cd(e,r)),n}function jd(e,t){let n={},r=J(t,[`name`]);return r!=null&&q(n,[`_url`,`name`],cd(e,r)),n}function Md(e){let t={},n=J(e,[`sdkHttpResponse`]);n!=null&&q(t,[`sdkHttpResponse`],n);let r=J(e,[`name`]);r!=null&&q(t,[`name`],r);let i=J(e,[`done`]);i!=null&&q(t,[`done`],i);let a=J(e,[`error`]);return a!=null&&q(t,[`error`],a),t}function Nd(e){let t={},n=J(e,[`sdkHttpResponse`]);n!=null&&q(t,[`sdkHttpResponse`],n);let r=J(e,[`name`]);r!=null&&q(t,[`name`],r);let i=J(e,[`done`]);i!=null&&q(t,[`done`],i);let a=J(e,[`error`]);return a!=null&&q(t,[`error`],a),t}function Pd(e,t){let n={},r=J(t,[`contents`]);if(r!=null){let t=Lu(e,r);Array.isArray(t)&&(t=t.map(e=>e)),q(n,[`requests[]`,`request`,`content`],t)}let i=J(t,[`config`]);return i!=null&&(q(n,[`_self`],Fd(i,n)),Nc(n,{"requests[].*":`requests[].request.*`})),n}function Fd(e,t){let n={},r=J(e,[`taskType`]);t!==void 0&&r!=null&&q(t,[`requests[]`,`taskType`],r);let i=J(e,[`title`]);t!==void 0&&i!=null&&q(t,[`requests[]`,`title`],i);let a=J(e,[`outputDimensionality`]);if(t!==void 0&&a!=null&&q(t,[`requests[]`,`outputDimensionality`],a),J(e,[`mimeType`])!==void 0)throw Error(`mimeType parameter is not supported in Gemini API.`);if(J(e,[`autoTruncate`])!==void 0)throw Error(`autoTruncate parameter is not supported in Gemini API.`);return n}function Id(e,t){let n={},r=J(t,[`fileName`]);r!=null&&q(n,[`file_name`],r);let i=J(t,[`inlinedRequests`]);return i!=null&&q(n,[`requests`],Pd(e,i)),n}function Ld(e){let t={};if(J(e,[`displayName`])!==void 0)throw Error(`displayName parameter is not supported in Gemini API.`);let n=J(e,[`fileUri`]);n!=null&&q(t,[`fileUri`],n);let r=J(e,[`mimeType`]);return r!=null&&q(t,[`mimeType`],r),t}function Rd(e){let t={},n=J(e,[`id`]);n!=null&&q(t,[`id`],n);let r=J(e,[`args`]);r!=null&&q(t,[`args`],r);let i=J(e,[`name`]);if(i!=null&&q(t,[`name`],i),J(e,[`partialArgs`])!==void 0)throw Error(`partialArgs parameter is not supported in Gemini API.`);if(J(e,[`willContinue`])!==void 0)throw Error(`willContinue parameter is not supported in Gemini API.`);return t}function zd(e){let t={},n=J(e,[`mode`]);n!=null&&q(t,[`mode`],n);let r=J(e,[`allowedFunctionNames`]);if(r!=null&&q(t,[`allowedFunctionNames`],r),J(e,[`streamFunctionCallArguments`])!==void 0)throw Error(`streamFunctionCallArguments parameter is not supported in Gemini API.`);return t}function Bd(e,t,n){let r={},i=J(t,[`systemInstruction`]);n!==void 0&&i!=null&&q(n,[`systemInstruction`],Cd(X(i)));let a=J(t,[`temperature`]);a!=null&&q(r,[`temperature`],a);let o=J(t,[`topP`]);o!=null&&q(r,[`topP`],o);let s=J(t,[`topK`]);s!=null&&q(r,[`topK`],s);let c=J(t,[`candidateCount`]);c!=null&&q(r,[`candidateCount`],c);let l=J(t,[`maxOutputTokens`]);l!=null&&q(r,[`maxOutputTokens`],l);let u=J(t,[`stopSequences`]);u!=null&&q(r,[`stopSequences`],u);let d=J(t,[`responseLogprobs`]);d!=null&&q(r,[`responseLogprobs`],d);let f=J(t,[`logprobs`]);f!=null&&q(r,[`logprobs`],f);let p=J(t,[`presencePenalty`]);p!=null&&q(r,[`presencePenalty`],p);let m=J(t,[`frequencyPenalty`]);m!=null&&q(r,[`frequencyPenalty`],m);let h=J(t,[`seed`]);h!=null&&q(r,[`seed`],h);let g=J(t,[`responseMimeType`]);g!=null&&q(r,[`responseMimeType`],g);let _=J(t,[`responseSchema`]);_!=null&&q(r,[`responseSchema`],Vu(_));let v=J(t,[`responseJsonSchema`]);if(v!=null&&q(r,[`responseJsonSchema`],v),J(t,[`routingConfig`])!==void 0)throw Error(`routingConfig parameter is not supported in Gemini API.`);if(J(t,[`modelSelectionConfig`])!==void 0)throw Error(`modelSelectionConfig parameter is not supported in Gemini API.`);let y=J(t,[`safetySettings`]);if(n!==void 0&&y!=null){let e=y;Array.isArray(e)&&(e=e.map(e=>nf(e))),q(n,[`safetySettings`],e)}let b=J(t,[`tools`]);if(n!==void 0&&b!=null){let e=Gu(b);Array.isArray(e)&&(e=e.map(e=>af(Wu(e)))),q(n,[`tools`],e)}let x=J(t,[`toolConfig`]);if(n!==void 0&&x!=null&&q(n,[`toolConfig`],rf(x)),J(t,[`labels`])!==void 0)throw Error(`labels parameter is not supported in Gemini API.`);let S=J(t,[`cachedContent`]);n!==void 0&&S!=null&&q(n,[`cachedContent`],qu(e,S));let C=J(t,[`responseModalities`]);C!=null&&q(r,[`responseModalities`],C);let w=J(t,[`mediaResolution`]);w!=null&&q(r,[`mediaResolution`],w);let T=J(t,[`speechConfig`]);if(T!=null&&q(r,[`speechConfig`],Hu(T)),J(t,[`audioTimestamp`])!==void 0)throw Error(`audioTimestamp parameter is not supported in Gemini API.`);let E=J(t,[`thinkingConfig`]);E!=null&&q(r,[`thinkingConfig`],E);let ee=J(t,[`imageConfig`]);ee!=null&&q(r,[`imageConfig`],Kd(ee));let te=J(t,[`enableEnhancedCivicAnswers`]);return te!=null&&q(r,[`enableEnhancedCivicAnswers`],te),r}function Vd(e){let t={},n=J(e,[`sdkHttpResponse`]);n!=null&&q(t,[`sdkHttpResponse`],n);let r=J(e,[`candidates`]);if(r!=null){let e=r;Array.isArray(e)&&(e=e.map(e=>xd(e))),q(t,[`candidates`],e)}let i=J(e,[`modelVersion`]);i!=null&&q(t,[`modelVersion`],i);let a=J(e,[`promptFeedback`]);a!=null&&q(t,[`promptFeedback`],a);let o=J(e,[`responseId`]);o!=null&&q(t,[`responseId`],o);let s=J(e,[`usageMetadata`]);return s!=null&&q(t,[`usageMetadata`],s),t}function Hd(e,t){let n={},r=J(t,[`name`]);return r!=null&&q(n,[`_url`,`name`],cd(e,r)),n}function Ud(e,t){let n={},r=J(t,[`name`]);return r!=null&&q(n,[`_url`,`name`],cd(e,r)),n}function Wd(e){let t={};if(J(e,[`authConfig`])!==void 0)throw Error(`authConfig parameter is not supported in Gemini API.`);let n=J(e,[`enableWidget`]);return n!=null&&q(t,[`enableWidget`],n),t}function Gd(e){let t={};if(J(e,[`excludeDomains`])!==void 0)throw Error(`excludeDomains parameter is not supported in Gemini API.`);if(J(e,[`blockingConfidence`])!==void 0)throw Error(`blockingConfidence parameter is not supported in Gemini API.`);let n=J(e,[`timeRangeFilter`]);return n!=null&&q(t,[`timeRangeFilter`],n),t}function Kd(e){let t={},n=J(e,[`aspectRatio`]);n!=null&&q(t,[`aspectRatio`],n);let r=J(e,[`imageSize`]);if(r!=null&&q(t,[`imageSize`],r),J(e,[`outputMimeType`])!==void 0)throw Error(`outputMimeType parameter is not supported in Gemini API.`);if(J(e,[`outputCompressionQuality`])!==void 0)throw Error(`outputCompressionQuality parameter is not supported in Gemini API.`);return t}function qd(e,t){let n={},r=J(t,[`model`]);r!=null&&q(n,[`request`,`model`],Y(e,r));let i=J(t,[`contents`]);if(i!=null){let e=Ru(i);Array.isArray(e)&&(e=e.map(e=>Cd(e))),q(n,[`request`,`contents`],e)}let a=J(t,[`metadata`]);a!=null&&q(n,[`metadata`],a);let o=J(t,[`config`]);return o!=null&&q(n,[`request`,`generationConfig`],Bd(e,o,J(n,[`request`],{}))),n}function Jd(e){let t={},n=J(e,[`response`]);n!=null&&q(t,[`response`],Vd(n));let r=J(e,[`error`]);return r!=null&&q(t,[`error`],r),t}function Yd(e,t){let n={},r=J(e,[`pageSize`]);t!==void 0&&r!=null&&q(t,[`_query`,`pageSize`],r);let i=J(e,[`pageToken`]);if(t!==void 0&&i!=null&&q(t,[`_query`,`pageToken`],i),J(e,[`filter`])!==void 0)throw Error(`filter parameter is not supported in Gemini API.`);return n}function Xd(e,t){let n={},r=J(e,[`pageSize`]);t!==void 0&&r!=null&&q(t,[`_query`,`pageSize`],r);let i=J(e,[`pageToken`]);t!==void 0&&i!=null&&q(t,[`_query`,`pageToken`],i);let a=J(e,[`filter`]);return t!==void 0&&a!=null&&q(t,[`_query`,`filter`],a),n}function Zd(e){let t={},n=J(e,[`config`]);return n!=null&&Yd(n,t),t}function Qd(e){let t={},n=J(e,[`config`]);return n!=null&&Xd(n,t),t}function $d(e){let t={},n=J(e,[`sdkHttpResponse`]);n!=null&&q(t,[`sdkHttpResponse`],n);let r=J(e,[`nextPageToken`]);r!=null&&q(t,[`nextPageToken`],r);let i=J(e,[`operations`]);if(i!=null){let e=i;Array.isArray(e)&&(e=e.map(e=>pd(e))),q(t,[`batchJobs`],e)}return t}function ef(e){let t={},n=J(e,[`sdkHttpResponse`]);n!=null&&q(t,[`sdkHttpResponse`],n);let r=J(e,[`nextPageToken`]);r!=null&&q(t,[`nextPageToken`],r);let i=J(e,[`batchPredictionJobs`]);if(i!=null){let e=i;Array.isArray(e)&&(e=e.map(e=>md(e))),q(t,[`batchJobs`],e)}return t}function tf(e){let t={},n=J(e,[`mediaResolution`]);n!=null&&q(t,[`mediaResolution`],n);let r=J(e,[`codeExecutionResult`]);r!=null&&q(t,[`codeExecutionResult`],r);let i=J(e,[`executableCode`]);i!=null&&q(t,[`executableCode`],i);let a=J(e,[`fileData`]);a!=null&&q(t,[`fileData`],Ld(a));let o=J(e,[`functionCall`]);o!=null&&q(t,[`functionCall`],Rd(o));let s=J(e,[`functionResponse`]);s!=null&&q(t,[`functionResponse`],s);let c=J(e,[`inlineData`]);c!=null&&q(t,[`inlineData`],vd(c));let l=J(e,[`text`]);l!=null&&q(t,[`text`],l);let u=J(e,[`thought`]);u!=null&&q(t,[`thought`],u);let d=J(e,[`thoughtSignature`]);d!=null&&q(t,[`thoughtSignature`],d);let f=J(e,[`videoMetadata`]);return f!=null&&q(t,[`videoMetadata`],f),t}function nf(e){let t={},n=J(e,[`category`]);if(n!=null&&q(t,[`category`],n),J(e,[`method`])!==void 0)throw Error(`method parameter is not supported in Gemini API.`);let r=J(e,[`threshold`]);return r!=null&&q(t,[`threshold`],r),t}function rf(e){let t={},n=J(e,[`functionCallingConfig`]);n!=null&&q(t,[`functionCallingConfig`],zd(n));let r=J(e,[`retrievalConfig`]);return r!=null&&q(t,[`retrievalConfig`],r),t}function af(e){let t={},n=J(e,[`functionDeclarations`]);if(n!=null){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),q(t,[`functionDeclarations`],e)}if(J(e,[`retrieval`])!==void 0)throw Error(`retrieval parameter is not supported in Gemini API.`);let r=J(e,[`googleSearchRetrieval`]);r!=null&&q(t,[`googleSearchRetrieval`],r);let i=J(e,[`computerUse`]);i!=null&&q(t,[`computerUse`],i);let a=J(e,[`fileSearch`]);a!=null&&q(t,[`fileSearch`],a);let o=J(e,[`codeExecution`]);if(o!=null&&q(t,[`codeExecution`],o),J(e,[`enterpriseWebSearch`])!==void 0)throw Error(`enterpriseWebSearch parameter is not supported in Gemini API.`);let s=J(e,[`googleMaps`]);s!=null&&q(t,[`googleMaps`],Wd(s));let c=J(e,[`googleSearch`]);c!=null&&q(t,[`googleSearch`],Gd(c));let l=J(e,[`urlContext`]);return l!=null&&q(t,[`urlContext`],l),t}var of;(function(e){e.PAGED_ITEM_BATCH_JOBS=`batchJobs`,e.PAGED_ITEM_MODELS=`models`,e.PAGED_ITEM_TUNING_JOBS=`tuningJobs`,e.PAGED_ITEM_FILES=`files`,e.PAGED_ITEM_CACHED_CONTENTS=`cachedContents`,e.PAGED_ITEM_FILE_SEARCH_STORES=`fileSearchStores`,e.PAGED_ITEM_DOCUMENTS=`documents`})(of||={});var sf=class{constructor(e,t,n,r){this.pageInternal=[],this.paramsInternal={},this.requestInternal=t,this.init(e,n,r)}init(e,t,n){this.nameInternal=e,this.pageInternal=t[this.nameInternal]||[],this.sdkHttpResponseInternal=t?.sdkHttpResponse,this.idxInternal=0;let r={config:{}};r=!n||Object.keys(n).length===0?{config:{}}:typeof n==`object`?Object.assign({},n):n,r.config&&(r.config.pageToken=t.nextPageToken),this.paramsInternal=r,this.pageInternalSize=r.config?.pageSize??this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};let e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw Error(`No more pages to fetch.`);let e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){return this.params.config?.pageToken!==void 0}},cf=class extends Mc{constructor(e){super(),this.apiClient=e,this.list=async(e={})=>new sf(of.PAGED_ITEM_BATCH_JOBS,e=>this.listInternal(e),await this.listInternal(e),e),this.create=async e=>(this.apiClient.isVertexAI()&&(e.config=this.formatDestination(e.src,e.config)),this.createInternal(e)),this.createEmbeddings=async e=>{if(console.warn(`batches.createEmbeddings() is experimental and may change without notice.`),this.apiClient.isVertexAI())throw Error(`Vertex AI does not support batches.createEmbeddings.`);return this.createEmbeddingsInternal(e)}}createInlinedGenerateContentRequest(e){let t=Ed(this.apiClient,e),n=t._url,r=K(`{model}:batchGenerateContent`,n),i=t.batch.inputConfig.requests,a=i.requests,o=[];for(let e of a){let t=Object.assign({},e);if(t.systemInstruction){let e=t.systemInstruction;delete t.systemInstruction;let n=t.request;n.systemInstruction=e,t.request=n}o.push(t)}return i.requests=o,delete t.config,delete t._url,delete t._query,{path:r,body:t}}getGcsUri(e){if(typeof e==`string`)return e.startsWith(`gs://`)?e:void 0;if(!Array.isArray(e)&&e.gcsUri&&e.gcsUri.length>0)return e.gcsUri[0]}getBigqueryUri(e){if(typeof e==`string`)return e.startsWith(`bq://`)?e:void 0;if(!Array.isArray(e))return e.bigqueryUri}formatDestination(e,t){let n=t?Object.assign({},t):{},r=Date.now().toString();if(n.displayName||=`genaiBatchJob_${r}`,n.dest===void 0){let t=this.getGcsUri(e),i=this.getBigqueryUri(e);if(t)t.endsWith(`.jsonl`)?n.dest=`${t.slice(0,-6)}/dest`:n.dest=`${t}_dest_${r}`;else if(i)n.dest=`${i}_dest_${r}`;else throw Error(`Unsupported source for Vertex AI: No GCS or BigQuery URI found.`)}return n}async createInternal(e){let t,n=``,r={};if(this.apiClient.isVertexAI()){let i=Dd(this.apiClient,e);return n=K(`batchPredictionJobs`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.request({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`POST`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}).then(e=>e.json()),t.then(e=>md(e))}else{let i=Ed(this.apiClient,e);return n=K(`{model}:batchGenerateContent`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.request({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`POST`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}).then(e=>e.json()),t.then(e=>pd(e))}}async createEmbeddingsInternal(e){let t,n=``,r={};if(this.apiClient.isVertexAI())throw Error(`This method is only supported by the Gemini Developer API.`);{let i=kd(this.apiClient,e);return n=K(`{model}:asyncBatchEmbedContent`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.request({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`POST`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}).then(e=>e.json()),t.then(e=>pd(e))}}async get(e){let t,n=``,r={};if(this.apiClient.isVertexAI()){let i=Ud(this.apiClient,e);return n=K(`batchPredictionJobs/{name}`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.request({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`GET`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}).then(e=>e.json()),t.then(e=>md(e))}else{let i=Hd(this.apiClient,e);return n=K(`batches/{name}`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.request({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`GET`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}).then(e=>e.json()),t.then(e=>pd(e))}}async cancel(e){let t=``,n={};if(this.apiClient.isVertexAI()){let r=bd(this.apiClient,e);t=K(`batchPredictionJobs/{name}:cancel`,r._url),n=r._query,delete r._url,delete r._query,await this.apiClient.request({path:t,queryParams:n,body:JSON.stringify(r),httpMethod:`POST`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal})}else{let r=yd(this.apiClient,e);t=K(`batches/{name}:cancel`,r._url),n=r._query,delete r._url,delete r._query,await this.apiClient.request({path:t,queryParams:n,body:JSON.stringify(r),httpMethod:`POST`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal})}}async listInternal(e){let t,n=``,r={};if(this.apiClient.isVertexAI()){let i=Qd(e);return n=K(`batchPredictionJobs`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.request({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`GET`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}).then(e=>e.json().then(t=>{let n=t;return n.sdkHttpResponse={headers:e.headers},n})),t.then(e=>{let t=ef(e),n=new Cu;return Object.assign(n,t),n})}else{let i=Zd(e);return n=K(`batches`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.request({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`GET`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}).then(e=>e.json().then(t=>{let n=t;return n.sdkHttpResponse={headers:e.headers},n})),t.then(e=>{let t=$d(e),n=new Cu;return Object.assign(n,t),n})}}async delete(e){let t,n=``,r={};if(this.apiClient.isVertexAI()){let i=jd(this.apiClient,e);return n=K(`batchPredictionJobs/{name}`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.request({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`DELETE`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}).then(e=>e.json().then(t=>{let n=t;return n.sdkHttpResponse={headers:e.headers},n})),t.then(e=>Nd(e))}else{let i=Ad(this.apiClient,e);return n=K(`batches/{name}`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.request({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`DELETE`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}).then(e=>e.json().then(t=>{let n=t;return n.sdkHttpResponse={headers:e.headers},n})),t.then(e=>Md(e))}}};function lf(e){let t={},n=J(e,[`data`]);if(n!=null&&q(t,[`data`],n),J(e,[`displayName`])!==void 0)throw Error(`displayName parameter is not supported in Gemini API.`);let r=J(e,[`mimeType`]);return r!=null&&q(t,[`mimeType`],r),t}function uf(e){let t={},n=J(e,[`parts`]);if(n!=null){let e=n;Array.isArray(e)&&(e=e.map(e=>Nf(e))),q(t,[`parts`],e)}let r=J(e,[`role`]);return r!=null&&q(t,[`role`],r),t}function df(e,t){let n={},r=J(e,[`ttl`]);t!==void 0&&r!=null&&q(t,[`ttl`],r);let i=J(e,[`expireTime`]);t!==void 0&&i!=null&&q(t,[`expireTime`],i);let a=J(e,[`displayName`]);t!==void 0&&a!=null&&q(t,[`displayName`],a);let o=J(e,[`contents`]);if(t!==void 0&&o!=null){let e=Ru(o);Array.isArray(e)&&(e=e.map(e=>uf(e))),q(t,[`contents`],e)}let s=J(e,[`systemInstruction`]);t!==void 0&&s!=null&&q(t,[`systemInstruction`],uf(X(s)));let c=J(e,[`tools`]);if(t!==void 0&&c!=null){let e=c;Array.isArray(e)&&(e=e.map(e=>Ff(e))),q(t,[`tools`],e)}let l=J(e,[`toolConfig`]);if(t!==void 0&&l!=null&&q(t,[`toolConfig`],Pf(l)),J(e,[`kmsKeyName`])!==void 0)throw Error(`kmsKeyName parameter is not supported in Gemini API.`);return n}function ff(e,t){let n={},r=J(e,[`ttl`]);t!==void 0&&r!=null&&q(t,[`ttl`],r);let i=J(e,[`expireTime`]);t!==void 0&&i!=null&&q(t,[`expireTime`],i);let a=J(e,[`displayName`]);t!==void 0&&a!=null&&q(t,[`displayName`],a);let o=J(e,[`contents`]);if(t!==void 0&&o!=null){let e=Ru(o);Array.isArray(e)&&(e=e.map(e=>e)),q(t,[`contents`],e)}let s=J(e,[`systemInstruction`]);t!==void 0&&s!=null&&q(t,[`systemInstruction`],X(s));let c=J(e,[`tools`]);if(t!==void 0&&c!=null){let e=c;Array.isArray(e)&&(e=e.map(e=>If(e))),q(t,[`tools`],e)}let l=J(e,[`toolConfig`]);t!==void 0&&l!=null&&q(t,[`toolConfig`],l);let u=J(e,[`kmsKeyName`]);return t!==void 0&&u!=null&&q(t,[`encryption_spec`,`kmsKeyName`],u),n}function pf(e,t){let n={},r=J(t,[`model`]);r!=null&&q(n,[`model`],Du(e,r));let i=J(t,[`config`]);return i!=null&&df(i,n),n}function mf(e,t){let n={},r=J(t,[`model`]);r!=null&&q(n,[`model`],Du(e,r));let i=J(t,[`config`]);return i!=null&&ff(i,n),n}function hf(e,t){let n={},r=J(t,[`name`]);return r!=null&&q(n,[`_url`,`name`],qu(e,r)),n}function gf(e,t){let n={},r=J(t,[`name`]);return r!=null&&q(n,[`_url`,`name`],qu(e,r)),n}function _f(e){let t={},n=J(e,[`sdkHttpResponse`]);return n!=null&&q(t,[`sdkHttpResponse`],n),t}function vf(e){let t={},n=J(e,[`sdkHttpResponse`]);return n!=null&&q(t,[`sdkHttpResponse`],n),t}function yf(e){let t={};if(J(e,[`displayName`])!==void 0)throw Error(`displayName parameter is not supported in Gemini API.`);let n=J(e,[`fileUri`]);n!=null&&q(t,[`fileUri`],n);let r=J(e,[`mimeType`]);return r!=null&&q(t,[`mimeType`],r),t}function bf(e){let t={},n=J(e,[`id`]);n!=null&&q(t,[`id`],n);let r=J(e,[`args`]);r!=null&&q(t,[`args`],r);let i=J(e,[`name`]);if(i!=null&&q(t,[`name`],i),J(e,[`partialArgs`])!==void 0)throw Error(`partialArgs parameter is not supported in Gemini API.`);if(J(e,[`willContinue`])!==void 0)throw Error(`willContinue parameter is not supported in Gemini API.`);return t}function xf(e){let t={},n=J(e,[`mode`]);n!=null&&q(t,[`mode`],n);let r=J(e,[`allowedFunctionNames`]);if(r!=null&&q(t,[`allowedFunctionNames`],r),J(e,[`streamFunctionCallArguments`])!==void 0)throw Error(`streamFunctionCallArguments parameter is not supported in Gemini API.`);return t}function Sf(e){let t={};if(J(e,[`behavior`])!==void 0)throw Error(`behavior parameter is not supported in Vertex AI.`);let n=J(e,[`description`]);n!=null&&q(t,[`description`],n);let r=J(e,[`name`]);r!=null&&q(t,[`name`],r);let i=J(e,[`parameters`]);i!=null&&q(t,[`parameters`],i);let a=J(e,[`parametersJsonSchema`]);a!=null&&q(t,[`parametersJsonSchema`],a);let o=J(e,[`response`]);o!=null&&q(t,[`response`],o);let s=J(e,[`responseJsonSchema`]);return s!=null&&q(t,[`responseJsonSchema`],s),t}function Cf(e,t){let n={},r=J(t,[`name`]);return r!=null&&q(n,[`_url`,`name`],qu(e,r)),n}function wf(e,t){let n={},r=J(t,[`name`]);return r!=null&&q(n,[`_url`,`name`],qu(e,r)),n}function Tf(e){let t={};if(J(e,[`authConfig`])!==void 0)throw Error(`authConfig parameter is not supported in Gemini API.`);let n=J(e,[`enableWidget`]);return n!=null&&q(t,[`enableWidget`],n),t}function Ef(e){let t={};if(J(e,[`excludeDomains`])!==void 0)throw Error(`excludeDomains parameter is not supported in Gemini API.`);if(J(e,[`blockingConfidence`])!==void 0)throw Error(`blockingConfidence parameter is not supported in Gemini API.`);let n=J(e,[`timeRangeFilter`]);return n!=null&&q(t,[`timeRangeFilter`],n),t}function Df(e,t){let n={},r=J(e,[`pageSize`]);t!==void 0&&r!=null&&q(t,[`_query`,`pageSize`],r);let i=J(e,[`pageToken`]);return t!==void 0&&i!=null&&q(t,[`_query`,`pageToken`],i),n}function Of(e,t){let n={},r=J(e,[`pageSize`]);t!==void 0&&r!=null&&q(t,[`_query`,`pageSize`],r);let i=J(e,[`pageToken`]);return t!==void 0&&i!=null&&q(t,[`_query`,`pageToken`],i),n}function kf(e){let t={},n=J(e,[`config`]);return n!=null&&Df(n,t),t}function Af(e){let t={},n=J(e,[`config`]);return n!=null&&Of(n,t),t}function jf(e){let t={},n=J(e,[`sdkHttpResponse`]);n!=null&&q(t,[`sdkHttpResponse`],n);let r=J(e,[`nextPageToken`]);r!=null&&q(t,[`nextPageToken`],r);let i=J(e,[`cachedContents`]);if(i!=null){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),q(t,[`cachedContents`],e)}return t}function Mf(e){let t={},n=J(e,[`sdkHttpResponse`]);n!=null&&q(t,[`sdkHttpResponse`],n);let r=J(e,[`nextPageToken`]);r!=null&&q(t,[`nextPageToken`],r);let i=J(e,[`cachedContents`]);if(i!=null){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),q(t,[`cachedContents`],e)}return t}function Nf(e){let t={},n=J(e,[`mediaResolution`]);n!=null&&q(t,[`mediaResolution`],n);let r=J(e,[`codeExecutionResult`]);r!=null&&q(t,[`codeExecutionResult`],r);let i=J(e,[`executableCode`]);i!=null&&q(t,[`executableCode`],i);let a=J(e,[`fileData`]);a!=null&&q(t,[`fileData`],yf(a));let o=J(e,[`functionCall`]);o!=null&&q(t,[`functionCall`],bf(o));let s=J(e,[`functionResponse`]);s!=null&&q(t,[`functionResponse`],s);let c=J(e,[`inlineData`]);c!=null&&q(t,[`inlineData`],lf(c));let l=J(e,[`text`]);l!=null&&q(t,[`text`],l);let u=J(e,[`thought`]);u!=null&&q(t,[`thought`],u);let d=J(e,[`thoughtSignature`]);d!=null&&q(t,[`thoughtSignature`],d);let f=J(e,[`videoMetadata`]);return f!=null&&q(t,[`videoMetadata`],f),t}function Pf(e){let t={},n=J(e,[`functionCallingConfig`]);n!=null&&q(t,[`functionCallingConfig`],xf(n));let r=J(e,[`retrievalConfig`]);return r!=null&&q(t,[`retrievalConfig`],r),t}function Ff(e){let t={},n=J(e,[`functionDeclarations`]);if(n!=null){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),q(t,[`functionDeclarations`],e)}if(J(e,[`retrieval`])!==void 0)throw Error(`retrieval parameter is not supported in Gemini API.`);let r=J(e,[`googleSearchRetrieval`]);r!=null&&q(t,[`googleSearchRetrieval`],r);let i=J(e,[`computerUse`]);i!=null&&q(t,[`computerUse`],i);let a=J(e,[`fileSearch`]);a!=null&&q(t,[`fileSearch`],a);let o=J(e,[`codeExecution`]);if(o!=null&&q(t,[`codeExecution`],o),J(e,[`enterpriseWebSearch`])!==void 0)throw Error(`enterpriseWebSearch parameter is not supported in Gemini API.`);let s=J(e,[`googleMaps`]);s!=null&&q(t,[`googleMaps`],Tf(s));let c=J(e,[`googleSearch`]);c!=null&&q(t,[`googleSearch`],Ef(c));let l=J(e,[`urlContext`]);return l!=null&&q(t,[`urlContext`],l),t}function If(e){let t={},n=J(e,[`functionDeclarations`]);if(n!=null){let e=n;Array.isArray(e)&&(e=e.map(e=>Sf(e))),q(t,[`functionDeclarations`],e)}let r=J(e,[`retrieval`]);r!=null&&q(t,[`retrieval`],r);let i=J(e,[`googleSearchRetrieval`]);i!=null&&q(t,[`googleSearchRetrieval`],i);let a=J(e,[`computerUse`]);if(a!=null&&q(t,[`computerUse`],a),J(e,[`fileSearch`])!==void 0)throw Error(`fileSearch parameter is not supported in Vertex AI.`);let o=J(e,[`codeExecution`]);o!=null&&q(t,[`codeExecution`],o);let s=J(e,[`enterpriseWebSearch`]);s!=null&&q(t,[`enterpriseWebSearch`],s);let c=J(e,[`googleMaps`]);c!=null&&q(t,[`googleMaps`],c);let l=J(e,[`googleSearch`]);l!=null&&q(t,[`googleSearch`],l);let u=J(e,[`urlContext`]);return u!=null&&q(t,[`urlContext`],u),t}function Lf(e,t){let n={},r=J(e,[`ttl`]);t!==void 0&&r!=null&&q(t,[`ttl`],r);let i=J(e,[`expireTime`]);return t!==void 0&&i!=null&&q(t,[`expireTime`],i),n}function Rf(e,t){let n={},r=J(e,[`ttl`]);t!==void 0&&r!=null&&q(t,[`ttl`],r);let i=J(e,[`expireTime`]);return t!==void 0&&i!=null&&q(t,[`expireTime`],i),n}function zf(e,t){let n={},r=J(t,[`name`]);r!=null&&q(n,[`_url`,`name`],qu(e,r));let i=J(t,[`config`]);return i!=null&&Lf(i,n),n}function Bf(e,t){let n={},r=J(t,[`name`]);r!=null&&q(n,[`_url`,`name`],qu(e,r));let i=J(t,[`config`]);return i!=null&&Rf(i,n),n}var Vf=class extends Mc{constructor(e){super(),this.apiClient=e,this.list=async(e={})=>new sf(of.PAGED_ITEM_CACHED_CONTENTS,e=>this.listInternal(e),await this.listInternal(e),e)}async create(e){let t,n=``,r={};if(this.apiClient.isVertexAI()){let i=mf(this.apiClient,e);return n=K(`cachedContents`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.request({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`POST`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}).then(e=>e.json()),t.then(e=>e)}else{let i=pf(this.apiClient,e);return n=K(`cachedContents`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.request({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`POST`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}).then(e=>e.json()),t.then(e=>e)}}async get(e){let t,n=``,r={};if(this.apiClient.isVertexAI()){let i=wf(this.apiClient,e);return n=K(`{name}`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.request({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`GET`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}).then(e=>e.json()),t.then(e=>e)}else{let i=Cf(this.apiClient,e);return n=K(`{name}`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.request({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`GET`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}).then(e=>e.json()),t.then(e=>e)}}async delete(e){let t,n=``,r={};if(this.apiClient.isVertexAI()){let i=gf(this.apiClient,e);return n=K(`{name}`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.request({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`DELETE`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}).then(e=>e.json().then(t=>{let n=t;return n.sdkHttpResponse={headers:e.headers},n})),t.then(e=>{let t=vf(e),n=new mu;return Object.assign(n,t),n})}else{let i=hf(this.apiClient,e);return n=K(`{name}`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.request({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`DELETE`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}).then(e=>e.json().then(t=>{let n=t;return n.sdkHttpResponse={headers:e.headers},n})),t.then(e=>{let t=_f(e),n=new mu;return Object.assign(n,t),n})}}async update(e){let t,n=``,r={};if(this.apiClient.isVertexAI()){let i=Bf(this.apiClient,e);return n=K(`{name}`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.request({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`PATCH`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}).then(e=>e.json()),t.then(e=>e)}else{let i=zf(this.apiClient,e);return n=K(`{name}`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.request({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`PATCH`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}).then(e=>e.json()),t.then(e=>e)}}async listInternal(e){let t,n=``,r={};if(this.apiClient.isVertexAI()){let i=Af(e);return n=K(`cachedContents`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.request({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`GET`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}).then(e=>e.json().then(t=>{let n=t;return n.sdkHttpResponse={headers:e.headers},n})),t.then(e=>{let t=Mf(e),n=new hu;return Object.assign(n,t),n})}else{let i=kf(e);return n=K(`cachedContents`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.request({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`GET`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}).then(e=>e.json().then(t=>{let n=t;return n.sdkHttpResponse={headers:e.headers},n})),t.then(e=>{let t=jf(e),n=new hu;return Object.assign(n,t),n})}}};function Hf(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols==`function`)for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n}function Uf(e){var t=typeof Symbol==`function`&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&typeof e.length==`number`)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw TypeError(t?`Object is not iterable.`:`Symbol.iterator is not defined.`)}function Z(e){return this instanceof Z?(this.v=e,this):new Z(e)}function Wf(e,t,n){if(!Symbol.asyncIterator)throw TypeError(`Symbol.asyncIterator is not defined.`);var r=n.apply(e,t||[]),i,a=[];return i=Object.create((typeof AsyncIterator==`function`?AsyncIterator:Object).prototype),s(`next`),s(`throw`),s(`return`,o),i[Symbol.asyncIterator]=function(){return this},i;function o(e){return function(t){return Promise.resolve(t).then(e,d)}}function s(e,t){r[e]&&(i[e]=function(t){return new Promise(function(n,r){a.push([e,t,n,r])>1||c(e,t)})},t&&(i[e]=t(i[e])))}function c(e,t){try{l(r[e](t))}catch(e){f(a[0][3],e)}}function l(e){e.value instanceof Z?Promise.resolve(e.value.v).then(u,d):f(a[0][2],e)}function u(e){c(`next`,e)}function d(e){c(`throw`,e)}function f(e,t){e(t),a.shift(),a.length&&c(a[0][0],a[0][1])}}function Gf(e){if(!Symbol.asyncIterator)throw TypeError(`Symbol.asyncIterator is not defined.`);var t=e[Symbol.asyncIterator],n;return t?t.call(e):(e=typeof Uf==`function`?Uf(e):e[Symbol.iterator](),n={},r(`next`),r(`throw`),r(`return`),n[Symbol.asyncIterator]=function(){return this},n);function r(t){n[t]=e[t]&&function(n){return new Promise(function(r,a){n=e[t](n),i(r,a,n.done,n.value)})}}function i(e,t,n,r){Promise.resolve(r).then(function(t){e({value:t,done:n})},t)}}function Kf(e){if(e.candidates==null||e.candidates.length===0)return!1;let t=e.candidates[0]?.content;return t===void 0?!1:qf(t)}function qf(e){if(e.parts===void 0||e.parts.length===0)return!1;for(let t of e.parts)if(t===void 0||Object.keys(t).length===0)return!1;return!0}function Jf(e){if(e.length!==0){for(let t of e)if(t.role!==`user`&&t.role!==`model`)throw Error(`Role must be user or model, but got ${t.role}.`)}}function Yf(e){if(e===void 0||e.length===0)return[];let t=[],n=e.length,r=0;for(;r<n;)if(e[r].role===`user`)t.push(e[r]),r++;else{let i=[],a=!0;for(;r<n&&e[r].role===`model`;)i.push(e[r]),a&&!qf(e[r])&&(a=!1),r++;a?t.push(...i):t.pop()}return t}var Xf=class{constructor(e,t){this.modelsModule=e,this.apiClient=t}create(e){return new Zf(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}},Zf=class{constructor(e,t,n,r={},i=[]){this.apiClient=e,this.modelsModule=t,this.model=n,this.config=r,this.history=i,this.sendPromise=Promise.resolve(),Jf(i)}async sendMessage(e){await this.sendPromise;let t=X(e.message),n=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(t),config:e.config??this.config});return this.sendPromise=(async()=>{let e=await n,r=e.candidates?.[0]?.content,i=e.automaticFunctionCallingHistory,a=this.getHistory(!0).length,o=[];i!=null&&(o=i.slice(a)??[]);let s=r?[r]:[];this.recordHistory(t,s,o)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),n}async sendMessageStream(e){await this.sendPromise;let t=X(e.message),n=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(t),config:e.config??this.config});this.sendPromise=n.then(()=>void 0).catch(()=>void 0);let r=await n;return this.processStreamResponse(r,t)}getHistory(e=!1){let t=e?Yf(this.history):this.history;return structuredClone(t)}processStreamResponse(e,t){return Wf(this,arguments,function*(){var n,r,i,a;let o=[];try{for(var s=!0,c=Gf(e),l;l=yield Z(c.next()),n=l.done,!n;s=!0){a=l.value,s=!1;let e=a;if(Kf(e)){let t=e.candidates?.[0]?.content;t!==void 0&&o.push(t)}yield yield Z(e)}}catch(e){r={error:e}}finally{try{!s&&!n&&(i=c.return)&&(yield Z(i.call(c)))}finally{if(r)throw r.error}}this.recordHistory(t,o)})}recordHistory(e,t,n){let r=[];t.length>0&&t.every(e=>e.role!==void 0)?r=t:r.push({role:`model`,parts:[]}),n&&n.length>0?this.history.push(...Yf(n)):this.history.push(e),this.history.push(...r)}},Qf=class e extends Error{constructor(t){super(t.message),this.name=`ApiError`,this.status=t.status,Object.setPrototypeOf(this,e.prototype)}};function $f(e){let t={},n=J(e,[`file`]);return n!=null&&q(t,[`file`],n),t}function ep(e){let t={},n=J(e,[`sdkHttpResponse`]);return n!=null&&q(t,[`sdkHttpResponse`],n),t}function tp(e){let t={},n=J(e,[`name`]);return n!=null&&q(t,[`_url`,`file`],$u(n)),t}function np(e){let t={},n=J(e,[`sdkHttpResponse`]);return n!=null&&q(t,[`sdkHttpResponse`],n),t}function rp(e){let t={},n=J(e,[`name`]);return n!=null&&q(t,[`_url`,`file`],$u(n)),t}function ip(e,t){let n={},r=J(e,[`pageSize`]);t!==void 0&&r!=null&&q(t,[`_query`,`pageSize`],r);let i=J(e,[`pageToken`]);return t!==void 0&&i!=null&&q(t,[`_query`,`pageToken`],i),n}function ap(e){let t={},n=J(e,[`config`]);return n!=null&&ip(n,t),t}function op(e){let t={},n=J(e,[`sdkHttpResponse`]);n!=null&&q(t,[`sdkHttpResponse`],n);let r=J(e,[`nextPageToken`]);r!=null&&q(t,[`nextPageToken`],r);let i=J(e,[`files`]);if(i!=null){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),q(t,[`files`],e)}return t}var sp=class extends Mc{constructor(e){super(),this.apiClient=e,this.list=async(e={})=>new sf(of.PAGED_ITEM_FILES,e=>this.listInternal(e),await this.listInternal(e),e)}async upload(e){if(this.apiClient.isVertexAI())throw Error(`Vertex AI does not support uploading files. You can share files through a GCS bucket.`);return this.apiClient.uploadFile(e.file,e.config).then(e=>e)}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){let t,n=``,r={};if(this.apiClient.isVertexAI())throw Error(`This method is only supported by the Gemini Developer API.`);{let i=ap(e);return n=K(`files`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.request({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`GET`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}).then(e=>e.json().then(t=>{let n=t;return n.sdkHttpResponse={headers:e.headers},n})),t.then(e=>{let t=op(e),n=new bu;return Object.assign(n,t),n})}}async createInternal(e){let t,n=``,r={};if(this.apiClient.isVertexAI())throw Error(`This method is only supported by the Gemini Developer API.`);{let i=$f(e);return n=K(`upload/v1beta/files`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.request({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`POST`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}).then(e=>e.json()),t.then(e=>{let t=ep(e),n=new xu;return Object.assign(n,t),n})}}async get(e){let t,n=``,r={};if(this.apiClient.isVertexAI())throw Error(`This method is only supported by the Gemini Developer API.`);{let i=rp(e);return n=K(`files/{file}`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.request({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`GET`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}).then(e=>e.json()),t.then(e=>e)}}async delete(e){let t,n=``,r={};if(this.apiClient.isVertexAI())throw Error(`This method is only supported by the Gemini Developer API.`);{let i=tp(e);return n=K(`files/{file}`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.request({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`DELETE`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}).then(e=>e.json().then(t=>{let n=t;return n.sdkHttpResponse={headers:e.headers},n})),t.then(e=>{let t=np(e),n=new Su;return Object.assign(n,t),n})}}};function cp(e){let t={},n=J(e,[`data`]);if(n!=null&&q(t,[`data`],n),J(e,[`displayName`])!==void 0)throw Error(`displayName parameter is not supported in Gemini API.`);let r=J(e,[`mimeType`]);return r!=null&&q(t,[`mimeType`],r),t}function lp(e){let t={},n=J(e,[`parts`]);if(n!=null){let e=n;Array.isArray(e)&&(e=e.map(e=>Tp(e))),q(t,[`parts`],e)}let r=J(e,[`role`]);return r!=null&&q(t,[`role`],r),t}function up(e){let t={};if(J(e,[`displayName`])!==void 0)throw Error(`displayName parameter is not supported in Gemini API.`);let n=J(e,[`fileUri`]);n!=null&&q(t,[`fileUri`],n);let r=J(e,[`mimeType`]);return r!=null&&q(t,[`mimeType`],r),t}function dp(e){let t={},n=J(e,[`id`]);n!=null&&q(t,[`id`],n);let r=J(e,[`args`]);r!=null&&q(t,[`args`],r);let i=J(e,[`name`]);if(i!=null&&q(t,[`name`],i),J(e,[`partialArgs`])!==void 0)throw Error(`partialArgs parameter is not supported in Gemini API.`);if(J(e,[`willContinue`])!==void 0)throw Error(`willContinue parameter is not supported in Gemini API.`);return t}function fp(e){let t={};if(J(e,[`behavior`])!==void 0)throw Error(`behavior parameter is not supported in Vertex AI.`);let n=J(e,[`description`]);n!=null&&q(t,[`description`],n);let r=J(e,[`name`]);r!=null&&q(t,[`name`],r);let i=J(e,[`parameters`]);i!=null&&q(t,[`parameters`],i);let a=J(e,[`parametersJsonSchema`]);a!=null&&q(t,[`parametersJsonSchema`],a);let o=J(e,[`response`]);o!=null&&q(t,[`response`],o);let s=J(e,[`responseJsonSchema`]);return s!=null&&q(t,[`responseJsonSchema`],s),t}function pp(e){let t={},n=J(e,[`modelSelectionConfig`]);n!=null&&q(t,[`modelConfig`],n);let r=J(e,[`responseJsonSchema`]);r!=null&&q(t,[`responseJsonSchema`],r);let i=J(e,[`audioTimestamp`]);i!=null&&q(t,[`audioTimestamp`],i);let a=J(e,[`candidateCount`]);a!=null&&q(t,[`candidateCount`],a);let o=J(e,[`enableAffectiveDialog`]);o!=null&&q(t,[`enableAffectiveDialog`],o);let s=J(e,[`frequencyPenalty`]);s!=null&&q(t,[`frequencyPenalty`],s);let c=J(e,[`logprobs`]);c!=null&&q(t,[`logprobs`],c);let l=J(e,[`maxOutputTokens`]);l!=null&&q(t,[`maxOutputTokens`],l);let u=J(e,[`mediaResolution`]);u!=null&&q(t,[`mediaResolution`],u);let d=J(e,[`presencePenalty`]);d!=null&&q(t,[`presencePenalty`],d);let f=J(e,[`responseLogprobs`]);f!=null&&q(t,[`responseLogprobs`],f);let p=J(e,[`responseMimeType`]);p!=null&&q(t,[`responseMimeType`],p);let m=J(e,[`responseModalities`]);m!=null&&q(t,[`responseModalities`],m);let h=J(e,[`responseSchema`]);h!=null&&q(t,[`responseSchema`],h);let g=J(e,[`routingConfig`]);g!=null&&q(t,[`routingConfig`],g);let _=J(e,[`seed`]);_!=null&&q(t,[`seed`],_);let v=J(e,[`speechConfig`]);v!=null&&q(t,[`speechConfig`],v);let y=J(e,[`stopSequences`]);y!=null&&q(t,[`stopSequences`],y);let b=J(e,[`temperature`]);b!=null&&q(t,[`temperature`],b);let x=J(e,[`thinkingConfig`]);x!=null&&q(t,[`thinkingConfig`],x);let S=J(e,[`topK`]);S!=null&&q(t,[`topK`],S);let C=J(e,[`topP`]);if(C!=null&&q(t,[`topP`],C),J(e,[`enableEnhancedCivicAnswers`])!==void 0)throw Error(`enableEnhancedCivicAnswers parameter is not supported in Vertex AI.`);return t}function mp(e){let t={};if(J(e,[`authConfig`])!==void 0)throw Error(`authConfig parameter is not supported in Gemini API.`);let n=J(e,[`enableWidget`]);return n!=null&&q(t,[`enableWidget`],n),t}function hp(e){let t={};if(J(e,[`excludeDomains`])!==void 0)throw Error(`excludeDomains parameter is not supported in Gemini API.`);if(J(e,[`blockingConfidence`])!==void 0)throw Error(`blockingConfidence parameter is not supported in Gemini API.`);let n=J(e,[`timeRangeFilter`]);return n!=null&&q(t,[`timeRangeFilter`],n),t}function gp(e,t){let n={},r=J(e,[`generationConfig`]);t!==void 0&&r!=null&&q(t,[`setup`,`generationConfig`],r);let i=J(e,[`responseModalities`]);t!==void 0&&i!=null&&q(t,[`setup`,`generationConfig`,`responseModalities`],i);let a=J(e,[`temperature`]);t!==void 0&&a!=null&&q(t,[`setup`,`generationConfig`,`temperature`],a);let o=J(e,[`topP`]);t!==void 0&&o!=null&&q(t,[`setup`,`generationConfig`,`topP`],o);let s=J(e,[`topK`]);t!==void 0&&s!=null&&q(t,[`setup`,`generationConfig`,`topK`],s);let c=J(e,[`maxOutputTokens`]);t!==void 0&&c!=null&&q(t,[`setup`,`generationConfig`,`maxOutputTokens`],c);let l=J(e,[`mediaResolution`]);t!==void 0&&l!=null&&q(t,[`setup`,`generationConfig`,`mediaResolution`],l);let u=J(e,[`seed`]);t!==void 0&&u!=null&&q(t,[`setup`,`generationConfig`,`seed`],u);let d=J(e,[`speechConfig`]);t!==void 0&&d!=null&&q(t,[`setup`,`generationConfig`,`speechConfig`],Uu(d));let f=J(e,[`thinkingConfig`]);t!==void 0&&f!=null&&q(t,[`setup`,`generationConfig`,`thinkingConfig`],f);let p=J(e,[`enableAffectiveDialog`]);t!==void 0&&p!=null&&q(t,[`setup`,`generationConfig`,`enableAffectiveDialog`],p);let m=J(e,[`systemInstruction`]);t!==void 0&&m!=null&&q(t,[`setup`,`systemInstruction`],lp(X(m)));let h=J(e,[`tools`]);if(t!==void 0&&h!=null){let e=Gu(h);Array.isArray(e)&&(e=e.map(e=>Dp(Wu(e)))),q(t,[`setup`,`tools`],e)}let g=J(e,[`sessionResumption`]);t!==void 0&&g!=null&&q(t,[`setup`,`sessionResumption`],Ep(g));let _=J(e,[`inputAudioTranscription`]);t!==void 0&&_!=null&&q(t,[`setup`,`inputAudioTranscription`],_);let v=J(e,[`outputAudioTranscription`]);t!==void 0&&v!=null&&q(t,[`setup`,`outputAudioTranscription`],v);let y=J(e,[`realtimeInputConfig`]);t!==void 0&&y!=null&&q(t,[`setup`,`realtimeInputConfig`],y);let b=J(e,[`contextWindowCompression`]);t!==void 0&&b!=null&&q(t,[`setup`,`contextWindowCompression`],b);let x=J(e,[`proactivity`]);if(t!==void 0&&x!=null&&q(t,[`setup`,`proactivity`],x),J(e,[`explicitVadSignal`])!==void 0)throw Error(`explicitVadSignal parameter is not supported in Gemini API.`);return n}function _p(e,t){let n={},r=J(e,[`generationConfig`]);t!==void 0&&r!=null&&q(t,[`setup`,`generationConfig`],pp(r));let i=J(e,[`responseModalities`]);t!==void 0&&i!=null&&q(t,[`setup`,`generationConfig`,`responseModalities`],i);let a=J(e,[`temperature`]);t!==void 0&&a!=null&&q(t,[`setup`,`generationConfig`,`temperature`],a);let o=J(e,[`topP`]);t!==void 0&&o!=null&&q(t,[`setup`,`generationConfig`,`topP`],o);let s=J(e,[`topK`]);t!==void 0&&s!=null&&q(t,[`setup`,`generationConfig`,`topK`],s);let c=J(e,[`maxOutputTokens`]);t!==void 0&&c!=null&&q(t,[`setup`,`generationConfig`,`maxOutputTokens`],c);let l=J(e,[`mediaResolution`]);t!==void 0&&l!=null&&q(t,[`setup`,`generationConfig`,`mediaResolution`],l);let u=J(e,[`seed`]);t!==void 0&&u!=null&&q(t,[`setup`,`generationConfig`,`seed`],u);let d=J(e,[`speechConfig`]);t!==void 0&&d!=null&&q(t,[`setup`,`generationConfig`,`speechConfig`],Uu(d));let f=J(e,[`thinkingConfig`]);t!==void 0&&f!=null&&q(t,[`setup`,`generationConfig`,`thinkingConfig`],f);let p=J(e,[`enableAffectiveDialog`]);t!==void 0&&p!=null&&q(t,[`setup`,`generationConfig`,`enableAffectiveDialog`],p);let m=J(e,[`systemInstruction`]);t!==void 0&&m!=null&&q(t,[`setup`,`systemInstruction`],X(m));let h=J(e,[`tools`]);if(t!==void 0&&h!=null){let e=Gu(h);Array.isArray(e)&&(e=e.map(e=>Op(Wu(e)))),q(t,[`setup`,`tools`],e)}let g=J(e,[`sessionResumption`]);t!==void 0&&g!=null&&q(t,[`setup`,`sessionResumption`],g);let _=J(e,[`inputAudioTranscription`]);t!==void 0&&_!=null&&q(t,[`setup`,`inputAudioTranscription`],_);let v=J(e,[`outputAudioTranscription`]);t!==void 0&&v!=null&&q(t,[`setup`,`outputAudioTranscription`],v);let y=J(e,[`realtimeInputConfig`]);t!==void 0&&y!=null&&q(t,[`setup`,`realtimeInputConfig`],y);let b=J(e,[`contextWindowCompression`]);t!==void 0&&b!=null&&q(t,[`setup`,`contextWindowCompression`],b);let x=J(e,[`proactivity`]);t!==void 0&&x!=null&&q(t,[`setup`,`proactivity`],x);let S=J(e,[`explicitVadSignal`]);return t!==void 0&&S!=null&&q(t,[`setup`,`explicitVadSignal`],S),n}function vp(e,t){let n={},r=J(t,[`model`]);r!=null&&q(n,[`setup`,`model`],Y(e,r));let i=J(t,[`config`]);return i!=null&&q(n,[`config`],gp(i,n)),n}function yp(e,t){let n={},r=J(t,[`model`]);r!=null&&q(n,[`setup`,`model`],Y(e,r));let i=J(t,[`config`]);return i!=null&&q(n,[`config`],_p(i,n)),n}function bp(e){let t={},n=J(e,[`musicGenerationConfig`]);return n!=null&&q(t,[`musicGenerationConfig`],n),t}function xp(e){let t={},n=J(e,[`weightedPrompts`]);if(n!=null){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),q(t,[`weightedPrompts`],e)}return t}function Sp(e){let t={},n=J(e,[`media`]);if(n!=null){let e=Ou(n);Array.isArray(e)&&(e=e.map(e=>cp(e))),q(t,[`mediaChunks`],e)}let r=J(e,[`audio`]);r!=null&&q(t,[`audio`],cp(ju(r)));let i=J(e,[`audioStreamEnd`]);i!=null&&q(t,[`audioStreamEnd`],i);let a=J(e,[`video`]);a!=null&&q(t,[`video`],cp(Au(a)));let o=J(e,[`text`]);o!=null&&q(t,[`text`],o);let s=J(e,[`activityStart`]);s!=null&&q(t,[`activityStart`],s);let c=J(e,[`activityEnd`]);return c!=null&&q(t,[`activityEnd`],c),t}function Cp(e){let t={},n=J(e,[`media`]);if(n!=null){let e=Ou(n);Array.isArray(e)&&(e=e.map(e=>e)),q(t,[`mediaChunks`],e)}let r=J(e,[`audio`]);r!=null&&q(t,[`audio`],ju(r));let i=J(e,[`audioStreamEnd`]);i!=null&&q(t,[`audioStreamEnd`],i);let a=J(e,[`video`]);a!=null&&q(t,[`video`],Au(a));let o=J(e,[`text`]);o!=null&&q(t,[`text`],o);let s=J(e,[`activityStart`]);s!=null&&q(t,[`activityStart`],s);let c=J(e,[`activityEnd`]);return c!=null&&q(t,[`activityEnd`],c),t}function wp(e){let t={},n=J(e,[`setupComplete`]);n!=null&&q(t,[`setupComplete`],n);let r=J(e,[`serverContent`]);r!=null&&q(t,[`serverContent`],r);let i=J(e,[`toolCall`]);i!=null&&q(t,[`toolCall`],i);let a=J(e,[`toolCallCancellation`]);a!=null&&q(t,[`toolCallCancellation`],a);let o=J(e,[`usageMetadata`]);o!=null&&q(t,[`usageMetadata`],kp(o));let s=J(e,[`goAway`]);s!=null&&q(t,[`goAway`],s);let c=J(e,[`sessionResumptionUpdate`]);c!=null&&q(t,[`sessionResumptionUpdate`],c);let l=J(e,[`voiceActivityDetectionSignal`]);return l!=null&&q(t,[`voiceActivityDetectionSignal`],l),t}function Tp(e){let t={},n=J(e,[`mediaResolution`]);n!=null&&q(t,[`mediaResolution`],n);let r=J(e,[`codeExecutionResult`]);r!=null&&q(t,[`codeExecutionResult`],r);let i=J(e,[`executableCode`]);i!=null&&q(t,[`executableCode`],i);let a=J(e,[`fileData`]);a!=null&&q(t,[`fileData`],up(a));let o=J(e,[`functionCall`]);o!=null&&q(t,[`functionCall`],dp(o));let s=J(e,[`functionResponse`]);s!=null&&q(t,[`functionResponse`],s);let c=J(e,[`inlineData`]);c!=null&&q(t,[`inlineData`],cp(c));let l=J(e,[`text`]);l!=null&&q(t,[`text`],l);let u=J(e,[`thought`]);u!=null&&q(t,[`thought`],u);let d=J(e,[`thoughtSignature`]);d!=null&&q(t,[`thoughtSignature`],d);let f=J(e,[`videoMetadata`]);return f!=null&&q(t,[`videoMetadata`],f),t}function Ep(e){let t={},n=J(e,[`handle`]);if(n!=null&&q(t,[`handle`],n),J(e,[`transparent`])!==void 0)throw Error(`transparent parameter is not supported in Gemini API.`);return t}function Dp(e){let t={},n=J(e,[`functionDeclarations`]);if(n!=null){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),q(t,[`functionDeclarations`],e)}if(J(e,[`retrieval`])!==void 0)throw Error(`retrieval parameter is not supported in Gemini API.`);let r=J(e,[`googleSearchRetrieval`]);r!=null&&q(t,[`googleSearchRetrieval`],r);let i=J(e,[`computerUse`]);i!=null&&q(t,[`computerUse`],i);let a=J(e,[`fileSearch`]);a!=null&&q(t,[`fileSearch`],a);let o=J(e,[`codeExecution`]);if(o!=null&&q(t,[`codeExecution`],o),J(e,[`enterpriseWebSearch`])!==void 0)throw Error(`enterpriseWebSearch parameter is not supported in Gemini API.`);let s=J(e,[`googleMaps`]);s!=null&&q(t,[`googleMaps`],mp(s));let c=J(e,[`googleSearch`]);c!=null&&q(t,[`googleSearch`],hp(c));let l=J(e,[`urlContext`]);return l!=null&&q(t,[`urlContext`],l),t}function Op(e){let t={},n=J(e,[`functionDeclarations`]);if(n!=null){let e=n;Array.isArray(e)&&(e=e.map(e=>fp(e))),q(t,[`functionDeclarations`],e)}let r=J(e,[`retrieval`]);r!=null&&q(t,[`retrieval`],r);let i=J(e,[`googleSearchRetrieval`]);i!=null&&q(t,[`googleSearchRetrieval`],i);let a=J(e,[`computerUse`]);if(a!=null&&q(t,[`computerUse`],a),J(e,[`fileSearch`])!==void 0)throw Error(`fileSearch parameter is not supported in Vertex AI.`);let o=J(e,[`codeExecution`]);o!=null&&q(t,[`codeExecution`],o);let s=J(e,[`enterpriseWebSearch`]);s!=null&&q(t,[`enterpriseWebSearch`],s);let c=J(e,[`googleMaps`]);c!=null&&q(t,[`googleMaps`],c);let l=J(e,[`googleSearch`]);l!=null&&q(t,[`googleSearch`],l);let u=J(e,[`urlContext`]);return u!=null&&q(t,[`urlContext`],u),t}function kp(e){let t={},n=J(e,[`promptTokenCount`]);n!=null&&q(t,[`promptTokenCount`],n);let r=J(e,[`cachedContentTokenCount`]);r!=null&&q(t,[`cachedContentTokenCount`],r);let i=J(e,[`candidatesTokenCount`]);i!=null&&q(t,[`responseTokenCount`],i);let a=J(e,[`toolUsePromptTokenCount`]);a!=null&&q(t,[`toolUsePromptTokenCount`],a);let o=J(e,[`thoughtsTokenCount`]);o!=null&&q(t,[`thoughtsTokenCount`],o);let s=J(e,[`totalTokenCount`]);s!=null&&q(t,[`totalTokenCount`],s);let c=J(e,[`promptTokensDetails`]);if(c!=null){let e=c;Array.isArray(e)&&(e=e.map(e=>e)),q(t,[`promptTokensDetails`],e)}let l=J(e,[`cacheTokensDetails`]);if(l!=null){let e=l;Array.isArray(e)&&(e=e.map(e=>e)),q(t,[`cacheTokensDetails`],e)}let u=J(e,[`candidatesTokensDetails`]);if(u!=null){let e=u;Array.isArray(e)&&(e=e.map(e=>e)),q(t,[`responseTokensDetails`],e)}let d=J(e,[`toolUsePromptTokensDetails`]);if(d!=null){let e=d;Array.isArray(e)&&(e=e.map(e=>e)),q(t,[`toolUsePromptTokensDetails`],e)}let f=J(e,[`trafficType`]);return f!=null&&q(t,[`trafficType`],f),t}function Ap(e){let t={},n=J(e,[`data`]);if(n!=null&&q(t,[`data`],n),J(e,[`displayName`])!==void 0)throw Error(`displayName parameter is not supported in Gemini API.`);let r=J(e,[`mimeType`]);return r!=null&&q(t,[`mimeType`],r),t}function jp(e){let t={},n=J(e,[`content`]);n!=null&&q(t,[`content`],n);let r=J(e,[`citationMetadata`]);r!=null&&q(t,[`citationMetadata`],Mp(r));let i=J(e,[`tokenCount`]);i!=null&&q(t,[`tokenCount`],i);let a=J(e,[`finishReason`]);a!=null&&q(t,[`finishReason`],a);let o=J(e,[`avgLogprobs`]);o!=null&&q(t,[`avgLogprobs`],o);let s=J(e,[`groundingMetadata`]);s!=null&&q(t,[`groundingMetadata`],s);let c=J(e,[`index`]);c!=null&&q(t,[`index`],c);let l=J(e,[`logprobsResult`]);l!=null&&q(t,[`logprobsResult`],l);let u=J(e,[`safetyRatings`]);if(u!=null){let e=u;Array.isArray(e)&&(e=e.map(e=>e)),q(t,[`safetyRatings`],e)}let d=J(e,[`urlContextMetadata`]);return d!=null&&q(t,[`urlContextMetadata`],d),t}function Mp(e){let t={},n=J(e,[`citationSources`]);if(n!=null){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),q(t,[`citations`],e)}return t}function Np(e,t){let n={},r=J(t,[`model`]);r!=null&&q(n,[`_url`,`model`],Y(e,r));let i=J(t,[`contents`]);if(i!=null){let e=Ru(i);Array.isArray(e)&&(e=e.map(e=>e)),q(n,[`contents`],e)}return n}function Pp(e){let t={},n=J(e,[`sdkHttpResponse`]);n!=null&&q(t,[`sdkHttpResponse`],n);let r=J(e,[`tokensInfo`]);if(r!=null){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),q(t,[`tokensInfo`],e)}return t}function Fp(e){let t={},n=J(e,[`values`]);n!=null&&q(t,[`values`],n);let r=J(e,[`statistics`]);return r!=null&&q(t,[`statistics`],Ip(r)),t}function Ip(e){let t={},n=J(e,[`truncated`]);n!=null&&q(t,[`truncated`],n);let r=J(e,[`token_count`]);return r!=null&&q(t,[`tokenCount`],r),t}function Lp(e){let t={},n=J(e,[`parts`]);if(n!=null){let e=n;Array.isArray(e)&&(e=e.map(e=>nh(e))),q(t,[`parts`],e)}let r=J(e,[`role`]);return r!=null&&q(t,[`role`],r),t}function Rp(e){let t={},n=J(e,[`controlType`]);n!=null&&q(t,[`controlType`],n);let r=J(e,[`enableControlImageComputation`]);return r!=null&&q(t,[`computeControl`],r),t}function zp(e){let t={};if(J(e,[`systemInstruction`])!==void 0)throw Error(`systemInstruction parameter is not supported in Gemini API.`);if(J(e,[`tools`])!==void 0)throw Error(`tools parameter is not supported in Gemini API.`);if(J(e,[`generationConfig`])!==void 0)throw Error(`generationConfig parameter is not supported in Gemini API.`);return t}function Bp(e,t){let n={},r=J(e,[`systemInstruction`]);t!==void 0&&r!=null&&q(t,[`systemInstruction`],X(r));let i=J(e,[`tools`]);if(t!==void 0&&i!=null){let e=i;Array.isArray(e)&&(e=e.map(e=>yh(e))),q(t,[`tools`],e)}let a=J(e,[`generationConfig`]);return t!==void 0&&a!=null&&q(t,[`generationConfig`],Im(a)),n}function Vp(e,t){let n={},r=J(t,[`model`]);r!=null&&q(n,[`_url`,`model`],Y(e,r));let i=J(t,[`contents`]);if(i!=null){let e=Ru(i);Array.isArray(e)&&(e=e.map(e=>Lp(e))),q(n,[`contents`],e)}let a=J(t,[`config`]);return a!=null&&zp(a),n}function Hp(e,t){let n={},r=J(t,[`model`]);r!=null&&q(n,[`_url`,`model`],Y(e,r));let i=J(t,[`contents`]);if(i!=null){let e=Ru(i);Array.isArray(e)&&(e=e.map(e=>e)),q(n,[`contents`],e)}let a=J(t,[`config`]);return a!=null&&Bp(a,n),n}function Up(e){let t={},n=J(e,[`sdkHttpResponse`]);n!=null&&q(t,[`sdkHttpResponse`],n);let r=J(e,[`totalTokens`]);r!=null&&q(t,[`totalTokens`],r);let i=J(e,[`cachedContentTokenCount`]);return i!=null&&q(t,[`cachedContentTokenCount`],i),t}function Wp(e){let t={},n=J(e,[`sdkHttpResponse`]);n!=null&&q(t,[`sdkHttpResponse`],n);let r=J(e,[`totalTokens`]);return r!=null&&q(t,[`totalTokens`],r),t}function Gp(e,t){let n={},r=J(t,[`model`]);return r!=null&&q(n,[`_url`,`name`],Y(e,r)),n}function Kp(e,t){let n={},r=J(t,[`model`]);return r!=null&&q(n,[`_url`,`name`],Y(e,r)),n}function qp(e){let t={},n=J(e,[`sdkHttpResponse`]);return n!=null&&q(t,[`sdkHttpResponse`],n),t}function Jp(e){let t={},n=J(e,[`sdkHttpResponse`]);return n!=null&&q(t,[`sdkHttpResponse`],n),t}function Yp(e,t){let n={},r=J(e,[`outputGcsUri`]);t!==void 0&&r!=null&&q(t,[`parameters`,`storageUri`],r);let i=J(e,[`negativePrompt`]);t!==void 0&&i!=null&&q(t,[`parameters`,`negativePrompt`],i);let a=J(e,[`numberOfImages`]);t!==void 0&&a!=null&&q(t,[`parameters`,`sampleCount`],a);let o=J(e,[`aspectRatio`]);t!==void 0&&o!=null&&q(t,[`parameters`,`aspectRatio`],o);let s=J(e,[`guidanceScale`]);t!==void 0&&s!=null&&q(t,[`parameters`,`guidanceScale`],s);let c=J(e,[`seed`]);t!==void 0&&c!=null&&q(t,[`parameters`,`seed`],c);let l=J(e,[`safetyFilterLevel`]);t!==void 0&&l!=null&&q(t,[`parameters`,`safetySetting`],l);let u=J(e,[`personGeneration`]);t!==void 0&&u!=null&&q(t,[`parameters`,`personGeneration`],u);let d=J(e,[`includeSafetyAttributes`]);t!==void 0&&d!=null&&q(t,[`parameters`,`includeSafetyAttributes`],d);let f=J(e,[`includeRaiReason`]);t!==void 0&&f!=null&&q(t,[`parameters`,`includeRaiReason`],f);let p=J(e,[`language`]);t!==void 0&&p!=null&&q(t,[`parameters`,`language`],p);let m=J(e,[`outputMimeType`]);t!==void 0&&m!=null&&q(t,[`parameters`,`outputOptions`,`mimeType`],m);let h=J(e,[`outputCompressionQuality`]);t!==void 0&&h!=null&&q(t,[`parameters`,`outputOptions`,`compressionQuality`],h);let g=J(e,[`addWatermark`]);t!==void 0&&g!=null&&q(t,[`parameters`,`addWatermark`],g);let _=J(e,[`labels`]);t!==void 0&&_!=null&&q(t,[`labels`],_);let v=J(e,[`editMode`]);t!==void 0&&v!=null&&q(t,[`parameters`,`editMode`],v);let y=J(e,[`baseSteps`]);return t!==void 0&&y!=null&&q(t,[`parameters`,`editConfig`,`baseSteps`],y),n}function Xp(e,t){let n={},r=J(t,[`model`]);r!=null&&q(n,[`_url`,`model`],Y(e,r));let i=J(t,[`prompt`]);i!=null&&q(n,[`instances[0]`,`prompt`],i);let a=J(t,[`referenceImages`]);if(a!=null){let e=a;Array.isArray(e)&&(e=e.map(e=>ch(e))),q(n,[`instances[0]`,`referenceImages`],e)}let o=J(t,[`config`]);return o!=null&&Yp(o,n),n}function Zp(e){let t={},n=J(e,[`sdkHttpResponse`]);n!=null&&q(t,[`sdkHttpResponse`],n);let r=J(e,[`predictions`]);if(r!=null){let e=r;Array.isArray(e)&&(e=e.map(e=>Mm(e))),q(t,[`generatedImages`],e)}return t}function Qp(e,t){let n={},r=J(e,[`taskType`]);t!==void 0&&r!=null&&q(t,[`requests[]`,`taskType`],r);let i=J(e,[`title`]);t!==void 0&&i!=null&&q(t,[`requests[]`,`title`],i);let a=J(e,[`outputDimensionality`]);if(t!==void 0&&a!=null&&q(t,[`requests[]`,`outputDimensionality`],a),J(e,[`mimeType`])!==void 0)throw Error(`mimeType parameter is not supported in Gemini API.`);if(J(e,[`autoTruncate`])!==void 0)throw Error(`autoTruncate parameter is not supported in Gemini API.`);return n}function $p(e,t){let n={},r=J(e,[`taskType`]);t!==void 0&&r!=null&&q(t,[`instances[]`,`task_type`],r);let i=J(e,[`title`]);t!==void 0&&i!=null&&q(t,[`instances[]`,`title`],i);let a=J(e,[`outputDimensionality`]);t!==void 0&&a!=null&&q(t,[`parameters`,`outputDimensionality`],a);let o=J(e,[`mimeType`]);t!==void 0&&o!=null&&q(t,[`instances[]`,`mimeType`],o);let s=J(e,[`autoTruncate`]);return t!==void 0&&s!=null&&q(t,[`parameters`,`autoTruncate`],s),n}function em(e,t){let n={},r=J(t,[`model`]);r!=null&&q(n,[`_url`,`model`],Y(e,r));let i=J(t,[`contents`]);if(i!=null){let t=Lu(e,i);Array.isArray(t)&&(t=t.map(e=>e)),q(n,[`requests[]`,`content`],t)}let a=J(t,[`config`]);a!=null&&Qp(a,n);let o=J(t,[`model`]);return o!==void 0&&q(n,[`requests[]`,`model`],Y(e,o)),n}function tm(e,t){let n={},r=J(t,[`model`]);r!=null&&q(n,[`_url`,`model`],Y(e,r));let i=J(t,[`contents`]);if(i!=null){let t=Lu(e,i);Array.isArray(t)&&(t=t.map(e=>e)),q(n,[`instances[]`,`content`],t)}let a=J(t,[`config`]);return a!=null&&$p(a,n),n}function nm(e){let t={},n=J(e,[`sdkHttpResponse`]);n!=null&&q(t,[`sdkHttpResponse`],n);let r=J(e,[`embeddings`]);if(r!=null){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),q(t,[`embeddings`],e)}let i=J(e,[`metadata`]);return i!=null&&q(t,[`metadata`],i),t}function rm(e){let t={},n=J(e,[`sdkHttpResponse`]);n!=null&&q(t,[`sdkHttpResponse`],n);let r=J(e,[`predictions[]`,`embeddings`]);if(r!=null){let e=r;Array.isArray(e)&&(e=e.map(e=>Fp(e))),q(t,[`embeddings`],e)}let i=J(e,[`metadata`]);return i!=null&&q(t,[`metadata`],i),t}function im(e){let t={},n=J(e,[`endpoint`]);n!=null&&q(t,[`name`],n);let r=J(e,[`deployedModelId`]);return r!=null&&q(t,[`deployedModelId`],r),t}function am(e){let t={};if(J(e,[`displayName`])!==void 0)throw Error(`displayName parameter is not supported in Gemini API.`);let n=J(e,[`fileUri`]);n!=null&&q(t,[`fileUri`],n);let r=J(e,[`mimeType`]);return r!=null&&q(t,[`mimeType`],r),t}function om(e){let t={},n=J(e,[`id`]);n!=null&&q(t,[`id`],n);let r=J(e,[`args`]);r!=null&&q(t,[`args`],r);let i=J(e,[`name`]);if(i!=null&&q(t,[`name`],i),J(e,[`partialArgs`])!==void 0)throw Error(`partialArgs parameter is not supported in Gemini API.`);if(J(e,[`willContinue`])!==void 0)throw Error(`willContinue parameter is not supported in Gemini API.`);return t}function sm(e){let t={},n=J(e,[`mode`]);n!=null&&q(t,[`mode`],n);let r=J(e,[`allowedFunctionNames`]);if(r!=null&&q(t,[`allowedFunctionNames`],r),J(e,[`streamFunctionCallArguments`])!==void 0)throw Error(`streamFunctionCallArguments parameter is not supported in Gemini API.`);return t}function cm(e){let t={};if(J(e,[`behavior`])!==void 0)throw Error(`behavior parameter is not supported in Vertex AI.`);let n=J(e,[`description`]);n!=null&&q(t,[`description`],n);let r=J(e,[`name`]);r!=null&&q(t,[`name`],r);let i=J(e,[`parameters`]);i!=null&&q(t,[`parameters`],i);let a=J(e,[`parametersJsonSchema`]);a!=null&&q(t,[`parametersJsonSchema`],a);let o=J(e,[`response`]);o!=null&&q(t,[`response`],o);let s=J(e,[`responseJsonSchema`]);return s!=null&&q(t,[`responseJsonSchema`],s),t}function lm(e,t,n){let r={},i=J(t,[`systemInstruction`]);n!==void 0&&i!=null&&q(n,[`systemInstruction`],Lp(X(i)));let a=J(t,[`temperature`]);a!=null&&q(r,[`temperature`],a);let o=J(t,[`topP`]);o!=null&&q(r,[`topP`],o);let s=J(t,[`topK`]);s!=null&&q(r,[`topK`],s);let c=J(t,[`candidateCount`]);c!=null&&q(r,[`candidateCount`],c);let l=J(t,[`maxOutputTokens`]);l!=null&&q(r,[`maxOutputTokens`],l);let u=J(t,[`stopSequences`]);u!=null&&q(r,[`stopSequences`],u);let d=J(t,[`responseLogprobs`]);d!=null&&q(r,[`responseLogprobs`],d);let f=J(t,[`logprobs`]);f!=null&&q(r,[`logprobs`],f);let p=J(t,[`presencePenalty`]);p!=null&&q(r,[`presencePenalty`],p);let m=J(t,[`frequencyPenalty`]);m!=null&&q(r,[`frequencyPenalty`],m);let h=J(t,[`seed`]);h!=null&&q(r,[`seed`],h);let g=J(t,[`responseMimeType`]);g!=null&&q(r,[`responseMimeType`],g);let _=J(t,[`responseSchema`]);_!=null&&q(r,[`responseSchema`],Vu(_));let v=J(t,[`responseJsonSchema`]);if(v!=null&&q(r,[`responseJsonSchema`],v),J(t,[`routingConfig`])!==void 0)throw Error(`routingConfig parameter is not supported in Gemini API.`);if(J(t,[`modelSelectionConfig`])!==void 0)throw Error(`modelSelectionConfig parameter is not supported in Gemini API.`);let y=J(t,[`safetySettings`]);if(n!==void 0&&y!=null){let e=y;Array.isArray(e)&&(e=e.map(e=>dh(e))),q(n,[`safetySettings`],e)}let b=J(t,[`tools`]);if(n!==void 0&&b!=null){let e=Gu(b);Array.isArray(e)&&(e=e.map(e=>vh(Wu(e)))),q(n,[`tools`],e)}let x=J(t,[`toolConfig`]);if(n!==void 0&&x!=null&&q(n,[`toolConfig`],_h(x)),J(t,[`labels`])!==void 0)throw Error(`labels parameter is not supported in Gemini API.`);let S=J(t,[`cachedContent`]);n!==void 0&&S!=null&&q(n,[`cachedContent`],qu(e,S));let C=J(t,[`responseModalities`]);C!=null&&q(r,[`responseModalities`],C);let w=J(t,[`mediaResolution`]);w!=null&&q(r,[`mediaResolution`],w);let T=J(t,[`speechConfig`]);if(T!=null&&q(r,[`speechConfig`],Hu(T)),J(t,[`audioTimestamp`])!==void 0)throw Error(`audioTimestamp parameter is not supported in Gemini API.`);let E=J(t,[`thinkingConfig`]);E!=null&&q(r,[`thinkingConfig`],E);let ee=J(t,[`imageConfig`]);ee!=null&&q(r,[`imageConfig`],Vm(ee));let te=J(t,[`enableEnhancedCivicAnswers`]);return te!=null&&q(r,[`enableEnhancedCivicAnswers`],te),r}function um(e,t,n){let r={},i=J(t,[`systemInstruction`]);n!==void 0&&i!=null&&q(n,[`systemInstruction`],X(i));let a=J(t,[`temperature`]);a!=null&&q(r,[`temperature`],a);let o=J(t,[`topP`]);o!=null&&q(r,[`topP`],o);let s=J(t,[`topK`]);s!=null&&q(r,[`topK`],s);let c=J(t,[`candidateCount`]);c!=null&&q(r,[`candidateCount`],c);let l=J(t,[`maxOutputTokens`]);l!=null&&q(r,[`maxOutputTokens`],l);let u=J(t,[`stopSequences`]);u!=null&&q(r,[`stopSequences`],u);let d=J(t,[`responseLogprobs`]);d!=null&&q(r,[`responseLogprobs`],d);let f=J(t,[`logprobs`]);f!=null&&q(r,[`logprobs`],f);let p=J(t,[`presencePenalty`]);p!=null&&q(r,[`presencePenalty`],p);let m=J(t,[`frequencyPenalty`]);m!=null&&q(r,[`frequencyPenalty`],m);let h=J(t,[`seed`]);h!=null&&q(r,[`seed`],h);let g=J(t,[`responseMimeType`]);g!=null&&q(r,[`responseMimeType`],g);let _=J(t,[`responseSchema`]);_!=null&&q(r,[`responseSchema`],Vu(_));let v=J(t,[`responseJsonSchema`]);v!=null&&q(r,[`responseJsonSchema`],v);let y=J(t,[`routingConfig`]);y!=null&&q(r,[`routingConfig`],y);let b=J(t,[`modelSelectionConfig`]);b!=null&&q(r,[`modelConfig`],b);let x=J(t,[`safetySettings`]);if(n!==void 0&&x!=null){let e=x;Array.isArray(e)&&(e=e.map(e=>e)),q(n,[`safetySettings`],e)}let S=J(t,[`tools`]);if(n!==void 0&&S!=null){let e=Gu(S);Array.isArray(e)&&(e=e.map(e=>yh(Wu(e)))),q(n,[`tools`],e)}let C=J(t,[`toolConfig`]);n!==void 0&&C!=null&&q(n,[`toolConfig`],C);let w=J(t,[`labels`]);n!==void 0&&w!=null&&q(n,[`labels`],w);let T=J(t,[`cachedContent`]);n!==void 0&&T!=null&&q(n,[`cachedContent`],qu(e,T));let E=J(t,[`responseModalities`]);E!=null&&q(r,[`responseModalities`],E);let ee=J(t,[`mediaResolution`]);ee!=null&&q(r,[`mediaResolution`],ee);let te=J(t,[`speechConfig`]);te!=null&&q(r,[`speechConfig`],Hu(te));let ne=J(t,[`audioTimestamp`]);ne!=null&&q(r,[`audioTimestamp`],ne);let re=J(t,[`thinkingConfig`]);re!=null&&q(r,[`thinkingConfig`],re);let ie=J(t,[`imageConfig`]);if(ie!=null&&q(r,[`imageConfig`],Hm(ie)),J(t,[`enableEnhancedCivicAnswers`])!==void 0)throw Error(`enableEnhancedCivicAnswers parameter is not supported in Vertex AI.`);return r}function dm(e,t){let n={},r=J(t,[`model`]);r!=null&&q(n,[`_url`,`model`],Y(e,r));let i=J(t,[`contents`]);if(i!=null){let e=Ru(i);Array.isArray(e)&&(e=e.map(e=>Lp(e))),q(n,[`contents`],e)}let a=J(t,[`config`]);return a!=null&&q(n,[`generationConfig`],lm(e,a,n)),n}function fm(e,t){let n={},r=J(t,[`model`]);r!=null&&q(n,[`_url`,`model`],Y(e,r));let i=J(t,[`contents`]);if(i!=null){let e=Ru(i);Array.isArray(e)&&(e=e.map(e=>e)),q(n,[`contents`],e)}let a=J(t,[`config`]);return a!=null&&q(n,[`generationConfig`],um(e,a,n)),n}function pm(e){let t={},n=J(e,[`sdkHttpResponse`]);n!=null&&q(t,[`sdkHttpResponse`],n);let r=J(e,[`candidates`]);if(r!=null){let e=r;Array.isArray(e)&&(e=e.map(e=>jp(e))),q(t,[`candidates`],e)}let i=J(e,[`modelVersion`]);i!=null&&q(t,[`modelVersion`],i);let a=J(e,[`promptFeedback`]);a!=null&&q(t,[`promptFeedback`],a);let o=J(e,[`responseId`]);o!=null&&q(t,[`responseId`],o);let s=J(e,[`usageMetadata`]);return s!=null&&q(t,[`usageMetadata`],s),t}function mm(e){let t={},n=J(e,[`sdkHttpResponse`]);n!=null&&q(t,[`sdkHttpResponse`],n);let r=J(e,[`candidates`]);if(r!=null){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),q(t,[`candidates`],e)}let i=J(e,[`createTime`]);i!=null&&q(t,[`createTime`],i);let a=J(e,[`modelVersion`]);a!=null&&q(t,[`modelVersion`],a);let o=J(e,[`promptFeedback`]);o!=null&&q(t,[`promptFeedback`],o);let s=J(e,[`responseId`]);s!=null&&q(t,[`responseId`],s);let c=J(e,[`usageMetadata`]);return c!=null&&q(t,[`usageMetadata`],c),t}function hm(e,t){let n={};if(J(e,[`outputGcsUri`])!==void 0)throw Error(`outputGcsUri parameter is not supported in Gemini API.`);if(J(e,[`negativePrompt`])!==void 0)throw Error(`negativePrompt parameter is not supported in Gemini API.`);let r=J(e,[`numberOfImages`]);t!==void 0&&r!=null&&q(t,[`parameters`,`sampleCount`],r);let i=J(e,[`aspectRatio`]);t!==void 0&&i!=null&&q(t,[`parameters`,`aspectRatio`],i);let a=J(e,[`guidanceScale`]);if(t!==void 0&&a!=null&&q(t,[`parameters`,`guidanceScale`],a),J(e,[`seed`])!==void 0)throw Error(`seed parameter is not supported in Gemini API.`);let o=J(e,[`safetyFilterLevel`]);t!==void 0&&o!=null&&q(t,[`parameters`,`safetySetting`],o);let s=J(e,[`personGeneration`]);t!==void 0&&s!=null&&q(t,[`parameters`,`personGeneration`],s);let c=J(e,[`includeSafetyAttributes`]);t!==void 0&&c!=null&&q(t,[`parameters`,`includeSafetyAttributes`],c);let l=J(e,[`includeRaiReason`]);t!==void 0&&l!=null&&q(t,[`parameters`,`includeRaiReason`],l);let u=J(e,[`language`]);t!==void 0&&u!=null&&q(t,[`parameters`,`language`],u);let d=J(e,[`outputMimeType`]);t!==void 0&&d!=null&&q(t,[`parameters`,`outputOptions`,`mimeType`],d);let f=J(e,[`outputCompressionQuality`]);if(t!==void 0&&f!=null&&q(t,[`parameters`,`outputOptions`,`compressionQuality`],f),J(e,[`addWatermark`])!==void 0)throw Error(`addWatermark parameter is not supported in Gemini API.`);if(J(e,[`labels`])!==void 0)throw Error(`labels parameter is not supported in Gemini API.`);let p=J(e,[`imageSize`]);if(t!==void 0&&p!=null&&q(t,[`parameters`,`sampleImageSize`],p),J(e,[`enhancePrompt`])!==void 0)throw Error(`enhancePrompt parameter is not supported in Gemini API.`);return n}function gm(e,t){let n={},r=J(e,[`outputGcsUri`]);t!==void 0&&r!=null&&q(t,[`parameters`,`storageUri`],r);let i=J(e,[`negativePrompt`]);t!==void 0&&i!=null&&q(t,[`parameters`,`negativePrompt`],i);let a=J(e,[`numberOfImages`]);t!==void 0&&a!=null&&q(t,[`parameters`,`sampleCount`],a);let o=J(e,[`aspectRatio`]);t!==void 0&&o!=null&&q(t,[`parameters`,`aspectRatio`],o);let s=J(e,[`guidanceScale`]);t!==void 0&&s!=null&&q(t,[`parameters`,`guidanceScale`],s);let c=J(e,[`seed`]);t!==void 0&&c!=null&&q(t,[`parameters`,`seed`],c);let l=J(e,[`safetyFilterLevel`]);t!==void 0&&l!=null&&q(t,[`parameters`,`safetySetting`],l);let u=J(e,[`personGeneration`]);t!==void 0&&u!=null&&q(t,[`parameters`,`personGeneration`],u);let d=J(e,[`includeSafetyAttributes`]);t!==void 0&&d!=null&&q(t,[`parameters`,`includeSafetyAttributes`],d);let f=J(e,[`includeRaiReason`]);t!==void 0&&f!=null&&q(t,[`parameters`,`includeRaiReason`],f);let p=J(e,[`language`]);t!==void 0&&p!=null&&q(t,[`parameters`,`language`],p);let m=J(e,[`outputMimeType`]);t!==void 0&&m!=null&&q(t,[`parameters`,`outputOptions`,`mimeType`],m);let h=J(e,[`outputCompressionQuality`]);t!==void 0&&h!=null&&q(t,[`parameters`,`outputOptions`,`compressionQuality`],h);let g=J(e,[`addWatermark`]);t!==void 0&&g!=null&&q(t,[`parameters`,`addWatermark`],g);let _=J(e,[`labels`]);t!==void 0&&_!=null&&q(t,[`labels`],_);let v=J(e,[`imageSize`]);t!==void 0&&v!=null&&q(t,[`parameters`,`sampleImageSize`],v);let y=J(e,[`enhancePrompt`]);return t!==void 0&&y!=null&&q(t,[`parameters`,`enhancePrompt`],y),n}function _m(e,t){let n={},r=J(t,[`model`]);r!=null&&q(n,[`_url`,`model`],Y(e,r));let i=J(t,[`prompt`]);i!=null&&q(n,[`instances[0]`,`prompt`],i);let a=J(t,[`config`]);return a!=null&&hm(a,n),n}function vm(e,t){let n={},r=J(t,[`model`]);r!=null&&q(n,[`_url`,`model`],Y(e,r));let i=J(t,[`prompt`]);i!=null&&q(n,[`instances[0]`,`prompt`],i);let a=J(t,[`config`]);return a!=null&&gm(a,n),n}function ym(e){let t={},n=J(e,[`sdkHttpResponse`]);n!=null&&q(t,[`sdkHttpResponse`],n);let r=J(e,[`predictions`]);if(r!=null){let e=r;Array.isArray(e)&&(e=e.map(e=>jm(e))),q(t,[`generatedImages`],e)}let i=J(e,[`positivePromptSafetyAttributes`]);return i!=null&&q(t,[`positivePromptSafetyAttributes`],lh(i)),t}function bm(e){let t={},n=J(e,[`sdkHttpResponse`]);n!=null&&q(t,[`sdkHttpResponse`],n);let r=J(e,[`predictions`]);if(r!=null){let e=r;Array.isArray(e)&&(e=e.map(e=>Mm(e))),q(t,[`generatedImages`],e)}let i=J(e,[`positivePromptSafetyAttributes`]);return i!=null&&q(t,[`positivePromptSafetyAttributes`],uh(i)),t}function xm(e,t){let n={},r=J(e,[`numberOfVideos`]);if(t!==void 0&&r!=null&&q(t,[`parameters`,`sampleCount`],r),J(e,[`outputGcsUri`])!==void 0)throw Error(`outputGcsUri parameter is not supported in Gemini API.`);if(J(e,[`fps`])!==void 0)throw Error(`fps parameter is not supported in Gemini API.`);let i=J(e,[`durationSeconds`]);if(t!==void 0&&i!=null&&q(t,[`parameters`,`durationSeconds`],i),J(e,[`seed`])!==void 0)throw Error(`seed parameter is not supported in Gemini API.`);let a=J(e,[`aspectRatio`]);t!==void 0&&a!=null&&q(t,[`parameters`,`aspectRatio`],a);let o=J(e,[`resolution`]);t!==void 0&&o!=null&&q(t,[`parameters`,`resolution`],o);let s=J(e,[`personGeneration`]);if(t!==void 0&&s!=null&&q(t,[`parameters`,`personGeneration`],s),J(e,[`pubsubTopic`])!==void 0)throw Error(`pubsubTopic parameter is not supported in Gemini API.`);let c=J(e,[`negativePrompt`]);t!==void 0&&c!=null&&q(t,[`parameters`,`negativePrompt`],c);let l=J(e,[`enhancePrompt`]);if(t!==void 0&&l!=null&&q(t,[`parameters`,`enhancePrompt`],l),J(e,[`generateAudio`])!==void 0)throw Error(`generateAudio parameter is not supported in Gemini API.`);let u=J(e,[`lastFrame`]);t!==void 0&&u!=null&&q(t,[`instances[0]`,`lastFrame`],Gm(u));let d=J(e,[`referenceImages`]);if(t!==void 0&&d!=null){let e=d;Array.isArray(e)&&(e=e.map(e=>Mh(e))),q(t,[`instances[0]`,`referenceImages`],e)}if(J(e,[`mask`])!==void 0)throw Error(`mask parameter is not supported in Gemini API.`);if(J(e,[`compressionQuality`])!==void 0)throw Error(`compressionQuality parameter is not supported in Gemini API.`);return n}function Sm(e,t){let n={},r=J(e,[`numberOfVideos`]);t!==void 0&&r!=null&&q(t,[`parameters`,`sampleCount`],r);let i=J(e,[`outputGcsUri`]);t!==void 0&&i!=null&&q(t,[`parameters`,`storageUri`],i);let a=J(e,[`fps`]);t!==void 0&&a!=null&&q(t,[`parameters`,`fps`],a);let o=J(e,[`durationSeconds`]);t!==void 0&&o!=null&&q(t,[`parameters`,`durationSeconds`],o);let s=J(e,[`seed`]);t!==void 0&&s!=null&&q(t,[`parameters`,`seed`],s);let c=J(e,[`aspectRatio`]);t!==void 0&&c!=null&&q(t,[`parameters`,`aspectRatio`],c);let l=J(e,[`resolution`]);t!==void 0&&l!=null&&q(t,[`parameters`,`resolution`],l);let u=J(e,[`personGeneration`]);t!==void 0&&u!=null&&q(t,[`parameters`,`personGeneration`],u);let d=J(e,[`pubsubTopic`]);t!==void 0&&d!=null&&q(t,[`parameters`,`pubsubTopic`],d);let f=J(e,[`negativePrompt`]);t!==void 0&&f!=null&&q(t,[`parameters`,`negativePrompt`],f);let p=J(e,[`enhancePrompt`]);t!==void 0&&p!=null&&q(t,[`parameters`,`enhancePrompt`],p);let m=J(e,[`generateAudio`]);t!==void 0&&m!=null&&q(t,[`parameters`,`generateAudio`],m);let h=J(e,[`lastFrame`]);t!==void 0&&h!=null&&q(t,[`instances[0]`,`lastFrame`],Km(h));let g=J(e,[`referenceImages`]);if(t!==void 0&&g!=null){let e=g;Array.isArray(e)&&(e=e.map(e=>Nh(e))),q(t,[`instances[0]`,`referenceImages`],e)}let _=J(e,[`mask`]);t!==void 0&&_!=null&&q(t,[`instances[0]`,`mask`],jh(_));let v=J(e,[`compressionQuality`]);return t!==void 0&&v!=null&&q(t,[`parameters`,`compressionQuality`],v),n}function Cm(e){let t={},n=J(e,[`name`]);n!=null&&q(t,[`name`],n);let r=J(e,[`metadata`]);r!=null&&q(t,[`metadata`],r);let i=J(e,[`done`]);i!=null&&q(t,[`done`],i);let a=J(e,[`error`]);a!=null&&q(t,[`error`],a);let o=J(e,[`response`,`generateVideoResponse`]);return o!=null&&q(t,[`response`],Dm(o)),t}function wm(e){let t={},n=J(e,[`name`]);n!=null&&q(t,[`name`],n);let r=J(e,[`metadata`]);r!=null&&q(t,[`metadata`],r);let i=J(e,[`done`]);i!=null&&q(t,[`done`],i);let a=J(e,[`error`]);a!=null&&q(t,[`error`],a);let o=J(e,[`response`]);return o!=null&&q(t,[`response`],Om(o)),t}function Tm(e,t){let n={},r=J(t,[`model`]);r!=null&&q(n,[`_url`,`model`],Y(e,r));let i=J(t,[`prompt`]);i!=null&&q(n,[`instances[0]`,`prompt`],i);let a=J(t,[`image`]);a!=null&&q(n,[`instances[0]`,`image`],Gm(a));let o=J(t,[`video`]);o!=null&&q(n,[`instances[0]`,`video`],Ph(o));let s=J(t,[`source`]);s!=null&&km(s,n);let c=J(t,[`config`]);return c!=null&&xm(c,n),n}function Em(e,t){let n={},r=J(t,[`model`]);r!=null&&q(n,[`_url`,`model`],Y(e,r));let i=J(t,[`prompt`]);i!=null&&q(n,[`instances[0]`,`prompt`],i);let a=J(t,[`image`]);a!=null&&q(n,[`instances[0]`,`image`],Km(a));let o=J(t,[`video`]);o!=null&&q(n,[`instances[0]`,`video`],Fh(o));let s=J(t,[`source`]);s!=null&&Am(s,n);let c=J(t,[`config`]);return c!=null&&Sm(c,n),n}function Dm(e){let t={},n=J(e,[`generatedSamples`]);if(n!=null){let e=n;Array.isArray(e)&&(e=e.map(e=>Pm(e))),q(t,[`generatedVideos`],e)}let r=J(e,[`raiMediaFilteredCount`]);r!=null&&q(t,[`raiMediaFilteredCount`],r);let i=J(e,[`raiMediaFilteredReasons`]);return i!=null&&q(t,[`raiMediaFilteredReasons`],i),t}function Om(e){let t={},n=J(e,[`videos`]);if(n!=null){let e=n;Array.isArray(e)&&(e=e.map(e=>Fm(e))),q(t,[`generatedVideos`],e)}let r=J(e,[`raiMediaFilteredCount`]);r!=null&&q(t,[`raiMediaFilteredCount`],r);let i=J(e,[`raiMediaFilteredReasons`]);return i!=null&&q(t,[`raiMediaFilteredReasons`],i),t}function km(e,t){let n={},r=J(e,[`prompt`]);t!==void 0&&r!=null&&q(t,[`instances[0]`,`prompt`],r);let i=J(e,[`image`]);t!==void 0&&i!=null&&q(t,[`instances[0]`,`image`],Gm(i));let a=J(e,[`video`]);return t!==void 0&&a!=null&&q(t,[`instances[0]`,`video`],Ph(a)),n}function Am(e,t){let n={},r=J(e,[`prompt`]);t!==void 0&&r!=null&&q(t,[`instances[0]`,`prompt`],r);let i=J(e,[`image`]);t!==void 0&&i!=null&&q(t,[`instances[0]`,`image`],Km(i));let a=J(e,[`video`]);return t!==void 0&&a!=null&&q(t,[`instances[0]`,`video`],Fh(a)),n}function jm(e){let t={},n=J(e,[`_self`]);n!=null&&q(t,[`image`],Um(n));let r=J(e,[`raiFilteredReason`]);r!=null&&q(t,[`raiFilteredReason`],r);let i=J(e,[`_self`]);return i!=null&&q(t,[`safetyAttributes`],lh(i)),t}function Mm(e){let t={},n=J(e,[`_self`]);n!=null&&q(t,[`image`],Wm(n));let r=J(e,[`raiFilteredReason`]);r!=null&&q(t,[`raiFilteredReason`],r);let i=J(e,[`_self`]);i!=null&&q(t,[`safetyAttributes`],uh(i));let a=J(e,[`prompt`]);return a!=null&&q(t,[`enhancedPrompt`],a),t}function Nm(e){let t={},n=J(e,[`_self`]);n!=null&&q(t,[`mask`],Wm(n));let r=J(e,[`labels`]);if(r!=null){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),q(t,[`labels`],e)}return t}function Pm(e){let t={},n=J(e,[`video`]);return n!=null&&q(t,[`video`],kh(n)),t}function Fm(e){let t={},n=J(e,[`_self`]);return n!=null&&q(t,[`video`],Ah(n)),t}function Im(e){let t={},n=J(e,[`modelSelectionConfig`]);n!=null&&q(t,[`modelConfig`],n);let r=J(e,[`responseJsonSchema`]);r!=null&&q(t,[`responseJsonSchema`],r);let i=J(e,[`audioTimestamp`]);i!=null&&q(t,[`audioTimestamp`],i);let a=J(e,[`candidateCount`]);a!=null&&q(t,[`candidateCount`],a);let o=J(e,[`enableAffectiveDialog`]);o!=null&&q(t,[`enableAffectiveDialog`],o);let s=J(e,[`frequencyPenalty`]);s!=null&&q(t,[`frequencyPenalty`],s);let c=J(e,[`logprobs`]);c!=null&&q(t,[`logprobs`],c);let l=J(e,[`maxOutputTokens`]);l!=null&&q(t,[`maxOutputTokens`],l);let u=J(e,[`mediaResolution`]);u!=null&&q(t,[`mediaResolution`],u);let d=J(e,[`presencePenalty`]);d!=null&&q(t,[`presencePenalty`],d);let f=J(e,[`responseLogprobs`]);f!=null&&q(t,[`responseLogprobs`],f);let p=J(e,[`responseMimeType`]);p!=null&&q(t,[`responseMimeType`],p);let m=J(e,[`responseModalities`]);m!=null&&q(t,[`responseModalities`],m);let h=J(e,[`responseSchema`]);h!=null&&q(t,[`responseSchema`],h);let g=J(e,[`routingConfig`]);g!=null&&q(t,[`routingConfig`],g);let _=J(e,[`seed`]);_!=null&&q(t,[`seed`],_);let v=J(e,[`speechConfig`]);v!=null&&q(t,[`speechConfig`],v);let y=J(e,[`stopSequences`]);y!=null&&q(t,[`stopSequences`],y);let b=J(e,[`temperature`]);b!=null&&q(t,[`temperature`],b);let x=J(e,[`thinkingConfig`]);x!=null&&q(t,[`thinkingConfig`],x);let S=J(e,[`topK`]);S!=null&&q(t,[`topK`],S);let C=J(e,[`topP`]);if(C!=null&&q(t,[`topP`],C),J(e,[`enableEnhancedCivicAnswers`])!==void 0)throw Error(`enableEnhancedCivicAnswers parameter is not supported in Vertex AI.`);return t}function Lm(e,t){let n={},r=J(t,[`model`]);return r!=null&&q(n,[`_url`,`name`],Y(e,r)),n}function Rm(e,t){let n={},r=J(t,[`model`]);return r!=null&&q(n,[`_url`,`name`],Y(e,r)),n}function zm(e){let t={};if(J(e,[`authConfig`])!==void 0)throw Error(`authConfig parameter is not supported in Gemini API.`);let n=J(e,[`enableWidget`]);return n!=null&&q(t,[`enableWidget`],n),t}function Bm(e){let t={};if(J(e,[`excludeDomains`])!==void 0)throw Error(`excludeDomains parameter is not supported in Gemini API.`);if(J(e,[`blockingConfidence`])!==void 0)throw Error(`blockingConfidence parameter is not supported in Gemini API.`);let n=J(e,[`timeRangeFilter`]);return n!=null&&q(t,[`timeRangeFilter`],n),t}function Vm(e){let t={},n=J(e,[`aspectRatio`]);n!=null&&q(t,[`aspectRatio`],n);let r=J(e,[`imageSize`]);if(r!=null&&q(t,[`imageSize`],r),J(e,[`outputMimeType`])!==void 0)throw Error(`outputMimeType parameter is not supported in Gemini API.`);if(J(e,[`outputCompressionQuality`])!==void 0)throw Error(`outputCompressionQuality parameter is not supported in Gemini API.`);return t}function Hm(e){let t={},n=J(e,[`aspectRatio`]);n!=null&&q(t,[`aspectRatio`],n);let r=J(e,[`imageSize`]);r!=null&&q(t,[`imageSize`],r);let i=J(e,[`outputMimeType`]);i!=null&&q(t,[`imageOutputOptions`,`mimeType`],i);let a=J(e,[`outputCompressionQuality`]);return a!=null&&q(t,[`imageOutputOptions`,`compressionQuality`],a),t}function Um(e){let t={},n=J(e,[`bytesBase64Encoded`]);n!=null&&q(t,[`imageBytes`],Yu(n));let r=J(e,[`mimeType`]);return r!=null&&q(t,[`mimeType`],r),t}function Wm(e){let t={},n=J(e,[`gcsUri`]);n!=null&&q(t,[`gcsUri`],n);let r=J(e,[`bytesBase64Encoded`]);r!=null&&q(t,[`imageBytes`],Yu(r));let i=J(e,[`mimeType`]);return i!=null&&q(t,[`mimeType`],i),t}function Gm(e){let t={};if(J(e,[`gcsUri`])!==void 0)throw Error(`gcsUri parameter is not supported in Gemini API.`);let n=J(e,[`imageBytes`]);n!=null&&q(t,[`bytesBase64Encoded`],Yu(n));let r=J(e,[`mimeType`]);return r!=null&&q(t,[`mimeType`],r),t}function Km(e){let t={},n=J(e,[`gcsUri`]);n!=null&&q(t,[`gcsUri`],n);let r=J(e,[`imageBytes`]);r!=null&&q(t,[`bytesBase64Encoded`],Yu(r));let i=J(e,[`mimeType`]);return i!=null&&q(t,[`mimeType`],i),t}function qm(e,t,n){let r={},i=J(t,[`pageSize`]);n!==void 0&&i!=null&&q(n,[`_query`,`pageSize`],i);let a=J(t,[`pageToken`]);n!==void 0&&a!=null&&q(n,[`_query`,`pageToken`],a);let o=J(t,[`filter`]);n!==void 0&&o!=null&&q(n,[`_query`,`filter`],o);let s=J(t,[`queryBase`]);return n!==void 0&&s!=null&&q(n,[`_url`,`models_url`],ed(e,s)),r}function Jm(e,t,n){let r={},i=J(t,[`pageSize`]);n!==void 0&&i!=null&&q(n,[`_query`,`pageSize`],i);let a=J(t,[`pageToken`]);n!==void 0&&a!=null&&q(n,[`_query`,`pageToken`],a);let o=J(t,[`filter`]);n!==void 0&&o!=null&&q(n,[`_query`,`filter`],o);let s=J(t,[`queryBase`]);return n!==void 0&&s!=null&&q(n,[`_url`,`models_url`],ed(e,s)),r}function Ym(e,t){let n={},r=J(t,[`config`]);return r!=null&&qm(e,r,n),n}function Xm(e,t){let n={},r=J(t,[`config`]);return r!=null&&Jm(e,r,n),n}function Zm(e){let t={},n=J(e,[`sdkHttpResponse`]);n!=null&&q(t,[`sdkHttpResponse`],n);let r=J(e,[`nextPageToken`]);r!=null&&q(t,[`nextPageToken`],r);let i=J(e,[`_self`]);if(i!=null){let e=td(i);Array.isArray(e)&&(e=e.map(e=>eh(e))),q(t,[`models`],e)}return t}function Qm(e){let t={},n=J(e,[`sdkHttpResponse`]);n!=null&&q(t,[`sdkHttpResponse`],n);let r=J(e,[`nextPageToken`]);r!=null&&q(t,[`nextPageToken`],r);let i=J(e,[`_self`]);if(i!=null){let e=td(i);Array.isArray(e)&&(e=e.map(e=>th(e))),q(t,[`models`],e)}return t}function $m(e){let t={},n=J(e,[`maskMode`]);n!=null&&q(t,[`maskMode`],n);let r=J(e,[`segmentationClasses`]);r!=null&&q(t,[`maskClasses`],r);let i=J(e,[`maskDilation`]);return i!=null&&q(t,[`dilation`],i),t}function eh(e){let t={},n=J(e,[`name`]);n!=null&&q(t,[`name`],n);let r=J(e,[`displayName`]);r!=null&&q(t,[`displayName`],r);let i=J(e,[`description`]);i!=null&&q(t,[`description`],i);let a=J(e,[`version`]);a!=null&&q(t,[`version`],a);let o=J(e,[`_self`]);o!=null&&q(t,[`tunedModelInfo`],bh(o));let s=J(e,[`inputTokenLimit`]);s!=null&&q(t,[`inputTokenLimit`],s);let c=J(e,[`outputTokenLimit`]);c!=null&&q(t,[`outputTokenLimit`],c);let l=J(e,[`supportedGenerationMethods`]);l!=null&&q(t,[`supportedActions`],l);let u=J(e,[`temperature`]);u!=null&&q(t,[`temperature`],u);let d=J(e,[`maxTemperature`]);d!=null&&q(t,[`maxTemperature`],d);let f=J(e,[`topP`]);f!=null&&q(t,[`topP`],f);let p=J(e,[`topK`]);p!=null&&q(t,[`topK`],p);let m=J(e,[`thinking`]);return m!=null&&q(t,[`thinking`],m),t}function th(e){let t={},n=J(e,[`name`]);n!=null&&q(t,[`name`],n);let r=J(e,[`displayName`]);r!=null&&q(t,[`displayName`],r);let i=J(e,[`description`]);i!=null&&q(t,[`description`],i);let a=J(e,[`versionId`]);a!=null&&q(t,[`version`],a);let o=J(e,[`deployedModels`]);if(o!=null){let e=o;Array.isArray(e)&&(e=e.map(e=>im(e))),q(t,[`endpoints`],e)}let s=J(e,[`labels`]);s!=null&&q(t,[`labels`],s);let c=J(e,[`_self`]);c!=null&&q(t,[`tunedModelInfo`],xh(c));let l=J(e,[`defaultCheckpointId`]);l!=null&&q(t,[`defaultCheckpointId`],l);let u=J(e,[`checkpoints`]);if(u!=null){let e=u;Array.isArray(e)&&(e=e.map(e=>e)),q(t,[`checkpoints`],e)}return t}function nh(e){let t={},n=J(e,[`mediaResolution`]);n!=null&&q(t,[`mediaResolution`],n);let r=J(e,[`codeExecutionResult`]);r!=null&&q(t,[`codeExecutionResult`],r);let i=J(e,[`executableCode`]);i!=null&&q(t,[`executableCode`],i);let a=J(e,[`fileData`]);a!=null&&q(t,[`fileData`],am(a));let o=J(e,[`functionCall`]);o!=null&&q(t,[`functionCall`],om(o));let s=J(e,[`functionResponse`]);s!=null&&q(t,[`functionResponse`],s);let c=J(e,[`inlineData`]);c!=null&&q(t,[`inlineData`],Ap(c));let l=J(e,[`text`]);l!=null&&q(t,[`text`],l);let u=J(e,[`thought`]);u!=null&&q(t,[`thought`],u);let d=J(e,[`thoughtSignature`]);d!=null&&q(t,[`thoughtSignature`],d);let f=J(e,[`videoMetadata`]);return f!=null&&q(t,[`videoMetadata`],f),t}function rh(e){let t={},n=J(e,[`productImage`]);return n!=null&&q(t,[`image`],Km(n)),t}function ih(e,t){let n={},r=J(e,[`numberOfImages`]);t!==void 0&&r!=null&&q(t,[`parameters`,`sampleCount`],r);let i=J(e,[`baseSteps`]);t!==void 0&&i!=null&&q(t,[`parameters`,`baseSteps`],i);let a=J(e,[`outputGcsUri`]);t!==void 0&&a!=null&&q(t,[`parameters`,`storageUri`],a);let o=J(e,[`seed`]);t!==void 0&&o!=null&&q(t,[`parameters`,`seed`],o);let s=J(e,[`safetyFilterLevel`]);t!==void 0&&s!=null&&q(t,[`parameters`,`safetySetting`],s);let c=J(e,[`personGeneration`]);t!==void 0&&c!=null&&q(t,[`parameters`,`personGeneration`],c);let l=J(e,[`addWatermark`]);t!==void 0&&l!=null&&q(t,[`parameters`,`addWatermark`],l);let u=J(e,[`outputMimeType`]);t!==void 0&&u!=null&&q(t,[`parameters`,`outputOptions`,`mimeType`],u);let d=J(e,[`outputCompressionQuality`]);t!==void 0&&d!=null&&q(t,[`parameters`,`outputOptions`,`compressionQuality`],d);let f=J(e,[`enhancePrompt`]);t!==void 0&&f!=null&&q(t,[`parameters`,`enhancePrompt`],f);let p=J(e,[`labels`]);return t!==void 0&&p!=null&&q(t,[`labels`],p),n}function ah(e,t){let n={},r=J(t,[`model`]);r!=null&&q(n,[`_url`,`model`],Y(e,r));let i=J(t,[`source`]);i!=null&&sh(i,n);let a=J(t,[`config`]);return a!=null&&ih(a,n),n}function oh(e){let t={},n=J(e,[`predictions`]);if(n!=null){let e=n;Array.isArray(e)&&(e=e.map(e=>Mm(e))),q(t,[`generatedImages`],e)}return t}function sh(e,t){let n={},r=J(e,[`prompt`]);t!==void 0&&r!=null&&q(t,[`instances[0]`,`prompt`],r);let i=J(e,[`personImage`]);t!==void 0&&i!=null&&q(t,[`instances[0]`,`personImage`,`image`],Km(i));let a=J(e,[`productImages`]);if(t!==void 0&&a!=null){let e=a;Array.isArray(e)&&(e=e.map(e=>rh(e))),q(t,[`instances[0]`,`productImages`],e)}return n}function ch(e){let t={},n=J(e,[`referenceImage`]);n!=null&&q(t,[`referenceImage`],Km(n));let r=J(e,[`referenceId`]);r!=null&&q(t,[`referenceId`],r);let i=J(e,[`referenceType`]);i!=null&&q(t,[`referenceType`],i);let a=J(e,[`maskImageConfig`]);a!=null&&q(t,[`maskImageConfig`],$m(a));let o=J(e,[`controlImageConfig`]);o!=null&&q(t,[`controlImageConfig`],Rp(o));let s=J(e,[`styleImageConfig`]);s!=null&&q(t,[`styleImageConfig`],s);let c=J(e,[`subjectImageConfig`]);return c!=null&&q(t,[`subjectImageConfig`],c),t}function lh(e){let t={},n=J(e,[`safetyAttributes`,`categories`]);n!=null&&q(t,[`categories`],n);let r=J(e,[`safetyAttributes`,`scores`]);r!=null&&q(t,[`scores`],r);let i=J(e,[`contentType`]);return i!=null&&q(t,[`contentType`],i),t}function uh(e){let t={},n=J(e,[`safetyAttributes`,`categories`]);n!=null&&q(t,[`categories`],n);let r=J(e,[`safetyAttributes`,`scores`]);r!=null&&q(t,[`scores`],r);let i=J(e,[`contentType`]);return i!=null&&q(t,[`contentType`],i),t}function dh(e){let t={},n=J(e,[`category`]);if(n!=null&&q(t,[`category`],n),J(e,[`method`])!==void 0)throw Error(`method parameter is not supported in Gemini API.`);let r=J(e,[`threshold`]);return r!=null&&q(t,[`threshold`],r),t}function fh(e){let t={},n=J(e,[`image`]);return n!=null&&q(t,[`image`],Km(n)),t}function ph(e,t){let n={},r=J(e,[`mode`]);t!==void 0&&r!=null&&q(t,[`parameters`,`mode`],r);let i=J(e,[`maxPredictions`]);t!==void 0&&i!=null&&q(t,[`parameters`,`maxPredictions`],i);let a=J(e,[`confidenceThreshold`]);t!==void 0&&a!=null&&q(t,[`parameters`,`confidenceThreshold`],a);let o=J(e,[`maskDilation`]);t!==void 0&&o!=null&&q(t,[`parameters`,`maskDilation`],o);let s=J(e,[`binaryColorThreshold`]);t!==void 0&&s!=null&&q(t,[`parameters`,`binaryColorThreshold`],s);let c=J(e,[`labels`]);return t!==void 0&&c!=null&&q(t,[`labels`],c),n}function mh(e,t){let n={},r=J(t,[`model`]);r!=null&&q(n,[`_url`,`model`],Y(e,r));let i=J(t,[`source`]);i!=null&&gh(i,n);let a=J(t,[`config`]);return a!=null&&ph(a,n),n}function hh(e){let t={},n=J(e,[`predictions`]);if(n!=null){let e=n;Array.isArray(e)&&(e=e.map(e=>Nm(e))),q(t,[`generatedMasks`],e)}return t}function gh(e,t){let n={},r=J(e,[`prompt`]);t!==void 0&&r!=null&&q(t,[`instances[0]`,`prompt`],r);let i=J(e,[`image`]);t!==void 0&&i!=null&&q(t,[`instances[0]`,`image`],Km(i));let a=J(e,[`scribbleImage`]);return t!==void 0&&a!=null&&q(t,[`instances[0]`,`scribble`],fh(a)),n}function _h(e){let t={},n=J(e,[`functionCallingConfig`]);n!=null&&q(t,[`functionCallingConfig`],sm(n));let r=J(e,[`retrievalConfig`]);return r!=null&&q(t,[`retrievalConfig`],r),t}function vh(e){let t={},n=J(e,[`functionDeclarations`]);if(n!=null){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),q(t,[`functionDeclarations`],e)}if(J(e,[`retrieval`])!==void 0)throw Error(`retrieval parameter is not supported in Gemini API.`);let r=J(e,[`googleSearchRetrieval`]);r!=null&&q(t,[`googleSearchRetrieval`],r);let i=J(e,[`computerUse`]);i!=null&&q(t,[`computerUse`],i);let a=J(e,[`fileSearch`]);a!=null&&q(t,[`fileSearch`],a);let o=J(e,[`codeExecution`]);if(o!=null&&q(t,[`codeExecution`],o),J(e,[`enterpriseWebSearch`])!==void 0)throw Error(`enterpriseWebSearch parameter is not supported in Gemini API.`);let s=J(e,[`googleMaps`]);s!=null&&q(t,[`googleMaps`],zm(s));let c=J(e,[`googleSearch`]);c!=null&&q(t,[`googleSearch`],Bm(c));let l=J(e,[`urlContext`]);return l!=null&&q(t,[`urlContext`],l),t}function yh(e){let t={},n=J(e,[`functionDeclarations`]);if(n!=null){let e=n;Array.isArray(e)&&(e=e.map(e=>cm(e))),q(t,[`functionDeclarations`],e)}let r=J(e,[`retrieval`]);r!=null&&q(t,[`retrieval`],r);let i=J(e,[`googleSearchRetrieval`]);i!=null&&q(t,[`googleSearchRetrieval`],i);let a=J(e,[`computerUse`]);if(a!=null&&q(t,[`computerUse`],a),J(e,[`fileSearch`])!==void 0)throw Error(`fileSearch parameter is not supported in Vertex AI.`);let o=J(e,[`codeExecution`]);o!=null&&q(t,[`codeExecution`],o);let s=J(e,[`enterpriseWebSearch`]);s!=null&&q(t,[`enterpriseWebSearch`],s);let c=J(e,[`googleMaps`]);c!=null&&q(t,[`googleMaps`],c);let l=J(e,[`googleSearch`]);l!=null&&q(t,[`googleSearch`],l);let u=J(e,[`urlContext`]);return u!=null&&q(t,[`urlContext`],u),t}function bh(e){let t={},n=J(e,[`baseModel`]);n!=null&&q(t,[`baseModel`],n);let r=J(e,[`createTime`]);r!=null&&q(t,[`createTime`],r);let i=J(e,[`updateTime`]);return i!=null&&q(t,[`updateTime`],i),t}function xh(e){let t={},n=J(e,[`labels`,`google-vertex-llm-tuning-base-model-id`]);n!=null&&q(t,[`baseModel`],n);let r=J(e,[`createTime`]);r!=null&&q(t,[`createTime`],r);let i=J(e,[`updateTime`]);return i!=null&&q(t,[`updateTime`],i),t}function Sh(e,t){let n={},r=J(e,[`displayName`]);t!==void 0&&r!=null&&q(t,[`displayName`],r);let i=J(e,[`description`]);t!==void 0&&i!=null&&q(t,[`description`],i);let a=J(e,[`defaultCheckpointId`]);return t!==void 0&&a!=null&&q(t,[`defaultCheckpointId`],a),n}function Ch(e,t){let n={},r=J(e,[`displayName`]);t!==void 0&&r!=null&&q(t,[`displayName`],r);let i=J(e,[`description`]);t!==void 0&&i!=null&&q(t,[`description`],i);let a=J(e,[`defaultCheckpointId`]);return t!==void 0&&a!=null&&q(t,[`defaultCheckpointId`],a),n}function wh(e,t){let n={},r=J(t,[`model`]);r!=null&&q(n,[`_url`,`name`],Y(e,r));let i=J(t,[`config`]);return i!=null&&Sh(i,n),n}function Th(e,t){let n={},r=J(t,[`model`]);r!=null&&q(n,[`_url`,`model`],Y(e,r));let i=J(t,[`config`]);return i!=null&&Ch(i,n),n}function Eh(e,t){let n={},r=J(e,[`outputGcsUri`]);t!==void 0&&r!=null&&q(t,[`parameters`,`storageUri`],r);let i=J(e,[`safetyFilterLevel`]);t!==void 0&&i!=null&&q(t,[`parameters`,`safetySetting`],i);let a=J(e,[`personGeneration`]);t!==void 0&&a!=null&&q(t,[`parameters`,`personGeneration`],a);let o=J(e,[`includeRaiReason`]);t!==void 0&&o!=null&&q(t,[`parameters`,`includeRaiReason`],o);let s=J(e,[`outputMimeType`]);t!==void 0&&s!=null&&q(t,[`parameters`,`outputOptions`,`mimeType`],s);let c=J(e,[`outputCompressionQuality`]);t!==void 0&&c!=null&&q(t,[`parameters`,`outputOptions`,`compressionQuality`],c);let l=J(e,[`enhanceInputImage`]);t!==void 0&&l!=null&&q(t,[`parameters`,`upscaleConfig`,`enhanceInputImage`],l);let u=J(e,[`imagePreservationFactor`]);t!==void 0&&u!=null&&q(t,[`parameters`,`upscaleConfig`,`imagePreservationFactor`],u);let d=J(e,[`labels`]);t!==void 0&&d!=null&&q(t,[`labels`],d);let f=J(e,[`numberOfImages`]);t!==void 0&&f!=null&&q(t,[`parameters`,`sampleCount`],f);let p=J(e,[`mode`]);return t!==void 0&&p!=null&&q(t,[`parameters`,`mode`],p),n}function Dh(e,t){let n={},r=J(t,[`model`]);r!=null&&q(n,[`_url`,`model`],Y(e,r));let i=J(t,[`image`]);i!=null&&q(n,[`instances[0]`,`image`],Km(i));let a=J(t,[`upscaleFactor`]);a!=null&&q(n,[`parameters`,`upscaleConfig`,`upscaleFactor`],a);let o=J(t,[`config`]);return o!=null&&Eh(o,n),n}function Oh(e){let t={},n=J(e,[`sdkHttpResponse`]);n!=null&&q(t,[`sdkHttpResponse`],n);let r=J(e,[`predictions`]);if(r!=null){let e=r;Array.isArray(e)&&(e=e.map(e=>Mm(e))),q(t,[`generatedImages`],e)}return t}function kh(e){let t={},n=J(e,[`uri`]);n!=null&&q(t,[`uri`],n);let r=J(e,[`encodedVideo`]);r!=null&&q(t,[`videoBytes`],Yu(r));let i=J(e,[`encoding`]);return i!=null&&q(t,[`mimeType`],i),t}function Ah(e){let t={},n=J(e,[`gcsUri`]);n!=null&&q(t,[`uri`],n);let r=J(e,[`bytesBase64Encoded`]);r!=null&&q(t,[`videoBytes`],Yu(r));let i=J(e,[`mimeType`]);return i!=null&&q(t,[`mimeType`],i),t}function jh(e){let t={},n=J(e,[`image`]);n!=null&&q(t,[`_self`],Km(n));let r=J(e,[`maskMode`]);return r!=null&&q(t,[`maskMode`],r),t}function Mh(e){let t={},n=J(e,[`image`]);n!=null&&q(t,[`image`],Gm(n));let r=J(e,[`referenceType`]);return r!=null&&q(t,[`referenceType`],r),t}function Nh(e){let t={},n=J(e,[`image`]);n!=null&&q(t,[`image`],Km(n));let r=J(e,[`referenceType`]);return r!=null&&q(t,[`referenceType`],r),t}function Ph(e){let t={},n=J(e,[`uri`]);n!=null&&q(t,[`uri`],n);let r=J(e,[`videoBytes`]);r!=null&&q(t,[`encodedVideo`],Yu(r));let i=J(e,[`mimeType`]);return i!=null&&q(t,[`encoding`],i),t}function Fh(e){let t={},n=J(e,[`uri`]);n!=null&&q(t,[`gcsUri`],n);let r=J(e,[`videoBytes`]);r!=null&&q(t,[`bytesBase64Encoded`],Yu(r));let i=J(e,[`mimeType`]);return i!=null&&q(t,[`mimeType`],i),t}function Ih(e,t){let n={},r=J(e,[`displayName`]);return t!==void 0&&r!=null&&q(t,[`displayName`],r),n}function Lh(e){let t={},n=J(e,[`config`]);return n!=null&&Ih(n,t),t}function Rh(e,t){let n={},r=J(e,[`force`]);return t!==void 0&&r!=null&&q(t,[`_query`,`force`],r),n}function zh(e){let t={},n=J(e,[`name`]);n!=null&&q(t,[`_url`,`name`],n);let r=J(e,[`config`]);return r!=null&&Rh(r,t),t}function Bh(e){let t={},n=J(e,[`name`]);return n!=null&&q(t,[`_url`,`name`],n),t}function Vh(e,t){let n={},r=J(e,[`customMetadata`]);if(t!==void 0&&r!=null){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),q(t,[`customMetadata`],e)}let i=J(e,[`chunkingConfig`]);return t!==void 0&&i!=null&&q(t,[`chunkingConfig`],i),n}function Hh(e){let t={},n=J(e,[`name`]);n!=null&&q(t,[`name`],n);let r=J(e,[`metadata`]);r!=null&&q(t,[`metadata`],r);let i=J(e,[`done`]);i!=null&&q(t,[`done`],i);let a=J(e,[`error`]);a!=null&&q(t,[`error`],a);let o=J(e,[`response`]);return o!=null&&q(t,[`response`],Wh(o)),t}function Uh(e){let t={},n=J(e,[`fileSearchStoreName`]);n!=null&&q(t,[`_url`,`file_search_store_name`],n);let r=J(e,[`fileName`]);r!=null&&q(t,[`fileName`],r);let i=J(e,[`config`]);return i!=null&&Vh(i,t),t}function Wh(e){let t={},n=J(e,[`sdkHttpResponse`]);n!=null&&q(t,[`sdkHttpResponse`],n);let r=J(e,[`parent`]);r!=null&&q(t,[`parent`],r);let i=J(e,[`documentName`]);return i!=null&&q(t,[`documentName`],i),t}function Gh(e,t){let n={},r=J(e,[`pageSize`]);t!==void 0&&r!=null&&q(t,[`_query`,`pageSize`],r);let i=J(e,[`pageToken`]);return t!==void 0&&i!=null&&q(t,[`_query`,`pageToken`],i),n}function Kh(e){let t={},n=J(e,[`config`]);return n!=null&&Gh(n,t),t}function qh(e){let t={},n=J(e,[`sdkHttpResponse`]);n!=null&&q(t,[`sdkHttpResponse`],n);let r=J(e,[`nextPageToken`]);r!=null&&q(t,[`nextPageToken`],r);let i=J(e,[`fileSearchStores`]);if(i!=null){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),q(t,[`fileSearchStores`],e)}return t}function Jh(e,t){let n={},r=J(e,[`mimeType`]);t!==void 0&&r!=null&&q(t,[`mimeType`],r);let i=J(e,[`displayName`]);t!==void 0&&i!=null&&q(t,[`displayName`],i);let a=J(e,[`customMetadata`]);if(t!==void 0&&a!=null){let e=a;Array.isArray(e)&&(e=e.map(e=>e)),q(t,[`customMetadata`],e)}let o=J(e,[`chunkingConfig`]);return t!==void 0&&o!=null&&q(t,[`chunkingConfig`],o),n}function Yh(e){let t={},n=J(e,[`fileSearchStoreName`]);n!=null&&q(t,[`_url`,`file_search_store_name`],n);let r=J(e,[`config`]);return r!=null&&Jh(r,t),t}function Xh(e){let t={},n=J(e,[`sdkHttpResponse`]);return n!=null&&q(t,[`sdkHttpResponse`],n),t}var Zh=`Content-Type`,Qh=`X-Server-Timeout`,$h=`User-Agent`,eg=`x-goog-api-client`,tg=`google-genai-sdk/1.34.0`,ng=`v1beta1`,rg=`v1beta`,ig=class{constructor(e){this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});let t={};this.clientOptions.vertexai?(t.apiVersion=this.clientOptions.apiVersion??ng,t.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(t.apiVersion=this.clientOptions.apiVersion??rg,t.baseUrl=`https://generativelanguage.googleapis.com/`),t.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=t,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(t,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!==`global`?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:`https://aiplatform.googleapis.com/`}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){return this.clientOptions.vertexai??!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}async getAuthHeaders(){let e=new Headers;return await this.clientOptions.auth.addAuthHeaders(e),e}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw Error(`API version is not set.`)}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw Error(`Base URL is not set.`)}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw Error(`Headers are not set.`)}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw Error(`HTTP options are not correctly set.`);let t=[e.baseUrl.endsWith(`/`)?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==``&&t.push(e.apiVersion),t.join(`/`)}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){let e=this.getBaseUrl(),t=new URL(e);return t.protocol=t.protocol==`http:`?`ws`:`wss`,t.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw Error(`HTTP options are not correctly set.`)}constructUrl(e,t,n){let r=[this.getRequestUrlInternal(t)];return n&&r.push(this.getBaseResourcePath()),e!==``&&r.push(e),new URL(`${r.join(`/`)}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith(`projects/`)||e.httpMethod===`GET`&&e.path.startsWith(`publishers/google/models`))}async request(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));let n=this.shouldPrependVertexProjectPath(e),r=this.constructUrl(e.path,t,n);if(e.queryParams)for(let[t,n]of Object.entries(e.queryParams))r.searchParams.append(t,String(n));let i={};if(e.httpMethod===`GET`){if(e.body&&e.body!==`{}`)throw Error(`Request body should be empty for GET request, but got non empty request body`)}else i.body=e.body;return i=await this.includeExtraHttpOptionsToRequestInit(i,t,r.toString(),e.abortSignal),this.unaryApiCall(r,i,e.httpMethod)}patchHttpOptions(e,t){let n=JSON.parse(JSON.stringify(e));for(let[e,r]of Object.entries(t))typeof r==`object`?n[e]=Object.assign(Object.assign({},n[e]),r):r!==void 0&&(n[e]=r);return n}async requestStream(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));let n=this.shouldPrependVertexProjectPath(e),r=this.constructUrl(e.path,t,n);(!r.searchParams.has(`alt`)||r.searchParams.get(`alt`)!==`sse`)&&r.searchParams.set(`alt`,`sse`);let i={};return i.body=e.body,i=await this.includeExtraHttpOptionsToRequestInit(i,t,r.toString(),e.abortSignal),this.streamApiCall(r,i,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,t,n,r){if(t&&t.timeout||r){let n=new AbortController,i=n.signal;if(t.timeout&&t?.timeout>0){let e=setTimeout(()=>n.abort(),t.timeout);e&&typeof e.unref==`function`&&e.unref()}r&&r.addEventListener(`abort`,()=>{n.abort()}),e.signal=i}return t&&t.extraBody!==null&&og(e,t.extraBody),e.headers=await this.getHeadersInternal(t,n),e}async unaryApiCall(e,t,n){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:n})).then(async e=>(await ag(e),new $l(e))).catch(e=>{throw e instanceof Error?e:Error(JSON.stringify(e))})}async streamApiCall(e,t,n){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:n})).then(async e=>(await ag(e),this.processStreamResponse(e))).catch(e=>{throw e instanceof Error?e:Error(JSON.stringify(e))})}processStreamResponse(e){return Wf(this,arguments,function*(){let t=(e?.body)?.getReader(),n=new TextDecoder(`utf-8`);if(!t)throw Error(`Response body is empty`);try{let r=``,i=[`

`,`\r\r`,`\r
\r
`];for(;;){let{done:a,value:o}=yield Z(t.read());if(a){if(r.trim().length>0)throw Error(`Incomplete JSON segment at the end`);break}let s=n.decode(o,{stream:!0});try{let e=JSON.parse(s);if(`error`in e){let t=JSON.parse(JSON.stringify(e.error)),n=t.status,r=t.code,i=`got status: ${n}. ${JSON.stringify(e)}`;if(r>=400&&r<600)throw new Qf({message:i,status:r})}}catch(e){if(e.name===`ApiError`)throw e}r+=s;let c=-1,l=0;for(;;){c=-1,l=0;for(let e of i){let t=r.indexOf(e);t!==-1&&(c===-1||t<c)&&(c=t,l=e.length)}if(c===-1)break;let t=r.substring(0,c);r=r.substring(c+l);let n=t.trim();if(n.startsWith(`data:`)){let t=n.substring(5).trim();try{yield yield Z(new $l(new Response(t,{headers:e?.headers,status:e?.status,statusText:e?.statusText})))}catch(e){throw Error(`exception parsing stream chunk ${t}. ${e}`)}}}}}finally{t.releaseLock()}})}async apiCall(e,t){return fetch(e,t).catch(e=>{throw Error(`exception ${e} sending request`)})}getDefaultHeaders(){let e={},t=tg+` `+this.clientOptions.userAgentExtra;return e[$h]=t,e[eg]=t,e[Zh]=`application/json`,e}async getHeadersInternal(e,t){let n=new Headers;if(e&&e.headers){for(let[t,r]of Object.entries(e.headers))n.append(t,r);e.timeout&&e.timeout>0&&n.append(Qh,String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(n,t),n}getFileName(e){let t=``;return typeof e==`string`&&(t=e.replace(/[/\\]+$/,``),t=t.split(/[/\\]/).pop()??``),t}async uploadFile(e,t){let n={};t!=null&&(n.mimeType=t.mimeType,n.name=t.name,n.displayName=t.displayName),n.name&&!n.name.startsWith(`files/`)&&(n.name=`files/${n.name}`);let r=this.clientOptions.uploader,i=await r.stat(e);n.sizeBytes=String(i.size);let a=t?.mimeType??i.type;if(a===void 0||a===``)throw Error(`Can not determine mimeType. Please provide mimeType in the config.`);n.mimeType=a;let o={file:n},s=this.getFileName(e),c=K(`upload/v1beta/files`,o._url),l=await this.fetchUploadUrl(c,n.sizeBytes,n.mimeType,s,o,t?.httpOptions);return r.upload(e,l,this)}async uploadFileToFileSearchStore(e,t,n){let r=this.clientOptions.uploader,i=await r.stat(t),a=String(i.size),o=n?.mimeType??i.type;if(o===void 0||o===``)throw Error(`Can not determine mimeType. Please provide mimeType in the config.`);let s=`upload/v1beta/${e}:uploadToFileSearchStore`,c=this.getFileName(t),l={};n!=null&&Jh(n,l);let u=await this.fetchUploadUrl(s,a,o,c,l,n?.httpOptions);return r.uploadToFileSearchStore(t,u,this)}async downloadFile(e){await this.clientOptions.downloader.download(e,this)}async fetchUploadUrl(e,t,n,r,i,a){let o={};o=a||{apiVersion:``,headers:Object.assign({"Content-Type":`application/json`,"X-Goog-Upload-Protocol":`resumable`,"X-Goog-Upload-Command":`start`,"X-Goog-Upload-Header-Content-Length":`${t}`,"X-Goog-Upload-Header-Content-Type":`${n}`},r?{"X-Goog-Upload-File-Name":r}:{})};let s=await this.request({path:e,body:JSON.stringify(i),httpMethod:`POST`,httpOptions:o});if(!s||!s?.headers)throw Error(`Server did not return an HttpResponse or the returned HttpResponse did not have headers.`);let c=s?.headers?.[`x-goog-upload-url`];if(c===void 0)throw Error(`Failed to get upload url. Server did not return the x-google-upload-url in the headers`);return c}};async function ag(e){if(e===void 0)throw Error(`response is undefined`);if(!e.ok){let t=e.status,n;n=e.headers.get(`content-type`)?.includes(`application/json`)?await e.json():{error:{message:await e.text(),code:e.status,status:e.statusText}};let r=JSON.stringify(n);throw t>=400&&t<600?new Qf({message:r,status:t}):Error(r)}}function og(e,t){if(!t||Object.keys(t).length===0)return;if(e.body instanceof Blob){console.warn(`includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.`);return}let n={};if(typeof e.body==`string`&&e.body.length>0)try{let t=JSON.parse(e.body);if(typeof t==`object`&&t&&!Array.isArray(t))n=t;else{console.warn(`includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.`);return}}catch{console.warn(`includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.`);return}function r(e,t){let n=Object.assign({},e);for(let e in t)if(Object.prototype.hasOwnProperty.call(t,e)){let i=t[e],a=n[e];i&&typeof i==`object`&&!Array.isArray(i)&&a&&typeof a==`object`&&!Array.isArray(a)?n[e]=r(a,i):(a&&i&&typeof a!=typeof i&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${e}". Original type: ${typeof a}, New type: ${typeof i}. Overwriting.`),n[e]=i)}return n}let i=r(n,t);e.body=JSON.stringify(i)}var sg=`mcp_used/unknown`,cg=!1;function lg(e){for(let t of e)if(dg(t)||typeof t==`object`&&`inputSchema`in t)return!0;return cg}function ug(e){e[eg]=((e[eg]??``)+` ${sg}`).trimStart()}function dg(e){return typeof e==`object`&&!!e&&e instanceof pg}function fg(e){return Wf(this,arguments,function*(e,t=100){let n,r=0;for(;r<t;){let t=yield Z(e.listTools({cursor:n}));for(let e of t.tools)yield yield Z(e),r++;if(!t.nextCursor)break;n=t.nextCursor}})}var pg=class e{constructor(e=[],t){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=t}static create(t,n){return new e(t,n)}async initialize(){var e,t,n,r;if(this.mcpTools.length>0)return;let i={},a=[];for(let l of this.mcpClients)try{for(var o=!0,s=(t=void 0,Gf(fg(l))),c;c=await s.next(),e=c.done,!e;o=!0){r=c.value,o=!1;let e=r;a.push(e);let t=e.name;if(i[t])throw Error(`Duplicate function name ${t} found in MCP tools. Please ensure function names are unique.`);i[t]=l}}catch(e){t={error:e}}finally{try{!o&&!e&&(n=s.return)&&await n.call(s)}finally{if(t)throw t.error}}this.mcpTools=a,this.functionNameToMcpClient=i}async tool(){return await this.initialize(),id(this.mcpTools,this.config)}async callTool(e){await this.initialize();let t=[];for(let n of e)if(n.name in this.functionNameToMcpClient){let e=this.functionNameToMcpClient[n.name],r;this.config.timeout&&(r={timeout:this.config.timeout});let i=await e.callTool({name:n.name,arguments:n.args},void 0,r);t.push({functionResponse:{name:n.name,response:i.isError?{error:i}:i}})}return t}};async function mg(e,t,n){let r=new Tu,i;i=n.data instanceof Blob?JSON.parse(await n.data.text()):JSON.parse(n.data),Object.assign(r,i),t(r)}var hg=class{constructor(e,t,n){this.apiClient=e,this.auth=t,this.webSocketFactory=n}async connect(e){if(this.apiClient.isVertexAI())throw Error(`Live music is not supported for Vertex AI.`);console.warn(`Live music generation is experimental and may change in future versions.`);let t=this.apiClient.getWebsocketBaseUrl(),n=this.apiClient.getApiVersion(),r=vg(this.apiClient.getDefaultHeaders()),i=`${t}/ws/google.ai.generativelanguage.${n}.GenerativeService.BidiGenerateMusic?key=${this.apiClient.getApiKey()}`,a=()=>{},o=new Promise(e=>{a=e}),s=e.callbacks,c=function(){a({})},l=this.apiClient,u={onopen:c,onmessage:e=>{mg(l,s.onmessage,e)},onerror:s?.onerror??function(e){},onclose:s?.onclose??function(e){}},d=this.webSocketFactory.create(i,_g(r),u);d.connect(),await o;let f={setup:{model:Y(this.apiClient,e.model)}};return d.send(JSON.stringify(f)),new gg(d,this.apiClient)}},gg=class{constructor(e,t){this.conn=e,this.apiClient=t}async setWeightedPrompts(e){if(!e.weightedPrompts||Object.keys(e.weightedPrompts).length===0)throw Error(`Weighted prompts must be set and contain at least one entry.`);let t=xp(e);this.conn.send(JSON.stringify({clientContent:t}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||={};let t=bp(e);this.conn.send(JSON.stringify(t))}sendPlaybackControl(e){let t={playbackControl:e};this.conn.send(JSON.stringify(t))}play(){this.sendPlaybackControl(Ql.PLAY)}pause(){this.sendPlaybackControl(Ql.PAUSE)}stop(){this.sendPlaybackControl(Ql.STOP)}resetContext(){this.sendPlaybackControl(Ql.RESET_CONTEXT)}close(){this.conn.close()}};function _g(e){let t={};return e.forEach((e,n)=>{t[n]=e}),t}function vg(e){let t=new Headers;for(let[n,r]of Object.entries(e))t.append(n,r);return t}var yg="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function bg(e,t,n){let r=new wu,i;i=n.data instanceof Blob?await n.data.text():n.data instanceof ArrayBuffer?new TextDecoder().decode(n.data):n.data;let a=JSON.parse(i);if(e.isVertexAI()){let e=wp(a);Object.assign(r,e)}else{let e=a;Object.assign(r,e)}t(r)}var xg=class{constructor(e,t,n){this.apiClient=e,this.auth=t,this.webSocketFactory=n,this.music=new hg(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){if(e.config&&e.config.httpOptions)throw Error(`The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.`);let t=this.apiClient.getWebsocketBaseUrl(),n=this.apiClient.getApiVersion(),r,i=this.apiClient.getHeaders();e.config&&e.config.tools&&lg(e.config.tools)&&ug(i);let a=Tg(i);if(this.apiClient.isVertexAI())r=`${t}/ws/google.cloud.aiplatform.${n}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(a,r);else{let e=this.apiClient.getApiKey(),i=`BidiGenerateContent`,a=`key`;e?.startsWith(`auth_tokens/`)&&(console.warn(`Warning: Ephemeral token support is experimental and may change in future versions.`),n!==`v1alpha`&&console.warn(`Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection.`),i=`BidiGenerateContentConstrained`,a=`access_token`),r=`${t}/ws/google.ai.generativelanguage.${n}.GenerativeService.${i}?${a}=${e}`}let o=()=>{},s=new Promise(e=>{o=e}),c=e.callbacks,l=function(){var e;(e=c?.onopen)==null||e.call(c),o({})},u=this.apiClient,d={onopen:l,onmessage:e=>{bg(u,c.onmessage,e)},onerror:c?.onerror??function(e){},onclose:c?.onclose??function(e){}},f=this.webSocketFactory.create(r,wg(a),d);f.connect(),await s;let p=Y(this.apiClient,e.model);this.apiClient.isVertexAI()&&p.startsWith(`publishers/`)&&(p=`projects/${this.apiClient.getProject()}/locations/${this.apiClient.getLocation()}/`+p);let m={};this.apiClient.isVertexAI()&&e.config?.responseModalities===void 0&&(e.config===void 0?e.config={responseModalities:[gl.AUDIO]}:e.config.responseModalities=[gl.AUDIO]),e.config?.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");let h=e.config?.tools??[],g=[];for(let e of h)if(this.isCallableTool(e)){let t=e;g.push(await t.tool())}else g.push(e);g.length>0&&(e.config.tools=g);let _={model:p,config:e.config,callbacks:e.callbacks};return m=this.apiClient.isVertexAI()?yp(this.apiClient,_):vp(this.apiClient,_),delete m.config,f.send(JSON.stringify(m)),new Cg(f,this.apiClient)}isCallableTool(e){return`callTool`in e&&typeof e.callTool==`function`}},Sg={turnComplete:!0},Cg=class{constructor(e,t){this.conn=e,this.apiClient=t}tLiveClientContent(e,t){if(t.turns!==null&&t.turns!==void 0){let n=[];try{n=Ru(t.turns),e.isVertexAI()||(n=n.map(e=>Lp(e)))}catch{throw Error(`Failed to parse client content "turns", type: '${typeof t.turns}'`)}return{clientContent:{turns:n,turnComplete:t.turnComplete}}}return{clientContent:{turnComplete:t.turnComplete}}}tLiveClienttToolResponse(e,t){let n=[];if(t.functionResponses==null||(n=Array.isArray(t.functionResponses)?t.functionResponses:[t.functionResponses],n.length===0))throw Error(`functionResponses is required.`);for(let t of n){if(typeof t!=`object`||!t||!(`name`in t)||!(`response`in t))throw Error(`Could not parse function response, type '${typeof t}'.`);if(!e.isVertexAI()&&!(`id`in t))throw Error(yg)}return{toolResponse:{functionResponses:n}}}sendClientContent(e){e=Object.assign(Object.assign({},Sg),e);let t=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(t))}sendRealtimeInput(e){let t={};t=this.apiClient.isVertexAI()?{realtimeInput:Cp(e)}:{realtimeInput:Sp(e)},this.conn.send(JSON.stringify(t))}sendToolResponse(e){if(e.functionResponses==null)throw Error(`Tool response parameters are required.`);let t=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(t))}close(){this.conn.close()}};function wg(e){let t={};return e.forEach((e,n)=>{t[n]=e}),t}function Tg(e){let t=new Headers;for(let[n,r]of Object.entries(e))t.append(n,r);return t}var Eg=10;function Dg(e){if(e?.automaticFunctionCalling?.disable)return!0;let t=!1;for(let n of e?.tools??[])if(Og(n)){t=!0;break}if(!t)return!0;let n=e?.automaticFunctionCalling?.maximumRemoteCalls;return n&&(n<0||!Number.isInteger(n))||n==0?(console.warn(`Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:`,n),!0):!1}function Og(e){return`callTool`in e&&typeof e.callTool==`function`}function kg(e){return(e.config?.tools)?.some(e=>Og(e))??!1}function Ag(e){let t=[];return e?.config?.tools&&e.config.tools.forEach((e,n)=>{if(Og(e))return;let r=e;r.functionDeclarations&&r.functionDeclarations.length>0&&t.push(n)}),t}function jg(e){return!e?.automaticFunctionCalling?.ignoreCallHistory}var Mg=class extends Mc{constructor(e){super(),this.apiClient=e,this.generateContent=async e=>{let t=await this.processParamsMaybeAddMcpUsage(e);if(this.maybeMoveToResponseJsonSchem(e),!kg(e)||Dg(e.config))return await this.generateContentInternal(t);let n=Ag(e);if(n.length>0){let e=n.map(e=>`tools[${e}]`).join(`, `);throw Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${e}.`)}let r,i,a=Ru(t.contents),o=t.config?.automaticFunctionCalling?.maximumRemoteCalls??Eg,s=0;for(;s<o&&(r=await this.generateContentInternal(t),!(!r.functionCalls||r.functionCalls.length===0));){let n=r.candidates[0].content,o=[];for(let t of e.config?.tools??[])if(Og(t)){let e=await t.callTool(r.functionCalls);o.push(...e)}s++,i={role:`user`,parts:o},t.contents=Ru(t.contents),t.contents.push(n),t.contents.push(i),jg(t.config)&&(a.push(n),a.push(i))}return jg(t.config)&&(r.automaticFunctionCallingHistory=a),r},this.generateContentStream=async e=>{if(this.maybeMoveToResponseJsonSchem(e),Dg(e.config)){let t=await this.processParamsMaybeAddMcpUsage(e);return await this.generateContentStreamInternal(t)}let t=Ag(e);if(t.length>0){let e=t.map(e=>`tools[${e}]`).join(`, `);throw Error(`Incompatible tools found at ${e}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}let n=e?.config?.toolConfig?.functionCallingConfig?.streamFunctionCallArguments,r=e?.config?.automaticFunctionCalling?.disable;if(n&&!r)throw Error(`Running in streaming mode with 'streamFunctionCallArguments' enabled, this feature is not compatible with automatic function calling (AFC). Please set 'config.automaticFunctionCalling.disable' to true to disable AFC or leave 'config.toolConfig.functionCallingConfig.streamFunctionCallArguments' to be undefined or set to false to disable streaming function call arguments feature.`);return await this.processAfcStream(e)},this.generateImages=async e=>await this.generateImagesInternal(e).then(e=>{let t,n=[];if(e?.generatedImages)for(let r of e.generatedImages)r&&r?.safetyAttributes&&r?.safetyAttributes?.contentType===`Positive Prompt`?t=r?.safetyAttributes:n.push(r);let r;return r=t?{generatedImages:n,positivePromptSafetyAttributes:t,sdkHttpResponse:e.sdkHttpResponse}:{generatedImages:n,sdkHttpResponse:e.sdkHttpResponse},r}),this.list=async e=>{let t={config:Object.assign(Object.assign({},{queryBase:!0}),e?.config)};if(this.apiClient.isVertexAI()&&!t.config.queryBase){if(t.config?.filter)throw Error(`Filtering tuned models list for Vertex AI is not currently supported`);t.config.filter=`labels.tune-type:*`}return new sf(of.PAGED_ITEM_MODELS,e=>this.listInternal(e),await this.listInternal(t),t)},this.editImage=async e=>{let t={model:e.model,prompt:e.prompt,referenceImages:[],config:e.config};return e.referenceImages&&e.referenceImages&&(t.referenceImages=e.referenceImages.map(e=>e.toReferenceImageAPI())),await this.editImageInternal(t)},this.upscaleImage=async e=>{let t={numberOfImages:1,mode:`upscale`};e.config&&(t=Object.assign(Object.assign({},t),e.config));let n={model:e.model,image:e.image,upscaleFactor:e.upscaleFactor,config:t};return await this.upscaleImageInternal(n)},this.generateVideos=async e=>{if((e.prompt||e.image||e.video)&&e.source)throw Error(`Source and prompt/image/video are mutually exclusive. Please only use source.`);return this.apiClient.isVertexAI()||(e.video?.uri&&e.video?.videoBytes?e.video={uri:e.video.uri,mimeType:e.video.mimeType}:e.source?.video?.uri&&e.source?.video?.videoBytes&&(e.source.video={uri:e.source.video.uri,mimeType:e.source.video.mimeType})),await this.generateVideosInternal(e)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&(e.config.responseJsonSchema||Object.keys(e.config.responseSchema).includes(`$schema`)&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema))}async processParamsMaybeAddMcpUsage(e){let t=e.config?.tools;if(!t)return e;let n=await Promise.all(t.map(async e=>Og(e)?await e.tool():e)),r={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:n})};if(r.config.tools=n,e.config&&e.config.tools&&lg(e.config.tools)){let t=e.config.httpOptions?.headers??{},n=Object.assign({},t);Object.keys(n).length===0&&(n=this.apiClient.getDefaultHeaders()),ug(n),r.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:n})}return r}async initAfcToolsMap(e){let t=new Map;for(let n of e.config?.tools??[])if(Og(n)){let e=n,r=await e.tool();for(let n of r.functionDeclarations??[]){if(!n.name)throw Error(`Function declaration name is required.`);if(t.has(n.name))throw Error(`Duplicate tool declaration name: ${n.name}`);t.set(n.name,e)}}return t}async processAfcStream(e){let t=e.config?.automaticFunctionCalling?.maximumRemoteCalls??Eg,n=!1,r=0,i=await this.initAfcToolsMap(e);return(function(e,i,a){return Wf(this,arguments,function*(){for(var o,s,c,l;r<t;){n&&=(r++,!1);let p=yield Z(e.processParamsMaybeAddMcpUsage(a)),m=yield Z(e.generateContentStreamInternal(p)),h=[],g=[];try{for(var u=!0,d=(s=void 0,Gf(m)),f;f=yield Z(d.next()),o=f.done,!o;u=!0){l=f.value,u=!1;let e=l;if(yield yield Z(e),e.candidates&&e.candidates[0]?.content){g.push(e.candidates[0].content);for(let n of e.candidates[0].content.parts??[])if(r<t&&n.functionCall){if(!n.functionCall.name)throw Error(`Function call name was not returned by the model.`);if(i.has(n.functionCall.name)){let e=yield Z(i.get(n.functionCall.name).callTool([n.functionCall]));h.push(...e)}else throw Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${i.keys()}, mising tool: ${n.functionCall.name}`)}}}}catch(e){s={error:e}}finally{try{!u&&!o&&(c=d.return)&&(yield Z(c.call(d)))}finally{if(s)throw s.error}}if(h.length>0){n=!0;let e=new eu;e.candidates=[{content:{role:`user`,parts:h}}],yield yield Z(e);let t=[];t.push(...g),t.push({role:`user`,parts:h}),a.contents=Ru(a.contents).concat(t)}else break}})})(this,i,e)}async generateContentInternal(e){let t,n=``,r={};if(this.apiClient.isVertexAI()){let i=fm(this.apiClient,e);return n=K(`{model}:generateContent`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.request({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`POST`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}).then(e=>e.json().then(t=>{let n=t;return n.sdkHttpResponse={headers:e.headers},n})),t.then(e=>{let t=mm(e),n=new eu;return Object.assign(n,t),n})}else{let i=dm(this.apiClient,e);return n=K(`{model}:generateContent`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.request({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`POST`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}).then(e=>e.json().then(t=>{let n=t;return n.sdkHttpResponse={headers:e.headers},n})),t.then(e=>{let t=pm(e),n=new eu;return Object.assign(n,t),n})}}async generateContentStreamInternal(e){let t,n=``,r={};if(this.apiClient.isVertexAI()){let i=fm(this.apiClient,e);return n=K(`{model}:streamGenerateContent?alt=sse`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.requestStream({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`POST`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}),t.then(function(e){return Wf(this,arguments,function*(){var t,n,r,i;try{for(var a=!0,o=Gf(e),s;s=yield Z(o.next()),t=s.done,!t;a=!0){i=s.value,a=!1;let e=i,t=mm(yield Z(e.json()));t.sdkHttpResponse={headers:e.headers};let n=new eu;Object.assign(n,t),yield yield Z(n)}}catch(e){n={error:e}}finally{try{!a&&!t&&(r=o.return)&&(yield Z(r.call(o)))}finally{if(n)throw n.error}}})})}else{let i=dm(this.apiClient,e);return n=K(`{model}:streamGenerateContent?alt=sse`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.requestStream({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`POST`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}),t.then(function(e){return Wf(this,arguments,function*(){var t,n,r,i;try{for(var a=!0,o=Gf(e),s;s=yield Z(o.next()),t=s.done,!t;a=!0){i=s.value,a=!1;let e=i,t=pm(yield Z(e.json()));t.sdkHttpResponse={headers:e.headers};let n=new eu;Object.assign(n,t),yield yield Z(n)}}catch(e){n={error:e}}finally{try{!a&&!t&&(r=o.return)&&(yield Z(r.call(o)))}finally{if(n)throw n.error}}})})}}async embedContent(e){let t,n=``,r={};if(this.apiClient.isVertexAI()){let i=tm(this.apiClient,e);return n=K(`{model}:predict`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.request({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`POST`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}).then(e=>e.json().then(t=>{let n=t;return n.sdkHttpResponse={headers:e.headers},n})),t.then(e=>{let t=rm(e),n=new tu;return Object.assign(n,t),n})}else{let i=em(this.apiClient,e);return n=K(`{model}:batchEmbedContents`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.request({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`POST`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}).then(e=>e.json().then(t=>{let n=t;return n.sdkHttpResponse={headers:e.headers},n})),t.then(e=>{let t=nm(e),n=new tu;return Object.assign(n,t),n})}}async generateImagesInternal(e){let t,n=``,r={};if(this.apiClient.isVertexAI()){let i=vm(this.apiClient,e);return n=K(`{model}:predict`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.request({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`POST`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}).then(e=>e.json().then(t=>{let n=t;return n.sdkHttpResponse={headers:e.headers},n})),t.then(e=>{let t=bm(e),n=new nu;return Object.assign(n,t),n})}else{let i=_m(this.apiClient,e);return n=K(`{model}:predict`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.request({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`POST`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}).then(e=>e.json().then(t=>{let n=t;return n.sdkHttpResponse={headers:e.headers},n})),t.then(e=>{let t=ym(e),n=new nu;return Object.assign(n,t),n})}}async editImageInternal(e){let t,n=``,r={};if(this.apiClient.isVertexAI()){let i=Xp(this.apiClient,e);return n=K(`{model}:predict`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.request({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`POST`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}).then(e=>e.json().then(t=>{let n=t;return n.sdkHttpResponse={headers:e.headers},n})),t.then(e=>{let t=Zp(e),n=new ru;return Object.assign(n,t),n})}else throw Error(`This method is only supported by the Vertex AI.`)}async upscaleImageInternal(e){let t,n=``,r={};if(this.apiClient.isVertexAI()){let i=Dh(this.apiClient,e);return n=K(`{model}:predict`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.request({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`POST`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}).then(e=>e.json().then(t=>{let n=t;return n.sdkHttpResponse={headers:e.headers},n})),t.then(e=>{let t=Oh(e),n=new iu;return Object.assign(n,t),n})}else throw Error(`This method is only supported by the Vertex AI.`)}async recontextImage(e){let t,n=``,r={};if(this.apiClient.isVertexAI()){let i=ah(this.apiClient,e);return n=K(`{model}:predict`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.request({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`POST`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}).then(e=>e.json()),t.then(e=>{let t=oh(e),n=new au;return Object.assign(n,t),n})}else throw Error(`This method is only supported by the Vertex AI.`)}async segmentImage(e){let t,n=``,r={};if(this.apiClient.isVertexAI()){let i=mh(this.apiClient,e);return n=K(`{model}:predict`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.request({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`POST`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}).then(e=>e.json()),t.then(e=>{let t=hh(e),n=new ou;return Object.assign(n,t),n})}else throw Error(`This method is only supported by the Vertex AI.`)}async get(e){let t,n=``,r={};if(this.apiClient.isVertexAI()){let i=Rm(this.apiClient,e);return n=K(`{name}`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.request({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`GET`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}).then(e=>e.json()),t.then(e=>th(e))}else{let i=Lm(this.apiClient,e);return n=K(`{name}`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.request({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`GET`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}).then(e=>e.json()),t.then(e=>eh(e))}}async listInternal(e){let t,n=``,r={};if(this.apiClient.isVertexAI()){let i=Xm(this.apiClient,e);return n=K(`{models_url}`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.request({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`GET`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}).then(e=>e.json().then(t=>{let n=t;return n.sdkHttpResponse={headers:e.headers},n})),t.then(e=>{let t=Qm(e),n=new su;return Object.assign(n,t),n})}else{let i=Ym(this.apiClient,e);return n=K(`{models_url}`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.request({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`GET`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}).then(e=>e.json().then(t=>{let n=t;return n.sdkHttpResponse={headers:e.headers},n})),t.then(e=>{let t=Zm(e),n=new su;return Object.assign(n,t),n})}}async update(e){let t,n=``,r={};if(this.apiClient.isVertexAI()){let i=Th(this.apiClient,e);return n=K(`{model}`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.request({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`PATCH`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}).then(e=>e.json()),t.then(e=>th(e))}else{let i=wh(this.apiClient,e);return n=K(`{name}`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.request({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`PATCH`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}).then(e=>e.json()),t.then(e=>eh(e))}}async delete(e){let t,n=``,r={};if(this.apiClient.isVertexAI()){let i=Kp(this.apiClient,e);return n=K(`{name}`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.request({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`DELETE`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}).then(e=>e.json().then(t=>{let n=t;return n.sdkHttpResponse={headers:e.headers},n})),t.then(e=>{let t=Jp(e),n=new cu;return Object.assign(n,t),n})}else{let i=Gp(this.apiClient,e);return n=K(`{name}`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.request({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`DELETE`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}).then(e=>e.json().then(t=>{let n=t;return n.sdkHttpResponse={headers:e.headers},n})),t.then(e=>{let t=qp(e),n=new cu;return Object.assign(n,t),n})}}async countTokens(e){let t,n=``,r={};if(this.apiClient.isVertexAI()){let i=Hp(this.apiClient,e);return n=K(`{model}:countTokens`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.request({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`POST`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}).then(e=>e.json().then(t=>{let n=t;return n.sdkHttpResponse={headers:e.headers},n})),t.then(e=>{let t=Wp(e),n=new lu;return Object.assign(n,t),n})}else{let i=Vp(this.apiClient,e);return n=K(`{model}:countTokens`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.request({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`POST`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}).then(e=>e.json().then(t=>{let n=t;return n.sdkHttpResponse={headers:e.headers},n})),t.then(e=>{let t=Up(e),n=new lu;return Object.assign(n,t),n})}}async computeTokens(e){let t,n=``,r={};if(this.apiClient.isVertexAI()){let i=Np(this.apiClient,e);return n=K(`{model}:computeTokens`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.request({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`POST`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}).then(e=>e.json().then(t=>{let n=t;return n.sdkHttpResponse={headers:e.headers},n})),t.then(e=>{let t=Pp(e),n=new uu;return Object.assign(n,t),n})}else throw Error(`This method is only supported by the Vertex AI.`)}async generateVideosInternal(e){let t,n=``,r={};if(this.apiClient.isVertexAI()){let i=Em(this.apiClient,e);return n=K(`{model}:predictLongRunning`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.request({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`POST`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}).then(e=>e.json()),t.then(e=>{let t=wm(e),n=new du;return Object.assign(n,t),n})}else{let i=Tm(this.apiClient,e);return n=K(`{model}:predictLongRunning`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.request({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`POST`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}).then(e=>e.json()),t.then(e=>{let t=Cm(e),n=new du;return Object.assign(n,t),n})}}},Ng=class extends Mc{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){let t=e.operation,n=e.config;if(t.name===void 0||t.name===``)throw Error(`Operation name is required.`);if(this.apiClient.isVertexAI()){let e=t.name.split(`/operations/`)[0],r;n&&`httpOptions`in n&&(r=n.httpOptions);let i=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:e,config:{httpOptions:r}});return t._fromAPIResponse({apiResponse:i,_isVertexAI:!0})}else{let e=await this.getVideosOperationInternal({operationName:t.name,config:n});return t._fromAPIResponse({apiResponse:e,_isVertexAI:!1})}}async get(e){let t=e.operation,n=e.config;if(t.name===void 0||t.name===``)throw Error(`Operation name is required.`);if(this.apiClient.isVertexAI()){let e=t.name.split(`/operations/`)[0],r;n&&`httpOptions`in n&&(r=n.httpOptions);let i=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:e,config:{httpOptions:r}});return t._fromAPIResponse({apiResponse:i,_isVertexAI:!0})}else{let e=await this.getVideosOperationInternal({operationName:t.name,config:n});return t._fromAPIResponse({apiResponse:e,_isVertexAI:!1})}}async getVideosOperationInternal(e){let t,n=``,r={};if(this.apiClient.isVertexAI()){let i=Wc(e);return n=K(`{operationName}`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.request({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`GET`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}).then(e=>e.json()),t}else{let i=Uc(e);return n=K(`{operationName}`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.request({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`GET`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}).then(e=>e.json()),t}}async fetchPredictVideosOperationInternal(e){let t,n=``,r={};if(this.apiClient.isVertexAI()){let i=Ic(e);return n=K(`{resourceName}:fetchPredictOperation`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.request({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`POST`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}).then(e=>e.json()),t}else throw Error(`This method is only supported by the Vertex AI.`)}};function Pg(e){let t={},n=J(e,[`data`]);if(n!=null&&q(t,[`data`],n),J(e,[`displayName`])!==void 0)throw Error(`displayName parameter is not supported in Gemini API.`);let r=J(e,[`mimeType`]);return r!=null&&q(t,[`mimeType`],r),t}function Fg(e){let t={},n=J(e,[`parts`]);if(n!=null){let e=n;Array.isArray(e)&&(e=e.map(e=>Wg(e))),q(t,[`parts`],e)}let r=J(e,[`role`]);return r!=null&&q(t,[`role`],r),t}function Ig(e,t,n){let r={},i=J(t,[`expireTime`]);n!==void 0&&i!=null&&q(n,[`expireTime`],i);let a=J(t,[`newSessionExpireTime`]);n!==void 0&&a!=null&&q(n,[`newSessionExpireTime`],a);let o=J(t,[`uses`]);n!==void 0&&o!=null&&q(n,[`uses`],o);let s=J(t,[`liveConnectConstraints`]);n!==void 0&&s!=null&&q(n,[`bidiGenerateContentSetup`],Ug(e,s));let c=J(t,[`lockAdditionalFields`]);return n!==void 0&&c!=null&&q(n,[`fieldMask`],c),r}function Lg(e,t){let n={},r=J(t,[`config`]);return r!=null&&q(n,[`config`],Ig(e,r,n)),n}function Rg(e){let t={};if(J(e,[`displayName`])!==void 0)throw Error(`displayName parameter is not supported in Gemini API.`);let n=J(e,[`fileUri`]);n!=null&&q(t,[`fileUri`],n);let r=J(e,[`mimeType`]);return r!=null&&q(t,[`mimeType`],r),t}function zg(e){let t={},n=J(e,[`id`]);n!=null&&q(t,[`id`],n);let r=J(e,[`args`]);r!=null&&q(t,[`args`],r);let i=J(e,[`name`]);if(i!=null&&q(t,[`name`],i),J(e,[`partialArgs`])!==void 0)throw Error(`partialArgs parameter is not supported in Gemini API.`);if(J(e,[`willContinue`])!==void 0)throw Error(`willContinue parameter is not supported in Gemini API.`);return t}function Bg(e){let t={};if(J(e,[`authConfig`])!==void 0)throw Error(`authConfig parameter is not supported in Gemini API.`);let n=J(e,[`enableWidget`]);return n!=null&&q(t,[`enableWidget`],n),t}function Vg(e){let t={};if(J(e,[`excludeDomains`])!==void 0)throw Error(`excludeDomains parameter is not supported in Gemini API.`);if(J(e,[`blockingConfidence`])!==void 0)throw Error(`blockingConfidence parameter is not supported in Gemini API.`);let n=J(e,[`timeRangeFilter`]);return n!=null&&q(t,[`timeRangeFilter`],n),t}function Hg(e,t){let n={},r=J(e,[`generationConfig`]);t!==void 0&&r!=null&&q(t,[`setup`,`generationConfig`],r);let i=J(e,[`responseModalities`]);t!==void 0&&i!=null&&q(t,[`setup`,`generationConfig`,`responseModalities`],i);let a=J(e,[`temperature`]);t!==void 0&&a!=null&&q(t,[`setup`,`generationConfig`,`temperature`],a);let o=J(e,[`topP`]);t!==void 0&&o!=null&&q(t,[`setup`,`generationConfig`,`topP`],o);let s=J(e,[`topK`]);t!==void 0&&s!=null&&q(t,[`setup`,`generationConfig`,`topK`],s);let c=J(e,[`maxOutputTokens`]);t!==void 0&&c!=null&&q(t,[`setup`,`generationConfig`,`maxOutputTokens`],c);let l=J(e,[`mediaResolution`]);t!==void 0&&l!=null&&q(t,[`setup`,`generationConfig`,`mediaResolution`],l);let u=J(e,[`seed`]);t!==void 0&&u!=null&&q(t,[`setup`,`generationConfig`,`seed`],u);let d=J(e,[`speechConfig`]);t!==void 0&&d!=null&&q(t,[`setup`,`generationConfig`,`speechConfig`],Uu(d));let f=J(e,[`thinkingConfig`]);t!==void 0&&f!=null&&q(t,[`setup`,`generationConfig`,`thinkingConfig`],f);let p=J(e,[`enableAffectiveDialog`]);t!==void 0&&p!=null&&q(t,[`setup`,`generationConfig`,`enableAffectiveDialog`],p);let m=J(e,[`systemInstruction`]);t!==void 0&&m!=null&&q(t,[`setup`,`systemInstruction`],Fg(X(m)));let h=J(e,[`tools`]);if(t!==void 0&&h!=null){let e=Gu(h);Array.isArray(e)&&(e=e.map(e=>Kg(Wu(e)))),q(t,[`setup`,`tools`],e)}let g=J(e,[`sessionResumption`]);t!==void 0&&g!=null&&q(t,[`setup`,`sessionResumption`],Gg(g));let _=J(e,[`inputAudioTranscription`]);t!==void 0&&_!=null&&q(t,[`setup`,`inputAudioTranscription`],_);let v=J(e,[`outputAudioTranscription`]);t!==void 0&&v!=null&&q(t,[`setup`,`outputAudioTranscription`],v);let y=J(e,[`realtimeInputConfig`]);t!==void 0&&y!=null&&q(t,[`setup`,`realtimeInputConfig`],y);let b=J(e,[`contextWindowCompression`]);t!==void 0&&b!=null&&q(t,[`setup`,`contextWindowCompression`],b);let x=J(e,[`proactivity`]);if(t!==void 0&&x!=null&&q(t,[`setup`,`proactivity`],x),J(e,[`explicitVadSignal`])!==void 0)throw Error(`explicitVadSignal parameter is not supported in Gemini API.`);return n}function Ug(e,t){let n={},r=J(t,[`model`]);r!=null&&q(n,[`setup`,`model`],Y(e,r));let i=J(t,[`config`]);return i!=null&&q(n,[`config`],Hg(i,n)),n}function Wg(e){let t={},n=J(e,[`mediaResolution`]);n!=null&&q(t,[`mediaResolution`],n);let r=J(e,[`codeExecutionResult`]);r!=null&&q(t,[`codeExecutionResult`],r);let i=J(e,[`executableCode`]);i!=null&&q(t,[`executableCode`],i);let a=J(e,[`fileData`]);a!=null&&q(t,[`fileData`],Rg(a));let o=J(e,[`functionCall`]);o!=null&&q(t,[`functionCall`],zg(o));let s=J(e,[`functionResponse`]);s!=null&&q(t,[`functionResponse`],s);let c=J(e,[`inlineData`]);c!=null&&q(t,[`inlineData`],Pg(c));let l=J(e,[`text`]);l!=null&&q(t,[`text`],l);let u=J(e,[`thought`]);u!=null&&q(t,[`thought`],u);let d=J(e,[`thoughtSignature`]);d!=null&&q(t,[`thoughtSignature`],d);let f=J(e,[`videoMetadata`]);return f!=null&&q(t,[`videoMetadata`],f),t}function Gg(e){let t={},n=J(e,[`handle`]);if(n!=null&&q(t,[`handle`],n),J(e,[`transparent`])!==void 0)throw Error(`transparent parameter is not supported in Gemini API.`);return t}function Kg(e){let t={},n=J(e,[`functionDeclarations`]);if(n!=null){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),q(t,[`functionDeclarations`],e)}if(J(e,[`retrieval`])!==void 0)throw Error(`retrieval parameter is not supported in Gemini API.`);let r=J(e,[`googleSearchRetrieval`]);r!=null&&q(t,[`googleSearchRetrieval`],r);let i=J(e,[`computerUse`]);i!=null&&q(t,[`computerUse`],i);let a=J(e,[`fileSearch`]);a!=null&&q(t,[`fileSearch`],a);let o=J(e,[`codeExecution`]);if(o!=null&&q(t,[`codeExecution`],o),J(e,[`enterpriseWebSearch`])!==void 0)throw Error(`enterpriseWebSearch parameter is not supported in Gemini API.`);let s=J(e,[`googleMaps`]);s!=null&&q(t,[`googleMaps`],Bg(s));let c=J(e,[`googleSearch`]);c!=null&&q(t,[`googleSearch`],Vg(c));let l=J(e,[`urlContext`]);return l!=null&&q(t,[`urlContext`],l),t}function qg(e){let t=[];for(let n in e)if(Object.prototype.hasOwnProperty.call(e,n)){let r=e[n];if(typeof r==`object`&&r&&Object.keys(r).length>0){let e=Object.keys(r).map(e=>`${n}.${e}`);t.push(...e)}else t.push(n)}return t.join(`,`)}function Jg(e,t){let n=null,r=e.bidiGenerateContentSetup;if(typeof r==`object`&&r&&`setup`in r){let t=r.setup;typeof t==`object`&&t?(e.bidiGenerateContentSetup=t,n=t):delete e.bidiGenerateContentSetup}else r!==void 0&&delete e.bidiGenerateContentSetup;let i=e.fieldMask;if(n){let r=qg(n);if(Array.isArray(t?.lockAdditionalFields)&&t?.lockAdditionalFields.length===0)r?e.fieldMask=r:delete e.fieldMask;else if(t?.lockAdditionalFields&&t.lockAdditionalFields.length>0&&i!==null&&Array.isArray(i)&&i.length>0){let t=[`temperature`,`topK`,`topP`,`maxOutputTokens`,`responseModalities`,`seed`,`speechConfig`],n=[];i.length>0&&(n=i.map(e=>t.includes(e)?`generationConfig.${e}`:e));let a=[];r&&a.push(r),n.length>0&&a.push(...n),a.length>0?e.fieldMask=a.join(`,`):delete e.fieldMask}else delete e.fieldMask}else i!==null&&Array.isArray(i)&&i.length>0?e.fieldMask=i.join(`,`):delete e.fieldMask;return e}var Yg=class extends Mc{constructor(e){super(),this.apiClient=e}async create(e){let t,n=``,r={};if(this.apiClient.isVertexAI())throw Error(`The client.tokens.create method is only supported by the Gemini Developer API.`);{let i=Lg(this.apiClient,e);n=K(`auth_tokens`,i._url),r=i._query,delete i.config,delete i._url,delete i._query;let a=Jg(i,e.config);return t=this.apiClient.request({path:n,queryParams:r,body:JSON.stringify(a),httpMethod:`POST`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}).then(e=>e.json()),t.then(e=>e)}}};function Xg(e,t){let n={},r=J(e,[`force`]);return t!==void 0&&r!=null&&q(t,[`_query`,`force`],r),n}function Zg(e){let t={},n=J(e,[`name`]);n!=null&&q(t,[`_url`,`name`],n);let r=J(e,[`config`]);return r!=null&&Xg(r,t),t}function Qg(e){let t={},n=J(e,[`name`]);return n!=null&&q(t,[`_url`,`name`],n),t}function $g(e,t){let n={},r=J(e,[`pageSize`]);t!==void 0&&r!=null&&q(t,[`_query`,`pageSize`],r);let i=J(e,[`pageToken`]);return t!==void 0&&i!=null&&q(t,[`_query`,`pageToken`],i),n}function e_(e){let t={},n=J(e,[`parent`]);n!=null&&q(t,[`_url`,`parent`],n);let r=J(e,[`config`]);return r!=null&&$g(r,t),t}function t_(e){let t={},n=J(e,[`sdkHttpResponse`]);n!=null&&q(t,[`sdkHttpResponse`],n);let r=J(e,[`nextPageToken`]);r!=null&&q(t,[`nextPageToken`],r);let i=J(e,[`documents`]);if(i!=null){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),q(t,[`documents`],e)}return t}var n_=class extends Mc{constructor(e){super(),this.apiClient=e,this.list=async e=>new sf(of.PAGED_ITEM_DOCUMENTS,t=>this.listInternal({parent:e.parent,config:t.config}),await this.listInternal(e),e)}async get(e){let t,n=``,r={};if(this.apiClient.isVertexAI())throw Error(`This method is only supported by the Gemini Developer API.`);{let i=Qg(e);return n=K(`{name}`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.request({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`GET`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}).then(e=>e.json()),t.then(e=>e)}}async delete(e){let t=``,n={};if(this.apiClient.isVertexAI())throw Error(`This method is only supported by the Gemini Developer API.`);{let r=Zg(e);t=K(`{name}`,r._url),n=r._query,delete r._url,delete r._query,await this.apiClient.request({path:t,queryParams:n,body:JSON.stringify(r),httpMethod:`DELETE`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal})}}async listInternal(e){let t,n=``,r={};if(this.apiClient.isVertexAI())throw Error(`This method is only supported by the Gemini Developer API.`);{let i=e_(e);return n=K(`{parent}/documents`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.request({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`GET`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}).then(e=>e.json()),t.then(e=>{let t=t_(e),n=new gu;return Object.assign(n,t),n})}}},r_=class extends Mc{constructor(e,t=new n_(e)){super(),this.apiClient=e,this.documents=t,this.list=async(e={})=>new sf(of.PAGED_ITEM_FILE_SEARCH_STORES,e=>this.listInternal(e),await this.listInternal(e),e)}async uploadToFileSearchStore(e){if(this.apiClient.isVertexAI())throw Error(`Vertex AI does not support uploading files to a file search store.`);return this.apiClient.uploadFileToFileSearchStore(e.fileSearchStoreName,e.file,e.config)}async create(e){let t,n=``,r={};if(this.apiClient.isVertexAI())throw Error(`This method is only supported by the Gemini Developer API.`);{let i=Lh(e);return n=K(`fileSearchStores`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.request({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`POST`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}).then(e=>e.json()),t.then(e=>e)}}async get(e){let t,n=``,r={};if(this.apiClient.isVertexAI())throw Error(`This method is only supported by the Gemini Developer API.`);{let i=Bh(e);return n=K(`{name}`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.request({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`GET`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}).then(e=>e.json()),t.then(e=>e)}}async delete(e){let t=``,n={};if(this.apiClient.isVertexAI())throw Error(`This method is only supported by the Gemini Developer API.`);{let r=zh(e);t=K(`{name}`,r._url),n=r._query,delete r._url,delete r._query,await this.apiClient.request({path:t,queryParams:n,body:JSON.stringify(r),httpMethod:`DELETE`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal})}}async listInternal(e){let t,n=``,r={};if(this.apiClient.isVertexAI())throw Error(`This method is only supported by the Gemini Developer API.`);{let i=Kh(e);return n=K(`fileSearchStores`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.request({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`GET`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}).then(e=>e.json()),t.then(e=>{let t=qh(e),n=new _u;return Object.assign(n,t),n})}}async uploadToFileSearchStoreInternal(e){let t,n=``,r={};if(this.apiClient.isVertexAI())throw Error(`This method is only supported by the Gemini Developer API.`);{let i=Yh(e);return n=K(`upload/v1beta/{file_search_store_name}:uploadToFileSearchStore`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.request({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`POST`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}).then(e=>e.json()),t.then(e=>{let t=Xh(e),n=new vu;return Object.assign(n,t),n})}}async importFile(e){let t,n=``,r={};if(this.apiClient.isVertexAI())throw Error(`This method is only supported by the Gemini Developer API.`);{let i=Uh(e);return n=K(`{file_search_store_name}:importFile`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.request({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`POST`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}).then(e=>e.json()),t.then(e=>{let t=Hh(e),n=new yu;return Object.assign(n,t),n})}}},i_=function(){let{crypto:e}=globalThis;if(e?.randomUUID)return i_=e.randomUUID.bind(e),e.randomUUID();let t=new Uint8Array(1),n=e?()=>e.getRandomValues(t)[0]:()=>Math.random()*255&255;return`10000000-1000-4000-8000-100000000000`.replace(/[018]/g,e=>(e^n()&15>>e/4).toString(16))},a_=()=>i_();function o_(e){return typeof e==`object`&&!!e&&(`name`in e&&e.name===`AbortError`||`message`in e&&String(e.message).includes(`FetchRequestCanceledException`))}var s_=e=>{if(e instanceof Error)return e;if(typeof e==`object`&&e){try{if(Object.prototype.toString.call(e)===`[object Error]`){let t=Error(e.message,e.cause?{cause:e.cause}:{});return e.stack&&(t.stack=e.stack),e.cause&&!t.cause&&(t.cause=e.cause),e.name&&(t.name=e.name),t}}catch{}try{return Error(JSON.stringify(e))}catch{}}return Error(e)},c_=class extends Error{},l_=class e extends c_{constructor(t,n,r,i){super(`${e.makeMessage(t,n,r)}`),this.status=t,this.headers=i,this.error=n}static makeMessage(e,t,n){let r=t?.message?typeof t.message==`string`?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&r?`${e} ${r}`:e?`${e} status code (no body)`:r||`(no status code or body)`}static generate(t,n,r,i){if(!t||!i)return new d_({message:r,cause:s_(n)});let a=n;return t===400?new p_(t,a,r,i):t===401?new m_(t,a,r,i):t===403?new h_(t,a,r,i):t===404?new g_(t,a,r,i):t===409?new __(t,a,r,i):t===422?new v_(t,a,r,i):t===429?new y_(t,a,r,i):t>=500?new b_(t,a,r,i):new e(t,a,r,i)}},u_=class extends l_{constructor({message:e}={}){super(void 0,void 0,e||`Request was aborted.`,void 0)}},d_=class extends l_{constructor({message:e,cause:t}){super(void 0,void 0,e||`Connection error.`,void 0),t&&(this.cause=t)}},f_=class extends d_{constructor({message:e}={}){super({message:e??`Request timed out.`})}},p_=class extends l_{},m_=class extends l_{},h_=class extends l_{},g_=class extends l_{},__=class extends l_{},v_=class extends l_{},y_=class extends l_{},b_=class extends l_{},x_=/^[a-z][a-z0-9+.-]*:/i,S_=e=>x_.test(e),C_=e=>(C_=Array.isArray,C_(e)),w_=C_;function T_(e){if(!e)return!0;for(let t in e)return!1;return!0}function E_(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var D_=(e,t)=>{if(typeof t!=`number`||!Number.isInteger(t))throw new c_(`${e} must be an integer`);if(t<0)throw new c_(`${e} must be a positive integer`);return t},O_=e=>{try{return JSON.parse(e)}catch{return}},k_=e=>new Promise(t=>setTimeout(t,e)),A_=`0.0.1`;function j_(){return typeof Deno<`u`&&Deno.build!=null?`deno`:typeof EdgeRuntime<`u`?`edge`:Object.prototype.toString.call(globalThis.process===void 0?0:globalThis.process)===`[object process]`?`node`:`unknown`}var M_=()=>{let e=j_();if(e===`deno`)return{"X-Stainless-Lang":`js`,"X-Stainless-Package-Version":A_,"X-Stainless-OS":F_(Deno.build.os),"X-Stainless-Arch":P_(Deno.build.arch),"X-Stainless-Runtime":`deno`,"X-Stainless-Runtime-Version":typeof Deno.version==`string`?Deno.version:Deno.version?.deno??`unknown`};if(typeof EdgeRuntime<`u`)return{"X-Stainless-Lang":`js`,"X-Stainless-Package-Version":A_,"X-Stainless-OS":`Unknown`,"X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":`edge`,"X-Stainless-Runtime-Version":globalThis.process.version};if(e===`node`)return{"X-Stainless-Lang":`js`,"X-Stainless-Package-Version":A_,"X-Stainless-OS":F_(globalThis.process.platform??`unknown`),"X-Stainless-Arch":P_(globalThis.process.arch??`unknown`),"X-Stainless-Runtime":`node`,"X-Stainless-Runtime-Version":globalThis.process.version??`unknown`};let t=N_();return t?{"X-Stainless-Lang":`js`,"X-Stainless-Package-Version":A_,"X-Stainless-OS":`Unknown`,"X-Stainless-Arch":`unknown`,"X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":`js`,"X-Stainless-Package-Version":A_,"X-Stainless-OS":`Unknown`,"X-Stainless-Arch":`unknown`,"X-Stainless-Runtime":`unknown`,"X-Stainless-Runtime-Version":`unknown`}};function N_(){if(typeof navigator>`u`||!navigator)return null;for(let{key:e,pattern:t}of[{key:`edge`,pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:`ie`,pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:`ie`,pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:`chrome`,pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:`firefox`,pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:`safari`,pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}]){let n=t.exec(navigator.userAgent);if(n)return{browser:e,version:`${n[1]||0}.${n[2]||0}.${n[3]||0}`}}return null}var P_=e=>e===`x32`?`x32`:e===`x86_64`||e===`x64`?`x64`:e===`arm`?`arm`:e===`aarch64`||e===`arm64`?`arm64`:e?`other:${e}`:`unknown`,F_=e=>(e=e.toLowerCase(),e.includes(`ios`)?`iOS`:e===`android`?`Android`:e===`darwin`?`MacOS`:e===`win32`?`Windows`:e===`freebsd`?`FreeBSD`:e===`openbsd`?`OpenBSD`:e===`linux`?`Linux`:e?`Other:${e}`:`Unknown`),I_,L_=()=>I_??=M_();function R_(){if(typeof fetch<`u`)return fetch;throw Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new GeminiNextGenAPIClient({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function z_(...e){let t=globalThis.ReadableStream;if(t===void 0)throw Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new t(...e)}function B_(e){let t=Symbol.asyncIterator in e?e[Symbol.asyncIterator]():e[Symbol.iterator]();return z_({start(){},async pull(e){let{done:n,value:r}=await t.next();n?e.close():e.enqueue(r)},async cancel(){await t.return?.call(t)}})}function V_(e){if(e[Symbol.asyncIterator])return e;let t=e.getReader();return{async next(){try{let e=await t.read();return e?.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){let e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function H_(e){var t;if(typeof e!=`object`||!e)return;if(e[Symbol.asyncIterator]){await(t=e[Symbol.asyncIterator]()).return?.call(t);return}let n=e.getReader(),r=n.cancel();n.releaseLock(),await r}var U_=({headers:e,body:t})=>({bodyHeaders:{"content-type":`application/json`},body:JSON.stringify(t)}),W_=()=>{if(typeof File>`u`){let{process:e}=globalThis,t=typeof e?.versions?.node==`string`&&parseInt(e.versions.node.split(`.`))<20;throw Error("`File` is not defined as a global, which is required for file uploads."+(t?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":``))}};function G_(e,t,n){return W_(),new File(e,t??`unknown_file`,n)}function K_(e){return(typeof e==`object`&&!!e&&(`name`in e&&e.name&&String(e.name)||`url`in e&&e.url&&String(e.url)||`filename`in e&&e.filename&&String(e.filename)||`path`in e&&e.path&&String(e.path))||``).split(/[\\/]/).pop()||void 0}var q_=e=>typeof e==`object`&&!!e&&typeof e[Symbol.asyncIterator]==`function`,J_=e=>typeof e==`object`&&!!e&&typeof e.size==`number`&&typeof e.type==`string`&&typeof e.text==`function`&&typeof e.slice==`function`&&typeof e.arrayBuffer==`function`,Y_=e=>typeof e==`object`&&!!e&&typeof e.name==`string`&&typeof e.lastModified==`number`&&J_(e),X_=e=>typeof e==`object`&&!!e&&typeof e.url==`string`&&typeof e.blob==`function`;async function Z_(e,t,n){if(W_(),e=await e,Y_(e))return e instanceof File?e:G_([await e.arrayBuffer()],e.name);if(X_(e)){let r=await e.blob();return t||=new URL(e.url).pathname.split(/[\\/]/).pop(),G_(await Q_(r),t,n)}let r=await Q_(e);if(t||=K_(e),!n?.type){let e=r.find(e=>typeof e==`object`&&`type`in e&&e.type);typeof e==`string`&&(n=Object.assign(Object.assign({},n),{type:e}))}return G_(r,t,n)}async function Q_(e){var t,n,r,i;let a=[];if(typeof e==`string`||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)a.push(e);else if(J_(e))a.push(e instanceof Blob?e:await e.arrayBuffer());else if(q_(e))try{for(var o=!0,s=Gf(e),c;c=await s.next(),t=c.done,!t;o=!0){i=c.value,o=!1;let e=i;a.push(...await Q_(e))}}catch(e){n={error:e}}finally{try{!o&&!t&&(r=s.return)&&await r.call(s)}finally{if(n)throw n.error}}else{let t=e?.constructor?.name;throw Error(`Unexpected data type: ${typeof e}${t?`; constructor: ${t}`:``}${$_(e)}`)}return a}function $_(e){return typeof e!=`object`||!e?``:`; props: [${Object.getOwnPropertyNames(e).map(e=>`"${e}"`).join(`, `)}]`}var ev=class{constructor(e){this._client=e}};ev._key=[];function tv(e){return e.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}var nv=Object.freeze(Object.create(null)),rv=((e=tv)=>(function(t,...n){if(t.length===1)return t[0];let r=!1,i=[],a=t.reduce((t,a,o)=>{/[?#]/.test(a)&&(r=!0);let s=n[o],c=(r?encodeURIComponent:e)(``+s);return o!==n.length&&(s==null||typeof s==`object`&&s.toString===Object.getPrototypeOf(Object.getPrototypeOf(s.hasOwnProperty??nv)??nv)?.toString)&&(c=s+``,i.push({start:t.length+a.length,length:c.length,error:`Value of type ${Object.prototype.toString.call(s).slice(8,-1)} is not a valid path parameter`})),t+a+(o===n.length?``:c)},``),o=a.split(/[?#]/,1)[0],s=RegExp(`(?<=^|\\/)(?:\\.|%2e){1,2}(?=\\/|$)`,`gi`),c;for(;(c=s.exec(o))!==null;)i.push({start:c.index,length:c[0].length,error:`Value "${c[0]}" can\'t be safely passed as a path parameter`});if(i.sort((e,t)=>e.start-t.start),i.length>0){let e=0,t=i.reduce((t,n)=>{let r=` `.repeat(n.start-e),i=`^`.repeat(n.length);return e=n.start+n.length,t+r+i},``);throw new c_(`Path parameters result in path with invalid segments:\n${i.map(e=>e.error).join(`
`)}\n${a}\n${t}`)}return a}))(tv),iv=class extends ev{create(e,t){let{api_version:n=this._client.apiVersion}=e,r=Hf(e,[`api_version`]);if(`model`in r&&`agent_config`in r)throw new c_("Invalid request: specified `model` and `agent_config`. If specifying `model`, use `generation_config`.");if(`agent`in r&&`generation_config`in r)throw new c_("Invalid request: specified `agent` and `generation_config`. If specifying `agent`, use `agent_config`.");return this._client.post(rv`/${n}/interactions`,Object.assign(Object.assign({body:r},t),{stream:e.stream??!1}))}delete(e,t={},n){let{api_version:r=this._client.apiVersion}=t??{};return this._client.delete(rv`/${r}/interactions/${e}`,n)}cancel(e,t={},n){let{api_version:r=this._client.apiVersion}=t??{};return this._client.post(rv`/${r}/interactions/${e}/cancel`,n)}get(e,t={},n){let r=t??{},{api_version:i=this._client.apiVersion}=r,a=Hf(r,[`api_version`]);return this._client.get(rv`/${i}/interactions/${e}`,Object.assign(Object.assign({query:a},n),{stream:t?.stream??!1}))}};iv._key=Object.freeze([`interactions`]);var av=class extends iv{};function ov(e){let t=0;for(let n of e)t+=n.length;let n=new Uint8Array(t),r=0;for(let t of e)n.set(t,r),r+=t.length;return n}var sv;function cv(e){let t;return(sv??=(t=new globalThis.TextEncoder,t.encode.bind(t)))(e)}var lv;function uv(e){let t;return(lv??=(t=new globalThis.TextDecoder,t.decode.bind(t)))(e)}var dv=class{constructor(){this.buffer=new Uint8Array,this.carriageReturnIndex=null}decode(e){if(e==null)return[];let t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e==`string`?cv(e):e;this.buffer=ov([this.buffer,t]);let n=[],r;for(;(r=fv(this.buffer,this.carriageReturnIndex))!=null;){if(r.carriage&&this.carriageReturnIndex==null){this.carriageReturnIndex=r.index;continue}if(this.carriageReturnIndex!=null&&(r.index!==this.carriageReturnIndex+1||r.carriage)){n.push(uv(this.buffer.subarray(0,this.carriageReturnIndex-1))),this.buffer=this.buffer.subarray(this.carriageReturnIndex),this.carriageReturnIndex=null;continue}let e=this.carriageReturnIndex===null?r.preceding:r.preceding-1,t=uv(this.buffer.subarray(0,e));n.push(t),this.buffer=this.buffer.subarray(r.index),this.carriageReturnIndex=null}return n}flush(){return this.buffer.length?this.decode(`
`):[]}};dv.NEWLINE_CHARS=new Set([`
`,`\r`]),dv.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function fv(e,t){for(let n=t??0;n<e.length;n++){if(e[n]===10)return{preceding:n,index:n+1,carriage:!1};if(e[n]===13)return{preceding:n,index:n+1,carriage:!0}}return null}function pv(e){for(let t=0;t<e.length-1;t++){if(e[t]===10&&e[t+1]===10||e[t]===13&&e[t+1]===13)return t+2;if(e[t]===13&&e[t+1]===10&&t+3<e.length&&e[t+2]===13&&e[t+3]===10)return t+4}return-1}var mv={off:0,error:200,warn:300,info:400,debug:500},hv=(e,t,n)=>{if(e){if(E_(mv,e))return e;Q(n).warn(`${t} was set to ${JSON.stringify(e)}, expected one of ${JSON.stringify(Object.keys(mv))}`)}};function gv(){}function _v(e,t,n){return!t||mv[e]>mv[n]?gv:t[e].bind(t)}var vv={error:gv,warn:gv,info:gv,debug:gv},yv=new WeakMap;function Q(e){let t=e.logger,n=e.logLevel??`off`;if(!t)return vv;let r=yv.get(t);if(r&&r[0]===n)return r[1];let i={error:_v(`error`,t,n),warn:_v(`warn`,t,n),info:_v(`info`,t,n),debug:_v(`debug`,t,n)};return yv.set(t,[n,i]),i}var bv=e=>(e.options&&(e.options=Object.assign({},e.options),delete e.options.headers),e.headers&&=Object.fromEntries((e.headers instanceof Headers?[...e.headers]:Object.entries(e.headers)).map(([e,t])=>[e,e.toLowerCase()===`x-goog-api-key`||e.toLowerCase()===`authorization`||e.toLowerCase()===`cookie`||e.toLowerCase()===`set-cookie`?`***`:t])),`retryOfRequestLogID`in e&&(e.retryOfRequestLogID&&(e.retryOf=e.retryOfRequestLogID),delete e.retryOfRequestLogID),e),xv=class e{constructor(e,t,n){this.iterator=e,this.controller=t,this.client=n}static fromSSEResponse(t,n,r){let i=!1,a=r?Q(r):console;function o(){return Wf(this,arguments,function*(){var e,r,o,s;if(i)throw new c_("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");i=!0;let c=!1;try{try{for(var l=!0,u=Gf(Sv(t,n)),d;d=yield Z(u.next()),e=d.done,!e;l=!0){s=d.value,l=!1;let e=s;if(!c)if(e.data.startsWith(`[DONE]`)){c=!0;continue}else try{yield yield Z(JSON.parse(e.data))}catch(t){throw a.error(`Could not parse message into JSON:`,e.data),a.error(`From chunk:`,e.raw),t}}}catch(e){r={error:e}}finally{try{!l&&!e&&(o=u.return)&&(yield Z(o.call(u)))}finally{if(r)throw r.error}}c=!0}catch(e){if(o_(e))return yield Z(void 0);throw e}finally{c||n.abort()}})}return new e(o,n,r)}static fromReadableStream(t,n,r){let i=!1;function a(){return Wf(this,arguments,function*(){var e,n,r,i;let a=new dv,o=V_(t);try{for(var s=!0,c=Gf(o),l;l=yield Z(c.next()),e=l.done,!e;s=!0){i=l.value,s=!1;let e=i;for(let t of a.decode(e))yield yield Z(t)}}catch(e){n={error:e}}finally{try{!s&&!e&&(r=c.return)&&(yield Z(r.call(c)))}finally{if(n)throw n.error}}for(let e of a.flush())yield yield Z(e)})}function o(){return Wf(this,arguments,function*(){var e,t,r,o;if(i)throw new c_("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");i=!0;let s=!1;try{try{for(var c=!0,l=Gf(a()),u;u=yield Z(l.next()),e=u.done,!e;c=!0){o=u.value,c=!1;let e=o;s||e&&(yield yield Z(JSON.parse(e)))}}catch(e){t={error:e}}finally{try{!c&&!e&&(r=l.return)&&(yield Z(r.call(l)))}finally{if(t)throw t.error}}s=!0}catch(e){if(o_(e))return yield Z(void 0);throw e}finally{s||n.abort()}})}return new e(o,n,r)}[Symbol.asyncIterator](){return this.iterator()}tee(){let t=[],n=[],r=this.iterator(),i=e=>({next:()=>{if(e.length===0){let e=r.next();t.push(e),n.push(e)}return e.shift()}});return[new e(()=>i(t),this.controller,this.client),new e(()=>i(n),this.controller,this.client)]}toReadableStream(){let e=this,t;return z_({async start(){t=e[Symbol.asyncIterator]()},async pull(e){try{let{value:n,done:r}=await t.next();if(r)return e.close();let i=cv(JSON.stringify(n)+`
`);e.enqueue(i)}catch(t){e.error(t)}},async cancel(){await t.return?.call(t)}})}};function Sv(e,t){return Wf(this,arguments,function*(){var n,r,i,a;if(!e.body)throw t.abort(),globalThis.navigator!==void 0&&globalThis.navigator.product===`ReactNative`?new c_(`The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api`):new c_(`Attempted to iterate over a response with no body`);let o=new wv,s=new dv,c=V_(e.body);try{for(var l=!0,u=Gf(Cv(c)),d;d=yield Z(u.next()),n=d.done,!n;l=!0){a=d.value,l=!1;let e=a;for(let t of s.decode(e)){let e=o.decode(t);e&&(yield yield Z(e))}}}catch(e){r={error:e}}finally{try{!l&&!n&&(i=u.return)&&(yield Z(i.call(u)))}finally{if(r)throw r.error}}for(let e of s.flush()){let t=o.decode(e);t&&(yield yield Z(t))}})}function Cv(e){return Wf(this,arguments,function*(){var t,n,r,i;let a=new Uint8Array;try{for(var o=!0,s=Gf(e),c;c=yield Z(s.next()),t=c.done,!t;o=!0){i=c.value,o=!1;let e=i;if(e==null)continue;let t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e==`string`?cv(e):e,n=new Uint8Array(a.length+t.length);n.set(a),n.set(t,a.length),a=n;let r;for(;(r=pv(a))!==-1;)yield yield Z(a.slice(0,r)),a=a.slice(r)}}catch(e){n={error:e}}finally{try{!o&&!t&&(r=s.return)&&(yield Z(r.call(s)))}finally{if(n)throw n.error}}a.length>0&&(yield yield Z(a))})}var wv=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith(`\r`)&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let e={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(`:`))return null;let[t,n,r]=Tv(e,`:`);return r.startsWith(` `)&&(r=r.substring(1)),t===`event`?this.event=r:t===`data`&&this.data.push(r),null}};function Tv(e,t){let n=e.indexOf(t);return n===-1?[e,``,``]:[e.substring(0,n),t,e.substring(n+t.length)]}async function Ev(e,t){let{response:n,requestLogID:r,retryOfRequestLogID:i,startTime:a}=t,o=await(async()=>{if(t.options.stream)return Q(e).debug(`response`,n.status,n.url,n.headers,n.body),t.options.__streamClass?t.options.__streamClass.fromSSEResponse(n,t.controller,e):xv.fromSSEResponse(n,t.controller,e);if(n.status===204)return null;if(t.options.__binaryResponse)return n;let r=(n.headers.get(`content-type`)?.split(`;`)[0])?.trim();return r?.includes(`application/json`)||r?.endsWith(`+json`)?await n.json():await n.text()})();return Q(e).debug(`[${r}] response parsed`,bv({retryOfRequestLogID:i,url:n.url,status:n.status,body:o,durationMs:Date.now()-a})),o}var Dv=class e extends Promise{constructor(e,t,n=Ev){super(e=>{e(null)}),this.responsePromise=t,this.parseResponse=n,this.client=e}_thenUnwrap(t){return new e(this.client,this.responsePromise,async(e,n)=>t(await this.parseResponse(e,n),n))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t}}parse(){return this.parsedPromise||=this.responsePromise.then(e=>this.parseResponse(this.client,e)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}},Ov=Symbol(`brand.privateNullableHeaders`);function*kv(e){if(!e)return;if(Ov in e){let{values:t,nulls:n}=e;yield*t.entries();for(let e of n)yield[e,null];return}let t=!1,n;e instanceof Headers?n=e.entries():w_(e)?n=e:(t=!0,n=Object.entries(e??{}));for(let e of n){let n=e[0];if(typeof n!=`string`)throw TypeError(`expected header name to be a string`);let r=w_(e[1])?e[1]:[e[1]],i=!1;for(let e of r)e!==void 0&&(t&&!i&&(i=!0,yield[n,null]),yield[n,e])}}var Av=e=>{let t=new Headers,n=new Set;for(let r of e){let e=new Set;for(let[i,a]of kv(r)){let r=i.toLowerCase();e.has(r)||(t.delete(i),e.add(r)),a===null?(t.delete(i),n.add(r)):(t.append(i,a),n.delete(r))}}return{[Ov]:!0,values:t,nulls:n}},jv=e=>{var t;if(globalThis.process!==void 0)return({}?.[e])?.trim()??void 0;if(globalThis.Deno!==void 0)return(((t=globalThis.Deno.env)?.get)?.call(t,e))?.trim()},Mv,Nv=class e{constructor(t){var{baseURL:n=jv(`GEMINI_NEXT_GEN_API_BASE_URL`),apiKey:r=jv(`GEMINI_API_KEY`)??null,apiVersion:i=`v1beta`}=t,a=Hf(t,[`baseURL`,`apiKey`,`apiVersion`]);let o=Object.assign(Object.assign({apiKey:r,apiVersion:i},a),{baseURL:n||`https://generativelanguage.googleapis.com`});this.baseURL=o.baseURL,this.timeout=o.timeout??e.DEFAULT_TIMEOUT,this.logger=o.logger??console;let s=`warn`;this.logLevel=s,this.logLevel=hv(o.logLevel,`ClientOptions.logLevel`,this)??hv(jv(`GEMINI_NEXT_GEN_API_LOG`),`process.env['GEMINI_NEXT_GEN_API_LOG']`,this)??s,this.fetchOptions=o.fetchOptions,this.maxRetries=o.maxRetries??2,this.fetch=o.fetch??R_(),this.encoder=U_,this._options=o,this.apiKey=r,this.apiVersion=i,this.clientAdapter=o.clientAdapter}withOptions(e){return new this.constructor(Object.assign(Object.assign(Object.assign({},this._options),{baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,apiVersion:this.apiVersion}),e))}baseURLOverridden(){return this.baseURL!==`https://generativelanguage.googleapis.com`}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){if(!(e.has(`authorization`)||e.has(`x-goog-api-key`))&&!(this.apiKey&&e.get(`x-goog-api-key`))&&!t.has(`x-goog-api-key`))throw Error(`Could not resolve authentication method. Expected the apiKey to be set. Or for the "x-goog-api-key" headers to be explicitly omitted`)}async authHeaders(e){let t=Av([e.headers]);if(!(t.values.has(`authorization`)||t.values.has(`x-goog-api-key`))){if(this.apiKey)return Av([{"x-goog-api-key":this.apiKey}]);if(this.clientAdapter.isVertexAI())return Av([await this.clientAdapter.getAuthHeaders()])}}stringifyQuery(e){return Object.entries(e).filter(([e,t])=>t!==void 0).map(([e,t])=>{if(typeof t==`string`||typeof t==`number`||typeof t==`boolean`)return`${encodeURIComponent(e)}=${encodeURIComponent(t)}`;if(t===null)return`${encodeURIComponent(e)}=`;throw new c_(`Cannot stringify type ${typeof t}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join(`&`)}getUserAgent(){return`${this.constructor.name}/JS ${A_}`}defaultIdempotencyKey(){return`stainless-node-retry-${a_()}`}makeStatusError(e,t,n,r){return l_.generate(e,t,n,r)}buildURL(e,t,n){let r=!this.baseURLOverridden()&&n||this.baseURL,i=S_(e)?new URL(e):new URL(r+(r.endsWith(`/`)&&e.startsWith(`/`)?e.slice(1):e)),a=this.defaultQuery();return T_(a)||(t=Object.assign(Object.assign({},a),t)),typeof t==`object`&&t&&!Array.isArray(t)&&(i.search=this.stringifyQuery(t)),i.toString()}async prepareOptions(e){if(this.clientAdapter&&this.clientAdapter.isVertexAI()&&!e.path.startsWith(`/${this.apiVersion}/projects/`)){let t=e.path.slice(this.apiVersion.length+1);e.path=`/${this.apiVersion}/projects/${this.clientAdapter.getProject()}/locations/${this.clientAdapter.getLocation()}${t}`}}async prepareRequest(e,{url:t,options:n}){}get(e,t){return this.methodRequest(`get`,e,t)}post(e,t){return this.methodRequest(`post`,e,t)}patch(e,t){return this.methodRequest(`patch`,e,t)}put(e,t){return this.methodRequest(`put`,e,t)}delete(e,t){return this.methodRequest(`delete`,e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then(n=>Object.assign({method:e,path:t},n)))}request(e,t=null){return new Dv(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,n){let r=await e,i=r.maxRetries??this.maxRetries;t??=i,await this.prepareOptions(r);let{req:a,url:o,timeout:s}=await this.buildRequest(r,{retryCount:i-t});await this.prepareRequest(a,{url:o,options:r});let c=`log_`+(Math.random()*(1<<24)|0).toString(16).padStart(6,`0`),l=n===void 0?``:`, retryOf: ${n}`,u=Date.now();if(Q(this).debug(`[${c}] sending request`,bv({retryOfRequestLogID:n,method:r.method,url:o,options:r,headers:a.headers})),r.signal?.aborted)throw new u_;let d=new AbortController,f=await this.fetchWithTimeout(o,a,s,d).catch(s_),p=Date.now();if(f instanceof globalThis.Error){let e=`retrying, ${t} attempts remaining`;if(r.signal?.aborted)throw new u_;let i=o_(f)||/timed? ?out/i.test(String(f)+(`cause`in f?String(f.cause):``));if(t)return Q(this).info(`[${c}] connection ${i?`timed out`:`failed`} - ${e}`),Q(this).debug(`[${c}] connection ${i?`timed out`:`failed`} (${e})`,bv({retryOfRequestLogID:n,url:o,durationMs:p-u,message:f.message})),this.retryRequest(r,t,n??c);throw Q(this).info(`[${c}] connection ${i?`timed out`:`failed`} - error; no more retries left`),Q(this).debug(`[${c}] connection ${i?`timed out`:`failed`} (error; no more retries left)`,bv({retryOfRequestLogID:n,url:o,durationMs:p-u,message:f.message})),i?new f_:new d_({cause:f})}let m=`[${c}${l}] ${a.method} ${o} ${f.ok?`succeeded`:`failed`} with status ${f.status} in ${p-u}ms`;if(!f.ok){let e=await this.shouldRetry(f);if(t&&e){let e=`retrying, ${t} attempts remaining`;return await H_(f.body),Q(this).info(`${m} - ${e}`),Q(this).debug(`[${c}] response error (${e})`,bv({retryOfRequestLogID:n,url:f.url,status:f.status,headers:f.headers,durationMs:p-u})),this.retryRequest(r,t,n??c,f.headers)}let i=e?`error; no more retries left`:`error; not retryable`;Q(this).info(`${m} - ${i}`);let a=await f.text().catch(e=>s_(e).message),o=O_(a),s=o?void 0:a;throw Q(this).debug(`[${c}] response error (${i})`,bv({retryOfRequestLogID:n,url:f.url,status:f.status,headers:f.headers,message:s,durationMs:Date.now()-u})),this.makeStatusError(f.status,o,s,f.headers)}return Q(this).info(m),Q(this).debug(`[${c}] response start`,bv({retryOfRequestLogID:n,url:f.url,status:f.status,headers:f.headers,durationMs:p-u})),{response:f,options:r,controller:d,requestLogID:c,retryOfRequestLogID:n,startTime:u}}async fetchWithTimeout(e,t,n,r){let i=t||{},{signal:a,method:o}=i,s=Hf(i,[`signal`,`method`]);a&&a.addEventListener(`abort`,()=>r.abort());let c=setTimeout(()=>r.abort(),n),l=globalThis.ReadableStream&&s.body instanceof globalThis.ReadableStream||typeof s.body==`object`&&s.body!==null&&Symbol.asyncIterator in s.body,u=Object.assign(Object.assign(Object.assign({signal:r.signal},l?{duplex:`half`}:{}),{method:`GET`}),s);o&&(u.method=o.toUpperCase());try{return await this.fetch.call(void 0,e,u)}finally{clearTimeout(c)}}async shouldRetry(e){let t=e.headers.get(`x-should-retry`);return t===`true`?!0:t===`false`?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,n,r){let i,a=r?.get(`retry-after-ms`);if(a){let e=parseFloat(a);Number.isNaN(e)||(i=e)}let o=r?.get(`retry-after`);if(o&&!i){let e=parseFloat(o);i=Number.isNaN(e)?Date.parse(o)-Date.now():e*1e3}if(!(i&&0<=i&&i<60*1e3)){let n=e.maxRetries??this.maxRetries;i=this.calculateDefaultRetryTimeoutMillis(t,n)}return await k_(i),this.makeRequest(e,t-1,n)}calculateDefaultRetryTimeoutMillis(e,t){let n=t-e;return Math.min(.5*2**n,8)*(1-Math.random()*.25)*1e3}async buildRequest(e,{retryCount:t=0}={}){let n=Object.assign({},e),{method:r,path:i,query:a,defaultBaseURL:o}=n,s=this.buildURL(i,a,o);`timeout`in n&&D_(`timeout`,n.timeout),n.timeout=n.timeout??this.timeout;let{bodyHeaders:c,body:l}=this.buildBody({options:n}),u=await this.buildHeaders({options:e,method:r,bodyHeaders:c,retryCount:t});return{req:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({method:r,headers:u},n.signal&&{signal:n.signal}),globalThis.ReadableStream&&l instanceof globalThis.ReadableStream&&{duplex:`half`}),l&&{body:l}),this.fetchOptions??{}),n.fetchOptions??{}),url:s,timeout:n.timeout}}async buildHeaders({options:e,method:t,bodyHeaders:n,retryCount:r}){let i={};this.idempotencyHeader&&t!==`get`&&(e.idempotencyKey||=this.defaultIdempotencyKey(),i[this.idempotencyHeader]=e.idempotencyKey);let a=await this.authHeaders(e),o=Av([i,Object.assign(Object.assign({Accept:`application/json`,"User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(r)},e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{}),L_()),this._options.defaultHeaders,n,e.headers,a]);return this.validateHeaders(o),o.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};let n=Av([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||typeof e==`string`&&n.values.has(`content-type`)||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:typeof e==`object`&&(Symbol.asyncIterator in e||Symbol.iterator in e&&`next`in e&&typeof e.next==`function`)?{bodyHeaders:void 0,body:B_(e)}:this.encoder({body:e,headers:n})}};Nv.DEFAULT_TIMEOUT=6e4;var $=class extends Nv{constructor(){super(...arguments),this.interactions=new av(this)}};Mv=$,$.GeminiNextGenAPIClient=Mv,$.GeminiNextGenAPIClientError=c_,$.APIError=l_,$.APIConnectionError=d_,$.APIConnectionTimeoutError=f_,$.APIUserAbortError=u_,$.NotFoundError=g_,$.ConflictError=__,$.RateLimitError=y_,$.BadRequestError=p_,$.AuthenticationError=m_,$.InternalServerError=b_,$.PermissionDeniedError=h_,$.UnprocessableEntityError=v_,$.toFile=Z_,$.Interactions=av;function Pv(e,t){let n={},r=J(e,[`name`]);return r!=null&&q(n,[`_url`,`name`],r),n}function Fv(e,t){let n={},r=J(e,[`name`]);return r!=null&&q(n,[`_url`,`name`],r),n}function Iv(e,t){let n={},r=J(e,[`sdkHttpResponse`]);return r!=null&&q(n,[`sdkHttpResponse`],r),n}function Lv(e,t){let n={},r=J(e,[`sdkHttpResponse`]);return r!=null&&q(n,[`sdkHttpResponse`],r),n}function Rv(e,t,n){let r={};if(J(e,[`validationDataset`])!==void 0)throw Error(`validationDataset parameter is not supported in Gemini API.`);let i=J(e,[`tunedModelDisplayName`]);if(t!==void 0&&i!=null&&q(t,[`displayName`],i),J(e,[`description`])!==void 0)throw Error(`description parameter is not supported in Gemini API.`);let a=J(e,[`epochCount`]);t!==void 0&&a!=null&&q(t,[`tuningTask`,`hyperparameters`,`epochCount`],a);let o=J(e,[`learningRateMultiplier`]);if(o!=null&&q(r,[`tuningTask`,`hyperparameters`,`learningRateMultiplier`],o),J(e,[`exportLastCheckpointOnly`])!==void 0)throw Error(`exportLastCheckpointOnly parameter is not supported in Gemini API.`);if(J(e,[`preTunedModelCheckpointId`])!==void 0)throw Error(`preTunedModelCheckpointId parameter is not supported in Gemini API.`);if(J(e,[`adapterSize`])!==void 0)throw Error(`adapterSize parameter is not supported in Gemini API.`);let s=J(e,[`batchSize`]);t!==void 0&&s!=null&&q(t,[`tuningTask`,`hyperparameters`,`batchSize`],s);let c=J(e,[`learningRate`]);if(t!==void 0&&c!=null&&q(t,[`tuningTask`,`hyperparameters`,`learningRate`],c),J(e,[`labels`])!==void 0)throw Error(`labels parameter is not supported in Gemini API.`);if(J(e,[`beta`])!==void 0)throw Error(`beta parameter is not supported in Gemini API.`);return r}function zv(e,t,n){let r={},i=J(n,[`config`,`method`]);if(i===void 0&&(i=`SUPERVISED_FINE_TUNING`),i===`SUPERVISED_FINE_TUNING`){let n=J(e,[`validationDataset`]);t!==void 0&&n!=null&&q(t,[`supervisedTuningSpec`],ny(n))}else if(i===`PREFERENCE_TUNING`){let n=J(e,[`validationDataset`]);t!==void 0&&n!=null&&q(t,[`preferenceOptimizationSpec`],ny(n))}let a=J(e,[`tunedModelDisplayName`]);t!==void 0&&a!=null&&q(t,[`tunedModelDisplayName`],a);let o=J(e,[`description`]);t!==void 0&&o!=null&&q(t,[`description`],o);let s=J(n,[`config`,`method`]);if(s===void 0&&(s=`SUPERVISED_FINE_TUNING`),s===`SUPERVISED_FINE_TUNING`){let n=J(e,[`epochCount`]);t!==void 0&&n!=null&&q(t,[`supervisedTuningSpec`,`hyperParameters`,`epochCount`],n)}else if(s===`PREFERENCE_TUNING`){let n=J(e,[`epochCount`]);t!==void 0&&n!=null&&q(t,[`preferenceOptimizationSpec`,`hyperParameters`,`epochCount`],n)}let c=J(n,[`config`,`method`]);if(c===void 0&&(c=`SUPERVISED_FINE_TUNING`),c===`SUPERVISED_FINE_TUNING`){let n=J(e,[`learningRateMultiplier`]);t!==void 0&&n!=null&&q(t,[`supervisedTuningSpec`,`hyperParameters`,`learningRateMultiplier`],n)}else if(c===`PREFERENCE_TUNING`){let n=J(e,[`learningRateMultiplier`]);t!==void 0&&n!=null&&q(t,[`preferenceOptimizationSpec`,`hyperParameters`,`learningRateMultiplier`],n)}let l=J(n,[`config`,`method`]);if(l===void 0&&(l=`SUPERVISED_FINE_TUNING`),l===`SUPERVISED_FINE_TUNING`){let n=J(e,[`exportLastCheckpointOnly`]);t!==void 0&&n!=null&&q(t,[`supervisedTuningSpec`,`exportLastCheckpointOnly`],n)}else if(l===`PREFERENCE_TUNING`){let n=J(e,[`exportLastCheckpointOnly`]);t!==void 0&&n!=null&&q(t,[`preferenceOptimizationSpec`,`exportLastCheckpointOnly`],n)}let u=J(n,[`config`,`method`]);if(u===void 0&&(u=`SUPERVISED_FINE_TUNING`),u===`SUPERVISED_FINE_TUNING`){let n=J(e,[`adapterSize`]);t!==void 0&&n!=null&&q(t,[`supervisedTuningSpec`,`hyperParameters`,`adapterSize`],n)}else if(u===`PREFERENCE_TUNING`){let n=J(e,[`adapterSize`]);t!==void 0&&n!=null&&q(t,[`preferenceOptimizationSpec`,`hyperParameters`,`adapterSize`],n)}if(J(e,[`batchSize`])!==void 0)throw Error(`batchSize parameter is not supported in Vertex AI.`);if(J(e,[`learningRate`])!==void 0)throw Error(`learningRate parameter is not supported in Vertex AI.`);let d=J(e,[`labels`]);t!==void 0&&d!=null&&q(t,[`labels`],d);let f=J(e,[`beta`]);return t!==void 0&&f!=null&&q(t,[`preferenceOptimizationSpec`,`hyperParameters`,`beta`],f),r}function Bv(e,t){let n={},r=J(e,[`baseModel`]);r!=null&&q(n,[`baseModel`],r);let i=J(e,[`preTunedModel`]);i!=null&&q(n,[`preTunedModel`],i);let a=J(e,[`trainingDataset`]);a!=null&&Zv(a);let o=J(e,[`config`]);return o!=null&&Rv(o,n),n}function Vv(e,t){let n={},r=J(e,[`baseModel`]);r!=null&&q(n,[`baseModel`],r);let i=J(e,[`preTunedModel`]);i!=null&&q(n,[`preTunedModel`],i);let a=J(e,[`trainingDataset`]);a!=null&&Qv(a,n,t);let o=J(e,[`config`]);return o!=null&&zv(o,n,t),n}function Hv(e,t){let n={},r=J(e,[`name`]);return r!=null&&q(n,[`_url`,`name`],r),n}function Uv(e,t){let n={},r=J(e,[`name`]);return r!=null&&q(n,[`_url`,`name`],r),n}function Wv(e,t,n){let r={},i=J(e,[`pageSize`]);t!==void 0&&i!=null&&q(t,[`_query`,`pageSize`],i);let a=J(e,[`pageToken`]);t!==void 0&&a!=null&&q(t,[`_query`,`pageToken`],a);let o=J(e,[`filter`]);return t!==void 0&&o!=null&&q(t,[`_query`,`filter`],o),r}function Gv(e,t,n){let r={},i=J(e,[`pageSize`]);t!==void 0&&i!=null&&q(t,[`_query`,`pageSize`],i);let a=J(e,[`pageToken`]);t!==void 0&&a!=null&&q(t,[`_query`,`pageToken`],a);let o=J(e,[`filter`]);return t!==void 0&&o!=null&&q(t,[`_query`,`filter`],o),r}function Kv(e,t){let n={},r=J(e,[`config`]);return r!=null&&Wv(r,n),n}function qv(e,t){let n={},r=J(e,[`config`]);return r!=null&&Gv(r,n),n}function Jv(e,t){let n={},r=J(e,[`sdkHttpResponse`]);r!=null&&q(n,[`sdkHttpResponse`],r);let i=J(e,[`nextPageToken`]);i!=null&&q(n,[`nextPageToken`],i);let a=J(e,[`tunedModels`]);if(a!=null){let e=a;Array.isArray(e)&&(e=e.map(e=>$v(e))),q(n,[`tuningJobs`],e)}return n}function Yv(e,t){let n={},r=J(e,[`sdkHttpResponse`]);r!=null&&q(n,[`sdkHttpResponse`],r);let i=J(e,[`nextPageToken`]);i!=null&&q(n,[`nextPageToken`],i);let a=J(e,[`tuningJobs`]);if(a!=null){let e=a;Array.isArray(e)&&(e=e.map(e=>ey(e))),q(n,[`tuningJobs`],e)}return n}function Xv(e,t){let n={},r=J(e,[`name`]);r!=null&&q(n,[`model`],r);let i=J(e,[`name`]);return i!=null&&q(n,[`endpoint`],i),n}function Zv(e,t){let n={};if(J(e,[`gcsUri`])!==void 0)throw Error(`gcsUri parameter is not supported in Gemini API.`);if(J(e,[`vertexDatasetResource`])!==void 0)throw Error(`vertexDatasetResource parameter is not supported in Gemini API.`);let r=J(e,[`examples`]);if(r!=null){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),q(n,[`examples`,`examples`],e)}return n}function Qv(e,t,n){let r={},i=J(n,[`config`,`method`]);if(i===void 0&&(i=`SUPERVISED_FINE_TUNING`),i===`SUPERVISED_FINE_TUNING`){let n=J(e,[`gcsUri`]);t!==void 0&&n!=null&&q(t,[`supervisedTuningSpec`,`trainingDatasetUri`],n)}else if(i===`PREFERENCE_TUNING`){let n=J(e,[`gcsUri`]);t!==void 0&&n!=null&&q(t,[`preferenceOptimizationSpec`,`trainingDatasetUri`],n)}let a=J(n,[`config`,`method`]);if(a===void 0&&(a=`SUPERVISED_FINE_TUNING`),a===`SUPERVISED_FINE_TUNING`){let n=J(e,[`vertexDatasetResource`]);t!==void 0&&n!=null&&q(t,[`supervisedTuningSpec`,`trainingDatasetUri`],n)}else if(a===`PREFERENCE_TUNING`){let n=J(e,[`vertexDatasetResource`]);t!==void 0&&n!=null&&q(t,[`preferenceOptimizationSpec`,`trainingDatasetUri`],n)}if(J(e,[`examples`])!==void 0)throw Error(`examples parameter is not supported in Vertex AI.`);return r}function $v(e,t){let n={},r=J(e,[`sdkHttpResponse`]);r!=null&&q(n,[`sdkHttpResponse`],r);let i=J(e,[`name`]);i!=null&&q(n,[`name`],i);let a=J(e,[`state`]);a!=null&&q(n,[`state`],Ju(a));let o=J(e,[`createTime`]);o!=null&&q(n,[`createTime`],o);let s=J(e,[`tuningTask`,`startTime`]);s!=null&&q(n,[`startTime`],s);let c=J(e,[`tuningTask`,`completeTime`]);c!=null&&q(n,[`endTime`],c);let l=J(e,[`updateTime`]);l!=null&&q(n,[`updateTime`],l);let u=J(e,[`description`]);u!=null&&q(n,[`description`],u);let d=J(e,[`baseModel`]);d!=null&&q(n,[`baseModel`],d);let f=J(e,[`_self`]);return f!=null&&q(n,[`tunedModel`],Xv(f)),n}function ey(e,t){let n={},r=J(e,[`sdkHttpResponse`]);r!=null&&q(n,[`sdkHttpResponse`],r);let i=J(e,[`name`]);i!=null&&q(n,[`name`],i);let a=J(e,[`state`]);a!=null&&q(n,[`state`],Ju(a));let o=J(e,[`createTime`]);o!=null&&q(n,[`createTime`],o);let s=J(e,[`startTime`]);s!=null&&q(n,[`startTime`],s);let c=J(e,[`endTime`]);c!=null&&q(n,[`endTime`],c);let l=J(e,[`updateTime`]);l!=null&&q(n,[`updateTime`],l);let u=J(e,[`error`]);u!=null&&q(n,[`error`],u);let d=J(e,[`description`]);d!=null&&q(n,[`description`],d);let f=J(e,[`baseModel`]);f!=null&&q(n,[`baseModel`],f);let p=J(e,[`tunedModel`]);p!=null&&q(n,[`tunedModel`],p);let m=J(e,[`preTunedModel`]);m!=null&&q(n,[`preTunedModel`],m);let h=J(e,[`supervisedTuningSpec`]);h!=null&&q(n,[`supervisedTuningSpec`],h);let g=J(e,[`preferenceOptimizationSpec`]);g!=null&&q(n,[`preferenceOptimizationSpec`],g);let _=J(e,[`tuningDataStats`]);_!=null&&q(n,[`tuningDataStats`],_);let v=J(e,[`encryptionSpec`]);v!=null&&q(n,[`encryptionSpec`],v);let y=J(e,[`partnerModelTuningSpec`]);y!=null&&q(n,[`partnerModelTuningSpec`],y);let b=J(e,[`customBaseModel`]);b!=null&&q(n,[`customBaseModel`],b);let x=J(e,[`experiment`]);x!=null&&q(n,[`experiment`],x);let S=J(e,[`labels`]);S!=null&&q(n,[`labels`],S);let C=J(e,[`outputUri`]);C!=null&&q(n,[`outputUri`],C);let w=J(e,[`pipelineJob`]);w!=null&&q(n,[`pipelineJob`],w);let T=J(e,[`serviceAccount`]);T!=null&&q(n,[`serviceAccount`],T);let E=J(e,[`tunedModelDisplayName`]);E!=null&&q(n,[`tunedModelDisplayName`],E);let ee=J(e,[`veoTuningSpec`]);return ee!=null&&q(n,[`veoTuningSpec`],ee),n}function ty(e,t){let n={},r=J(e,[`sdkHttpResponse`]);r!=null&&q(n,[`sdkHttpResponse`],r);let i=J(e,[`name`]);i!=null&&q(n,[`name`],i);let a=J(e,[`metadata`]);a!=null&&q(n,[`metadata`],a);let o=J(e,[`done`]);o!=null&&q(n,[`done`],o);let s=J(e,[`error`]);return s!=null&&q(n,[`error`],s),n}function ny(e,t){let n={},r=J(e,[`gcsUri`]);r!=null&&q(n,[`validationDatasetUri`],r);let i=J(e,[`vertexDatasetResource`]);return i!=null&&q(n,[`validationDatasetUri`],i),n}var ry=class extends Mc{constructor(e){super(),this.apiClient=e,this.list=async(e={})=>new sf(of.PAGED_ITEM_TUNING_JOBS,e=>this.listInternal(e),await this.listInternal(e),e),this.get=async e=>await this.getInternal(e),this.tune=async e=>{if(this.apiClient.isVertexAI())if(e.baseModel.startsWith(`projects/`)){let t={tunedModelName:e.baseModel};e.config?.preTunedModelCheckpointId&&(t.checkpointId=e.config.preTunedModelCheckpointId);let n=Object.assign(Object.assign({},e),{preTunedModel:t});return n.baseModel=void 0,await this.tuneInternal(n)}else{let t=Object.assign({},e);return await this.tuneInternal(t)}else{let t=Object.assign({},e),n=await this.tuneMldevInternal(t),r=``;return n.metadata!==void 0&&n.metadata.tunedModel!==void 0?r=n.metadata.tunedModel:n.name!==void 0&&n.name.includes(`/operations/`)&&(r=n.name.split(`/operations/`)[0]),{name:r,state:bl.JOB_STATE_QUEUED}}}}async getInternal(e){let t,n=``,r={};if(this.apiClient.isVertexAI()){let i=Uv(e);return n=K(`{name}`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.request({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`GET`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}).then(e=>e.json().then(t=>{let n=t;return n.sdkHttpResponse={headers:e.headers},n})),t.then(e=>ey(e))}else{let i=Hv(e);return n=K(`{name}`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.request({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`GET`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}).then(e=>e.json().then(t=>{let n=t;return n.sdkHttpResponse={headers:e.headers},n})),t.then(e=>$v(e))}}async listInternal(e){let t,n=``,r={};if(this.apiClient.isVertexAI()){let i=qv(e);return n=K(`tuningJobs`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.request({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`GET`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}).then(e=>e.json().then(t=>{let n=t;return n.sdkHttpResponse={headers:e.headers},n})),t.then(e=>{let t=Yv(e),n=new fu;return Object.assign(n,t),n})}else{let i=Kv(e);return n=K(`tunedModels`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.request({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`GET`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}).then(e=>e.json().then(t=>{let n=t;return n.sdkHttpResponse={headers:e.headers},n})),t.then(e=>{let t=Jv(e),n=new fu;return Object.assign(n,t),n})}}async cancel(e){let t,n=``,r={};if(this.apiClient.isVertexAI()){let i=Fv(e);return n=K(`{name}:cancel`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.request({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`POST`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}).then(e=>e.json().then(t=>{let n=t;return n.sdkHttpResponse={headers:e.headers},n})),t.then(e=>{let t=Lv(e),n=new pu;return Object.assign(n,t),n})}else{let i=Pv(e);return n=K(`{name}:cancel`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.request({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`POST`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}).then(e=>e.json().then(t=>{let n=t;return n.sdkHttpResponse={headers:e.headers},n})),t.then(e=>{let t=Iv(e),n=new pu;return Object.assign(n,t),n})}}async tuneInternal(e){let t,n=``,r={};if(this.apiClient.isVertexAI()){let i=Vv(e,e);return n=K(`tuningJobs`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.request({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`POST`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}).then(e=>e.json().then(t=>{let n=t;return n.sdkHttpResponse={headers:e.headers},n})),t.then(e=>ey(e))}else throw Error(`This method is only supported by the Vertex AI.`)}async tuneMldevInternal(e){let t,n=``,r={};if(this.apiClient.isVertexAI())throw Error(`This method is only supported by the Gemini Developer API.`);{let i=Bv(e);return n=K(`tunedModels`,i._url),r=i._query,delete i._url,delete i._query,t=this.apiClient.request({path:n,queryParams:r,body:JSON.stringify(i),httpMethod:`POST`,httpOptions:e.config?.httpOptions,abortSignal:e.config?.abortSignal}).then(e=>e.json().then(t=>{let n=t;return n.sdkHttpResponse={headers:e.headers},n})),t.then(e=>ty(e))}}},iy=class{async download(e,t){throw Error(`Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.`)}},ay=1024*1024*8,oy=3,sy=1e3,cy=2,ly=`x-goog-upload-status`;async function uy(e,t,n){let r=await fy(e,t,n),i=await r?.json();if(r?.headers?.[ly]!==`final`)throw Error(`Failed to upload file: Upload status is not finalized.`);return i.file}async function dy(e,t,n){let r=await fy(e,t,n),i=await r?.json();if(r?.headers?.[ly]!==`final`)throw Error(`Failed to upload file: Upload status is not finalized.`);let a=qc(i),o=new Eu;return Object.assign(o,a),o}async function fy(e,t,n){let r=0,i=0,a=new $l(new Response),o=`upload`;for(r=e.size;i<r;){let s=Math.min(ay,r-i),c=e.slice(i,i+s);i+s>=r&&(o+=`, finalize`);let l=0,u=sy;for(;l<oy&&(a=await n.request({path:``,body:c,httpMethod:`POST`,httpOptions:{apiVersion:``,baseUrl:t,headers:{"X-Goog-Upload-Command":o,"X-Goog-Upload-Offset":String(i),"Content-Length":String(s)}}}),!a?.headers?.[ly]);)l++,await my(u),u*=cy;if(i+=s,a?.headers?.[ly]!==`active`)break;if(r<=i)throw Error(`All content has been uploaded, but the upload status is not finalized.`)}return a}async function py(e){return{size:e.size,type:e.type}}function my(e){return new Promise(t=>setTimeout(t,e))}var hy=class{async upload(e,t,n){if(typeof e==`string`)throw Error(`File path is not supported in browser uploader.`);return await uy(e,t,n)}async uploadToFileSearchStore(e,t,n){if(typeof e==`string`)throw Error(`File path is not supported in browser uploader.`);return await dy(e,t,n)}async stat(e){if(typeof e==`string`)throw Error(`File path is not supported in browser uploader.`);return await py(e)}},gy=class{create(e,t,n){return new _y(e,t,n)}},_y=class{constructor(e,t,n){this.url=e,this.headers=t,this.callbacks=n}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw Error(`WebSocket is not connected`);this.ws.send(e)}close(){if(this.ws===void 0)throw Error(`WebSocket is not connected`);this.ws.close()}},vy=`x-goog-api-key`,yy=class{constructor(e){this.apiKey=e}async addAuthHeaders(e,t){if(e.get(vy)===null){if(this.apiKey.startsWith(`auth_tokens/`))throw Error(`Ephemeral tokens are only supported by the live API.`);if(!this.apiKey)throw Error(`API key is missing. Please provide a valid API key.`);e.append(vy,this.apiKey)}}},by=`gl-node/`,xy=class{get interactions(){if(this._interactions!==void 0)return this._interactions;console.warn(`GoogleGenAI.interactions: Interactions usage is experimental and may change in future versions.`);let e=this.httpOptions;return e?.extraBody&&console.warn(`GoogleGenAI.interactions: Client level httpOptions.extraBody is not supported by the interactions client and will be ignored.`),this._interactions=new $({baseURL:this.apiClient.getBaseUrl(),apiKey:this.apiKey,apiVersion:this.apiClient.getApiVersion(),clientAdapter:this.apiClient,defaultHeaders:this.apiClient.getDefaultHeaders(),timeout:e?.timeout}).interactions,this._interactions}constructor(e){if(e.apiKey==null)throw Error(`An API Key must be set when running in a browser`);if(e.project||e.location)throw Error(`Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.`);this.vertexai=e.vertexai??!1,this.apiKey=e.apiKey;let t=jc(e.httpOptions,e.vertexai,void 0,void 0);t&&(e.httpOptions?e.httpOptions.baseUrl=t:e.httpOptions={baseUrl:t}),this.apiVersion=e.apiVersion,this.httpOptions=e.httpOptions;let n=new yy(this.apiKey);this.apiClient=new ig({auth:n,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:this.httpOptions,userAgentExtra:by+`web`,uploader:new hy,downloader:new iy}),this.models=new Mg(this.apiClient),this.live=new xg(this.apiClient,n,new gy),this.batches=new cf(this.apiClient),this.chats=new Xf(this.models,this.apiClient),this.caches=new Vf(this.apiClient),this.files=new sp(this.apiClient),this.operations=new Ng(this.apiClient),this.authTokens=new Yg(this.apiClient),this.tunings=new ry(this.apiClient),this.fileSearchStores=new r_(this.apiClient)}};export{L as i,ol as n,Dc as r,xy as t};